<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MaCh3: SMonolithGPU Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="MaCh3.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mach3logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MaCh3
   &#160;<span id="projectnumber">2.4.0</span>
   </div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classSMonolithGPU-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">SMonolithGPU Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Class responsible for calculating spline weight on GPU.  
 <a href="classSMonolithGPU.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aa19e498d0e762566ee62c7b93de18598"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#aa19e498d0e762566ee62c7b93de18598">SMonolithGPU</a> ()</td></tr>
<tr class="memdesc:aa19e498d0e762566ee62c7b93de18598"><td class="mdescLeft">&#160;</td><td class="mdescRight">constructor  <a href="classSMonolithGPU.html#aa19e498d0e762566ee62c7b93de18598">More...</a><br /></td></tr>
<tr class="separator:aa19e498d0e762566ee62c7b93de18598"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a780471949538f9b359fe9f604491e620"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a780471949538f9b359fe9f604491e620">~SMonolithGPU</a> ()</td></tr>
<tr class="memdesc:a780471949538f9b359fe9f604491e620"><td class="mdescLeft">&#160;</td><td class="mdescRight">destructor  <a href="classSMonolithGPU.html#a780471949538f9b359fe9f604491e620">More...</a><br /></td></tr>
<tr class="separator:a780471949538f9b359fe9f604491e620"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a713a47fd41a93d2b6d40c4b392158aae"><td class="memItemLeft" align="right" valign="top">__host__ void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a713a47fd41a93d2b6d40c4b392158aae">InitGPU_SplineMonolith</a> (float **cpu_total_weights, int n_events, unsigned int total_nknots, unsigned int n_splines, unsigned int n_tf1, int Eve_size)</td></tr>
<tr class="memdesc:a713a47fd41a93d2b6d40c4b392158aae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate memory on gpu for spline monolith.  <a href="classSMonolithGPU.html#a713a47fd41a93d2b6d40c4b392158aae">More...</a><br /></td></tr>
<tr class="separator:a713a47fd41a93d2b6d40c4b392158aae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef41d94cf5e44ebf4fe427c3ce84f20b"><td class="memItemLeft" align="right" valign="top">__host__ void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#aef41d94cf5e44ebf4fe427c3ce84f20b">CopyToGPU_SplineMonolith</a> (<a class="el" href="structSplineMonoStruct.html">SplineMonoStruct</a> *cpu_spline_handler, std::vector&lt; float &gt; cpu_many_array_TF1, std::vector&lt; short int &gt; cpu_paramNo_arr_TF1, int n_events, std::vector&lt; unsigned int &gt; cpu_nParamPerEvent, std::vector&lt; unsigned int &gt; cpu_nParamPerEvent_TF1, int n_params, unsigned int n_splines, short int spline_size, unsigned int total_nknots, unsigned int n_tf1)</td></tr>
<tr class="memdesc:aef41d94cf5e44ebf4fe427c3ce84f20b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies data from CPU to GPU for the spline monolith.  <a href="classSMonolithGPU.html#aef41d94cf5e44ebf4fe427c3ce84f20b">More...</a><br /></td></tr>
<tr class="separator:aef41d94cf5e44ebf4fe427c3ce84f20b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab674ec40c136d89b56b7c25d9337c48a"><td class="memItemLeft" align="right" valign="top">__host__ void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#ab674ec40c136d89b56b7c25d9337c48a">InitGPU_Segments</a> (short int **segment)</td></tr>
<tr class="memdesc:ab674ec40c136d89b56b7c25d9337c48a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate memory for spline segments.  <a href="classSMonolithGPU.html#ab674ec40c136d89b56b7c25d9337c48a">More...</a><br /></td></tr>
<tr class="separator:ab674ec40c136d89b56b7c25d9337c48a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fbbb94f6db65b73a394ab541f94fba6"><td class="memItemLeft" align="right" valign="top">__host__ void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a3fbbb94f6db65b73a394ab541f94fba6">InitGPU_Vals</a> (float **vals)</td></tr>
<tr class="memdesc:a3fbbb94f6db65b73a394ab541f94fba6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate memory for spline segments.  <a href="classSMonolithGPU.html#a3fbbb94f6db65b73a394ab541f94fba6">More...</a><br /></td></tr>
<tr class="separator:a3fbbb94f6db65b73a394ab541f94fba6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8419e01082c64b291c3b38d8e69ceb4d"><td class="memItemLeft" align="right" valign="top">__host__ void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a8419e01082c64b291c3b38d8e69ceb4d">RunGPU_SplineMonolith</a> (float *cpu_total_weights, float *vals, short int *segment, const unsigned int h_n_splines, const unsigned int h_n_tf1)</td></tr>
<tr class="memdesc:a8419e01082c64b291c3b38d8e69ceb4d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run the GPU code for the separate many arrays. As in separate {x}, {y,b,c,d} arrays Pass the segment and the parameter values (binary search already performed in SplineMonolith::FindSplineSegment()  <a href="classSMonolithGPU.html#a8419e01082c64b291c3b38d8e69ceb4d">More...</a><br /></td></tr>
<tr class="separator:a8419e01082c64b291c3b38d8e69ceb4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ca23401d8d99412288952a1d44390ea"><td class="memItemLeft" align="right" valign="top">__host__ void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a1ca23401d8d99412288952a1d44390ea">CleanupGPU_SplineMonolith</a> (float *cpu_total_weights)</td></tr>
<tr class="memdesc:a1ca23401d8d99412288952a1d44390ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function deallocates the resources allocated for the separate {x} and {ybcd} arrays in the and TF1 stuff at GPU.  <a href="classSMonolithGPU.html#a1ca23401d8d99412288952a1d44390ea">More...</a><br /></td></tr>
<tr class="separator:a1ca23401d8d99412288952a1d44390ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5ca949ba6d79666b541350d24e3daaf"><td class="memItemLeft" align="right" valign="top">__host__ void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#af5ca949ba6d79666b541350d24e3daaf">CleanupGPU_Segments</a> (short int *segment, float *vals)</td></tr>
<tr class="memdesc:af5ca949ba6d79666b541350d24e3daaf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean up pinned variables at CPU.  <a href="classSMonolithGPU.html#af5ca949ba6d79666b541350d24e3daaf">More...</a><br /></td></tr>
<tr class="separator:af5ca949ba6d79666b541350d24e3daaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a13324d2fe2a29f7bbff19c55ddd6968c"><td class="memItemLeft" align="right" valign="top">unsigned int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a13324d2fe2a29f7bbff19c55ddd6968c">gpu_nParamPerEvent</a></td></tr>
<tr class="memdesc:a13324d2fe2a29f7bbff19c55ddd6968c"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: GPU map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}.  <a href="classSMonolithGPU.html#a13324d2fe2a29f7bbff19c55ddd6968c">More...</a><br /></td></tr>
<tr class="separator:a13324d2fe2a29f7bbff19c55ddd6968c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60191ebfcba5bedf7e01c923887d5ceb"><td class="memItemLeft" align="right" valign="top">unsigned int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a60191ebfcba5bedf7e01c923887d5ceb">gpu_nParamPerEvent_TF1</a></td></tr>
<tr class="memdesc:a60191ebfcba5bedf7e01c923887d5ceb"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: GPU map keeping track how many parameters applies to each event, we keep two numbers here {number of TF1 per event, index where TF1 start for a given event}.  <a href="classSMonolithGPU.html#a60191ebfcba5bedf7e01c923887d5ceb">More...</a><br /></td></tr>
<tr class="separator:a60191ebfcba5bedf7e01c923887d5ceb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a871589b8a52dea4ed9a4963a7b05e1af"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a871589b8a52dea4ed9a4963a7b05e1af">gpu_coeff_x</a></td></tr>
<tr class="memdesc:a871589b8a52dea4ed9a4963a7b05e1af"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: GPU arrays to hold X coefficient.  <a href="classSMonolithGPU.html#a871589b8a52dea4ed9a4963a7b05e1af">More...</a><br /></td></tr>
<tr class="separator:a871589b8a52dea4ed9a4963a7b05e1af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a51e7b819a0c8cf786aa8f13dfdc0cc"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a5a51e7b819a0c8cf786aa8f13dfdc0cc">gpu_coeff_many</a></td></tr>
<tr class="memdesc:a5a51e7b819a0c8cf786aa8f13dfdc0cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">GPU arrays to hold other coefficients.  <a href="classSMonolithGPU.html#a5a51e7b819a0c8cf786aa8f13dfdc0cc">More...</a><br /></td></tr>
<tr class="separator:a5a51e7b819a0c8cf786aa8f13dfdc0cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac291adc527ef593bb62a8440a131798f"><td class="memItemLeft" align="right" valign="top">unsigned int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#ac291adc527ef593bb62a8440a131798f">gpu_nKnots_arr</a></td></tr>
<tr class="memdesc:ac291adc527ef593bb62a8440a131798f"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: GPU Number of knots per spline.  <a href="classSMonolithGPU.html#ac291adc527ef593bb62a8440a131798f">More...</a><br /></td></tr>
<tr class="separator:ac291adc527ef593bb62a8440a131798f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8f091bec85671c4f96a2d0d9dbe4243"><td class="memItemLeft" align="right" valign="top">short int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#ae8f091bec85671c4f96a2d0d9dbe4243">gpu_paramNo_arr</a></td></tr>
<tr class="memdesc:ae8f091bec85671c4f96a2d0d9dbe4243"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: GPU array with the number of points per spline (not per spline point!)  <a href="classSMonolithGPU.html#ae8f091bec85671c4f96a2d0d9dbe4243">More...</a><br /></td></tr>
<tr class="separator:ae8f091bec85671c4f96a2d0d9dbe4243"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae58804bb65745dbd8835876bf0debdc7"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#ae58804bb65745dbd8835876bf0debdc7">gpu_coeff_TF1_many</a></td></tr>
<tr class="memdesc:ae58804bb65745dbd8835876bf0debdc7"><td class="mdescLeft">&#160;</td><td class="mdescRight">GPU arrays to hold TF1 coefficients.  <a href="classSMonolithGPU.html#ae58804bb65745dbd8835876bf0debdc7">More...</a><br /></td></tr>
<tr class="separator:ae58804bb65745dbd8835876bf0debdc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa84c07d3cda1c29b039a0fd3778c0c0f"><td class="memItemLeft" align="right" valign="top">short int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#aa84c07d3cda1c29b039a0fd3778c0c0f">gpu_nPoints_arr</a></td></tr>
<tr class="memdesc:aa84c07d3cda1c29b039a0fd3778c0c0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">GPU arrays to hold number of points.  <a href="classSMonolithGPU.html#aa84c07d3cda1c29b039a0fd3778c0c0f">More...</a><br /></td></tr>
<tr class="separator:aa84c07d3cda1c29b039a0fd3778c0c0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f8de24623a787f9f728bdd0b735c89c"><td class="memItemLeft" align="right" valign="top">short int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a2f8de24623a787f9f728bdd0b735c89c">gpu_paramNo_TF1_arr</a></td></tr>
<tr class="memdesc:a2f8de24623a787f9f728bdd0b735c89c"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: GPU array with the number of points per TF1 object.  <a href="classSMonolithGPU.html#a2f8de24623a787f9f728bdd0b735c89c">More...</a><br /></td></tr>
<tr class="separator:a2f8de24623a787f9f728bdd0b735c89c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5007136ab5e2fdbf3b9387e14a1c64a"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#af5007136ab5e2fdbf3b9387e14a1c64a">gpu_total_weights</a></td></tr>
<tr class="memdesc:af5007136ab5e2fdbf3b9387e14a1c64a"><td class="mdescLeft">&#160;</td><td class="mdescRight">GPU arrays to hold weight for event.  <a href="classSMonolithGPU.html#af5007136ab5e2fdbf3b9387e14a1c64a">More...</a><br /></td></tr>
<tr class="separator:af5007136ab5e2fdbf3b9387e14a1c64a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f29d521544dd4bb64e6f2bfd68c21af"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a4f29d521544dd4bb64e6f2bfd68c21af">gpu_weights</a></td></tr>
<tr class="memdesc:a4f29d521544dd4bb64e6f2bfd68c21af"><td class="mdescLeft">&#160;</td><td class="mdescRight">GPU arrays to hold weight for each spline.  <a href="classSMonolithGPU.html#a4f29d521544dd4bb64e6f2bfd68c21af">More...</a><br /></td></tr>
<tr class="separator:a4f29d521544dd4bb64e6f2bfd68c21af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5d038b66802271bbaf8f0c06704e5da"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#ab5d038b66802271bbaf8f0c06704e5da">gpu_weights_tf1</a></td></tr>
<tr class="memdesc:ab5d038b66802271bbaf8f0c06704e5da"><td class="mdescLeft">&#160;</td><td class="mdescRight">GPU arrays to hold weight for each TF1.  <a href="classSMonolithGPU.html#ab5d038b66802271bbaf8f0c06704e5da">More...</a><br /></td></tr>
<tr class="separator:ab5d038b66802271bbaf8f0c06704e5da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad36c112081992f2887fe24675f4bba06"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#ad36c112081992f2887fe24675f4bba06">h_n_params</a></td></tr>
<tr class="memdesc:ad36c112081992f2887fe24675f4bba06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of params living on CPU.  <a href="classSMonolithGPU.html#ad36c112081992f2887fe24675f4bba06">More...</a><br /></td></tr>
<tr class="separator:ad36c112081992f2887fe24675f4bba06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4628e4d9bb58650086cf51098c996059"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a4628e4d9bb58650086cf51098c996059">h_n_events</a></td></tr>
<tr class="memdesc:a4628e4d9bb58650086cf51098c996059"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of events living on CPU.  <a href="classSMonolithGPU.html#a4628e4d9bb58650086cf51098c996059">More...</a><br /></td></tr>
<tr class="separator:a4628e4d9bb58650086cf51098c996059"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fb766b50293e6b611c45aa21c5c1b9c"><td class="memItemLeft" align="right" valign="top">cudaTextureObject_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a1fb766b50293e6b611c45aa21c5c1b9c">text_coeff_x</a> = 0</td></tr>
<tr class="memdesc:a1fb766b50293e6b611c45aa21c5c1b9c"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Textures are L1 cache variables which are well optimised for fetching. Make texture only for variables you often access but rarely overwrite. There are limits on texture memory so don't use huge arrays.  <a href="classSMonolithGPU.html#a1fb766b50293e6b611c45aa21c5c1b9c">More...</a><br /></td></tr>
<tr class="separator:a1fb766b50293e6b611c45aa21c5c1b9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a663a150b3464b28d6161df1924cd534f"><td class="memItemLeft" align="right" valign="top">cudaTextureObject_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a663a150b3464b28d6161df1924cd534f">text_nParamPerEvent</a> = 0</td></tr>
<tr class="memdesc:a663a150b3464b28d6161df1924cd534f"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}.  <a href="classSMonolithGPU.html#a663a150b3464b28d6161df1924cd534f">More...</a><br /></td></tr>
<tr class="separator:a663a150b3464b28d6161df1924cd534f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a089fd1b491667e60d06c3713cd45552e"><td class="memItemLeft" align="right" valign="top">cudaTextureObject_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolithGPU.html#a089fd1b491667e60d06c3713cd45552e">text_nParamPerEvent_TF1</a> = 0</td></tr>
<tr class="memdesc:a089fd1b491667e60d06c3713cd45552e"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Map keeping track how many parameters applies to each event, we keep two numbers here {number of TF1 per event, index where TF1 start for a given event}.  <a href="classSMonolithGPU.html#a089fd1b491667e60d06c3713cd45552e">More...</a><br /></td></tr>
<tr class="separator:a089fd1b491667e60d06c3713cd45552e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class responsible for calculating spline weight on GPU. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00061">61</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="aa19e498d0e762566ee62c7b93de18598"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa19e498d0e762566ee62c7b93de18598">&#9670;&nbsp;</a></span>SMonolithGPU()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SMonolithGPU::SMonolithGPU </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>constructor </p>
<p>Number of events living on CPU</p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cu_source.html#l00081">81</a> of file <a class="el" href="gpuSplineUtils_8cu_source.html">gpuSplineUtils.cu</a>.</p>
<div class="fragment"><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                           {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <a class="code" href="classSMonolithGPU.html#ad36c112081992f2887fe24675f4bba06">h_n_params</a>     = -1;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="classSMonolithGPU.html#a4628e4d9bb58650086cf51098c996059">h_n_events</a> = -1;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="classSMonolithGPU.html#a4f29d521544dd4bb64e6f2bfd68c21af">gpu_weights</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <a class="code" href="classSMonolithGPU.html#af5007136ab5e2fdbf3b9387e14a1c64a">gpu_total_weights</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="classSMonolithGPU.html#a13324d2fe2a29f7bbff19c55ddd6968c">gpu_nParamPerEvent</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <a class="code" href="classSMonolithGPU.html#aa84c07d3cda1c29b039a0fd3778c0c0f">gpu_nPoints_arr</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="classSMonolithGPU.html#ae8f091bec85671c4f96a2d0d9dbe4243">gpu_paramNo_arr</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="classSMonolithGPU.html#ac291adc527ef593bb62a8440a131798f">gpu_nKnots_arr</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <a class="code" href="classSMonolithGPU.html#a871589b8a52dea4ed9a4963a7b05e1af">gpu_coeff_x</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <a class="code" href="classSMonolithGPU.html#a5a51e7b819a0c8cf786aa8f13dfdc0cc">gpu_coeff_many</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="classSMonolithGPU.html#ae58804bb65745dbd8835876bf0debdc7">gpu_coeff_TF1_many</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <a class="code" href="classSMonolithGPU.html#a2f8de24623a787f9f728bdd0b735c89c">gpu_paramNo_TF1_arr</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <a class="code" href="classSMonolithGPU.html#a60191ebfcba5bedf7e01c923887d5ceb">gpu_nParamPerEvent_TF1</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="classSMonolithGPU.html#ab5d038b66802271bbaf8f0c06704e5da">gpu_weights_tf1</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;}</div>
<div class="ttc" id="aclassSMonolithGPU_html_a13324d2fe2a29f7bbff19c55ddd6968c"><div class="ttname"><a href="classSMonolithGPU.html#a13324d2fe2a29f7bbff19c55ddd6968c">SMonolithGPU::gpu_nParamPerEvent</a></div><div class="ttdeci">unsigned int * gpu_nParamPerEvent</div><div class="ttdoc">KS: GPU map keeping track how many parameters applies to each event, we keep two numbers here {number...</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00184">gpuSplineUtils.cuh:184</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_a2f8de24623a787f9f728bdd0b735c89c"><div class="ttname"><a href="classSMonolithGPU.html#a2f8de24623a787f9f728bdd0b735c89c">SMonolithGPU::gpu_paramNo_TF1_arr</a></div><div class="ttdeci">short int * gpu_paramNo_TF1_arr</div><div class="ttdoc">CW: GPU array with the number of points per TF1 object.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00205">gpuSplineUtils.cuh:205</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_a4628e4d9bb58650086cf51098c996059"><div class="ttname"><a href="classSMonolithGPU.html#a4628e4d9bb58650086cf51098c996059">SMonolithGPU::h_n_events</a></div><div class="ttdeci">int h_n_events</div><div class="ttdoc">Number of events living on CPU.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00218">gpuSplineUtils.cuh:218</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_a4f29d521544dd4bb64e6f2bfd68c21af"><div class="ttname"><a href="classSMonolithGPU.html#a4f29d521544dd4bb64e6f2bfd68c21af">SMonolithGPU::gpu_weights</a></div><div class="ttdeci">float * gpu_weights</div><div class="ttdoc">GPU arrays to hold weight for each spline.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00210">gpuSplineUtils.cuh:210</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_a5a51e7b819a0c8cf786aa8f13dfdc0cc"><div class="ttname"><a href="classSMonolithGPU.html#a5a51e7b819a0c8cf786aa8f13dfdc0cc">SMonolithGPU::gpu_coeff_many</a></div><div class="ttdeci">float * gpu_coeff_many</div><div class="ttdoc">GPU arrays to hold other coefficients.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00192">gpuSplineUtils.cuh:192</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_a60191ebfcba5bedf7e01c923887d5ceb"><div class="ttname"><a href="classSMonolithGPU.html#a60191ebfcba5bedf7e01c923887d5ceb">SMonolithGPU::gpu_nParamPerEvent_TF1</a></div><div class="ttdeci">unsigned int * gpu_nParamPerEvent_TF1</div><div class="ttdoc">KS: GPU map keeping track how many parameters applies to each event, we keep two numbers here {number...</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00186">gpuSplineUtils.cuh:186</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_a871589b8a52dea4ed9a4963a7b05e1af"><div class="ttname"><a href="classSMonolithGPU.html#a871589b8a52dea4ed9a4963a7b05e1af">SMonolithGPU::gpu_coeff_x</a></div><div class="ttdeci">float * gpu_coeff_x</div><div class="ttdoc">KS: GPU arrays to hold X coefficient.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00189">gpuSplineUtils.cuh:189</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_aa84c07d3cda1c29b039a0fd3778c0c0f"><div class="ttname"><a href="classSMonolithGPU.html#aa84c07d3cda1c29b039a0fd3778c0c0f">SMonolithGPU::gpu_nPoints_arr</a></div><div class="ttdeci">short int * gpu_nPoints_arr</div><div class="ttdoc">GPU arrays to hold number of points.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00203">gpuSplineUtils.cuh:203</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_ab5d038b66802271bbaf8f0c06704e5da"><div class="ttname"><a href="classSMonolithGPU.html#ab5d038b66802271bbaf8f0c06704e5da">SMonolithGPU::gpu_weights_tf1</a></div><div class="ttdeci">float * gpu_weights_tf1</div><div class="ttdoc">GPU arrays to hold weight for each TF1.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00212">gpuSplineUtils.cuh:212</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_ac291adc527ef593bb62a8440a131798f"><div class="ttname"><a href="classSMonolithGPU.html#ac291adc527ef593bb62a8440a131798f">SMonolithGPU::gpu_nKnots_arr</a></div><div class="ttdeci">unsigned int * gpu_nKnots_arr</div><div class="ttdoc">KS: GPU Number of knots per spline.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00195">gpuSplineUtils.cuh:195</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_ad36c112081992f2887fe24675f4bba06"><div class="ttname"><a href="classSMonolithGPU.html#ad36c112081992f2887fe24675f4bba06">SMonolithGPU::h_n_params</a></div><div class="ttdeci">int h_n_params</div><div class="ttdoc">Number of params living on CPU.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00216">gpuSplineUtils.cuh:216</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_ae58804bb65745dbd8835876bf0debdc7"><div class="ttname"><a href="classSMonolithGPU.html#ae58804bb65745dbd8835876bf0debdc7">SMonolithGPU::gpu_coeff_TF1_many</a></div><div class="ttdeci">float * gpu_coeff_TF1_many</div><div class="ttdoc">GPU arrays to hold TF1 coefficients.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00201">gpuSplineUtils.cuh:201</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_ae8f091bec85671c4f96a2d0d9dbe4243"><div class="ttname"><a href="classSMonolithGPU.html#ae8f091bec85671c4f96a2d0d9dbe4243">SMonolithGPU::gpu_paramNo_arr</a></div><div class="ttdeci">short int * gpu_paramNo_arr</div><div class="ttdoc">CW: GPU array with the number of points per spline (not per spline point!)</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00198">gpuSplineUtils.cuh:198</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_af5007136ab5e2fdbf3b9387e14a1c64a"><div class="ttname"><a href="classSMonolithGPU.html#af5007136ab5e2fdbf3b9387e14a1c64a">SMonolithGPU::gpu_total_weights</a></div><div class="ttdeci">float * gpu_total_weights</div><div class="ttdoc">GPU arrays to hold weight for event.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00208">gpuSplineUtils.cuh:208</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a780471949538f9b359fe9f604491e620"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a780471949538f9b359fe9f604491e620">&#9670;&nbsp;</a></span>~SMonolithGPU()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">SMonolithGPU::~SMonolithGPU </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>destructor </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cu_source.html#l00100">100</a> of file <a class="el" href="gpuSplineUtils_8cu_source.html">gpuSplineUtils.cu</a>.</p>
<div class="fragment"><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                            {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="af5ca949ba6d79666b541350d24e3daaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5ca949ba6d79666b541350d24e3daaf">&#9670;&nbsp;</a></span>CleanupGPU_Segments()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__host__ void SMonolithGPU::CleanupGPU_Segments </td>
          <td>(</td>
          <td class="paramtype">short int *&#160;</td>
          <td class="paramname"><em>segment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>vals</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clean up pinned variables at CPU. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">segment</td><td>Found spline segment for each parameter </td></tr>
    <tr><td class="paramname">vals</td><td>Value to which we want reweight for each parameter </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cu_source.html#l00584">584</a> of file <a class="el" href="gpuSplineUtils_8cu_source.html">gpuSplineUtils.cu</a>.</p>
<div class="fragment"><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                                                                               {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">// *******************************************</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  cudaFreeHost(segment);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  cudaFreeHost(vals);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  segment = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  vals = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1ca23401d8d99412288952a1d44390ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ca23401d8d99412288952a1d44390ea">&#9670;&nbsp;</a></span>CleanupGPU_SplineMonolith()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__host__ void SMonolithGPU::CleanupGPU_SplineMonolith </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>cpu_total_weights</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function deallocates the resources allocated for the separate {x} and {ybcd} arrays in the and TF1 stuff at GPU. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cpu_total_weights</td><td>Pointer to the total weights array on the CPU (used if <code>Weight_On_SplineBySpline_Basis</code> is not defined). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cu_source.html#l00549">549</a> of file <a class="el" href="gpuSplineUtils_8cu_source.html">gpuSplineUtils.cu</a>.</p>
<div class="fragment"><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">// *********************************</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  cudaFree(<a class="code" href="classSMonolithGPU.html#ae8f091bec85671c4f96a2d0d9dbe4243">gpu_paramNo_arr</a>);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  cudaFree(<a class="code" href="classSMonolithGPU.html#ac291adc527ef593bb62a8440a131798f">gpu_nKnots_arr</a>);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="comment">// free the coefficient arrays</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  cudaDestroyTextureObject(<a class="code" href="classSMonolithGPU.html#a1fb766b50293e6b611c45aa21c5c1b9c">text_coeff_x</a>);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160; </div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  cudaFree(<a class="code" href="classSMonolithGPU.html#a871589b8a52dea4ed9a4963a7b05e1af">gpu_coeff_x</a>);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  cudaFree(<a class="code" href="classSMonolithGPU.html#a5a51e7b819a0c8cf786aa8f13dfdc0cc">gpu_coeff_many</a>);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  cudaFree(<a class="code" href="classSMonolithGPU.html#ae58804bb65745dbd8835876bf0debdc7">gpu_coeff_TF1_many</a>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  cudaFree(<a class="code" href="classSMonolithGPU.html#a2f8de24623a787f9f728bdd0b735c89c">gpu_paramNo_TF1_arr</a>);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="comment">// free weights on the gpu</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  cudaFree(<a class="code" href="classSMonolithGPU.html#a4f29d521544dd4bb64e6f2bfd68c21af">gpu_weights</a>);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  cudaFree(<a class="code" href="classSMonolithGPU.html#ab5d038b66802271bbaf8f0c06704e5da">gpu_weights_tf1</a>);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="preprocessor">#ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  cudaFree(<a class="code" href="classSMonolithGPU.html#af5007136ab5e2fdbf3b9387e14a1c64a">gpu_total_weights</a>);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="comment">//KS: Before removing variable let&#39;s destroy texture</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  cudaDestroyTextureObject(<a class="code" href="classSMonolithGPU.html#a663a150b3464b28d6161df1924cd534f">text_nParamPerEvent</a>);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  cudaDestroyTextureObject(<a class="code" href="classSMonolithGPU.html#a089fd1b491667e60d06c3713cd45552e">text_nParamPerEvent_TF1</a>);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  cudaFree(<a class="code" href="classSMonolithGPU.html#a13324d2fe2a29f7bbff19c55ddd6968c">gpu_nParamPerEvent</a>);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  cudaFree(<a class="code" href="classSMonolithGPU.html#a60191ebfcba5bedf7e01c923887d5ceb">gpu_nParamPerEvent_TF1</a>);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  cudaFreeHost(cpu_total_weights);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  cpu_total_weights = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}</div>
<div class="ttc" id="aclassSMonolithGPU_html_a089fd1b491667e60d06c3713cd45552e"><div class="ttname"><a href="classSMonolithGPU.html#a089fd1b491667e60d06c3713cd45552e">SMonolithGPU::text_nParamPerEvent_TF1</a></div><div class="ttdeci">cudaTextureObject_t text_nParamPerEvent_TF1</div><div class="ttdoc">KS: Map keeping track how many parameters applies to each event, we keep two numbers here {number of ...</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00229">gpuSplineUtils.cuh:229</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_a1fb766b50293e6b611c45aa21c5c1b9c"><div class="ttname"><a href="classSMonolithGPU.html#a1fb766b50293e6b611c45aa21c5c1b9c">SMonolithGPU::text_coeff_x</a></div><div class="ttdeci">cudaTextureObject_t text_coeff_x</div><div class="ttdoc">KS: Textures are L1 cache variables which are well optimised for fetching. Make texture only for vari...</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00224">gpuSplineUtils.cuh:224</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_a663a150b3464b28d6161df1924cd534f"><div class="ttname"><a href="classSMonolithGPU.html#a663a150b3464b28d6161df1924cd534f">SMonolithGPU::text_nParamPerEvent</a></div><div class="ttdeci">cudaTextureObject_t text_nParamPerEvent</div><div class="ttdoc">KS: Map keeping track how many parameters applies to each event, we keep two numbers here {number of ...</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00227">gpuSplineUtils.cuh:227</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aef41d94cf5e44ebf4fe427c3ce84f20b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef41d94cf5e44ebf4fe427c3ce84f20b">&#9670;&nbsp;</a></span>CopyToGPU_SplineMonolith()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__host__ void SMonolithGPU::CopyToGPU_SplineMonolith </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSplineMonoStruct.html">SplineMonoStruct</a> *&#160;</td>
          <td class="paramname"><em>cpu_spline_handler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; float &gt;&#160;</td>
          <td class="paramname"><em>cpu_many_array_TF1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; short int &gt;&#160;</td>
          <td class="paramname"><em>cpu_paramNo_arr_TF1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n_events</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; unsigned int &gt;&#160;</td>
          <td class="paramname"><em>cpu_nParamPerEvent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; unsigned int &gt;&#160;</td>
          <td class="paramname"><em>cpu_nParamPerEvent_TF1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n_params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>n_splines</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short int&#160;</td>
          <td class="paramname"><em>spline_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>total_nknots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>n_tf1</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies data from CPU to GPU for the spline monolith. </p>
<p>This function transfers the necessary spline data and parameters from the CPU to the GPU, including TF1-related arrays and parameters. This setup is crucial for spline evaluations on the GPU.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cpu_spline_handler</td><td>Pointer to the structure managing spline data on the CPU. </td></tr>
    <tr><td class="paramname">cpu_many_array_TF1</td><td>Array of TF1 parameters on the CPU. </td></tr>
    <tr><td class="paramname">cpu_paramNo_arr_TF1</td><td>Array containing parameter numbers for TF1 objects. </td></tr>
    <tr><td class="paramname">n_events</td><td>Number of events, necessary for correct data handling. </td></tr>
    <tr><td class="paramname">cpu_nParamPerEvent</td><td>Array indicating the number of parameters per event. </td></tr>
    <tr><td class="paramname">cpu_nParamPerEvent_TF1</td><td>Array indicating the number of parameters per TF1 object. </td></tr>
    <tr><td class="paramname">n_params</td><td>Total number of parameters across all splines. </td></tr>
    <tr><td class="paramname">n_splines</td><td>Total number of spline objects. </td></tr>
    <tr><td class="paramname">spline_size</td><td>Size of each spline object. </td></tr>
    <tr><td class="paramname">total_nknots</td><td>Total number of knots across all splines. </td></tr>
    <tr><td class="paramname">n_tf1</td><td>Total number of TF1 objects. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cu_source.html#l00200">200</a> of file <a class="el" href="gpuSplineUtils_8cu_source.html">gpuSplineUtils.cu</a>.</p>
<div class="fragment"><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                                                {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">// ******************************************************</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordflow">if</span> (n_params != <a class="code" href="gpuSplineUtils_8cu.html#a466f32a4912da866d5014fd8cdbd06a4">_N_SPLINES_</a>) {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    printf(<span class="stringliteral">&quot;Number of splines not equal to %i, GPU code for event-by-event splines will fail\n&quot;</span>, <a class="code" href="gpuSplineUtils_8cu.html#a466f32a4912da866d5014fd8cdbd06a4">_N_SPLINES_</a>);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    printf(<span class="stringliteral">&quot;n_params = %i\n&quot;</span>, n_params);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    printf(<span class="stringliteral">&quot;%s : %i\n&quot;</span>, __FILE__, __LINE__);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">// Write to the global statics (h_* denotes host stored variable)</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <a class="code" href="classSMonolithGPU.html#ad36c112081992f2887fe24675f4bba06">h_n_params</a> = n_params;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="preprocessor">#ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <a class="code" href="classSMonolithGPU.html#a4628e4d9bb58650086cf51098c996059">h_n_events</a>    = n_events;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="comment">// Copy the constants</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="comment">// Total number of valid splines for all loaded events</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  cudaMemcpyToSymbol(<a class="code" href="gpuSplineUtils_8cu.html#a8df652f27dcffc6b349298601ed790ea">d_n_splines</a>, &amp;n_splines, <span class="keyword">sizeof</span>(n_splines));</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="comment">// Total number of valid TF1 for all loaded events</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  cudaMemcpyToSymbol(<a class="code" href="gpuSplineUtils_8cu.html#a70d02be4848ebb3c6778c1c1250a5288">d_n_TF1</a>,   &amp;n_tf1, <span class="keyword">sizeof</span>(n_tf1));</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="comment">// Total spline size per spline; i.e. just the number of points or knots in the spline</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  cudaMemcpyToSymbol(<a class="code" href="gpuSplineUtils_8cu.html#ae11082fcc44d3cf2e38cb74043fd7835">d_spline_size</a>, &amp;spline_size, <span class="keyword">sizeof</span>(spline_size));</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="preprocessor">#ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="comment">// Number of events</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  cudaMemcpyToSymbol(<a class="code" href="gpuSplineUtils_8cu.html#ad333bfa4035ada9207fc1df19272c4e2">d_n_events</a>, &amp;<a class="code" href="classSMonolithGPU.html#a4628e4d9bb58650086cf51098c996059">h_n_events</a>, <span class="keyword">sizeof</span>(<a class="code" href="classSMonolithGPU.html#a4628e4d9bb58650086cf51098c996059">h_n_events</a>));</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="comment">// Copy the coefficient arrays to the GPU; this only happens once per entire Markov Chain so is OK to do multiple extensive memory copies</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  cudaMemcpy(<a class="code" href="classSMonolithGPU.html#a5a51e7b819a0c8cf786aa8f13dfdc0cc">gpu_coeff_many</a>, cpu_spline_handler-&gt;<a class="code" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>.data(), <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*total_nknots*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>, cudaMemcpyHostToDevice);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  cudaMemcpy(<a class="code" href="classSMonolithGPU.html#a871589b8a52dea4ed9a4963a7b05e1af">gpu_coeff_x</a>, cpu_spline_handler-&gt;<a class="code" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>.data(), <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*spline_size*n_params, cudaMemcpyHostToDevice);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="comment">//KS: Bind our texture with the GPU variable</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">//KS: Tried also moving gpu_many_array to texture memory it only worked with restricted number of MC runs, most likely hit texture memory limit :(</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keyword">struct </span>cudaResourceDesc resDesc_coeff_x;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  memset(&amp;resDesc_coeff_x, 0, <span class="keyword">sizeof</span>(resDesc_coeff_x));</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  resDesc_coeff_x.resType = cudaResourceTypeLinear;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  resDesc_coeff_x.res.linear.devPtr = <a class="code" href="classSMonolithGPU.html#a871589b8a52dea4ed9a4963a7b05e1af">gpu_coeff_x</a>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  resDesc_coeff_x.res.linear.desc = cudaCreateChannelDesc&lt;float&gt;();</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  resDesc_coeff_x.res.linear.sizeInBytes = <span class="keyword">sizeof</span>(float)*spline_size*n_params;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="comment">// Specify texture object parameters</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keyword">struct </span>cudaTextureDesc texDesc_coeff_x;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  memset(&amp;texDesc_coeff_x, 0, <span class="keyword">sizeof</span>(texDesc_coeff_x));</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  texDesc_coeff_x.readMode = cudaReadModeElementType;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">// Create texture object</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  cudaCreateTextureObject(&amp;<a class="code" href="classSMonolithGPU.html#a1fb766b50293e6b611c45aa21c5c1b9c">text_coeff_x</a>, &amp;resDesc_coeff_x, &amp;texDesc_coeff_x, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">// Also copy the parameter number for each spline onto the GPU; i.e. what spline parameter are we calculating right now</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  cudaMemcpy(<a class="code" href="classSMonolithGPU.html#ae8f091bec85671c4f96a2d0d9dbe4243">gpu_paramNo_arr</a>, cpu_spline_handler-&gt;<a class="code" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>.data(), n_splines*<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>), cudaMemcpyHostToDevice);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="comment">// Also copy the knot map for each spline onto the GPU;</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  cudaMemcpy(<a class="code" href="classSMonolithGPU.html#ac291adc527ef593bb62a8440a131798f">gpu_nKnots_arr</a>, cpu_spline_handler-&gt;<a class="code" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>.data(), n_splines*<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), cudaMemcpyHostToDevice);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="comment">//Now TF1</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">// Copy the coefficient arrays to the GPU; this only happens once per entire Markov Chain so is OK to do multiple extensive memory copies</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  cudaMemcpy(<a class="code" href="classSMonolithGPU.html#ae58804bb65745dbd8835876bf0debdc7">gpu_coeff_TF1_many</a>, cpu_many_array_TF1.data(), <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*n_tf1*<a class="code" href="SplineCommon_8h.html#ad6cacf3d45a37eeeeffe38ad24345d54">_nTF1Coeff_</a>, cudaMemcpyHostToDevice);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">// Also copy the parameter number for each TF1 onto the GPU; i.e. what TF1 parameter are we calculating right now</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  cudaMemcpy(<a class="code" href="classSMonolithGPU.html#a2f8de24623a787f9f728bdd0b735c89c">gpu_paramNo_TF1_arr</a>, cpu_paramNo_arr_TF1.data(), n_tf1*<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>), cudaMemcpyHostToDevice);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor">  #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="comment">//KS: Keep track how much splines each event has</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  cudaMemcpy(<a class="code" href="classSMonolithGPU.html#a13324d2fe2a29f7bbff19c55ddd6968c">gpu_nParamPerEvent</a>, cpu_nParamPerEvent.data(), 2*n_events*<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), cudaMemcpyHostToDevice);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="comment">//KS: Bind our texture with the GPU variable</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="comment">// create a resource descriptor based on device pointers</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keyword">struct </span>cudaResourceDesc resDesc_nParamPerEvent;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  memset(&amp;resDesc_nParamPerEvent, 0, <span class="keyword">sizeof</span>(resDesc_nParamPerEvent));</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  resDesc_nParamPerEvent.resType = cudaResourceTypeLinear;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  resDesc_nParamPerEvent.res.linear.devPtr = <a class="code" href="classSMonolithGPU.html#a13324d2fe2a29f7bbff19c55ddd6968c">gpu_nParamPerEvent</a>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  resDesc_nParamPerEvent.res.linear.desc = cudaCreateChannelDesc&lt;unsigned int&gt;();</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  resDesc_nParamPerEvent.res.linear.sizeInBytes = 2*n_events*<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> int);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="comment">// Specify texture object parameters</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="keyword">struct </span>cudaTextureDesc texDesc_nParamPerEvent;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  memset(&amp;texDesc_nParamPerEvent, 0, <span class="keyword">sizeof</span>(texDesc_nParamPerEvent));</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  texDesc_nParamPerEvent.readMode = cudaReadModeElementType;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="comment">//Finally create texture object</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  cudaCreateTextureObject(&amp;<a class="code" href="classSMonolithGPU.html#a663a150b3464b28d6161df1924cd534f">text_nParamPerEvent</a>, &amp;resDesc_nParamPerEvent, &amp;texDesc_nParamPerEvent, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">// Now TF1</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  cudaMemcpy(<a class="code" href="classSMonolithGPU.html#a60191ebfcba5bedf7e01c923887d5ceb">gpu_nParamPerEvent_TF1</a>, cpu_nParamPerEvent_TF1.data(), 2*n_events*<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), cudaMemcpyHostToDevice);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="comment">//KS: Bind our texture with the GPU variable</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="comment">// create a resource descriptor based on device pointers</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keyword">struct </span>cudaResourceDesc resDesc_nParamPerEvent_tf1;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  memset(&amp;resDesc_nParamPerEvent_tf1, 0, <span class="keyword">sizeof</span>(resDesc_nParamPerEvent_tf1));</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  resDesc_nParamPerEvent_tf1.resType = cudaResourceTypeLinear;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  resDesc_nParamPerEvent_tf1.res.linear.devPtr = <a class="code" href="classSMonolithGPU.html#a60191ebfcba5bedf7e01c923887d5ceb">gpu_nParamPerEvent_TF1</a>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  resDesc_nParamPerEvent_tf1.res.linear.desc = cudaCreateChannelDesc&lt;unsigned int&gt;();</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  resDesc_nParamPerEvent_tf1.res.linear.sizeInBytes = 2*n_events*<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> int);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="comment">// Specify texture object parameters</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keyword">struct </span>cudaTextureDesc texDesc_nParamPerEvent_tf1;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  memset(&amp;texDesc_nParamPerEvent_tf1, 0, <span class="keyword">sizeof</span>(texDesc_nParamPerEvent_tf1));</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  texDesc_nParamPerEvent_tf1.readMode = cudaReadModeElementType;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="comment">//Finally create texture object</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  cudaCreateTextureObject(&amp;<a class="code" href="classSMonolithGPU.html#a089fd1b491667e60d06c3713cd45552e">text_nParamPerEvent_TF1</a>, &amp;resDesc_nParamPerEvent_tf1, &amp;texDesc_nParamPerEvent_tf1, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;}</div>
<div class="ttc" id="aSplineCommon_8h_html_a790348db7c20fb9896e94403fbee52cf"><div class="ttname"><a href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a></div><div class="ttdeci">constexpr int _nCoeff_</div><div class="ttdoc">KS: We store coefficients {y,b,c,d} in one array one by one, this is only to define it once rather th...</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00013">SplineCommon.h:13</a></div></div>
<div class="ttc" id="aSplineCommon_8h_html_ad6cacf3d45a37eeeeffe38ad24345d54"><div class="ttname"><a href="SplineCommon_8h.html#ad6cacf3d45a37eeeeffe38ad24345d54">_nTF1Coeff_</a></div><div class="ttdeci">constexpr int _nTF1Coeff_</div><div class="ttdoc">KS: For TF1 we store at most 5 coefficients, we could make it more flexible but for now define it her...</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00015">SplineCommon.h:15</a></div></div>
<div class="ttc" id="agpuSplineUtils_8cu_html_a466f32a4912da866d5014fd8cdbd06a4"><div class="ttname"><a href="gpuSplineUtils_8cu.html#a466f32a4912da866d5014fd8cdbd06a4">_N_SPLINES_</a></div><div class="ttdeci">#define _N_SPLINES_</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00006">gpuSplineUtils.cu:6</a></div></div>
<div class="ttc" id="agpuSplineUtils_8cu_html_a70d02be4848ebb3c6778c1c1250a5288"><div class="ttname"><a href="gpuSplineUtils_8cu.html#a70d02be4848ebb3c6778c1c1250a5288">d_n_TF1</a></div><div class="ttdeci">__device__ __constant__ unsigned int d_n_TF1</div><div class="ttdoc">Number of tf1 living on GPU.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00059">gpuSplineUtils.cu:59</a></div></div>
<div class="ttc" id="agpuSplineUtils_8cu_html_a8df652f27dcffc6b349298601ed790ea"><div class="ttname"><a href="gpuSplineUtils_8cu.html#a8df652f27dcffc6b349298601ed790ea">d_n_splines</a></div><div class="ttdeci">__device__ __constant__ unsigned int d_n_splines</div><div class="ttdoc">Number of splines living on GPU.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00057">gpuSplineUtils.cu:57</a></div></div>
<div class="ttc" id="agpuSplineUtils_8cu_html_ad333bfa4035ada9207fc1df19272c4e2"><div class="ttname"><a href="gpuSplineUtils_8cu.html#ad333bfa4035ada9207fc1df19272c4e2">d_n_events</a></div><div class="ttdeci">__device__ __constant__ int d_n_events</div><div class="ttdoc">Number of events living on GPU.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00064">gpuSplineUtils.cu:64</a></div></div>
<div class="ttc" id="agpuSplineUtils_8cu_html_ae11082fcc44d3cf2e38cb74043fd7835"><div class="ttname"><a href="gpuSplineUtils_8cu.html#ae11082fcc44d3cf2e38cb74043fd7835">d_spline_size</a></div><div class="ttdeci">__device__ __constant__ short int d_spline_size</div><div class="ttdoc">Size of splines living on GPU.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00061">gpuSplineUtils.cu:61</a></div></div>
<div class="ttc" id="agpuUtils_8cuh_html_a0345e89c96b417069f1e64674cc77318"><div class="ttname"><a href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a></div><div class="ttdeci">#define CudaCheckError()</div><div class="ttdef"><b>Definition:</b> <a href="gpuUtils_8cuh_source.html#l00022">gpuUtils.cuh:22</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html_a398e0212915793852137384a3406b37f"><div class="ttname"><a href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">SplineMonoStruct::nKnots_arr</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; nKnots_arr</div><div class="ttdoc">KS: CPU Number of knots per spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00041">SplineCommon.h:41</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html_a47012ee423ea21f99d06eff8257cf0f0"><div class="ttname"><a href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">SplineMonoStruct::coeff_x</a></div><div class="ttdeci">std::vector&lt; float &gt; coeff_x</div><div class="ttdoc">KS: CPU arrays to hold X coefficient.</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00035">SplineCommon.h:32</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html_a67c5585ae47fc8a646dfae3fe9690775"><div class="ttname"><a href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">SplineMonoStruct::coeff_many</a></div><div class="ttdeci">std::vector&lt; float &gt; coeff_many</div><div class="ttdoc">CPU arrays to hold other coefficients.</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00038">SplineCommon.h:38</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html_af24b409ab3da1a88e855e1a9d172741f"><div class="ttname"><a href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">SplineMonoStruct::paramNo_arr</a></div><div class="ttdeci">std::vector&lt; short int &gt; paramNo_arr</div><div class="ttdoc">CW: CPU array with the number of points per spline (not per spline point!)</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00044">SplineCommon.h:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab674ec40c136d89b56b7c25d9337c48a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab674ec40c136d89b56b7c25d9337c48a">&#9670;&nbsp;</a></span>InitGPU_Segments()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__host__ void SMonolithGPU::InitGPU_Segments </td>
          <td>(</td>
          <td class="paramtype">short int **&#160;</td>
          <td class="paramname"><em>segment</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate memory for spline segments. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">segment</td><td>Found spline segment for each parameter </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cu_source.html#l00177">177</a> of file <a class="el" href="gpuSplineUtils_8cu_source.html">gpuSplineUtils.cu</a>.</p>
<div class="fragment"><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                                                {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">// *******************************************</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="comment">//KS: Rather than allocate memory in standard way this fancy cuda tool allows to pin host memory which make memory transfer faster</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  cudaMallocHost((<span class="keywordtype">void</span> **) segment, <a class="code" href="gpuSplineUtils_8cu.html#a466f32a4912da866d5014fd8cdbd06a4">_N_SPLINES_</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a713a47fd41a93d2b6d40c4b392158aae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a713a47fd41a93d2b6d40c4b392158aae">&#9670;&nbsp;</a></span>InitGPU_SplineMonolith()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__host__ void SMonolithGPU::InitGPU_SplineMonolith </td>
          <td>(</td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>cpu_total_weights</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n_events</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>total_nknots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>n_splines</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>n_tf1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>Eve_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate memory on gpu for spline monolith. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cpu_total_weights</td><td>KS: Rather than allocate memory in standard way this fancy cuda tool allows to pin host memory which make memory transfer faster </td></tr>
    <tr><td class="paramname">n_events</td><td>Number of events, this is necessary to allocate correctly memory </td></tr>
    <tr><td class="paramname">total_nknots</td><td>Total number of knots in all splines summed </td></tr>
    <tr><td class="paramname">n_splines</td><td>Total number of spline objects, not knots </td></tr>
    <tr><td class="paramname">n_tf1</td><td>Total number of TF1 objects, not coefficients </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cu_source.html#l00105">105</a> of file <a class="el" href="gpuSplineUtils_8cu_source.html">gpuSplineUtils.cu</a>.</p>
<div class="fragment"><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                        {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">// *******************************************</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="comment">// Allocate chunks of memory to GPU</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  cudaMalloc((<span class="keywordtype">void</span> **) &amp;<a class="code" href="classSMonolithGPU.html#ae8f091bec85671c4f96a2d0d9dbe4243">gpu_paramNo_arr</a>, n_splines*<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  cudaMalloc((<span class="keywordtype">void</span> **) &amp;<a class="code" href="classSMonolithGPU.html#ac291adc527ef593bb62a8440a131798f">gpu_nKnots_arr</a>, n_splines*<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  cudaMalloc((<span class="keywordtype">void</span> **) &amp;<a class="code" href="classSMonolithGPU.html#a871589b8a52dea4ed9a4963a7b05e1af">gpu_coeff_x</a>, Eve_size*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  cudaMalloc((<span class="keywordtype">void</span> **) &amp;<a class="code" href="classSMonolithGPU.html#a5a51e7b819a0c8cf786aa8f13dfdc0cc">gpu_coeff_many</a>, <a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>*total_nknots*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// Allocate memory for the array of weights to be returned to CPU</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  cudaMalloc((<span class="keywordtype">void</span> **) &amp;<a class="code" href="classSMonolithGPU.html#a4f29d521544dd4bb64e6f2bfd68c21af">gpu_weights</a>, n_splines*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="comment">// Now TF1 specific</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  cudaMalloc((<span class="keywordtype">void</span> **) &amp;<a class="code" href="classSMonolithGPU.html#ae58804bb65745dbd8835876bf0debdc7">gpu_coeff_TF1_many</a>, <a class="code" href="SplineCommon_8h.html#ad6cacf3d45a37eeeeffe38ad24345d54">_nTF1Coeff_</a>*n_tf1*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  cudaMalloc((<span class="keywordtype">void</span> **) &amp;<a class="code" href="classSMonolithGPU.html#ab5d038b66802271bbaf8f0c06704e5da">gpu_weights_tf1</a>, n_tf1*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  cudaMalloc((<span class="keywordtype">void</span> **) &amp;<a class="code" href="classSMonolithGPU.html#a2f8de24623a787f9f728bdd0b735c89c">gpu_paramNo_TF1_arr</a>, n_tf1*<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="preprocessor">#ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">//KS: Rather than allocate memory in standard way this fancy cuda tool allows to pin host memory which make memory transfer faster</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  cudaMallocHost((<span class="keywordtype">void</span> **) cpu_total_weights, n_events*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">//KS: Allocate memory for the array of total weights to be returned to CPU</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  cudaMalloc((<span class="keywordtype">void</span> **) &amp;<a class="code" href="classSMonolithGPU.html#af5007136ab5e2fdbf3b9387e14a1c64a">gpu_total_weights</a>, n_events*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="comment">//KS: Allocate memory for the map keeping track how many splines each parameter has</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  cudaMalloc((<span class="keywordtype">void</span> **) &amp;<a class="code" href="classSMonolithGPU.html#a13324d2fe2a29f7bbff19c55ddd6968c">gpu_nParamPerEvent</a>, 2*n_events*<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="comment">//KS: Allocate memory for the map keeping track how many TF1 each parameter has</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  cudaMalloc((<span class="keywordtype">void</span> **) &amp;<a class="code" href="classSMonolithGPU.html#a60191ebfcba5bedf7e01c923887d5ceb">gpu_nParamPerEvent_TF1</a>, 2*n_events*<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">// Print allocation info to user</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  printf(<span class="stringliteral">&quot;Allocated %i entries for paramNo and nKnots arrays, size = %f MB\n&quot;</span>,</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;         n_splines, <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>) * n_splines + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) * n_splines) / 1.0e6);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  printf(<span class="stringliteral">&quot;Allocated %i entries for x coeff arrays, size = %f MB\n&quot;</span>,</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;         Eve_size, <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * Eve_size) / 1.0e6);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  printf(<span class="stringliteral">&quot;Allocated %i entries for {ybcd} coeff arrays, size = %f MB\n&quot;</span>,</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;         <a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a> * total_nknots, <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a> * total_nknots) / 1.0e6);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  printf(<span class="stringliteral">&quot;Allocated %i entries for TF1 coefficient arrays, size = %f MB\n&quot;</span>,</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;         <a class="code" href="SplineCommon_8h.html#ad6cacf3d45a37eeeeffe38ad24345d54">_nTF1Coeff_</a> * n_tf1, <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code" href="SplineCommon_8h.html#ad6cacf3d45a37eeeeffe38ad24345d54">_nTF1Coeff_</a> * n_tf1) / 1.0e6);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="comment">//KS: Ask CUDA about memory usage</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <a class="code" href="gpuUtils_8cu.html#a5cfcf006bd817b3cff5da08c7f0ecb5e">checkGpuMem</a>();</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <a class="code" href="gpuUtils_8cu.html#acbef44018c81d3830eb03d342bd55dd0">PrintNdevices</a>();</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div>
<div class="ttc" id="agpuUtils_8cu_html_a5cfcf006bd817b3cff5da08c7f0ecb5e"><div class="ttname"><a href="gpuUtils_8cu.html#a5cfcf006bd817b3cff5da08c7f0ecb5e">checkGpuMem</a></div><div class="ttdeci">void checkGpuMem()</div><div class="ttdoc">KS: Get some fancy info about VRAM usage.</div><div class="ttdef"><b>Definition:</b> <a href="gpuUtils_8cu_source.html#l00043">gpuUtils.cu:43</a></div></div>
<div class="ttc" id="agpuUtils_8cu_html_acbef44018c81d3830eb03d342bd55dd0"><div class="ttname"><a href="gpuUtils_8cu.html#acbef44018c81d3830eb03d342bd55dd0">PrintNdevices</a></div><div class="ttdeci">void PrintNdevices()</div><div class="ttdoc">KS: Get some fancy info about GPU.</div><div class="ttdef"><b>Definition:</b> <a href="gpuUtils_8cu_source.html#l00060">gpuUtils.cu:60</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3fbbb94f6db65b73a394ab541f94fba6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fbbb94f6db65b73a394ab541f94fba6">&#9670;&nbsp;</a></span>InitGPU_Vals()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__host__ void SMonolithGPU::InitGPU_Vals </td>
          <td>(</td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>vals</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate memory for spline segments. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">vals</td><td>Value to which we want reweight for each parameter </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cu_source.html#l00186">186</a> of file <a class="el" href="gpuSplineUtils_8cu_source.html">gpuSplineUtils.cu</a>.</p>
<div class="fragment"><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                                                     {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">// *******************************************</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="comment">//KS: Rather than allocate memory in standard way this fancy cuda tool allows to pin host memory which make memory transfer faster</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  cudaMallocHost((<span class="keywordtype">void</span> **) vals, <a class="code" href="gpuSplineUtils_8cu.html#a466f32a4912da866d5014fd8cdbd06a4">_N_SPLINES_</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8419e01082c64b291c3b38d8e69ceb4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8419e01082c64b291c3b38d8e69ceb4d">&#9670;&nbsp;</a></span>RunGPU_SplineMonolith()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__host__ void SMonolithGPU::RunGPU_SplineMonolith </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>cpu_total_weights</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>vals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short int *&#160;</td>
          <td class="paramname"><em>segment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>h_n_splines</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>h_n_tf1</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Run the GPU code for the separate many arrays. As in separate {x}, {y,b,c,d} arrays Pass the segment and the parameter values (binary search already performed in SplineMonolith::FindSplineSegment() </p>
<p>Executes the GPU code for calculating spline weights.</p>
<p>This function runs the GPU computation for the spline monolith. It assumes that the appropriate segment has already been identified through binary search in the <code>SplineMonolith::FindSplineSegment()</code> function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cpu_weights</td><td>Pointer to the array of weights on the CPU (used if <code>Weight_On_SplineBySpline_Basis</code> is defined). </td></tr>
    <tr><td class="paramname">cpu_weights_tf1</td><td>Pointer to the array of TF1 weights (used if <code>Weight_On_SplineBySpline_Basis</code> is defined). </td></tr>
    <tr><td class="paramname">cpu_total_weights</td><td>Pointer to the total weights array (used if <code>Weight_On_SplineBySpline_Basis</code> is not defined). </td></tr>
    <tr><td class="paramname">vals</td><td>Pointer to an array holding the parameter values to be processed. </td></tr>
    <tr><td class="paramname">segment</td><td>Pointer to an array containing segment indices for parameters. </td></tr>
    <tr><td class="paramname">h_n_splines</td><td>Total number of spline objects in the GPU context. </td></tr>
    <tr><td class="paramname">h_n_tf1</td><td>Total number of TF1 objects in the GPU context. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cu_source.html#l00456">456</a> of file <a class="el" href="gpuSplineUtils_8cu_source.html">gpuSplineUtils.cu</a>.</p>
<div class="fragment"><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                                {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  dim3 block_size;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  dim3 grid_size;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  block_size.x = <a class="code" href="gpuUtils_8cuh.html#a393d21a8f493c2561a0ae703973dccc2">_BlockSize_</a>;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  grid_size.x = (h_n_splines / block_size.x) + 1;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="comment">// Copy the segment values to the GPU (segment_gpu), which is h_n_params long</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  cudaMemcpyToSymbol(<a class="code" href="gpuSplineUtils_8cu.html#ab99f54969e418c0517309fae3f648588">segment_gpu</a>, segment, <a class="code" href="classSMonolithGPU.html#ad36c112081992f2887fe24675f4bba06">h_n_params</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">// Copy the parameter values values to the GPU (vals_gpu), which is h_n_params long</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  cudaMemcpyToSymbol(<a class="code" href="gpuSplineUtils_8cu.html#ac95f6dd3bc9efb4292a4e3f264492f05">val_gpu</a>, vals, <a class="code" href="classSMonolithGPU.html#ad36c112081992f2887fe24675f4bba06">h_n_params</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">// KS: Consider asynchronous kernel call, this might help EvalOnGPU_Splines and EvalOnGPU_TF1 are independent</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">// Set the cache config to prefer L1 for the kernel</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">//cudaFuncSetCacheConfig(EvalOnGPU_Splines, cudaFuncCachePreferL1);</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  EvalOnGPU_Splines&lt;&lt;&lt;grid_size, block_size&gt;&gt;&gt;(</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <a class="code" href="classSMonolithGPU.html#ae8f091bec85671c4f96a2d0d9dbe4243">gpu_paramNo_arr</a>,</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <a class="code" href="classSMonolithGPU.html#ac291adc527ef593bb62a8440a131798f">gpu_nKnots_arr</a>,</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <a class="code" href="classSMonolithGPU.html#a5a51e7b819a0c8cf786aa8f13dfdc0cc">gpu_coeff_many</a>,</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <a class="code" href="classSMonolithGPU.html#a4f29d521544dd4bb64e6f2bfd68c21af">gpu_weights</a>,</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <a class="code" href="classSMonolithGPU.html#a1fb766b50293e6b611c45aa21c5c1b9c">text_coeff_x</a></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  );</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  grid_size.x = (h_n_tf1 / block_size.x) + 1;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  EvalOnGPU_TF1&lt;&lt;&lt;grid_size, block_size&gt;&gt;&gt;(</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <a class="code" href="classSMonolithGPU.html#ae58804bb65745dbd8835876bf0debdc7">gpu_coeff_TF1_many</a>,</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <a class="code" href="classSMonolithGPU.html#a2f8de24623a787f9f728bdd0b735c89c">gpu_paramNo_TF1_arr</a>,</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160; </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <a class="code" href="classSMonolithGPU.html#ab5d038b66802271bbaf8f0c06704e5da">gpu_weights_tf1</a></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  );</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">//KS: We can either copy gpu_weight and calculate total weight in reweighting loop, or not copy and calculate total weight stall at GPU, which means less memory transfer</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="preprocessor">#ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="comment">// Here we have to make a somewhat large GPU-&gt;CPU transfer because it&#39;s all the splines&#39; response</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  cudaMemcpy(cpu_weights, <a class="code" href="classSMonolithGPU.html#a4f29d521544dd4bb64e6f2bfd68c21af">gpu_weights</a>, h_n_splines*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), cudaMemcpyDeviceToHost);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160; </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  cudaMemcpy(cpu_weights_tf1, <a class="code" href="classSMonolithGPU.html#ab5d038b66802271bbaf8f0c06704e5da">gpu_weights_tf1</a>, h_n_tf1*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), cudaMemcpyDeviceToHost);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">//KS: Else calculate Total Weight</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  grid_size.x = (<a class="code" href="classSMonolithGPU.html#a4628e4d9bb58650086cf51098c996059">h_n_events</a> / block_size.x) + 1;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  EvalOnGPU_TotWeight&lt;&lt;&lt;grid_size, block_size&gt;&gt;&gt;(</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <a class="code" href="classSMonolithGPU.html#a4f29d521544dd4bb64e6f2bfd68c21af">gpu_weights</a>,</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <a class="code" href="classSMonolithGPU.html#ab5d038b66802271bbaf8f0c06704e5da">gpu_weights_tf1</a>,</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <a class="code" href="classSMonolithGPU.html#af5007136ab5e2fdbf3b9387e14a1c64a">gpu_total_weights</a>,</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <a class="code" href="classSMonolithGPU.html#a663a150b3464b28d6161df1924cd534f">text_nParamPerEvent</a>,</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <a class="code" href="classSMonolithGPU.html#a089fd1b491667e60d06c3713cd45552e">text_nParamPerEvent_TF1</a></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      );</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="comment">//KS: Here we have to make a somewhat large GPU-&gt;CPU transfer because it is proportional to number of events</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="comment">//KS: Normally code wait for memory transfer to finish before moving further cudaMemcpyAsync means we will continue to execute code and in a meantime keep copying stuff.</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  cudaMemcpyAsync(cpu_total_weights, <a class="code" href="classSMonolithGPU.html#af5007136ab5e2fdbf3b9387e14a1c64a">gpu_total_weights</a>, <a class="code" href="classSMonolithGPU.html#a4628e4d9bb58650086cf51098c996059">h_n_events</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), cudaMemcpyDeviceToHost, 0);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <a class="code" href="gpuUtils_8cuh.html#a0345e89c96b417069f1e64674cc77318">CudaCheckError</a>();</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160; </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="preprocessor">  #ifdef DEBUG</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    printf(<span class="stringliteral">&quot;Copied GPU total weights to CPU with SUCCESS (drink more tea)\n&quot;</span>);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    printf(<span class="stringliteral">&quot;Released calculated response from GPU with SUCCESS (drink most tea)\n&quot;</span>);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;}</div>
<div class="ttc" id="agpuSplineUtils_8cu_html_ab99f54969e418c0517309fae3f648588"><div class="ttname"><a href="gpuSplineUtils_8cu.html#ab99f54969e418c0517309fae3f648588">segment_gpu</a></div><div class="ttdeci">__device__ __constant__ short int segment_gpu[NSplines_GPU]</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00068">gpuSplineUtils.cu:68</a></div></div>
<div class="ttc" id="agpuSplineUtils_8cu_html_ac95f6dd3bc9efb4292a4e3f264492f05"><div class="ttname"><a href="gpuSplineUtils_8cu.html#ac95f6dd3bc9efb4292a4e3f264492f05">val_gpu</a></div><div class="ttdeci">__device__ __constant__ float val_gpu[NSplines_GPU]</div><div class="ttdoc">CW: Constant memory needs to be hard-coded on compile time. Could make this texture memory instead,...</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00067">gpuSplineUtils.cu:67</a></div></div>
<div class="ttc" id="agpuUtils_8cuh_html_a393d21a8f493c2561a0ae703973dccc2"><div class="ttname"><a href="gpuUtils_8cuh.html#a393d21a8f493c2561a0ae703973dccc2">_BlockSize_</a></div><div class="ttdeci">#define _BlockSize_</div><div class="ttdoc">KS: Need it for shared memory, there is way to use dynamic shared memory but I am lazy right now.</div><div class="ttdef"><b>Definition:</b> <a href="gpuUtils_8cuh_source.html#l00025">gpuUtils.cuh:25</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a5a51e7b819a0c8cf786aa8f13dfdc0cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a51e7b819a0c8cf786aa8f13dfdc0cc">&#9670;&nbsp;</a></span>gpu_coeff_many</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolithGPU::gpu_coeff_many</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>GPU arrays to hold other coefficients. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00192">192</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="ae58804bb65745dbd8835876bf0debdc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae58804bb65745dbd8835876bf0debdc7">&#9670;&nbsp;</a></span>gpu_coeff_TF1_many</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolithGPU::gpu_coeff_TF1_many</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>GPU arrays to hold TF1 coefficients. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00201">201</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="a871589b8a52dea4ed9a4963a7b05e1af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a871589b8a52dea4ed9a4963a7b05e1af">&#9670;&nbsp;</a></span>gpu_coeff_x</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolithGPU::gpu_coeff_x</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: GPU arrays to hold X coefficient. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00189">189</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="ac291adc527ef593bb62a8440a131798f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac291adc527ef593bb62a8440a131798f">&#9670;&nbsp;</a></span>gpu_nKnots_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int* SMonolithGPU::gpu_nKnots_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: GPU Number of knots per spline. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00195">195</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="a13324d2fe2a29f7bbff19c55ddd6968c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13324d2fe2a29f7bbff19c55ddd6968c">&#9670;&nbsp;</a></span>gpu_nParamPerEvent</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int* SMonolithGPU::gpu_nParamPerEvent</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: GPU map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00184">184</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="a60191ebfcba5bedf7e01c923887d5ceb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60191ebfcba5bedf7e01c923887d5ceb">&#9670;&nbsp;</a></span>gpu_nParamPerEvent_TF1</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int* SMonolithGPU::gpu_nParamPerEvent_TF1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: GPU map keeping track how many parameters applies to each event, we keep two numbers here {number of TF1 per event, index where TF1 start for a given event}. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00186">186</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="aa84c07d3cda1c29b039a0fd3778c0c0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa84c07d3cda1c29b039a0fd3778c0c0f">&#9670;&nbsp;</a></span>gpu_nPoints_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">short int* SMonolithGPU::gpu_nPoints_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>GPU arrays to hold number of points. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00203">203</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="ae8f091bec85671c4f96a2d0d9dbe4243"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8f091bec85671c4f96a2d0d9dbe4243">&#9670;&nbsp;</a></span>gpu_paramNo_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">short int* SMonolithGPU::gpu_paramNo_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: GPU array with the number of points per spline (not per spline point!) </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00198">198</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="a2f8de24623a787f9f728bdd0b735c89c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f8de24623a787f9f728bdd0b735c89c">&#9670;&nbsp;</a></span>gpu_paramNo_TF1_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">short int* SMonolithGPU::gpu_paramNo_TF1_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: GPU array with the number of points per TF1 object. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00205">205</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="af5007136ab5e2fdbf3b9387e14a1c64a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5007136ab5e2fdbf3b9387e14a1c64a">&#9670;&nbsp;</a></span>gpu_total_weights</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolithGPU::gpu_total_weights</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>GPU arrays to hold weight for event. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00208">208</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="a4f29d521544dd4bb64e6f2bfd68c21af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f29d521544dd4bb64e6f2bfd68c21af">&#9670;&nbsp;</a></span>gpu_weights</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolithGPU::gpu_weights</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>GPU arrays to hold weight for each spline. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00210">210</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="ab5d038b66802271bbaf8f0c06704e5da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5d038b66802271bbaf8f0c06704e5da">&#9670;&nbsp;</a></span>gpu_weights_tf1</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolithGPU::gpu_weights_tf1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>GPU arrays to hold weight for each TF1. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00212">212</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="a4628e4d9bb58650086cf51098c996059"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4628e4d9bb58650086cf51098c996059">&#9670;&nbsp;</a></span>h_n_events</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int SMonolithGPU::h_n_events</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of events living on CPU. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00218">218</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="ad36c112081992f2887fe24675f4bba06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad36c112081992f2887fe24675f4bba06">&#9670;&nbsp;</a></span>h_n_params</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int SMonolithGPU::h_n_params</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of params living on CPU. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00216">216</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="a1fb766b50293e6b611c45aa21c5c1b9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fb766b50293e6b611c45aa21c5c1b9c">&#9670;&nbsp;</a></span>text_coeff_x</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">cudaTextureObject_t SMonolithGPU::text_coeff_x = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Textures are L1 cache variables which are well optimised for fetching. Make texture only for variables you often access but rarely overwrite. There are limits on texture memory so don't use huge arrays. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00224">224</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="a663a150b3464b28d6161df1924cd534f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a663a150b3464b28d6161df1924cd534f">&#9670;&nbsp;</a></span>text_nParamPerEvent</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">cudaTextureObject_t SMonolithGPU::text_nParamPerEvent = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00227">227</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<a id="a089fd1b491667e60d06c3713cd45552e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a089fd1b491667e60d06c3713cd45552e">&#9670;&nbsp;</a></span>text_nParamPerEvent_TF1</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">cudaTextureObject_t SMonolithGPU::text_nParamPerEvent_TF1 = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Map keeping track how many parameters applies to each event, we keep two numbers here {number of TF1 per event, index where TF1 start for a given event}. </p>

<p class="definition">Definition at line <a class="el" href="gpuSplineUtils_8cuh_source.html#l00229">229</a> of file <a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>Splines/<a class="el" href="gpuSplineUtils_8cuh_source.html">gpuSplineUtils.cuh</a></li>
<li>Splines/<a class="el" href="gpuSplineUtils_8cu_source.html">gpuSplineUtils.cu</a></li>
</ul>
</div><!-- contents -->
<!-- Footer for MaCh3 Doxygen documentation -->
<footer class="mach3-footer" style="text-align: center;">
    <div style="margin-bottom: 15px;">
        <span style="font-weight: bold;">The MaCh3 Collaboration</span>
    </div>
    <!-- Dropdown to jump between doc versions -->
    <div style="margin-bottom: 10px;">
        <span>Select Software Version: </span>
        <select id="versionSelector" onchange="window.location.href=this.value" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="">-- Select --</option>
            <option value="https://mach3-software.github.io/MaCh3/">develop</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.3.0/index.html">v2.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.2.0/index.html">v2.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.1.0/index.html">v2.1.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.0.0/index.html">v2.0.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.5.0/index.html">v1.5.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.4.0/index.html">v1.4.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.3.0/index.html">v1.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.2.0/index.html">v1.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.1.0/index.html">v1.1.0</option>
        </select>
    </div>
    <!-- Footer info about doxygen -->
    <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
        Documentation generated with
        <a href="https://www.doxygen.nl/" target="_blank" style="color: #666;">Doxygen</a>
        <span id="doxygenVersion"></span>
    </div>
    <!-- Now grab doxygen version from metadata -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const meta = document.querySelector('meta[name="generator"]');
        if (meta) {
            const version = meta.getAttribute("content").replace("Doxygen ", "");
            document.getElementById("doxygenVersion").textContent = " " + version;
        }
    });
    </script>
</footer>
