<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MaCh3: Plotting</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="MaCh3.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mach3logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MaCh3
   &#160;<span id="projectnumber">1.4.0</span>
   </div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Plotting </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This directory contains the core MaCh3 plotting tools. <code>plottingUtils</code> contains all the code defining the plotting library, the majority of which basically consists of a highly flexible root file reader which can be configured by different experiments to read from their MaCh3 output files and put everything in a nice common format that can then be accessed in plotting applications and allows for easy iteration over parameters and samples. It is also possible to configure the plotting library to be able to read files from other fitters, which is especially useful for cross-fitter validations (a task that tends to take up a lot of time during an analsis). The aim here is to avoid having to have vast numbers of un-maintained plotting scripts for dealing with every possible combination of fitter and analysis iteration and instead maintain this core code and allow experiments to simply maintain their own config files.</p>
<h1><a class="anchor" id="autotoc_md22"></a>
Structure</h1>
<p>The plotting library consists of 3 main manager classes: <code>PlottingManager</code>, <code>inputManager</code> and <code>styleManager</code> each of which is responsible for different aspects of plot making.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
PlottingManager</h2>
<p>This is intended to be the main class that the user interacts with. It is responsible for parsing user specified options, keeping track of which config files to use, and managing instances of the other manager classes.</p>
<h2><a class="anchor" id="autotoc_md24"></a>
inputManager</h2>
<p>This is responsible for keeping track of the files whose data is to be plotted and reading in that data from them. It will attempt to automatically detect which fitter the file came from based on the config-defined file structures. It will read in the data accordingly, storing in a common format which it provides functions to easily obtain.</p>
<h2><a class="anchor" id="autotoc_md25"></a>
styleManager</h2>
<p>This is responsible for the styling of the plots produces. It contains the functionality to apply user specified styles, colour palettes and fancy names for parameters and samples.</p>
<h1><a class="anchor" id="autotoc_md26"></a>
Config Files</h1>
<p>The goal with MaCh3s plotting library is to be as flexible as possible and to abstract away all of the most annoying parts about plot making like reading in the data from fitter output files and keeping track of parameter names across different fitters, while allowing the user as much freedom as possible when it comes plot style and formatting . In order to do this, MaCh3s plotting library makes heavy use of config files so that the behaviour of the code can be adapted easily to individual experiments without having to totally reinvent the wheel and rewrite large ammounts of boilerplate code. In line with the rest of MaCh3, the plotting library uses <a href="https://yaml.org/spec/1.2.2/">YAML</a> to specify its config files. There are a few different config files which control different parts of the plotting library. Some example yaml configs found in this directory.</p>
<h1><a class="anchor" id="autotoc_md27"></a>
Python</h1>
<p>The plotting library comes with a python interface (see <a href="https://github.com/mach3-software/MaCh3/blob/develop/README.md#python">here</a> for installation details). Once installed, you can simply import the plotting submodule as follows:</p>
<div class="fragment"><div class="line">from pyMaCh3 import plotting</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md28"></a>
Usage</h2>
<p>A very basic example that will plot LLH scans is:</p>
<div class="fragment"><div class="line">from pyMaCh3 import plotting</div>
<div class="line">import matplotlib.backends.backend_pdf</div>
<div class="line">from matplotlib import pyplot as plt</div>
<div class="line">import sys</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">## create an instance of the PlottingManager</div>
<div class="line">man = plotting.PlottingManager()</div>
<div class="line"> </div>
<div class="line">## use the manager to parse command line inputs passed to the scripts</div>
<div class="line">man.parse_inputs(sys.argv)</div>
<div class="line"> </div>
<div class="line">## open a pdf file to save the generated plots to </div>
<div class="line">pdf = matplotlib.backends.backend_pdf.PdfPages(&quot;LLH-scans.pdf&quot;)</div>
<div class="line"> </div>
<div class="line">## now just loop through all possible parameters and plot their likelihood scans using pyplot</div>
<div class="line">for i, param in enumerate( man.input().get_known_parameters() ):</div>
<div class="line">    </div>
<div class="line">    fig = plt.figure()</div>
<div class="line">    plt.title(man.style().prettify_parameter_name(param))</div>
<div class="line"> </div>
<div class="line">    for file_id in range(man.input().get_n_input_files()):</div>
<div class="line">        llh_scan = man.input().get_llh_scan(file_id, param, &quot;sample&quot;)</div>
<div class="line">        plt.plot(llh_scan[0], llh_scan[1])</div>
<div class="line">    </div>
<div class="line">    pdf.savefig( fig )</div>
<div class="line"> </div>
<div class="line">pdf.close()</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md29"></a>
Apps</h1>
<p>There are a few pre-written applications to plot some standard things that we typically look at (there will be some more to follow but they need to be "modernised" to use plotting library)</p>
<p><b>GetPostfitParamPlots</b> - This will plot output from ProcessMCMC for nice plots which can go to TN. Bits are hardcoded to make plots nicer users should be careful when using the non-conventional xsec model. If you used <code>ProcessMCMC</code> with <code>PlotDet</code> you will also get an overlay of detector parameters (ND or ND+FD depending on chain type). If Violin plot was produced in <code>ProcessMCMC</code> you will get fancy plots here as well.</p>
<p><b>PlotLLH</b> - Plot LLH scans, flexible and configurable in command line. can take any number of LLH scans as input, will use the first one as a baseline when making e.g. ratio plots. The first file must be a MaCh3 scan. options: </p><pre class="fragment">-r overlay ratio plots

-s also make plots split by sample contribution, to use this option, the LLH scan must have been run with the option `LLH_SCAN_BY_SAMPLE = true` in the config file

-g draw a grid on the plots

-l a string specifying the labels for each scan to plot in the legent. this should be a string of labels separated by semi colons, e.g.: -`l "label1;label2;label3"`

-o the name of the output pdf

-d a string specifying additional drawing options to pass to the histogram draw calls, e.g. `-d "C"` will plot smooth curves through the histogram bins. See https://root.cern/doc/master/classTHistPainter.html#HP01a for possible options.
</pre><p><b>MatrixPlotter</b> - As input you need output from <code>ProcessMCMC</code>, keep in mind you need to run it with <code>PlotCorr</code>. The executable allows to plot submatrices and whatever combination of parameters you like. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<footer class="mach3-footer" style="text-align: center;">
    <div style="margin-bottom: 15px;">
        <span style="font-weight: bold;">The MaCh3 Collaboration</span>
    </div>
    <div style="margin-bottom: 10px;">
        <span>Select Software Version: </span>
        <select id="versionSelector" onchange="window.location.href=this.value" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="">-- Select --</option>
            <option value="https://mach3-software.github.io/MaCh3/">develop</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.2.0/index.html">v2.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.1.0/index.html">v2.1.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.0.0/index.html">v2.0.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.5.0/index.html">v1.5.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.4.0/index.html">v1.4.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.3.0/index.html">v1.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.2.0/index.html">v1.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.1.0/index.html">v1.1.0</option>
        </select>
    </div>
    <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
        Documentation generated with <a href="https://www.doxygen.nl/" target="_blank" style="color: #666;">Doxygen</a>
    </div>
</footer>
