<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MaCh3: SMonolith Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="MaCh3.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="mach3logo_small.png"/></td>
  <td id="projectalign">
   <div id="projectname">MaCh3<span id="projectnumber">&#160;1.2.0</span>
   </div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classSMonolith-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">SMonolith Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Even-by-event class calculating response for spline parameters. It is possible to use GPU acceleration.  
 <a href="classSMonolith.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="SplineMonolith_8h_source.html">/home/runner/work/MaCh3/MaCh3/splines/SplineMonolith.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for SMonolith:</div>
<div class="dyncontent">
<div class="center"><img src="classSMonolith__inherit__graph.png" border="0" usemap="#aSMonolith_inherit__map" alt="Inheritance graph"/></div>
<map name="aSMonolith_inherit__map" id="aSMonolith_inherit__map">
<area shape="rect" title="Even&#45;by&#45;event class calculating response for spline parameters. It is possible to use GPU acceleratio..." alt="" coords="9,79,96,104"/>
<area shape="rect" href="classSplineBase.html" title="Base class for calculating weight from spline." alt="" coords="5,5,100,31"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for SMonolith:</div>
<div class="dyncontent">
<div class="center"><img src="classSMonolith__coll__graph.png" border="0" usemap="#aSMonolith_coll__map" alt="Collaboration graph"/></div>
<map name="aSMonolith_coll__map" id="aSMonolith_coll__map">
<area shape="rect" title="Even&#45;by&#45;event class calculating response for spline parameters. It is possible to use GPU acceleratio..." alt="" coords="649,201,736,227"/>
<area shape="rect" href="classSplineBase.html" title="Base class for calculating weight from spline." alt="" coords="342,5,437,31"/>
<area shape="rect" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment." alt="" coords="333,55,446,80"/>
<area shape="rect" title=" " alt="" coords="319,105,460,145"/>
<area shape="rect" title=" " alt="" coords="5,189,171,229"/>
<area shape="rect" href="structSplineMonoStruct.html" title="KS: Struct storing information for spline monolith." alt="" coords="321,253,457,279"/>
<area shape="rect" title=" " alt="" coords="13,301,163,327"/>
<area shape="rect" title=" " alt="" coords="19,362,157,402"/>
<area shape="rect" href="classSMonolithGPU.html" title="Class responsible for calculating spline weight on GPU." alt="" coords="332,457,447,483"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a4fe737f7c948f9ee963d87aac46ddebb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a4fe737f7c948f9ee963d87aac46ddebb">SMonolith</a> (std::vector&lt; std::vector&lt; <a class="el" href="classTResponseFunction__red.html">TResponseFunction_red</a> * &gt; &gt; &amp;MasterSpline, const std::vector&lt; <a class="el" href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36d">RespFuncType</a> &gt; &amp;SplineType, const bool SaveFlatTree=false)</td></tr>
<tr class="memdesc:a4fe737f7c948f9ee963d87aac46ddebb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <br /></td></tr>
<tr class="separator:a4fe737f7c948f9ee963d87aac46ddebb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac622c355f630c12438b547bbb9fe212c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac622c355f630c12438b547bbb9fe212c">SMonolith</a> (std::string FileName)</td></tr>
<tr class="memdesc:ac622c355f630c12438b547bbb9fe212c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor where you pass path to preprocessed root FileName.  <br /></td></tr>
<tr class="separator:ac622c355f630c12438b547bbb9fe212c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0ae7f110fa4c6e46e808d8c1ae979b6"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac0ae7f110fa4c6e46e808d8c1ae979b6">~SMonolith</a> ()</td></tr>
<tr class="memdesc:ac0ae7f110fa4c6e46e808d8c1ae979b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor for <a class="el" href="classSMonolith.html" title="Even-by-event class calculating response for spline parameters. It is possible to use GPU acceleratio...">SMonolith</a> class.  <br /></td></tr>
<tr class="separator:ac0ae7f110fa4c6e46e808d8c1ae979b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d1128bb78b165d94721407a124f516b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a3d1128bb78b165d94721407a124f516b">Evaluate</a> () override</td></tr>
<tr class="memdesc:a3d1128bb78b165d94721407a124f516b"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: This Eval should be used when using two separate x,{y,a,b,c,d} arrays to store the weights; probably the best one here! Same thing but pass parameter spline segments instead of variations.  <br /></td></tr>
<tr class="separator:a3d1128bb78b165d94721407a124f516b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad85cab15f5dfdd47e1123b5bd1815a05"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ad85cab15f5dfdd47e1123b5bd1815a05">GetName</a> () const</td></tr>
<tr class="memdesc:ad85cab15f5dfdd47e1123b5bd1815a05"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get class name.  <br /></td></tr>
<tr class="separator:ad85cab15f5dfdd47e1123b5bd1815a05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3332e054f985fc59a162419f0a1d71d"><td class="memItemLeft" align="right" valign="top">short int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aa3332e054f985fc59a162419f0a1d71d">GetNParams</a> () const</td></tr>
<tr class="memdesc:aa3332e054f985fc59a162419f0a1d71d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get number of spline parameters.  <br /></td></tr>
<tr class="separator:aa3332e054f985fc59a162419f0a1d71d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68e18d73ed1ac524ceaea79d2a5460ce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a68e18d73ed1ac524ceaea79d2a5460ce">SynchroniseMemTransfer</a> ()</td></tr>
<tr class="memdesc:a68e18d73ed1ac524ceaea79d2a5460ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: After calculations are done on GPU we copy memory to CPU. This operation is asynchronous meaning while memory is being copied some operations are being carried. Memory must be copied before actual reweight. This function make sure all has been copied.  <br /></td></tr>
<tr class="separator:a68e18d73ed1ac524ceaea79d2a5460ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51bbc20cfe4ebed21f6d9f91a86ea0ee"><td class="memItemLeft" align="right" valign="top">const float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a51bbc20cfe4ebed21f6d9f91a86ea0ee">retPointer</a> (const int event)</td></tr>
<tr class="memdesc:a51bbc20cfe4ebed21f6d9f91a86ea0ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Get pointer to total weight to make fit faster wrooom!  <br /></td></tr>
<tr class="separator:a51bbc20cfe4ebed21f6d9f91a86ea0ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40f6b9256a18fa59009e5961aec776ff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a40f6b9256a18fa59009e5961aec776ff">setSplinePointers</a> (std::vector&lt; const double * &gt; spline_ParsPointers)</td></tr>
<tr class="memdesc:a40f6b9256a18fa59009e5961aec776ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Set pointers to spline params.  <br /></td></tr>
<tr class="separator:a40f6b9256a18fa59009e5961aec776ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classSplineBase"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classSplineBase')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classSplineBase.html">SplineBase</a></td></tr>
<tr class="memitem:aa6965d1522cc68ecf81ac3bfd2dcd6f1 inherit pub_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase</a> ()</td></tr>
<tr class="memdesc:aa6965d1522cc68ecf81ac3bfd2dcd6f1 inherit pub_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <br /></td></tr>
<tr class="separator:aa6965d1522cc68ecf81ac3bfd2dcd6f1 inherit pub_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0de19b2322edb4197380506d594456bd inherit pub_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#a0de19b2322edb4197380506d594456bd">~SplineBase</a> ()</td></tr>
<tr class="memdesc:a0de19b2322edb4197380506d594456bd inherit pub_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <br /></td></tr>
<tr class="separator:a0de19b2322edb4197380506d594456bd inherit pub_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86e629f3eef59b2f3800136c86fe90c3 inherit pub_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#a86e629f3eef59b2f3800136c86fe90c3">Evaluate</a> ()=0</td></tr>
<tr class="memdesc:a86e629f3eef59b2f3800136c86fe90c3 inherit pub_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: This Eval should be used when using two separate x,{y,a,b,c,d} arrays to store the weights; probably the best one here! Same thing but pass parameter spline segments instead of variations.  <br /></td></tr>
<tr class="separator:a86e629f3eef59b2f3800136c86fe90c3 inherit pub_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e1534f622ae1976b21df1ebf984eec5 inherit pub_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">virtual std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#a2e1534f622ae1976b21df1ebf984eec5">GetName</a> () const</td></tr>
<tr class="memdesc:a2e1534f622ae1976b21df1ebf984eec5 inherit pub_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get class name.  <br /></td></tr>
<tr class="separator:a2e1534f622ae1976b21df1ebf984eec5 inherit pub_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a8614e8ef07431d99f62ab88d9ebdad16"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a></td></tr>
<tr class="memdesc:a8614e8ef07431d99f62ab88d9ebdad16"><td class="mdescLeft">&#160;</td><td class="mdescRight">The returned gpu weights, read by the GPU.  <br /></td></tr>
<tr class="separator:a8614e8ef07431d99f62ab88d9ebdad16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab572dd7e0a46caf44eb925a89cbfb0cf"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a></td></tr>
<tr class="memdesc:ab572dd7e0a46caf44eb925a89cbfb0cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: This holds the total CPU weights that gets read in samplePDFND.  <br /></td></tr>
<tr class="separator:ab572dd7e0a46caf44eb925a89cbfb0cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a45cece9dcbe699e00a7b5fdff4806c1e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">Initialise</a> ()</td></tr>
<tr class="memdesc:a45cece9dcbe699e00a7b5fdff4806c1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Set everything to null etc.  <br /></td></tr>
<tr class="separator:a45cece9dcbe699e00a7b5fdff4806c1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12cddfcbec851b468cba86dc9b223c78"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a12cddfcbec851b468cba86dc9b223c78">ScanMasterSpline</a> (std::vector&lt; std::vector&lt; <a class="el" href="classTResponseFunction__red.html">TResponseFunction_red</a> * &gt; &gt; &amp;MasterSpline, unsigned int &amp;nEvents, int &amp;MaxPoints, short int &amp;numParams, int &amp;nSplines, unsigned int &amp;NSplinesValid, unsigned int &amp;numKnots, unsigned int &amp;nTF1Valid, unsigned int &amp;nTF1_coeff, const std::vector&lt; <a class="el" href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36d">RespFuncType</a> &gt; &amp;SplineType)</td></tr>
<tr class="memdesc:a12cddfcbec851b468cba86dc9b223c78"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Function to scan through the MasterSpline of TSpline3.  <br /></td></tr>
<tr class="separator:a12cddfcbec851b468cba86dc9b223c78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1bd2dc5c55b7258d5544512659ef9d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aa1bd2dc5c55b7258d5544512659ef9d7">PrepareForGPU</a> (std::vector&lt; std::vector&lt; <a class="el" href="classTResponseFunction__red.html">TResponseFunction_red</a> * &gt; &gt; &amp;MasterSpline, const std::vector&lt; <a class="el" href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36d">RespFuncType</a> &gt; &amp;SplineType)</td></tr>
<tr class="memdesc:aa1bd2dc5c55b7258d5544512659ef9d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Prepare the <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> objects for the GPU.  <br /></td></tr>
<tr class="separator:aa1bd2dc5c55b7258d5544512659ef9d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac73a1089592c5f22755b7427869827f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aac73a1089592c5f22755b7427869827f">MoveToGPU</a> ()</td></tr>
<tr class="memdesc:aac73a1089592c5f22755b7427869827f"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: The shared initialiser from constructors of <a class="el" href="classTResponseFunction__red.html" title="KS: A reduced ResponseFunction Generic function used for evaluating weight.">TResponseFunction_red</a>.  <br /></td></tr>
<tr class="separator:aac73a1089592c5f22755b7427869827f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c374d4505de53ad68d176a5644568e6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a5c374d4505de53ad68d176a5644568e6">PrintInitialsiation</a> ()</td></tr>
<tr class="memdesc:a5c374d4505de53ad68d176a5644568e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Print info about how much knots etc has been initialised.  <br /></td></tr>
<tr class="separator:a5c374d4505de53ad68d176a5644568e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbbe3398718d0d02d65a1e92a91c112c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#acbbe3398718d0d02d65a1e92a91c112c">getSplineCoeff_SepMany</a> (<a class="el" href="classTSpline3__red.html">TSpline3_red</a> *&amp;spl, int &amp;nPoints, float *&amp;xArray, float *&amp;manyArray)</td></tr>
<tr class="memdesc:acbbe3398718d0d02d65a1e92a91c112c"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: This loads up coefficients into two arrays: one x array and one yabcd array.  <br /></td></tr>
<tr class="separator:acbbe3398718d0d02d65a1e92a91c112c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7128a7c13b10f331df8946a0a87c4b33"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a7128a7c13b10f331df8946a0a87c4b33">FindSplineSegment</a> () override</td></tr>
<tr class="memdesc:a7128a7c13b10f331df8946a0a87c4b33"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW:Code used in step by step reweighting, Find Spline Segment for each param.  <br /></td></tr>
<tr class="separator:a7128a7c13b10f331df8946a0a87c4b33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa36be17828281e1412a93c0e239cdbc0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aa36be17828281e1412a93c0e239cdbc0">CalcSplineWeights</a> () override</td></tr>
<tr class="memdesc:aa36be17828281e1412a93c0e239cdbc0"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU based code which eval weight for each spline.  <br /></td></tr>
<tr class="separator:aa36be17828281e1412a93c0e239cdbc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac37ee525aa57316f652433a4e393afaf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac37ee525aa57316f652433a4e393afaf">ModifyWeights</a> () override</td></tr>
<tr class="memdesc:ac37ee525aa57316f652433a4e393afaf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calc total event weight.  <br /></td></tr>
<tr class="separator:ac37ee525aa57316f652433a4e393afaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72cd282322bdaadb23d8a376efa9e2c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a72cd282322bdaadb23d8a376efa9e2c1">ModifyWeights_GPU</a> ()</td></tr>
<tr class="memdesc:a72cd282322bdaadb23d8a376efa9e2c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Conversion from valid splines to all.  <br /></td></tr>
<tr class="separator:a72cd282322bdaadb23d8a376efa9e2c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79f4bf0cac279cf57ab8f06698052922"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a79f4bf0cac279cf57ab8f06698052922">PrepareSplineFile</a> ()</td></tr>
<tr class="memdesc:a79f4bf0cac279cf57ab8f06698052922"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Prepare spline file that can be used for fast loading.  <br /></td></tr>
<tr class="separator:a79f4bf0cac279cf57ab8f06698052922"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6783cdc3c485378ca21852e1a7b02482"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a6783cdc3c485378ca21852e1a7b02482">LoadSplineFile</a> (std::string FileName)</td></tr>
<tr class="memdesc:a6783cdc3c485378ca21852e1a7b02482"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Load preprocessed spline file.  <br /></td></tr>
<tr class="separator:a6783cdc3c485378ca21852e1a7b02482"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a50a4ad58aebffdb820626f855bae6821"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structFastSplineInfo.html">FastSplineInfo</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a></td></tr>
<tr class="separator:a50a4ad58aebffdb820626f855bae6821"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53ab5b2235fd697f27556f1a1a7a5354"><td class="memItemLeft" align="right" valign="top">short int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a></td></tr>
<tr class="memdesc:a53ab5b2235fd697f27556f1a1a7a5354"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store currently found segment they are not in <a class="el" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.">FastSplineInfo</a> as in case of GPU we need to copy paste it to GPU.  <br /></td></tr>
<tr class="separator:a53ab5b2235fd697f27556f1a1a7a5354"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2a793b82a6c650a6fad52510e49b6b0"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a></td></tr>
<tr class="memdesc:aa2a793b82a6c650a6fad52510e49b6b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store parameter values they are not in <a class="el" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.">FastSplineInfo</a> as in case of GPU we need to copy paste it to GPU.  <br /></td></tr>
<tr class="separator:aa2a793b82a6c650a6fad52510e49b6b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa782652b0b3da923c5b20bb1319aadd"><td class="memItemLeft" align="right" valign="top">std::vector&lt; const double * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">splineParsPointer</a></td></tr>
<tr class="memdesc:afa782652b0b3da923c5b20bb1319aadd"><td class="mdescLeft">&#160;</td><td class="mdescRight">This holds pointer to parameter position which we later copy paste it to GPU.  <br /></td></tr>
<tr class="separator:afa782652b0b3da923c5b20bb1319aadd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac86282b04659bae5cccb6073c9edc0a5"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a></td></tr>
<tr class="memdesc:ac86282b04659bae5cccb6073c9edc0a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of events.  <br /></td></tr>
<tr class="separator:ac86282b04659bae5cccb6073c9edc0a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4606b53f321992377d420a838c76ab3b"><td class="memItemLeft" align="right" valign="top">short int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a></td></tr>
<tr class="memdesc:a4606b53f321992377d420a838c76ab3b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of NIWG parameters that have splines.  <br /></td></tr>
<tr class="separator:a4606b53f321992377d420a838c76ab3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0d1df54649909e4cee3385f68132799"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a></td></tr>
<tr class="memdesc:ac0d1df54649909e4cee3385f68132799"><td class="mdescLeft">&#160;</td><td class="mdescRight">Max knots for production.  <br /></td></tr>
<tr class="separator:ac0d1df54649909e4cee3385f68132799"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9fa50f60f717558f517faea6a38d251"><td class="memItemLeft" align="right" valign="top">int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a></td></tr>
<tr class="memdesc:ae9fa50f60f717558f517faea6a38d251"><td class="mdescLeft">&#160;</td><td class="mdescRight">holds the index for good splines; don't do unsigned since starts with negative value!  <br /></td></tr>
<tr class="separator:ae9fa50f60f717558f517faea6a38d251"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1aa70cce5867e7e784e97eacebe6bfbd"><td class="memItemLeft" align="right" valign="top">int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a1aa70cce5867e7e784e97eacebe6bfbd">index_TF1_cpu</a></td></tr>
<tr class="memdesc:a1aa70cce5867e7e784e97eacebe6bfbd"><td class="mdescLeft">&#160;</td><td class="mdescRight">holds the index for good TF1; don't do unsigned since starts with negative value!  <br /></td></tr>
<tr class="separator:a1aa70cce5867e7e784e97eacebe6bfbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab72795333d6f632565b0f7eb0ca8a658"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a></td></tr>
<tr class="memdesc:ab72795333d6f632565b0f7eb0ca8a658"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of valid splines.  <br /></td></tr>
<tr class="separator:ab72795333d6f632565b0f7eb0ca8a658"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13699796db31517edba3a8009317f779"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a></td></tr>
<tr class="memdesc:a13699796db31517edba3a8009317f779"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of valid TF1.  <br /></td></tr>
<tr class="separator:a13699796db31517edba3a8009317f779"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee3c18513f8209f1ac940b492cd3ed68"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a></td></tr>
<tr class="memdesc:aee3c18513f8209f1ac940b492cd3ed68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of total splines if each event had every parameter's spline.  <br /></td></tr>
<tr class="separator:aee3c18513f8209f1ac940b492cd3ed68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc0e3d1eafd575cf7628319a66925d5b"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a></td></tr>
<tr class="memdesc:afc0e3d1eafd575cf7628319a66925d5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sum of all knots over all splines.  <br /></td></tr>
<tr class="separator:afc0e3d1eafd575cf7628319a66925d5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a403e7cf909f98d4c59b5f6c7ff8aac5b"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a></td></tr>
<tr class="memdesc:a403e7cf909f98d4c59b5f6c7ff8aac5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sum of all coefficients over all TF1.  <br /></td></tr>
<tr class="separator:a403e7cf909f98d4c59b5f6c7ff8aac5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6a29f13d8e6efb380f2b9d59cfa88fc"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a></td></tr>
<tr class="memdesc:ab6a29f13d8e6efb380f2b9d59cfa88fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU arrays to hold weight for each spline.  <br /></td></tr>
<tr class="separator:ab6a29f13d8e6efb380f2b9d59cfa88fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a1d45d273cc40cb4f684400812dcb60"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a></td></tr>
<tr class="memdesc:a4a1d45d273cc40cb4f684400812dcb60"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU arrays to hold weight for each TF1.  <br /></td></tr>
<tr class="separator:a4a1d45d273cc40cb4f684400812dcb60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a6599372d1e3d38105478a68308d9a6"><td class="memItemLeft" align="right" valign="top">std::vector&lt; unsigned int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a></td></tr>
<tr class="memdesc:a0a6599372d1e3d38105478a68308d9a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}.  <br /></td></tr>
<tr class="separator:a0a6599372d1e3d38105478a68308d9a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66eecc550dea893c60a435a034e7ebf5"><td class="memItemLeft" align="right" valign="top">std::vector&lt; unsigned int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a></td></tr>
<tr class="memdesc:a66eecc550dea893c60a435a034e7ebf5"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number of TF1 per event, index where TF1 start for a given event}.  <br /></td></tr>
<tr class="separator:a66eecc550dea893c60a435a034e7ebf5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48d0e5e5b4130fcd191c3e8f1d841eb7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structSplineMonoStruct.html">SplineMonoStruct</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a></td></tr>
<tr class="memdesc:a48d0e5e5b4130fcd191c3e8f1d841eb7"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Store info about Spline monolith, this allow to obtain better step time. As all necessary information for spline weight calculation are here meaning better cache hits.  <br /></td></tr>
<tr class="separator:a48d0e5e5b4130fcd191c3e8f1d841eb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03444cbed8a9d9a7798d0ef2b26bd702"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classSMonolithGPU.html">SMonolithGPU</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a></td></tr>
<tr class="memdesc:a03444cbed8a9d9a7798d0ef2b26bd702"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Store info about Spline monolith, this allow to obtain better step time. As all necessary information for spline weight calculation are here meaning better cache hits.  <br /></td></tr>
<tr class="separator:a03444cbed8a9d9a7798d0ef2b26bd702"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a456dd14e1693e445ad6dddd5a8b9794f"><td class="memItemLeft" align="right" valign="top">std::vector&lt; float &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a></td></tr>
<tr class="memdesc:a456dd14e1693e445ad6dddd5a8b9794f"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU arrays to hold TF1 coefficients.  <br /></td></tr>
<tr class="separator:a456dd14e1693e445ad6dddd5a8b9794f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14b9c21186a53196f49c8d8d3555fbf2"><td class="memItemLeft" align="right" valign="top">std::vector&lt; short int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a></td></tr>
<tr class="memdesc:a14b9c21186a53196f49c8d8d3555fbf2"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU arrays to hold number of points.  <br /></td></tr>
<tr class="separator:a14b9c21186a53196f49c8d8d3555fbf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af87cf7ae888eb7d4c56f8b6c41c9fd02"><td class="memItemLeft" align="right" valign="top">std::vector&lt; short int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a></td></tr>
<tr class="memdesc:af87cf7ae888eb7d4c56f8b6c41c9fd02"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: CPU array with the number of points per spline (not per spline point!)  <br /></td></tr>
<tr class="separator:af87cf7ae888eb7d4c56f8b6c41c9fd02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5692081772ca14bd012eb125e2ccfd4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">SaveSplineFile</a></td></tr>
<tr class="memdesc:ab5692081772ca14bd012eb125e2ccfd4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag telling whether we are saving spline monolith into handy root file.  <br /></td></tr>
<tr class="separator:ab5692081772ca14bd012eb125e2ccfd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="inherited" name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pro_methods_classSplineBase"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_classSplineBase')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="classSplineBase.html">SplineBase</a></td></tr>
<tr class="memitem:ae18e490295762416c8627d2db11ee98d inherit pro_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#ae18e490295762416c8627d2db11ee98d">FindSplineSegment</a> ()=0</td></tr>
<tr class="memdesc:ae18e490295762416c8627d2db11ee98d inherit pro_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW:Code used in step by step reweighting, Find Spline Segment for each param.  <br /></td></tr>
<tr class="separator:ae18e490295762416c8627d2db11ee98d inherit pro_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ceacf5fee1fc8438501582bef93a9b5 inherit pro_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#a1ceacf5fee1fc8438501582bef93a9b5">CalcSplineWeights</a> ()=0</td></tr>
<tr class="memdesc:a1ceacf5fee1fc8438501582bef93a9b5 inherit pro_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU based code which eval weight for each spline.  <br /></td></tr>
<tr class="separator:a1ceacf5fee1fc8438501582bef93a9b5 inherit pro_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49665d2712b61b038085d25ace96a568 inherit pro_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#a49665d2712b61b038085d25ace96a568">ModifyWeights</a> ()=0</td></tr>
<tr class="memdesc:a49665d2712b61b038085d25ace96a568 inherit pro_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calc total event weight.  <br /></td></tr>
<tr class="separator:a49665d2712b61b038085d25ace96a568 inherit pro_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8a5f86ac6f156a7e11ef188b06f425f inherit pro_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#ac8a5f86ac6f156a7e11ef188b06f425f">getTF1Coeff</a> (<a class="el" href="classTF1__red.html">TF1_red</a> *&amp;spl, int &amp;nPoints, float *&amp;coeffs)</td></tr>
<tr class="memdesc:ac8a5f86ac6f156a7e11ef188b06f425f inherit pro_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Gets the polynomial coefficients for TF1.  <br /></td></tr>
<tr class="separator:ac8a5f86ac6f156a7e11ef188b06f425f inherit pro_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Even-by-event class calculating response for spline parameters. It is possible to use GPU acceleration. </p>
<dl class="section see"><dt>See also</dt><dd>For more details, visit the <a href="https://github.com/mach3-software/MaCh3/wiki/05.-Splines">Wiki</a>. </dd></dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00010">10</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a4fe737f7c948f9ee963d87aac46ddebb" name="a4fe737f7c948f9ee963d87aac46ddebb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fe737f7c948f9ee963d87aac46ddebb">&#9670;&#160;</a></span>SMonolith() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SMonolith::SMonolith </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classTResponseFunction__red.html">TResponseFunction_red</a> * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36d">RespFuncType</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>SplineType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>SaveFlatTree</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of TSpline3 pointers which we strip back </td></tr>
    <tr><td class="paramname">SplineType</td><td>Whether object is TSpline3 or TF1 </td></tr>
    <tr><td class="paramname">SaveFlatTree</td><td>Whether we want to save monolith into speedy flat tree </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00048">48</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   49</span>: <a class="code hl_function" href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase</a>() {</div>
<div class="line"><span class="lineno">   50</span><span class="comment">// *****************************************</span></div>
<div class="line"><span class="lineno">   51</span> </div>
<div class="line"><span class="lineno">   52</span>  <span class="comment">//KS: If true it will save spline monolith into huge ROOT file</span></div>
<div class="line"><span class="lineno">   53</span>  <a class="code hl_variable" href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">SaveSplineFile</a> = SaveFlatTree;</div>
<div class="line"><span class="lineno">   54</span>  <a class="code hl_function" href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">Initialise</a>();</div>
<div class="line"><span class="lineno">   55</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;-- GPUING WITH arrays and master spline containing TResponseFunction_red&quot;</span>);</div>
<div class="line"><span class="lineno">   56</span> </div>
<div class="line"><span class="lineno">   57</span>  <span class="comment">// Convert the TSpline3 pointers to the reduced form and call the reduced constructor</span></div>
<div class="line"><span class="lineno">   58</span>  <a class="code hl_function" href="classSMonolith.html#aa1bd2dc5c55b7258d5544512659ef9d7">PrepareForGPU</a>(MasterSpline, SplineType);</div>
<div class="line"><span class="lineno">   59</span>}</div>
<div class="ttc" id="aMaCh3Logger_8h_html_a95fa4dffc648e4c5536c9292c2bdcac3"><div class="ttname"><a href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a></div><div class="ttdeci">#define MACH3LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Logger_8h_source.html#l00016">MaCh3Logger.h:16</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a45cece9dcbe699e00a7b5fdff4806c1e"><div class="ttname"><a href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">SMonolith::Initialise</a></div><div class="ttdeci">void Initialise()</div><div class="ttdoc">KS: Set everything to null etc.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00012">SplineMonolith.cpp:12</a></div></div>
<div class="ttc" id="aclassSMonolith_html_aa1bd2dc5c55b7258d5544512659ef9d7"><div class="ttname"><a href="classSMonolith.html#aa1bd2dc5c55b7258d5544512659ef9d7">SMonolith::PrepareForGPU</a></div><div class="ttdeci">void PrepareForGPU(std::vector&lt; std::vector&lt; TResponseFunction_red * &gt; &gt; &amp;MasterSpline, const std::vector&lt; RespFuncType &gt; &amp;SplineType)</div><div class="ttdoc">CW: Prepare the TSpline3_red objects for the GPU.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00063">SplineMonolith.cpp:63</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ab5692081772ca14bd012eb125e2ccfd4"><div class="ttname"><a href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">SMonolith::SaveSplineFile</a></div><div class="ttdeci">bool SaveSplineFile</div><div class="ttdoc">Flag telling whether we are saving spline monolith into handy root file.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00171">SplineMonolith.h:171</a></div></div>
<div class="ttc" id="aclassSplineBase_html_aa6965d1522cc68ecf81ac3bfd2dcd6f1"><div class="ttname"><a href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase::SplineBase</a></div><div class="ttdeci">SplineBase()</div><div class="ttdoc">Constructor.</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8cpp_source.html#l00007">SplineBase.cpp:7</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac622c355f630c12438b547bbb9fe212c" name="ac622c355f630c12438b547bbb9fe212c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac622c355f630c12438b547bbb9fe212c">&#9670;&#160;</a></span>SMonolith() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SMonolith::SMonolith </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>FileName</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor where you pass path to preprocessed root FileName. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">FileName</td><td>path to pre-processed root file containing stripped monolith info </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00518">518</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  519</span>          : <a class="code hl_function" href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase</a>() {</div>
<div class="line"><span class="lineno">  520</span><span class="comment">// *****************************************</span></div>
<div class="line"><span class="lineno">  521</span>  <a class="code hl_function" href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">Initialise</a>();</div>
<div class="line"><span class="lineno">  522</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;-- GPUING WITH {X} and {Y,B,C,D} arrays and master spline containing TSpline3_red&quot;</span>);</div>
<div class="line"><span class="lineno">  523</span>  <span class="comment">// Convert the TSpline3 pointers to the reduced form and call the reduced constructor</span></div>
<div class="line"><span class="lineno">  524</span>  <a class="code hl_function" href="classSMonolith.html#a6783cdc3c485378ca21852e1a7b02482">LoadSplineFile</a>(FileName);</div>
<div class="line"><span class="lineno">  525</span>}</div>
<div class="ttc" id="aclassSMonolith_html_a6783cdc3c485378ca21852e1a7b02482"><div class="ttname"><a href="classSMonolith.html#a6783cdc3c485378ca21852e1a7b02482">SMonolith::LoadSplineFile</a></div><div class="ttdeci">void LoadSplineFile(std::string FileName)</div><div class="ttdoc">KS: Load preprocessed spline file.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00529">SplineMonolith.cpp:529</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac0ae7f110fa4c6e46e808d8c1ae979b6" name="ac0ae7f110fa4c6e46e808d8c1ae979b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0ae7f110fa4c6e46e808d8c1ae979b6">&#9670;&#160;</a></span>~SMonolith()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">SMonolith::~SMonolith </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor for <a class="el" href="classSMonolith.html" title="Even-by-event class calculating response for spline parameters. It is possible to use GPU acceleratio...">SMonolith</a> class. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00812">812</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  812</span>                      {</div>
<div class="line"><span class="lineno">  813</span>  <span class="comment">// *****************************************</span></div>
<div class="line"><span class="lineno">  814</span> </div>
<div class="line"><span class="lineno">  815</span><span class="preprocessor">  #ifdef CUDA</span></div>
<div class="line"><span class="lineno">  816</span>  <a class="code hl_variable" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code hl_function" href="classSMonolithGPU.html#a1ca23401d8d99412288952a1d44390ea">CleanupGPU_SplineMonolith</a>(</div>
<div class="line"><span class="lineno">  817</span>        #ifndef Weight_On_SplineBySpline_Basis</div>
<div class="line"><span class="lineno">  818</span>        <a class="code hl_variable" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a></div>
<div class="line"><span class="lineno">  819</span>        #endif</div>
<div class="line"><span class="lineno">  820</span>        );</div>
<div class="line"><span class="lineno">  821</span> </div>
<div class="line"><span class="lineno">  822</span>  <span class="comment">//KS: Since we declared them using CUDA alloc we have to free memory using also cuda functions</span></div>
<div class="line"><span class="lineno">  823</span>  <a class="code hl_variable" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code hl_function" href="classSMonolithGPU.html#af5ca949ba6d79666b541350d24e3daaf">CleanupGPU_Segments</a>(<a class="code hl_variable" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>, <a class="code hl_variable" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>);</div>
<div class="line"><span class="lineno">  824</span> </div>
<div class="line"><span class="lineno">  825</span>  <span class="keyword">delete</span> <a class="code hl_variable" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>;</div>
<div class="line"><span class="lineno">  826</span><span class="preprocessor">  #else</span></div>
<div class="line"><span class="lineno">  827</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code hl_variable" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>;</div>
<div class="line"><span class="lineno">  828</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code hl_variable" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>;</div>
<div class="line"><span class="lineno">  829</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code hl_variable" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>;</div>
<div class="line"><span class="lineno">  830</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno">  831</span> </div>
<div class="line"><span class="lineno">  832</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>;</div>
<div class="line"><span class="lineno">  833</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code hl_variable" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a>;</div>
<div class="line"><span class="lineno">  834</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code hl_variable" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a>;</div>
<div class="line"><span class="lineno">  835</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code hl_variable" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a>;</div>
<div class="line"><span class="lineno">  836</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code hl_variable" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a>;</div>
<div class="line"><span class="lineno">  837</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="classSMonolith.html#a1aa70cce5867e7e784e97eacebe6bfbd">index_TF1_cpu</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code hl_variable" href="classSMonolith.html#a1aa70cce5867e7e784e97eacebe6bfbd">index_TF1_cpu</a>;</div>
<div class="line"><span class="lineno">  838</span> </div>
<div class="line"><span class="lineno">  839</span>  <span class="comment">//KS: Those might be deleted or not depending on GPU/CPU TSpline3/TF1 DEBUG or not hence we check if not NULL</span></div>
<div class="line"><span class="lineno">  840</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a> != <span class="keyword">nullptr</span>)</div>
<div class="line"><span class="lineno">  841</span>  {</div>
<div class="line"><span class="lineno">  842</span>    <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>.clear();</div>
<div class="line"><span class="lineno">  843</span>    <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  844</span>    <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>.clear();</div>
<div class="line"><span class="lineno">  845</span>    <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  846</span>    <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>.clear();</div>
<div class="line"><span class="lineno">  847</span>    <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  848</span>    <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>.clear();</div>
<div class="line"><span class="lineno">  849</span>    <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  850</span>  }</div>
<div class="line"><span class="lineno">  851</span>  <a class="code hl_variable" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>.clear();</div>
<div class="line"><span class="lineno">  852</span>  <a class="code hl_variable" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  853</span>  <a class="code hl_variable" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a>.clear();</div>
<div class="line"><span class="lineno">  854</span>  <a class="code hl_variable" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  855</span><span class="preprocessor">  #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><span class="lineno">  856</span>  <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.clear();</div>
<div class="line"><span class="lineno">  857</span>  <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  858</span>  <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>.clear();</div>
<div class="line"><span class="lineno">  859</span>  <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  860</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno">  861</span>  <a class="code hl_variable" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>.clear();</div>
<div class="line"><span class="lineno">  862</span>  <a class="code hl_variable" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  863</span> </div>
<div class="line"><span class="lineno">  864</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span> <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>;</div>
<div class="line"><span class="lineno">  865</span>}</div>
<div class="ttc" id="aclassSMonolithGPU_html_a1ca23401d8d99412288952a1d44390ea"><div class="ttname"><a href="classSMonolithGPU.html#a1ca23401d8d99412288952a1d44390ea">SMonolithGPU::CleanupGPU_SplineMonolith</a></div><div class="ttdeci">__host__ void CleanupGPU_SplineMonolith(float *cpu_total_weights)</div><div class="ttdoc">This function deallocates the resources allocated for the separate {x} and {ybcd} arrays in the and T...</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00568">gpuSplineUtils.cu:568</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_af5ca949ba6d79666b541350d24e3daaf"><div class="ttname"><a href="classSMonolithGPU.html#af5ca949ba6d79666b541350d24e3daaf">SMonolithGPU::CleanupGPU_Segments</a></div><div class="ttdeci">__host__ void CleanupGPU_Segments(short int *segment, float *vals)</div><div class="ttdoc">Clean up pinned variables at CPU.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00604">gpuSplineUtils.cu:604</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a03444cbed8a9d9a7798d0ef2b26bd702"><div class="ttname"><a href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">SMonolith::gpu_spline_handler</a></div><div class="ttdeci">SMonolithGPU * gpu_spline_handler</div><div class="ttdoc">KS: Store info about Spline monolith, this allow to obtain better step time. As all necessary informa...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00159">SplineMonolith.h:159</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a0a6599372d1e3d38105478a68308d9a6"><div class="ttname"><a href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">SMonolith::cpu_nParamPerEvent</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; cpu_nParamPerEvent</div><div class="ttdoc">KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00150">SplineMonolith.h:150</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a14b9c21186a53196f49c8d8d3555fbf2"><div class="ttname"><a href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">SMonolith::cpu_nPoints_arr</a></div><div class="ttdeci">std::vector&lt; short int &gt; cpu_nPoints_arr</div><div class="ttdoc">CPU arrays to hold number of points.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00165">SplineMonolith.h:165</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a1aa70cce5867e7e784e97eacebe6bfbd"><div class="ttname"><a href="classSMonolith.html#a1aa70cce5867e7e784e97eacebe6bfbd">SMonolith::index_TF1_cpu</a></div><div class="ttdeci">int * index_TF1_cpu</div><div class="ttdoc">holds the index for good TF1; don't do unsigned since starts with negative value!</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00128">SplineMonolith.h:128</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a456dd14e1693e445ad6dddd5a8b9794f"><div class="ttname"><a href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">SMonolith::cpu_coeff_TF1_many</a></div><div class="ttdeci">std::vector&lt; float &gt; cpu_coeff_TF1_many</div><div class="ttdoc">CPU arrays to hold TF1 coefficients.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00162">SplineMonolith.h:162</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a48d0e5e5b4130fcd191c3e8f1d841eb7"><div class="ttname"><a href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">SMonolith::cpu_spline_handler</a></div><div class="ttdeci">SplineMonoStruct * cpu_spline_handler</div><div class="ttdoc">KS: Store info about Spline monolith, this allow to obtain better step time. As all necessary informa...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00156">SplineMonolith.h:156</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a4a1d45d273cc40cb4f684400812dcb60"><div class="ttname"><a href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">SMonolith::cpu_weights_tf1_var</a></div><div class="ttdeci">float * cpu_weights_tf1_var</div><div class="ttdoc">CPU arrays to hold weight for each TF1.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00147">SplineMonolith.h:147</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a50a4ad58aebffdb820626f855bae6821"><div class="ttname"><a href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SMonolith::SplineInfoArray</a></div><div class="ttdeci">FastSplineInfo * SplineInfoArray</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00111">SplineMonolith.h:111</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a53ab5b2235fd697f27556f1a1a7a5354"><div class="ttname"><a href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">SMonolith::segments</a></div><div class="ttdeci">short int * segments</div><div class="ttdoc">Store currently found segment they are not in FastSplineInfo as in case of GPU we need to copy paste ...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00113">SplineMonolith.h:113</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a66eecc550dea893c60a435a034e7ebf5"><div class="ttname"><a href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">SMonolith::cpu_nParamPerEvent_tf1</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; cpu_nParamPerEvent_tf1</div><div class="ttdoc">KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00153">SplineMonolith.h:153</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a8614e8ef07431d99f62ab88d9ebdad16"><div class="ttname"><a href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">SMonolith::cpu_weights</a></div><div class="ttdeci">float * cpu_weights</div><div class="ttdoc">The returned gpu weights, read by the GPU.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00050">SplineMonolith.h:50</a></div></div>
<div class="ttc" id="aclassSMonolith_html_aa2a793b82a6c650a6fad52510e49b6b0"><div class="ttname"><a href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">SMonolith::vals</a></div><div class="ttdeci">float * vals</div><div class="ttdoc">Store parameter values they are not in FastSplineInfo as in case of GPU we need to copy paste it to G...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00115">SplineMonolith.h:115</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ab572dd7e0a46caf44eb925a89cbfb0cf"><div class="ttname"><a href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">SMonolith::cpu_total_weights</a></div><div class="ttdeci">float * cpu_total_weights</div><div class="ttdoc">KS: This holds the total CPU weights that gets read in samplePDFND.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00052">SplineMonolith.h:52</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ab6a29f13d8e6efb380f2b9d59cfa88fc"><div class="ttname"><a href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">SMonolith::cpu_weights_var</a></div><div class="ttdeci">float * cpu_weights_var</div><div class="ttdoc">CPU arrays to hold weight for each spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00144">SplineMonolith.h:144</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ae9fa50f60f717558f517faea6a38d251"><div class="ttname"><a href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">SMonolith::index_cpu</a></div><div class="ttdeci">int * index_cpu</div><div class="ttdoc">holds the index for good splines; don't do unsigned since starts with negative value!</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00126">SplineMonolith.h:126</a></div></div>
<div class="ttc" id="aclassSMonolith_html_af87cf7ae888eb7d4c56f8b6c41c9fd02"><div class="ttname"><a href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">SMonolith::cpu_paramNo_TF1_arr</a></div><div class="ttdeci">std::vector&lt; short int &gt; cpu_paramNo_TF1_arr</div><div class="ttdoc">CW: CPU array with the number of points per spline (not per spline point!)</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00168">SplineMonolith.h:168</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html_a398e0212915793852137384a3406b37f"><div class="ttname"><a href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">SplineMonoStruct::nKnots_arr</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; nKnots_arr</div><div class="ttdoc">KS: CPU Number of knots per spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00042">SplineCommon.h:42</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html_a47012ee423ea21f99d06eff8257cf0f0"><div class="ttname"><a href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">SplineMonoStruct::coeff_x</a></div><div class="ttdeci">std::vector&lt; float &gt; coeff_x</div><div class="ttdoc">KS: CPU arrays to hold X coefficient.</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00036">SplineCommon.h:36</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html_a67c5585ae47fc8a646dfae3fe9690775"><div class="ttname"><a href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">SplineMonoStruct::coeff_many</a></div><div class="ttdeci">std::vector&lt; float &gt; coeff_many</div><div class="ttdoc">CPU arrays to hold other coefficients.</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00039">SplineCommon.h:39</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html_af24b409ab3da1a88e855e1a9d172741f"><div class="ttname"><a href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">SplineMonoStruct::paramNo_arr</a></div><div class="ttdeci">std::vector&lt; short int &gt; paramNo_arr</div><div class="ttdoc">CW: CPU array with the number of points per spline (not per spline point!)</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00045">SplineCommon.h:45</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aa36be17828281e1412a93c0e239cdbc0" name="aa36be17828281e1412a93c0e239cdbc0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa36be17828281e1412a93c0e239cdbc0">&#9670;&#160;</a></span>CalcSplineWeights()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::CalcSplineWeights </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">private</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU based code which eval weight for each spline. </p>

<p>Implements <a class="el" href="classSplineBase.html#a1ceacf5fee1fc8438501582bef93a9b5">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01050">1050</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1050</span>                                  {</div>
<div class="line"><span class="lineno"> 1051</span><span class="comment">//*********************************************************</span></div>
<div class="line"><span class="lineno"> 1052</span><span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><span class="lineno"> 1053</span>  <span class="comment">//KS: Open parallel region</span></div>
<div class="line"><span class="lineno"> 1054</span><span class="preprocessor">  #pragma omp parallel</span></div>
<div class="line"><span class="lineno"> 1055</span>  {</div>
<div class="line"><span class="lineno"> 1056</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno"> 1057</span>    <span class="comment">//KS: First we calculate</span></div>
<div class="line"><span class="lineno"> 1058</span><span class="preprocessor">    #ifdef MULTITHREAD</span></div>
<div class="line"><span class="lineno"> 1059</span><span class="preprocessor">    #pragma omp for simd nowait</span></div>
<div class="line"><span class="lineno"> 1060</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno"> 1061</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> splineNum = 0; splineNum &lt; <a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>; ++splineNum)</div>
<div class="line"><span class="lineno"> 1062</span>    {</div>
<div class="line"><span class="lineno"> 1063</span>      <span class="comment">//CW: Which Parameter we are accessing</span></div>
<div class="line"><span class="lineno"> 1064</span>      <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> Param = <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>[splineNum];</div>
<div class="line"><span class="lineno"> 1065</span> </div>
<div class="line"><span class="lineno"> 1066</span>      <span class="comment">//CW: Avoids doing costly binary search on GPU</span></div>
<div class="line"><span class="lineno"> 1067</span>      <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> segment = <a class="code hl_variable" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>[Param];</div>
<div class="line"><span class="lineno"> 1068</span> </div>
<div class="line"><span class="lineno"> 1069</span>      <span class="comment">//KS: Segment for coeff_x is simply parameter*max knots + segment as each parameters has the same spacing</span></div>
<div class="line"><span class="lineno"> 1070</span>      <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> segment_X = short(Param*<a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>+segment);</div>
<div class="line"><span class="lineno"> 1071</span> </div>
<div class="line"><span class="lineno"> 1072</span>      <span class="comment">//KS: Find knot position in out monolithical structure</span></div>
<div class="line"><span class="lineno"> 1073</span>      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CurrentKnotPos = <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>[splineNum]*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+segment*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>;</div>
<div class="line"><span class="lineno"> 1074</span> </div>
<div class="line"><span class="lineno"> 1075</span>      <span class="comment">// We&#39;ve read the segment straight from CPU and is saved in segment_gpu</span></div>
<div class="line"><span class="lineno"> 1076</span>      <span class="comment">// polynomial parameters from the monolithic splineMonolith</span></div>
<div class="line"><span class="lineno"> 1077</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> fY = <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>[CurrentKnotPos];</div>
<div class="line"><span class="lineno"> 1078</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> fB = <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>[CurrentKnotPos+1];</div>
<div class="line"><span class="lineno"> 1079</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> fC = <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>[CurrentKnotPos+2];</div>
<div class="line"><span class="lineno"> 1080</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> fD = <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>[CurrentKnotPos+3];</div>
<div class="line"><span class="lineno"> 1081</span>      <span class="comment">// The is the variation itself (needed to evaluate variation - stored spline point = dx)</span></div>
<div class="line"><span class="lineno"> 1082</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> dx = <a class="code hl_variable" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>[Param] - <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>[segment_X];</div>
<div class="line"><span class="lineno"> 1083</span> </div>
<div class="line"><span class="lineno"> 1084</span>      <span class="comment">//CW: Wooow, let&#39;s use some fancy intrinsic and pull down the processing time by &lt;1% from normal multiplication! HURRAY</span></div>
<div class="line"><span class="lineno"> 1085</span>      <a class="code hl_variable" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a>[splineNum] = fmaf(dx, fmaf(dx, fmaf(dx, fD, fC), fB), fY);</div>
<div class="line"><span class="lineno"> 1086</span>      <span class="comment">// Or for the more &quot;easy to read&quot; version:</span></div>
<div class="line"><span class="lineno"> 1087</span>      <span class="comment">//cpu_weights_var[splineNum] = (fY+dx*(fB+dx*(fC+dx*fD)));</span></div>
<div class="line"><span class="lineno"> 1088</span>    }</div>
<div class="line"><span class="lineno"> 1089</span> </div>
<div class="line"><span class="lineno"> 1090</span><span class="preprocessor">    #ifdef MULTITHREAD</span></div>
<div class="line"><span class="lineno"> 1091</span><span class="preprocessor">    #pragma omp for simd</span></div>
<div class="line"><span class="lineno"> 1092</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno"> 1093</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tf1Num = 0; tf1Num &lt; <a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>; ++tf1Num)</div>
<div class="line"><span class="lineno"> 1094</span>    {</div>
<div class="line"><span class="lineno"> 1095</span>      <span class="comment">// The is the variation itself (needed to evaluate variation - stored spline point = dx)</span></div>
<div class="line"><span class="lineno"> 1096</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> x = <a class="code hl_variable" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>[<a class="code hl_variable" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a>[tf1Num]];</div>
<div class="line"><span class="lineno"> 1097</span> </div>
<div class="line"><span class="lineno"> 1098</span>      <span class="comment">// Read the coefficients</span></div>
<div class="line"><span class="lineno"> 1099</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> a = <a class="code hl_variable" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>[tf1Num*<a class="code hl_define" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>];</div>
<div class="line"><span class="lineno"> 1100</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> b = <a class="code hl_variable" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>[tf1Num*<a class="code hl_define" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>+1];</div>
<div class="line"><span class="lineno"> 1101</span> </div>
<div class="line"><span class="lineno"> 1102</span>      <a class="code hl_variable" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a>[tf1Num] = fmaf(a, x, b);</div>
<div class="line"><span class="lineno"> 1103</span>      <span class="comment">// cpu_weights_tf1_var[tf1Num] = a*x + b;</span></div>
<div class="line"><span class="lineno"> 1104</span> </div>
<div class="line"><span class="lineno"> 1105</span>      <span class="comment">//cpu_weights_tf1_var[splineNum] = 1 + a*x + b*x*x + c*x*x*x + d*x*x*x*x + e*x*x*x*x*x;</span></div>
<div class="line"><span class="lineno"> 1106</span>    }</div>
<div class="line"><span class="lineno"> 1107</span><span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><span class="lineno"> 1108</span>  <span class="comment">//KS: End parallel region</span></div>
<div class="line"><span class="lineno"> 1109</span>  }</div>
<div class="line"><span class="lineno"> 1110</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno"> 1111</span>  <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1112</span>}</div>
<div class="ttc" id="aSplineCommon_8h_html_a283177311bade7400c6088e8fad71a1f"><div class="ttname"><a href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a></div><div class="ttdeci">#define _nCoeff_</div><div class="ttdoc">KS: We store coefficients {y,b,c,d} in one array one by one, this is only to define it once rather th...</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00015">SplineCommon.h:15</a></div></div>
<div class="ttc" id="aSplineCommon_8h_html_a911160077ffa38727e0494f178ce380a"><div class="ttname"><a href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a></div><div class="ttdeci">#define _nTF1Coeff_</div><div class="ttdoc">KS: For TF1 we store at most 5 coefficients, we could make it more flexible but for now define it her...</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00017">SplineCommon.h:17</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a13699796db31517edba3a8009317f779"><div class="ttname"><a href="classSMonolith.html#a13699796db31517edba3a8009317f779">SMonolith::NTF1_valid</a></div><div class="ttdeci">unsigned int NTF1_valid</div><div class="ttdoc">Number of valid TF1.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00133">SplineMonolith.h:133</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ab72795333d6f632565b0f7eb0ca8a658"><div class="ttname"><a href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">SMonolith::NSplines_valid</a></div><div class="ttdeci">unsigned int NSplines_valid</div><div class="ttdoc">Number of valid splines.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00131">SplineMonolith.h:131</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ac0d1df54649909e4cee3385f68132799"><div class="ttname"><a href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">SMonolith::_max_knots</a></div><div class="ttdeci">int _max_knots</div><div class="ttdoc">Max knots for production.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00124">SplineMonolith.h:124</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3d1128bb78b165d94721407a124f516b" name="a3d1128bb78b165d94721407a124f516b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d1128bb78b165d94721407a124f516b">&#9670;&#160;</a></span>Evaluate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::Evaluate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: This Eval should be used when using two separate x,{y,a,b,c,d} arrays to store the weights; probably the best one here! Same thing but pass parameter spline segments instead of variations. </p>

<p>Implements <a class="el" href="classSplineBase.html#a86e629f3eef59b2f3800136c86fe90c3">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00950">950</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  950</span>                         {</div>
<div class="line"><span class="lineno">  951</span><span class="comment">// *****************************************</span></div>
<div class="line"><span class="lineno">  952</span> </div>
<div class="line"><span class="lineno">  953</span>  <span class="comment">// There&#39;s a parameter mapping that goes from spline parameter to a global parameter index</span></div>
<div class="line"><span class="lineno">  954</span>  <span class="comment">// Find the spline segments</span></div>
<div class="line"><span class="lineno">  955</span>  <a class="code hl_function" href="classSMonolith.html#a7128a7c13b10f331df8946a0a87c4b33">FindSplineSegment</a>();</div>
<div class="line"><span class="lineno">  956</span> </div>
<div class="line"><span class="lineno">  957</span>  <span class="comment">//KS: Huge MP loop over all valid splines</span></div>
<div class="line"><span class="lineno">  958</span>  <a class="code hl_function" href="classSMonolith.html#aa36be17828281e1412a93c0e239cdbc0">CalcSplineWeights</a>();</div>
<div class="line"><span class="lineno">  959</span> </div>
<div class="line"><span class="lineno">  960</span>  <span class="comment">//KS: Huge MP loop over all events calculating total weight</span></div>
<div class="line"><span class="lineno">  961</span>  <a class="code hl_function" href="classSMonolith.html#ac37ee525aa57316f652433a4e393afaf">ModifyWeights</a>();</div>
<div class="line"><span class="lineno">  962</span> </div>
<div class="line"><span class="lineno">  963</span>  <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  964</span>}</div>
<div class="ttc" id="aclassSMonolith_html_a7128a7c13b10f331df8946a0a87c4b33"><div class="ttname"><a href="classSMonolith.html#a7128a7c13b10f331df8946a0a87c4b33">SMonolith::FindSplineSegment</a></div><div class="ttdeci">void FindSplineSegment() override</div><div class="ttdoc">CW:Code used in step by step reweighting, Find Spline Segment for each param.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00971">SplineMonolith.cpp:971</a></div></div>
<div class="ttc" id="aclassSMonolith_html_aa36be17828281e1412a93c0e239cdbc0"><div class="ttname"><a href="classSMonolith.html#aa36be17828281e1412a93c0e239cdbc0">SMonolith::CalcSplineWeights</a></div><div class="ttdeci">void CalcSplineWeights() override</div><div class="ttdoc">CPU based code which eval weight for each spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01050">SplineMonolith.cpp:1050</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ac37ee525aa57316f652433a4e393afaf"><div class="ttname"><a href="classSMonolith.html#ac37ee525aa57316f652433a4e393afaf">SMonolith::ModifyWeights</a></div><div class="ttdeci">void ModifyWeights() override</div><div class="ttdoc">Calc total event weight.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01116">SplineMonolith.cpp:1116</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7128a7c13b10f331df8946a0a87c4b33" name="a7128a7c13b10f331df8946a0a87c4b33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7128a7c13b10f331df8946a0a87c4b33">&#9670;&#160;</a></span>FindSplineSegment()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::FindSplineSegment </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">private</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW:Code used in step by step reweighting, Find Spline Segment for each param. </p>

<p>Implements <a class="el" href="classSplineBase.html#ae18e490295762416c8627d2db11ee98d">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00971">971</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  971</span>                                  {</div>
<div class="line"><span class="lineno">  972</span><span class="comment">// *************************</span></div>
<div class="line"><span class="lineno">  973</span>  <span class="comment">// Loop over the splines</span></div>
<div class="line"><span class="lineno">  974</span>  <span class="comment">//KS: Tried multithreading here with 48 splines and it is faster with one thread, maybe in future multithreading will be worth revisiting</span></div>
<div class="line"><span class="lineno">  975</span>  <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> i = 0; i &lt; <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>; ++i)</div>
<div class="line"><span class="lineno">  976</span>  {</div>
<div class="line"><span class="lineno">  977</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> nPoints = <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="structFastSplineInfo.html#ac8538a8e3438ae06d8f467cc0fd5ce0d">nPts</a>;</div>
<div class="line"><span class="lineno">  978</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a>* xArray = <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="structFastSplineInfo.html#a9e9d432eb250bba227d31022ac9c5779">xPts</a>;</div>
<div class="line"><span class="lineno">  979</span> </div>
<div class="line"><span class="lineno">  980</span>    <span class="comment">// Get the variation for this reconfigure for the ith parameter</span></div>
<div class="line"><span class="lineno">  981</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> xvar = float(*<a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">splineParsPointer</a>);</div>
<div class="line"><span class="lineno">  982</span>    <a class="code hl_variable" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>[i] = xvar;</div>
<div class="line"><span class="lineno">  983</span> </div>
<div class="line"><span class="lineno">  984</span>    <span class="comment">// EM: if we have a parameter that has no response for any event (i.e. all splines have just one knot), then skip it and avoid a seg fault here</span></div>
<div class="line"><span class="lineno">  985</span>    <span class="comment">//     In principle, such parameters shouldn&#39;t really be included in the first place, but with new det syst splines this</span></div>
<div class="line"><span class="lineno">  986</span>    <span class="comment">//     could happen if say you were just running on one FHC run, then all RHC parameters would be flat and the code below would break.</span></div>
<div class="line"><span class="lineno">  987</span>    <span class="keywordflow">if</span>(xArray == NULL) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  988</span> </div>
<div class="line"><span class="lineno">  989</span>    <span class="comment">// The segment we&#39;re interested in (klow in ROOT code)</span></div>
<div class="line"><span class="lineno">  990</span>    <a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> segment = 0;</div>
<div class="line"><span class="lineno">  991</span>    <a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> kHigh = nPoints-1;</div>
<div class="line"><span class="lineno">  992</span>    <span class="comment">//KS: We expect new segment is very close to previous</span></div>
<div class="line"><span class="lineno">  993</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> PreviousSegment = <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="structFastSplineInfo.html#a80e4c1195099d2c34a1a511e4f749fe4">CurrSegment</a>;</div>
<div class="line"><span class="lineno">  994</span> </div>
<div class="line"><span class="lineno">  995</span>    <span class="comment">// If the variation is below the lowest saved spline point</span></div>
<div class="line"><span class="lineno">  996</span>    <span class="keywordflow">if</span> (xvar &lt;= xArray[0]) {</div>
<div class="line"><span class="lineno">  997</span>      segment = 0;</div>
<div class="line"><span class="lineno">  998</span>      <span class="comment">// If the variation is above the highest saved spline point</span></div>
<div class="line"><span class="lineno">  999</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xvar &gt;= xArray[nPoints-1]) {</div>
<div class="line"><span class="lineno"> 1000</span>      <span class="comment">//CW: Yes, the -2 is indeed correct, see TSpline.cxx:814 and //see: https://savannah.cern.ch/bugs/?71651</span></div>
<div class="line"><span class="lineno"> 1001</span>      segment = kHigh;</div>
<div class="line"><span class="lineno"> 1002</span>      <span class="comment">//KS: It is quite probable the new segment is same as in previous step so try to avoid binary search, first we have to check if it is in bounds to avoid seg fault</span></div>
<div class="line"><span class="lineno"> 1003</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( xArray[PreviousSegment+1] &gt; xvar &amp;&amp; xvar &gt;= xArray[PreviousSegment] ) {</div>
<div class="line"><span class="lineno"> 1004</span>      segment = PreviousSegment;</div>
<div class="line"><span class="lineno"> 1005</span>      <span class="comment">// If the variation is between the maximum and minimum, perform a binary search</span></div>
<div class="line"><span class="lineno"> 1006</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1007</span>      <span class="comment">// The top point we&#39;ve got</span></div>
<div class="line"><span class="lineno"> 1008</span>      <a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> kHalf = 0;</div>
<div class="line"><span class="lineno"> 1009</span>      <span class="comment">// While there is still a difference in the points (we haven&#39;t yet found the segment)</span></div>
<div class="line"><span class="lineno"> 1010</span>      <span class="comment">// This is a binary search, incrementing segment and decrementing kHalf until we&#39;ve found the segment</span></div>
<div class="line"><span class="lineno"> 1011</span>      <span class="keywordflow">while</span> (kHigh - segment &gt; 1) {</div>
<div class="line"><span class="lineno"> 1012</span>        <span class="comment">// Increment the half-step</span></div>
<div class="line"><span class="lineno"> 1013</span>        kHalf = <a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a>((segment + kHigh)/2);</div>
<div class="line"><span class="lineno"> 1014</span>        <span class="comment">// If our variation is above the kHalf, set the segment to kHalf</span></div>
<div class="line"><span class="lineno"> 1015</span>        <span class="keywordflow">if</span> (xvar &gt; xArray[kHalf]) {</div>
<div class="line"><span class="lineno"> 1016</span>          segment = kHalf;</div>
<div class="line"><span class="lineno"> 1017</span>          <span class="comment">// Else move kHigh down</span></div>
<div class="line"><span class="lineno"> 1018</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1019</span>          kHigh = kHalf;</div>
<div class="line"><span class="lineno"> 1020</span>        }</div>
<div class="line"><span class="lineno"> 1021</span>      } <span class="comment">// End the while: we&#39;ve now done our binary search</span></div>
<div class="line"><span class="lineno"> 1022</span>    } <span class="comment">// End the else: we&#39;ve now found our point</span></div>
<div class="line"><span class="lineno"> 1023</span> </div>
<div class="line"><span class="lineno"> 1024</span>    <span class="keywordflow">if</span> (segment &gt;= nPoints-1 &amp;&amp; nPoints &gt; 1) segment = nPoints-2;</div>
<div class="line"><span class="lineno"> 1025</span> </div>
<div class="line"><span class="lineno"> 1026</span>    <span class="comment">//CW: This way we avoid doing 1.2M+ binary searches on the GPU</span></div>
<div class="line"><span class="lineno"> 1027</span>    <span class="comment">// and literally just multiply lots of numbers together on the GPU without any algorithm</span></div>
<div class="line"><span class="lineno"> 1028</span>    <span class="comment">// Update the values and which segment it belongs to</span></div>
<div class="line"><span class="lineno"> 1029</span>    <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="structFastSplineInfo.html#a80e4c1195099d2c34a1a511e4f749fe4">CurrSegment</a> = segment;</div>
<div class="line"><span class="lineno"> 1030</span>    <a class="code hl_variable" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>[i] = short(<a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].CurrSegment);</div>
<div class="line"><span class="lineno"> 1031</span> </div>
<div class="line"><span class="lineno"> 1032</span><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><span class="lineno"> 1033</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].xPts[segment] &gt; xvar &amp;&amp; segment != 0) {</div>
<div class="line"><span class="lineno"> 1034</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Found a segment which is _ABOVE_ the variation!&quot;</span>);</div>
<div class="line"><span class="lineno"> 1035</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;IT SHOULD ALWAYS BE BELOW! (except when segment 0)&quot;</span>);</div>
<div class="line"><span class="lineno"> 1036</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Spline: {}&quot;</span>, i);</div>
<div class="line"><span class="lineno"> 1037</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Found segment = {}&quot;</span>, segment);</div>
<div class="line"><span class="lineno"> 1038</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Doing variation = {}&quot;</span>, xvar);</div>
<div class="line"><span class="lineno"> 1039</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;x in spline = {}&quot;</span>, <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].xPts[segment]);</div>
<div class="line"><span class="lineno"> 1040</span>      <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> j = 0; j &lt; <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[j].<a class="code hl_variable" href="structFastSplineInfo.html#ac8538a8e3438ae06d8f467cc0fd5ce0d">nPts</a>; ++j) {</div>
<div class="line"><span class="lineno"> 1041</span>        <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;    {} = {}&quot;</span>, j, <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].xPts[j]);</div>
<div class="line"><span class="lineno"> 1042</span>      }</div>
<div class="line"><span class="lineno"> 1043</span>      <span class="keywordflow">throw</span> <a class="code hl_class" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__ , __LINE__ );</div>
<div class="line"><span class="lineno"> 1044</span>    }</div>
<div class="line"><span class="lineno"> 1045</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1046</span>  } <span class="comment">//end loop over params</span></div>
<div class="line"><span class="lineno"> 1047</span>}</div>
<div class="ttc" id="aMaCh3Logger_8h_html_a61052119a625282d0ec6d4a97adf3ee2"><div class="ttname"><a href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a></div><div class="ttdeci">#define MACH3LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Logger_8h_source.html#l00018">MaCh3Logger.h:18</a></div></div>
<div class="ttc" id="aclassMaCh3Exception_html"><div class="ttname"><a href="classMaCh3Exception.html">MaCh3Exception</a></div><div class="ttdoc">Custom exception class for MaCh3 errors.</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Exception_8h_source.html#l00012">MaCh3Exception.h:12</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a4606b53f321992377d420a838c76ab3b"><div class="ttname"><a href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">SMonolith::nParams</a></div><div class="ttdeci">short int nParams</div><div class="ttdoc">Number of NIWG parameters that have splines.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00122">SplineMonolith.h:122</a></div></div>
<div class="ttc" id="aclassSMonolith_html_afa782652b0b3da923c5b20bb1319aadd"><div class="ttname"><a href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">SMonolith::splineParsPointer</a></div><div class="ttdeci">std::vector&lt; const double * &gt; splineParsPointer</div><div class="ttdoc">This holds pointer to parameter position which we later copy paste it to GPU.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00117">SplineMonolith.h:117</a></div></div>
<div class="ttc" id="anamespaceM3_html_a1f95274549f25fc19fe7db343c8a7a68"><div class="ttname"><a href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a></div><div class="ttdeci">double float_t</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00015">Structs.h:15</a></div></div>
<div class="ttc" id="anamespaceM3_html_adb59b8ecdc4e1b2d5d4c826a13aa7463"><div class="ttname"><a href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a></div><div class="ttdeci">int int_t</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00016">Structs.h:16</a></div></div>
<div class="ttc" id="astructFastSplineInfo_html_a80e4c1195099d2c34a1a511e4f749fe4"><div class="ttname"><a href="structFastSplineInfo.html#a80e4c1195099d2c34a1a511e4f749fe4">FastSplineInfo::CurrSegment</a></div><div class="ttdeci">M3::int_t CurrSegment</div><div class="ttdoc">Array of what segment of spline we're currently interested in. Gets updated once per MCMC iteration.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00042">SplineStructs.h:42</a></div></div>
<div class="ttc" id="astructFastSplineInfo_html_a9e9d432eb250bba227d31022ac9c5779"><div class="ttname"><a href="structFastSplineInfo.html#a9e9d432eb250bba227d31022ac9c5779">FastSplineInfo::xPts</a></div><div class="ttdeci">M3::float_t * xPts</div><div class="ttdoc">Array of the knots positions.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00039">SplineStructs.h:39</a></div></div>
<div class="ttc" id="astructFastSplineInfo_html_ac8538a8e3438ae06d8f467cc0fd5ce0d"><div class="ttname"><a href="structFastSplineInfo.html#ac8538a8e3438ae06d8f467cc0fd5ce0d">FastSplineInfo::nPts</a></div><div class="ttdeci">M3::int_t nPts</div><div class="ttdoc">Number of points in spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00036">SplineStructs.h:36</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad85cab15f5dfdd47e1123b5bd1815a05" name="ad85cab15f5dfdd47e1123b5bd1815a05"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad85cab15f5dfdd47e1123b5bd1815a05">&#9670;&#160;</a></span>GetName()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string SMonolith::GetName </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get class name. </p>

<p>Reimplemented from <a class="el" href="classSplineBase.html#a2e1534f622ae1976b21df1ebf984eec5">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00029">29</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   29</span>{<span class="keywordflow">return</span> <span class="stringliteral">&quot;SplineMonolith&quot;</span>;};</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa3332e054f985fc59a162419f0a1d71d" name="aa3332e054f985fc59a162419f0a1d71d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3332e054f985fc59a162419f0a1d71d">&#9670;&#160;</a></span>GetNParams()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">short int SMonolith::GetNParams </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get number of spline parameters. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00032">32</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   32</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;};</div>
</div><!-- fragment -->
</div>
</div>
<a id="acbbe3398718d0d02d65a1e92a91c112c" name="acbbe3398718d0d02d65a1e92a91c112c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acbbe3398718d0d02d65a1e92a91c112c">&#9670;&#160;</a></span>getSplineCoeff_SepMany()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::getSplineCoeff_SepMany </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classTSpline3__red.html">TSpline3_red</a> *&amp;&#160;</td>
          <td class="paramname"><em>spl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>nPoints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&amp;&#160;</td>
          <td class="paramname"><em>xArray</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&amp;&#160;</td>
          <td class="paramname"><em>manyArray</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: This loads up coefficients into two arrays: one x array and one yabcd array. </p>
<p>CW: This should maximize our cache hits! </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spl</td><td>pointer to <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> </td></tr>
    <tr><td class="paramname">nPoints</td><td>number of knots </td></tr>
    <tr><td class="paramname">xArray</td><td>array X value for each knot </td></tr>
    <tr><td class="paramname">manyArray</td><td>Array holding coefficients for each knot </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00871">871</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  871</span>                                                                                                            {</div>
<div class="line"><span class="lineno">  872</span><span class="comment">// *****************************************</span></div>
<div class="line"><span class="lineno">  873</span>  <span class="comment">// Initialise all arrays to 1.0</span></div>
<div class="line"><span class="lineno">  874</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>; ++i) {</div>
<div class="line"><span class="lineno">  875</span>    xArray[i] = 1.0;</div>
<div class="line"><span class="lineno">  876</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>; j++) {</div>
<div class="line"><span class="lineno">  877</span>      manyArray[i*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+j] = 1.0;</div>
<div class="line"><span class="lineno">  878</span>    }</div>
<div class="line"><span class="lineno">  879</span>  }</div>
<div class="line"><span class="lineno">  880</span>  <span class="comment">// Get number of points in spline</span></div>
<div class="line"><span class="lineno">  881</span>  <span class="keywordtype">int</span> Np = spl-&gt;<a class="code hl_function" href="classTSpline3__red.html#a6b680cfb96e11c55b8325e1274251b91">GetNp</a>();</div>
<div class="line"><span class="lineno">  882</span>  <span class="comment">// If spline is flat, set number of knots to 1.0,</span></div>
<div class="line"><span class="lineno">  883</span>  <span class="comment">// This is used later to expedite the calculations for flat splines</span></div>
<div class="line"><span class="lineno">  884</span>  <span class="comment">// tmpArray[0] is number of knots</span></div>
<div class="line"><span class="lineno">  885</span>  nPoints = Np;</div>
<div class="line"><span class="lineno">  886</span>  <span class="keywordflow">if</span> (Np &gt; <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>) {</div>
<div class="line"><span class="lineno">  887</span>    <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Error, number of points is greater than saved {}&quot;</span>, <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>);</div>
<div class="line"><span class="lineno">  888</span>    <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;This _WILL_ cause problems with GPU splines and _SHOULD_ be fixed!&quot;</span>);</div>
<div class="line"><span class="lineno">  889</span>    <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;nPoints = {}, _max_knots = {}&quot;</span>, nPoints, <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>);</div>
<div class="line"><span class="lineno">  890</span>    <span class="keywordflow">throw</span> <a class="code hl_class" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__ , __LINE__ );</div>
<div class="line"><span class="lineno">  891</span>  }</div>
<div class="line"><span class="lineno">  892</span> </div>
<div class="line"><span class="lineno">  893</span>  <span class="comment">// The coefficients we&#39;re writing to</span></div>
<div class="line"><span class="lineno">  894</span>  <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a> x, y, b, c, d;</div>
<div class="line"><span class="lineno">  895</span>  <span class="comment">// TSpline3 can only take doubles, not floats</span></div>
<div class="line"><span class="lineno">  896</span>  <span class="comment">// But our GPU is slow with doubles, so need to cast to float</span></div>
<div class="line"><span class="lineno">  897</span>  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; Np; i++) {</div>
<div class="line"><span class="lineno">  898</span>    <span class="comment">// Get the coefficients from the TSpline3 object</span></div>
<div class="line"><span class="lineno">  899</span>    spl-&gt;<a class="code hl_function" href="classTSpline3__red.html#a74d108b99a9060ab85c22343fa4a4532">GetCoeff</a>(i, x, y, b, c, d);</div>
<div class="line"><span class="lineno">  900</span>    <span class="comment">// Write the arrays</span></div>
<div class="line"><span class="lineno">  901</span>    xArray[i] = float(x);</div>
<div class="line"><span class="lineno">  902</span>    manyArray[i*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>] = float(y); <span class="comment">// 4 because manyArray stores y,b,c,d</span></div>
<div class="line"><span class="lineno">  903</span>    manyArray[i*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+1] = float(b);</div>
<div class="line"><span class="lineno">  904</span>    manyArray[i*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+2] = float(c);</div>
<div class="line"><span class="lineno">  905</span>    manyArray[i*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+3] = float(d);</div>
<div class="line"><span class="lineno">  906</span>    <span class="keywordflow">if</span>((xArray[i] == -999) || (manyArray[i*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>] == -999) || (manyArray[i*4+1] == -999) || (manyArray[i*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+2] == -999) || (manyArray[i*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+3] == -999)){</div>
<div class="line"><span class="lineno">  907</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;*********** Bad params in getSplineCoeff_SepMany() ************&quot;</span>);</div>
<div class="line"><span class="lineno">  908</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;pre cast to float (x, y, b, c, d) = {:.2f}, {:.2f}, {:.2f}, {:.2f}, {:.2f}&quot;</span>, x, y, b, c, d);</div>
<div class="line"><span class="lineno">  909</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;pre cast to float (x, y, b, c, d) = {:.2f}, {:.2f}, {:.2f}, {:.2f}, {:.2f}&quot;</span>, xArray[i], manyArray[i*4], manyArray[i*4+1], manyArray[i*4+2], manyArray[i*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+3]);</div>
<div class="line"><span class="lineno">  910</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;This will cause problems when preparing for GPU&quot;</span>);</div>
<div class="line"><span class="lineno">  911</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;***************************************************************&quot;</span>);</div>
<div class="line"><span class="lineno">  912</span>    }</div>
<div class="line"><span class="lineno">  913</span>  }</div>
<div class="line"><span class="lineno">  914</span>}</div>
<div class="ttc" id="aclassTSpline3__red_html_a6b680cfb96e11c55b8325e1274251b91"><div class="ttname"><a href="classTSpline3__red.html#a6b680cfb96e11c55b8325e1274251b91">TSpline3_red::GetNp</a></div><div class="ttdeci">M3::int_t GetNp() override</div><div class="ttdoc">CW: Get the number of points.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00613">SplineStructs.h:613</a></div></div>
<div class="ttc" id="aclassTSpline3__red_html_a74d108b99a9060ab85c22343fa4a4532"><div class="ttname"><a href="classTSpline3__red.html#a74d108b99a9060ab85c22343fa4a4532">TSpline3_red::GetCoeff</a></div><div class="ttdeci">void GetCoeff(int segment, M3::float_t &amp;x, M3::float_t &amp;y, M3::float_t &amp;b, M3::float_t &amp;c, M3::float_t &amp;d)</div><div class="ttdoc">CW: Get the coefficient of a given segment.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00621">SplineStructs.h:621</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a45cece9dcbe699e00a7b5fdff4806c1e" name="a45cece9dcbe699e00a7b5fdff4806c1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45cece9dcbe699e00a7b5fdff4806c1e">&#9670;&#160;</a></span>Initialise()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::Initialise </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Set everything to null etc. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00012">12</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   12</span>                           {</div>
<div class="line"><span class="lineno">   13</span><span class="comment">// *****************************************</span></div>
<div class="line"><span class="lineno">   14</span> </div>
<div class="line"><span class="lineno">   15</span><span class="preprocessor">#ifdef CUDA</span></div>
<div class="line"><span class="lineno">   16</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Using GPU version event by event monolith&quot;</span>);</div>
<div class="line"><span class="lineno">   17</span>  <a class="code hl_variable" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   18</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">   19</span> </div>
<div class="line"><span class="lineno">   20</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a> = <span class="keyword">new</span> <a class="code hl_struct" href="structSplineMonoStruct.html">SplineMonoStruct</a>();</div>
<div class="line"><span class="lineno">   21</span> </div>
<div class="line"><span class="lineno">   22</span>  <a class="code hl_variable" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a> = 0;</div>
<div class="line"><span class="lineno">   23</span>  <a class="code hl_variable" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a> = 0;</div>
<div class="line"><span class="lineno">   24</span>  <a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a> = 0;</div>
<div class="line"><span class="lineno">   25</span>  <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> = 0;</div>
<div class="line"><span class="lineno">   26</span>  <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a> = 0;</div>
<div class="line"><span class="lineno">   27</span> </div>
<div class="line"><span class="lineno">   28</span>  <a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a> = 0;</div>
<div class="line"><span class="lineno">   29</span>  <a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a> = 0;</div>
<div class="line"><span class="lineno">   30</span>  <a class="code hl_variable" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a> = 0;</div>
<div class="line"><span class="lineno">   31</span> </div>
<div class="line"><span class="lineno">   32</span>  <a class="code hl_variable" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   33</span>  <a class="code hl_variable" href="classSMonolith.html#a1aa70cce5867e7e784e97eacebe6bfbd">index_TF1_cpu</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   34</span>  <a class="code hl_variable" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   35</span>  <a class="code hl_variable" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   36</span>  <a class="code hl_variable" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   37</span> </div>
<div class="line"><span class="lineno">   38</span>  <a class="code hl_variable" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   39</span> </div>
<div class="line"><span class="lineno">   40</span>  <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   41</span>  <a class="code hl_variable" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a> = NULL;</div>
<div class="line"><span class="lineno">   42</span>  <a class="code hl_variable" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a> = NULL;</div>
<div class="line"><span class="lineno">   43</span>  </div>
<div class="line"><span class="lineno">   44</span>  <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   45</span>}</div>
<div class="ttc" id="aclassSMonolith_html_a403e7cf909f98d4c59b5f6c7ff8aac5b"><div class="ttname"><a href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">SMonolith::nTF1coeff</a></div><div class="ttdeci">unsigned int nTF1coeff</div><div class="ttdoc">Sum of all coefficients over all TF1.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00141">SplineMonolith.h:141</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ac86282b04659bae5cccb6073c9edc0a5"><div class="ttname"><a href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">SMonolith::NEvents</a></div><div class="ttdeci">unsigned int NEvents</div><div class="ttdoc">Number of events.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00120">SplineMonolith.h:120</a></div></div>
<div class="ttc" id="aclassSMonolith_html_aee3c18513f8209f1ac940b492cd3ed68"><div class="ttname"><a href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">SMonolith::NSplines_total_large</a></div><div class="ttdeci">unsigned int NSplines_total_large</div><div class="ttdoc">Number of total splines if each event had every parameter's spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00136">SplineMonolith.h:136</a></div></div>
<div class="ttc" id="aclassSMonolith_html_afc0e3d1eafd575cf7628319a66925d5b"><div class="ttname"><a href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">SMonolith::nKnots</a></div><div class="ttdeci">unsigned int nKnots</div><div class="ttdoc">Sum of all knots over all splines.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00139">SplineMonolith.h:139</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html"><div class="ttname"><a href="structSplineMonoStruct.html">SplineMonoStruct</a></div><div class="ttdoc">KS: Struct storing information for spline monolith.</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00033">SplineCommon.h:33</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6783cdc3c485378ca21852e1a7b02482" name="a6783cdc3c485378ca21852e1a7b02482"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6783cdc3c485378ca21852e1a7b02482">&#9670;&#160;</a></span>LoadSplineFile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::LoadSplineFile </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>FileName</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Load preprocessed spline file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">FileName</td><td>Path to ROOT file with predefined reduced Spline Monolith </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00529">529</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  529</span>                                                 {</div>
<div class="line"><span class="lineno">  530</span><span class="comment">// *****************************************</span></div>
<div class="line"><span class="lineno">  531</span><span class="preprocessor">  #ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><span class="lineno">  532</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Trying to load Monolith from file using weight by weight base, this is not supported right now, sorry&quot;</span>);</div>
<div class="line"><span class="lineno">  533</span>  <span class="keywordflow">throw</span> <a class="code hl_class" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__ , __LINE__ );</div>
<div class="line"><span class="lineno">  534</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno">  535</span> </div>
<div class="line"><span class="lineno">  536</span>  <span class="keywordflow">if</span> (std::getenv(<span class="stringliteral">&quot;MACH3&quot;</span>) != NULL) {</div>
<div class="line"><span class="lineno">  537</span>      FileName.insert(0, std::string(std::getenv(<span class="stringliteral">&quot;MACH3&quot;</span>))+<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><span class="lineno">  538</span>   }</div>
<div class="line"><span class="lineno">  539</span> </div>
<div class="line"><span class="lineno">  540</span>  TFile *SplineFile = <span class="keyword">new</span> TFile(FileName.c_str(), <span class="stringliteral">&quot;OPEN&quot;</span>);</div>
<div class="line"><span class="lineno">  541</span>  TTree *Settings = SplineFile-&gt;Get&lt;TTree&gt;(<span class="stringliteral">&quot;Settings&quot;</span>);</div>
<div class="line"><span class="lineno">  542</span>  TTree *Monolith = SplineFile-&gt;Get&lt;TTree&gt;(<span class="stringliteral">&quot;Monolith&quot;</span>);</div>
<div class="line"><span class="lineno">  543</span>  TTree *Monolith_TF1 = SplineFile-&gt;Get&lt;TTree&gt;(<span class="stringliteral">&quot;Monolith_TF1&quot;</span>);</div>
<div class="line"><span class="lineno">  544</span>  TTree *ParamInfo = SplineFile-&gt;Get&lt;TTree&gt;(<span class="stringliteral">&quot;ParamInfo&quot;</span>);</div>
<div class="line"><span class="lineno">  545</span>  TTree *XKnots = SplineFile-&gt;Get&lt;TTree&gt;(<span class="stringliteral">&quot;XKnots&quot;</span>);</div>
<div class="line"><span class="lineno">  546</span>  TTree *EventInfo = SplineFile-&gt;Get&lt;TTree&gt;(<span class="stringliteral">&quot;EventInfo&quot;</span>);</div>
<div class="line"><span class="lineno">  547</span>  TTree *FastSplineInfoTree = SplineFile-&gt;Get&lt;TTree&gt;(<span class="stringliteral">&quot;FastSplineInfoTree&quot;</span>);</div>
<div class="line"><span class="lineno">  548</span> </div>
<div class="line"><span class="lineno">  549</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NEvents_temp;</div>
<div class="line"><span class="lineno">  550</span>  <span class="keywordtype">short</span> <span class="keywordtype">int</span> nParams_temp;</div>
<div class="line"><span class="lineno">  551</span>  <span class="keywordtype">int</span> _max_knots_temp;</div>
<div class="line"><span class="lineno">  552</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nKnots_temp;</div>
<div class="line"><span class="lineno">  553</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NSplines_valid_temp;</div>
<div class="line"><span class="lineno">  554</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nTF1Valid_temp;</div>
<div class="line"><span class="lineno">  555</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nTF1coeff_temp;</div>
<div class="line"><span class="lineno">  556</span> </div>
<div class="line"><span class="lineno">  557</span>  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;NEvents&quot;</span>, &amp;NEvents_temp);</div>
<div class="line"><span class="lineno">  558</span>  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;nParams&quot;</span>, &amp;nParams_temp);</div>
<div class="line"><span class="lineno">  559</span>  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;_max_knots&quot;</span>, &amp;_max_knots_temp);</div>
<div class="line"><span class="lineno">  560</span>  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;nKnots&quot;</span>, &amp;nKnots_temp);</div>
<div class="line"><span class="lineno">  561</span>  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;NSplines_valid&quot;</span>, &amp;NSplines_valid_temp);</div>
<div class="line"><span class="lineno">  562</span>  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;NTF1_valid&quot;</span>, &amp;nTF1Valid_temp);</div>
<div class="line"><span class="lineno">  563</span>  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;nTF1coeff&quot;</span>, &amp;nTF1coeff_temp);</div>
<div class="line"><span class="lineno">  564</span> </div>
<div class="line"><span class="lineno">  565</span>  Settings-&gt;GetEntry(0);</div>
<div class="line"><span class="lineno">  566</span> </div>
<div class="line"><span class="lineno">  567</span>  <a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a> = NEvents_temp;</div>
<div class="line"><span class="lineno">  568</span>  <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a> = nParams_temp;</div>
<div class="line"><span class="lineno">  569</span>  <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> = _max_knots_temp;</div>
<div class="line"><span class="lineno">  570</span>  <a class="code hl_variable" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a> = nKnots_temp;</div>
<div class="line"><span class="lineno">  571</span>  <a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a> = NSplines_valid_temp;</div>
<div class="line"><span class="lineno">  572</span>  <a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a> = nTF1Valid_temp;</div>
<div class="line"><span class="lineno">  573</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event_size_max = <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> * <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><span class="lineno">  574</span>  <a class="code hl_variable" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a> = nTF1coeff_temp;</div>
<div class="line"><span class="lineno">  575</span> </div>
<div class="line"><span class="lineno">  576</span>  <span class="comment">//KS: Since we are going to copy it each step use fancy CUDA memory allocation</span></div>
<div class="line"><span class="lineno">  577</span><span class="preprocessor">#ifdef CUDA</span></div>
<div class="line"><span class="lineno">  578</span>  <a class="code hl_variable" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code hl_function" href="classSMonolithGPU.html#ab674ec40c136d89b56b7c25d9337c48a">InitGPU_Segments</a>(&amp;<a class="code hl_variable" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>);</div>
<div class="line"><span class="lineno">  579</span>  <a class="code hl_variable" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code hl_function" href="classSMonolithGPU.html#a3fbbb94f6db65b73a394ab541f94fba6">InitGPU_Vals</a>(&amp;<a class="code hl_variable" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>);</div>
<div class="line"><span class="lineno">  580</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  581</span>  <a class="code hl_variable" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a> = <span class="keyword">new</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>[<a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>]();</div>
<div class="line"><span class="lineno">  582</span>  <a class="code hl_variable" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>]();</div>
<div class="line"><span class="lineno">  583</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  584</span> </div>
<div class="line"><span class="lineno">  585</span>  <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.resize(2*<a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><span class="lineno">  586</span>  <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>.resize(2*<a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><span class="lineno">  587</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>.resize(<a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><span class="lineno">  588</span>  <span class="comment">//KS: And array which tells where each spline stars in a big monolith array, sort of knot map</span></div>
<div class="line"><span class="lineno">  589</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>.resize(<a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><span class="lineno">  590</span> </div>
<div class="line"><span class="lineno">  591</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>.resize(<a class="code hl_variable" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>); <span class="comment">// *4 because we store y,b,c,d parameters in this array</span></div>
<div class="line"><span class="lineno">  592</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>.resize(event_size_max);</div>
<div class="line"><span class="lineno">  593</span> </div>
<div class="line"><span class="lineno">  594</span>  <a class="code hl_variable" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>.resize(<a class="code hl_variable" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>);</div>
<div class="line"><span class="lineno">  595</span> </div>
<div class="line"><span class="lineno">  596</span>  <span class="comment">//KS: This is tricky as this variable use both by CPU and GPU, however if use CUDA we use cudaMallocHost</span></div>
<div class="line"><span class="lineno">  597</span><span class="preprocessor">#ifndef CUDA</span></div>
<div class="line"><span class="lineno">  598</span>  <a class="code hl_variable" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>]();</div>
<div class="line"><span class="lineno">  599</span>  <a class="code hl_variable" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>]();</div>
<div class="line"><span class="lineno">  600</span>  <a class="code hl_variable" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>]();</div>
<div class="line"><span class="lineno">  601</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  602</span> </div>
<div class="line"><span class="lineno">  603</span>  <span class="keywordtype">float</span> coeff = 0.;</div>
<div class="line"><span class="lineno">  604</span>  Monolith-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_coeff_many&quot;</span>, &amp;coeff);</div>
<div class="line"><span class="lineno">  605</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>; i++)</div>
<div class="line"><span class="lineno">  606</span>  {</div>
<div class="line"><span class="lineno">  607</span>    Monolith-&gt;GetEntry(i);</div>
<div class="line"><span class="lineno">  608</span>    <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>[i] = coeff;</div>
<div class="line"><span class="lineno">  609</span>  }</div>
<div class="line"><span class="lineno">  610</span> </div>
<div class="line"><span class="lineno">  611</span>  <span class="keywordtype">float</span> coeff_tf1 = 0.;</div>
<div class="line"><span class="lineno">  612</span>  Monolith_TF1-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_coeff_TF1_many&quot;</span>, &amp;coeff_tf1);</div>
<div class="line"><span class="lineno">  613</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>; i++)</div>
<div class="line"><span class="lineno">  614</span>  {</div>
<div class="line"><span class="lineno">  615</span>    Monolith_TF1-&gt;GetEntry(i);</div>
<div class="line"><span class="lineno">  616</span>    <a class="code hl_variable" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>[i] = coeff_tf1;</div>
<div class="line"><span class="lineno">  617</span>  }</div>
<div class="line"><span class="lineno">  618</span> </div>
<div class="line"><span class="lineno">  619</span>  <span class="keywordtype">short</span> <span class="keywordtype">int</span> paramNo_arr = 0;</div>
<div class="line"><span class="lineno">  620</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nKnots_arr = 0;</div>
<div class="line"><span class="lineno">  621</span>  ParamInfo-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_paramNo_arr&quot;</span>, &amp;paramNo_arr);</div>
<div class="line"><span class="lineno">  622</span>  ParamInfo-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_nKnots_arr&quot;</span>, &amp;nKnots_arr);</div>
<div class="line"><span class="lineno">  623</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>; i++)</div>
<div class="line"><span class="lineno">  624</span>  {</div>
<div class="line"><span class="lineno">  625</span>    ParamInfo-&gt;GetEntry(i);</div>
<div class="line"><span class="lineno">  626</span>    <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>[i] = paramNo_arr;</div>
<div class="line"><span class="lineno">  627</span>    <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>[i] = nKnots_arr;</div>
<div class="line"><span class="lineno">  628</span>  }</div>
<div class="line"><span class="lineno">  629</span> </div>
<div class="line"><span class="lineno">  630</span>  <span class="keywordtype">float</span> coeff_x = 0.;</div>
<div class="line"><span class="lineno">  631</span>  XKnots-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_coeff_x&quot;</span>, &amp;coeff_x);</div>
<div class="line"><span class="lineno">  632</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; event_size_max; i++)</div>
<div class="line"><span class="lineno">  633</span>  {</div>
<div class="line"><span class="lineno">  634</span>    XKnots-&gt;GetEntry(i);</div>
<div class="line"><span class="lineno">  635</span>    <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>[i] = coeff_x;</div>
<div class="line"><span class="lineno">  636</span>  }</div>
<div class="line"><span class="lineno">  637</span> </div>
<div class="line"><span class="lineno">  638</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nParamPerEvent = 0;</div>
<div class="line"><span class="lineno">  639</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nParamPerEvent_tf1 = 0;</div>
<div class="line"><span class="lineno">  640</span> </div>
<div class="line"><span class="lineno">  641</span>  EventInfo-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_nParamPerEvent&quot;</span>, &amp;nParamPerEvent);</div>
<div class="line"><span class="lineno">  642</span>  EventInfo-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_nParamPerEvent_tf1&quot;</span>, &amp;nParamPerEvent_tf1);</div>
<div class="line"><span class="lineno">  643</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 2*<a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>; i++)</div>
<div class="line"><span class="lineno">  644</span>  {</div>
<div class="line"><span class="lineno">  645</span>    EventInfo-&gt;GetEntry(i);</div>
<div class="line"><span class="lineno">  646</span>    <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[i] = nParamPerEvent;</div>
<div class="line"><span class="lineno">  647</span>    <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[i] = nParamPerEvent_tf1;</div>
<div class="line"><span class="lineno">  648</span>  }</div>
<div class="line"><span class="lineno">  649</span> </div>
<div class="line"><span class="lineno">  650</span>  <a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> nPoints = 0;</div>
<div class="line"><span class="lineno">  651</span>  <span class="keywordtype">float</span> xtemp[20];</div>
<div class="line"><span class="lineno">  652</span>  FastSplineInfoTree-&gt;SetBranchAddress(<span class="stringliteral">&quot;nPts&quot;</span>, &amp;nPoints);</div>
<div class="line"><span class="lineno">  653</span>  FastSplineInfoTree-&gt;SetBranchAddress(<span class="stringliteral">&quot;xPts&quot;</span>, &amp;xtemp);</div>
<div class="line"><span class="lineno">  654</span> </div>
<div class="line"><span class="lineno">  655</span>  <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a> = <span class="keyword">new</span> <a class="code hl_struct" href="structFastSplineInfo.html">FastSplineInfo</a>[<a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>];</div>
<div class="line"><span class="lineno">  656</span>  <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> i = 0; i &lt; <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>; ++i) {</div>
<div class="line"><span class="lineno">  657</span>    FastSplineInfoTree-&gt;GetEntry(i);</div>
<div class="line"><span class="lineno">  658</span> </div>
<div class="line"><span class="lineno">  659</span>    <span class="comment">// Fill the number of points</span></div>
<div class="line"><span class="lineno">  660</span>    <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="structFastSplineInfo.html#ac8538a8e3438ae06d8f467cc0fd5ce0d">nPts</a> = nPoints;</div>
<div class="line"><span class="lineno">  661</span>    <span class="keywordflow">if</span>(nPoints == -999) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  662</span>    <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="structFastSplineInfo.html#a9e9d432eb250bba227d31022ac9c5779">xPts</a> = <span class="keyword">new</span> <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a>[<a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="structFastSplineInfo.html#ac8538a8e3438ae06d8f467cc0fd5ce0d">nPts</a>];</div>
<div class="line"><span class="lineno">  663</span>    <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> k = 0; k &lt; <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="structFastSplineInfo.html#ac8538a8e3438ae06d8f467cc0fd5ce0d">nPts</a>; ++k)</div>
<div class="line"><span class="lineno">  664</span>    {</div>
<div class="line"><span class="lineno">  665</span>      <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="structFastSplineInfo.html#a9e9d432eb250bba227d31022ac9c5779">xPts</a>[k] = xtemp[k];</div>
<div class="line"><span class="lineno">  666</span>    }</div>
<div class="line"><span class="lineno">  667</span>  }</div>
<div class="line"><span class="lineno">  668</span> </div>
<div class="line"><span class="lineno">  669</span>  SplineFile-&gt;Close();</div>
<div class="line"><span class="lineno">  670</span>  <span class="keyword">delete</span> SplineFile;</div>
<div class="line"><span class="lineno">  671</span> </div>
<div class="line"><span class="lineno">  672</span>  <span class="comment">// Print some info; could probably make this to a separate function</span></div>
<div class="line"><span class="lineno">  673</span>  <a class="code hl_function" href="classSMonolith.html#a5c374d4505de53ad68d176a5644568e6">PrintInitialsiation</a>();</div>
<div class="line"><span class="lineno">  674</span> </div>
<div class="line"><span class="lineno">  675</span>  <a class="code hl_function" href="classSMonolith.html#aac73a1089592c5f22755b7427869827f">MoveToGPU</a>();</div>
<div class="line"><span class="lineno">  676</span>}</div>
<div class="ttc" id="aclassSMonolithGPU_html_a3fbbb94f6db65b73a394ab541f94fba6"><div class="ttname"><a href="classSMonolithGPU.html#a3fbbb94f6db65b73a394ab541f94fba6">SMonolithGPU::InitGPU_Vals</a></div><div class="ttdeci">__host__ void InitGPU_Vals(float **vals)</div><div class="ttdoc">Allocate memory for spline segments.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00184">gpuSplineUtils.cu:184</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_ab674ec40c136d89b56b7c25d9337c48a"><div class="ttname"><a href="classSMonolithGPU.html#ab674ec40c136d89b56b7c25d9337c48a">SMonolithGPU::InitGPU_Segments</a></div><div class="ttdeci">__host__ void InitGPU_Segments(short int **segment)</div><div class="ttdoc">Allocate memory for spline segments.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00175">gpuSplineUtils.cu:175</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a5c374d4505de53ad68d176a5644568e6"><div class="ttname"><a href="classSMonolith.html#a5c374d4505de53ad68d176a5644568e6">SMonolith::PrintInitialsiation</a></div><div class="ttdeci">void PrintInitialsiation()</div><div class="ttdoc">KS: Print info about how much knots etc has been initialised.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01184">SplineMonolith.cpp:1184</a></div></div>
<div class="ttc" id="aclassSMonolith_html_aac73a1089592c5f22755b7427869827f"><div class="ttname"><a href="classSMonolith.html#aac73a1089592c5f22755b7427869827f">SMonolith::MoveToGPU</a></div><div class="ttdeci">void MoveToGPU()</div><div class="ttdoc">CW: The shared initialiser from constructors of TResponseFunction_red.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00314">SplineMonolith.cpp:314</a></div></div>
<div class="ttc" id="astructFastSplineInfo_html"><div class="ttname"><a href="structFastSplineInfo.html">FastSplineInfo</a></div><div class="ttdoc">CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00019">SplineStructs.h:19</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac37ee525aa57316f652433a4e393afaf" name="ac37ee525aa57316f652433a4e393afaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac37ee525aa57316f652433a4e393afaf">&#9670;&#160;</a></span>ModifyWeights()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::ModifyWeights </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">private</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calc total event weight. </p>

<p>Implements <a class="el" href="classSplineBase.html#a49665d2712b61b038085d25ace96a568">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01116">1116</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1116</span>                             {</div>
<div class="line"><span class="lineno"> 1117</span><span class="comment">//*********************************************************</span></div>
<div class="line"><span class="lineno"> 1118</span><span class="preprocessor">#ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><span class="lineno"> 1119</span><span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><span class="lineno"> 1120</span><span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><span class="lineno"> 1121</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno"> 1122</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EventNum = 0; EventNum &lt; <a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>; ++EventNum)</div>
<div class="line"><span class="lineno"> 1123</span>  {</div>
<div class="line"><span class="lineno"> 1124</span>    <span class="keywordtype">float</span> totalWeight = 1.0f; <span class="comment">// Initialize total weight for each event</span></div>
<div class="line"><span class="lineno"> 1125</span> </div>
<div class="line"><span class="lineno"> 1126</span>    <span class="comment">// Extract the parameters for the current event</span></div>
<div class="line"><span class="lineno"> 1127</span>    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> startIndex = <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[2 * EventNum + 1];</div>
<div class="line"><span class="lineno"> 1128</span>    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numParams = <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[2 * EventNum];</div>
<div class="line"><span class="lineno"> 1129</span> </div>
<div class="line"><span class="lineno"> 1130</span>    <span class="comment">// Compute total weight for the current event</span></div>
<div class="line"><span class="lineno"> 1131</span><span class="preprocessor">    #ifdef MULTITHREAD</span></div>
<div class="line"><span class="lineno"> 1132</span><span class="preprocessor">    #pragma omp simd</span></div>
<div class="line"><span class="lineno"> 1133</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno"> 1134</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; numParams; ++id) {</div>
<div class="line"><span class="lineno"> 1135</span>      totalWeight *= <a class="code hl_variable" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a>[startIndex + id];</div>
<div class="line"><span class="lineno"> 1136</span>    }</div>
<div class="line"><span class="lineno"> 1137</span>    <span class="comment">//Now TF1</span></div>
<div class="line"><span class="lineno"> 1138</span>    <span class="comment">// Extract the parameters for the current event</span></div>
<div class="line"><span class="lineno"> 1139</span>    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> startIndex_tf1 = <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[2 * EventNum + 1];</div>
<div class="line"><span class="lineno"> 1140</span>    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numParams_tf1 = <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[2 * EventNum];</div>
<div class="line"><span class="lineno"> 1141</span> </div>
<div class="line"><span class="lineno"> 1142</span>    <span class="comment">// Compute total weight for the current event</span></div>
<div class="line"><span class="lineno"> 1143</span><span class="preprocessor">    #ifdef MULTITHREAD</span></div>
<div class="line"><span class="lineno"> 1144</span><span class="preprocessor">    #pragma omp simd</span></div>
<div class="line"><span class="lineno"> 1145</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno"> 1146</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; numParams_tf1; ++id) {</div>
<div class="line"><span class="lineno"> 1147</span>      totalWeight *= <a class="code hl_variable" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a>[startIndex_tf1 + id];</div>
<div class="line"><span class="lineno"> 1148</span>    }</div>
<div class="line"><span class="lineno"> 1149</span> </div>
<div class="line"><span class="lineno"> 1150</span>    <span class="comment">// Store the total weight for the current event</span></div>
<div class="line"><span class="lineno"> 1151</span>    <a class="code hl_variable" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>[EventNum] = totalWeight;</div>
<div class="line"><span class="lineno"> 1152</span>  }</div>
<div class="line"><span class="lineno"> 1153</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 1154</span>  <span class="comment">//KS: Name is confusing but what it does it make a nice mapping used for debugging</span></div>
<div class="line"><span class="lineno"> 1155</span>  <a class="code hl_function" href="classSMonolith.html#a72cd282322bdaadb23d8a376efa9e2c1">ModifyWeights_GPU</a>();</div>
<div class="line"><span class="lineno"> 1156</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1157</span>  <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1158</span>}</div>
<div class="ttc" id="aclassSMonolith_html_a72cd282322bdaadb23d8a376efa9e2c1"><div class="ttname"><a href="classSMonolith.html#a72cd282322bdaadb23d8a376efa9e2c1">SMonolith::ModifyWeights_GPU</a></div><div class="ttdeci">void ModifyWeights_GPU()</div><div class="ttdoc">Conversion from valid splines to all.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01162">SplineMonolith.cpp:1162</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a72cd282322bdaadb23d8a376efa9e2c1" name="a72cd282322bdaadb23d8a376efa9e2c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72cd282322bdaadb23d8a376efa9e2c1">&#9670;&#160;</a></span>ModifyWeights_GPU()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::ModifyWeights_GPU </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Conversion from valid splines to all. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01162">1162</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1162</span>                                 {</div>
<div class="line"><span class="lineno"> 1163</span><span class="comment">//*********************************************************</span></div>
<div class="line"><span class="lineno"> 1164</span><span class="preprocessor">#ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><span class="lineno"> 1165</span>  <span class="comment">// Multi-thread here because _numIndex is really quite large!</span></div>
<div class="line"><span class="lineno"> 1166</span><span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><span class="lineno"> 1167</span><span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><span class="lineno"> 1168</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno"> 1169</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a>; ++i) {</div>
<div class="line"><span class="lineno"> 1170</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a>[i] &gt;= 0) {</div>
<div class="line"><span class="lineno"> 1171</span>      <a class="code hl_variable" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a>[i] = <a class="code hl_variable" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a>[<a class="code hl_variable" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a>[i]];</div>
<div class="line"><span class="lineno"> 1172</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classSMonolith.html#a1aa70cce5867e7e784e97eacebe6bfbd">index_TF1_cpu</a>[i] &gt;= 0) {</div>
<div class="line"><span class="lineno"> 1173</span>      <a class="code hl_variable" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a>[i] = <a class="code hl_variable" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a>[<a class="code hl_variable" href="classSMonolith.html#a1aa70cce5867e7e784e97eacebe6bfbd">index_TF1_cpu</a>[i]];</div>
<div class="line"><span class="lineno"> 1174</span>    }  <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1175</span>      <a class="code hl_variable" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a>[i] = 1.;</div>
<div class="line"><span class="lineno"> 1176</span>    }</div>
<div class="line"><span class="lineno"> 1177</span>  }</div>
<div class="line"><span class="lineno"> 1178</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1179</span>  <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1180</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aac73a1089592c5f22755b7427869827f" name="aac73a1089592c5f22755b7427869827f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac73a1089592c5f22755b7427869827f">&#9670;&#160;</a></span>MoveToGPU()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::MoveToGPU </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: The shared initialiser from constructors of <a class="el" href="classTResponseFunction__red.html" title="KS: A reduced ResponseFunction Generic function used for evaluating weight.">TResponseFunction_red</a>. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00314">314</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  314</span>                          {</div>
<div class="line"><span class="lineno">  315</span><span class="comment">// *****************************************</span></div>
<div class="line"><span class="lineno">  316</span><span class="preprocessor">  #ifdef CUDA</span></div>
<div class="line"><span class="lineno">  317</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event_size_max = <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> * <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><span class="lineno">  318</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Total size = {:.2f} MB memory on CPU to move to GPU&quot;</span>,</div>
<div class="line"><span class="lineno">  319</span>                (<span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code hl_variable" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a> * <a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>) + <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * event_size_max) / 1.E6 +</div>
<div class="line"><span class="lineno">  320</span>                <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>) * <a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)) / 1.E6);</div>
<div class="line"><span class="lineno">  321</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Total TF1 size = {:.2f} MB memory on CPU to move to GPU&quot;</span>,</div>
<div class="line"><span class="lineno">  322</span>                <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a> * <a class="code hl_define" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>) / 1.E6);</div>
<div class="line"><span class="lineno">  323</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;GPU weight array (GPU-&gt;CPU every step) = {:.2f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * (<a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a> + <a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>) / 1.E6));</div>
<div class="line"><span class="lineno">  324</span><span class="preprocessor">  #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><span class="lineno">  325</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Since you are running Total event weight mode then GPU weight array (GPU-&gt;CPU every step) = {:.2f} MB&quot;</span>,</div>
<div class="line"><span class="lineno">  326</span>                <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>) / 1.E6);</div>
<div class="line"><span class="lineno">  327</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno">  328</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Parameter value array (CPU-&gt;GPU every step) = {:.4f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>) / 1.E6);</div>
<div class="line"><span class="lineno">  329</span>  <span class="comment">//CW: With the new set-up we have:   1 coefficient array of size coeff_array_size, all same size</span></div>
<div class="line"><span class="lineno">  330</span>  <span class="comment">//                                1 coefficient array of size coeff_array_size*4, holding y,b,c,d in order (y11,b11,c11,d11; y12,b12,c12,d12;...) where ynm is n = spline number, m = spline point. Should really make array so that order is (y11,b11,c11,d11; y21,b21,c21,d21;...) because it will optimise cache hits I think; try this if you have time</span></div>
<div class="line"><span class="lineno">  331</span>  <span class="comment">//                                return gpu_weights</span></div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>  <a class="code hl_variable" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a> = <span class="keyword">new</span> <a class="code hl_class" href="classSMonolithGPU.html">SMonolithGPU</a>();</div>
<div class="line"><span class="lineno">  334</span> </div>
<div class="line"><span class="lineno">  335</span>  <span class="comment">// The gpu_XY arrays don&#39;t actually need initialising, since they are only placeholders for what we&#39;ll move onto the GPU. As long as we cudaMalloc the size of the arrays correctly there shouldn&#39;t be any problems</span></div>
<div class="line"><span class="lineno">  336</span>  <span class="comment">// Can probably make this a bit prettier but will do for now</span></div>
<div class="line"><span class="lineno">  337</span>  <span class="comment">// Could be a lot smaller of a function...</span></div>
<div class="line"><span class="lineno">  338</span>  <a class="code hl_variable" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code hl_function" href="classSMonolithGPU.html#a713a47fd41a93d2b6d40c4b392158aae">InitGPU_SplineMonolith</a>(</div>
<div class="line"><span class="lineno">  339</span>          #ifndef Weight_On_SplineBySpline_Basis</div>
<div class="line"><span class="lineno">  340</span>          &amp;<a class="code hl_variable" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>,</div>
<div class="line"><span class="lineno">  341</span>          <a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>,</div>
<div class="line"><span class="lineno">  342</span>          #endif</div>
<div class="line"><span class="lineno">  343</span>          <a class="code hl_variable" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>, <span class="comment">// How many entries in coefficient array (*4 for the &quot;many&quot; array)</span></div>
<div class="line"><span class="lineno">  344</span>          <a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>, <span class="comment">// What&#39;s the number of splines we have (also number of entries in gpu_nPoints_arr)</span></div>
<div class="line"><span class="lineno">  345</span>          <a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>,</div>
<div class="line"><span class="lineno">  346</span>          event_size_max <span class="comment">//Knots times event number of unique splines</span></div>
<div class="line"><span class="lineno">  347</span>  );</div>
<div class="line"><span class="lineno">  348</span> </div>
<div class="line"><span class="lineno">  349</span>  <span class="comment">// Move number of splines and spline size to constant GPU memory; every thread does not need a copy...</span></div>
<div class="line"><span class="lineno">  350</span>  <span class="comment">// The implementation lives in splines/gpuSplineUtils.cu</span></div>
<div class="line"><span class="lineno">  351</span>  <span class="comment">// The GPU splines don&#39;t actually need declaring but is good for demonstration, kind of</span></div>
<div class="line"><span class="lineno">  352</span>  <span class="comment">// fixed by passing const reference</span></div>
<div class="line"><span class="lineno">  353</span>  <a class="code hl_variable" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code hl_function" href="classSMonolithGPU.html#aef41d94cf5e44ebf4fe427c3ce84f20b">CopyToGPU_SplineMonolith</a>(</div>
<div class="line"><span class="lineno">  354</span>          <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>,</div>
<div class="line"><span class="lineno">  355</span> </div>
<div class="line"><span class="lineno">  356</span>          <span class="comment">// TFI related now</span></div>
<div class="line"><span class="lineno">  357</span>          <a class="code hl_variable" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>,</div>
<div class="line"><span class="lineno">  358</span>          <a class="code hl_variable" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a>,</div>
<div class="line"><span class="lineno">  359</span>          #ifndef Weight_On_SplineBySpline_Basis</div>
<div class="line"><span class="lineno">  360</span>          <a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>,</div>
<div class="line"><span class="lineno">  361</span>          <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>,</div>
<div class="line"><span class="lineno">  362</span>          <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>,</div>
<div class="line"><span class="lineno">  363</span>          #endif</div>
<div class="line"><span class="lineno">  364</span>          <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>,</div>
<div class="line"><span class="lineno">  365</span>          <a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>,</div>
<div class="line"><span class="lineno">  366</span>          <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>,</div>
<div class="line"><span class="lineno">  367</span>          <a class="code hl_variable" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>,</div>
<div class="line"><span class="lineno">  368</span>          <a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>);</div>
<div class="line"><span class="lineno">  369</span> </div>
<div class="line"><span class="lineno">  370</span>  <span class="comment">// Delete all the coefficient arrays from the CPU once they are on the GPU</span></div>
<div class="line"><span class="lineno">  371</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>.clear();</div>
<div class="line"><span class="lineno">  372</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  373</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>.clear();</div>
<div class="line"><span class="lineno">  374</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  375</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>.clear();</div>
<div class="line"><span class="lineno">  376</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  377</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>.clear();</div>
<div class="line"><span class="lineno">  378</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  379</span>  <a class="code hl_variable" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>.clear();</div>
<div class="line"><span class="lineno">  380</span>  <a class="code hl_variable" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  381</span>  <a class="code hl_variable" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a>.clear();</div>
<div class="line"><span class="lineno">  382</span>  <a class="code hl_variable" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  383</span><span class="preprocessor">  #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><span class="lineno">  384</span>  <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.clear();</div>
<div class="line"><span class="lineno">  385</span>  <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  386</span>  <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>.clear();</div>
<div class="line"><span class="lineno">  387</span>  <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>.shrink_to_fit();</div>
<div class="line"><span class="lineno">  388</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno">  389</span>  <span class="keyword">delete</span> <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>;</div>
<div class="line"><span class="lineno">  390</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  391</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Good GPU loading&quot;</span>);</div>
<div class="line"><span class="lineno">  392</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno">  393</span>  <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  394</span>}</div>
<div class="ttc" id="aclassSMonolithGPU_html"><div class="ttname"><a href="classSMonolithGPU.html">SMonolithGPU</a></div><div class="ttdoc">Class responsible for calculating spline weight on GPU.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00061">gpuSplineUtils.cuh:62</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_a713a47fd41a93d2b6d40c4b392158aae"><div class="ttname"><a href="classSMonolithGPU.html#a713a47fd41a93d2b6d40c4b392158aae">SMonolithGPU::InitGPU_SplineMonolith</a></div><div class="ttdeci">__host__ void InitGPU_SplineMonolith(float **cpu_total_weights, int n_events, unsigned int total_nknots, unsigned int n_splines, unsigned int n_tf1, int Eve_size)</div><div class="ttdoc">Allocate memory on gpu for spline monolith.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00106">gpuSplineUtils.cu:106</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_aef41d94cf5e44ebf4fe427c3ce84f20b"><div class="ttname"><a href="classSMonolithGPU.html#aef41d94cf5e44ebf4fe427c3ce84f20b">SMonolithGPU::CopyToGPU_SplineMonolith</a></div><div class="ttdeci">__host__ void CopyToGPU_SplineMonolith(SplineMonoStruct *cpu_spline_handler, std::vector&lt; float &gt; cpu_many_array_TF1, std::vector&lt; short int &gt; cpu_paramNo_arr_TF1, int n_events, std::vector&lt; unsigned int &gt; cpu_nParamPerEvent, std::vector&lt; unsigned int &gt; cpu_nParamPerEvent_TF1, int n_params, unsigned int n_splines, short int spline_size, unsigned int total_nknots, unsigned int n_tf1)</div><div class="ttdoc">Copies data from CPU to GPU for the spline monolith.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00199">gpuSplineUtils.cu:199</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa1bd2dc5c55b7258d5544512659ef9d7" name="aa1bd2dc5c55b7258d5544512659ef9d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1bd2dc5c55b7258d5544512659ef9d7">&#9670;&#160;</a></span>PrepareForGPU()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::PrepareForGPU </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classTResponseFunction__red.html">TResponseFunction_red</a> * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36d">RespFuncType</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>SplineType</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Prepare the <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> objects for the GPU. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of <a class="el" href="classTResponseFunction__red.html" title="KS: A reduced ResponseFunction Generic function used for evaluating weight.">TResponseFunction_red</a> pointers which we strip back </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00063">63</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   63</span>                                                                                                                                    {</div>
<div class="line"><span class="lineno">   64</span><span class="comment">// *****************************************</span></div>
<div class="line"><span class="lineno">   65</span> </div>
<div class="line"><span class="lineno">   66</span>  <span class="comment">// Scan for the max number of knots, the number of events (number of splines), and number of parameters</span></div>
<div class="line"><span class="lineno">   67</span>  <span class="keywordtype">int</span> maxnSplines = 0;</div>
<div class="line"><span class="lineno">   68</span>  <a class="code hl_function" href="classSMonolith.html#a12cddfcbec851b468cba86dc9b223c78">ScanMasterSpline</a>(MasterSpline,</div>
<div class="line"><span class="lineno">   69</span>                   <a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>,</div>
<div class="line"><span class="lineno">   70</span>                   <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>,</div>
<div class="line"><span class="lineno">   71</span>                   <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>,</div>
<div class="line"><span class="lineno">   72</span>                   maxnSplines,</div>
<div class="line"><span class="lineno">   73</span>                   <a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>,</div>
<div class="line"><span class="lineno">   74</span>                   <a class="code hl_variable" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>,</div>
<div class="line"><span class="lineno">   75</span>                   <a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>,</div>
<div class="line"><span class="lineno">   76</span>                   <a class="code hl_variable" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>,</div>
<div class="line"><span class="lineno">   77</span>                   SplineType);</div>
<div class="line"><span class="lineno">   78</span> </div>
<div class="line"><span class="lineno">   79</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} events&quot;</span>, <a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><span class="lineno">   80</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} knots at max&quot;</span>, <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>);</div>
<div class="line"><span class="lineno">   81</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} parameters&quot;</span>, <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>);</div>
<div class="line"><span class="lineno">   82</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} maximum number of splines in an event&quot;</span>, maxnSplines);</div>
<div class="line"><span class="lineno">   83</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found total {} knots in all splines&quot;</span>, <a class="code hl_variable" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>);</div>
<div class="line"><span class="lineno">   84</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Number of splines = {}&quot;</span>, <a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><span class="lineno">   85</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found total {} coeffs in all TF1&quot;</span>, <a class="code hl_variable" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>);</div>
<div class="line"><span class="lineno">   86</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Number of TF1 = {}&quot;</span>, <a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>);</div>
<div class="line"><span class="lineno">   87</span> </div>
<div class="line"><span class="lineno">   88</span>  <span class="comment">// Can pass the spline segments to the GPU instead of the values</span></div>
<div class="line"><span class="lineno">   89</span>  <span class="comment">// Make these here and only refill them for each loop, avoiding unnecessary new/delete on each reconfigure</span></div>
<div class="line"><span class="lineno">   90</span>  <span class="comment">//KS: Since we are going to copy it each step use fancy CUDA memory allocation</span></div>
<div class="line"><span class="lineno">   91</span><span class="preprocessor">  #ifdef CUDA</span></div>
<div class="line"><span class="lineno">   92</span>  <a class="code hl_variable" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code hl_function" href="classSMonolithGPU.html#ab674ec40c136d89b56b7c25d9337c48a">InitGPU_Segments</a>(&amp;<a class="code hl_variable" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>);</div>
<div class="line"><span class="lineno">   93</span>  <a class="code hl_variable" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code hl_function" href="classSMonolithGPU.html#a3fbbb94f6db65b73a394ab541f94fba6">InitGPU_Vals</a>(&amp;<a class="code hl_variable" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>);</div>
<div class="line"><span class="lineno">   94</span><span class="preprocessor">  #else</span></div>
<div class="line"><span class="lineno">   95</span>  <a class="code hl_variable" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a> = <span class="keyword">new</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>[<a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>]();</div>
<div class="line"><span class="lineno">   96</span>  <a class="code hl_variable" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>]();</div>
<div class="line"><span class="lineno">   97</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno">   98</span> </div>
<div class="line"><span class="lineno">   99</span>  <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> j = 0; j &lt; <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>; j++)</div>
<div class="line"><span class="lineno">  100</span>  {</div>
<div class="line"><span class="lineno">  101</span>    <a class="code hl_variable" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>[j] = 0;</div>
<div class="line"><span class="lineno">  102</span>    <a class="code hl_variable" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>[j] = -999;</div>
<div class="line"><span class="lineno">  103</span>  }</div>
<div class="line"><span class="lineno">  104</span> </div>
<div class="line"><span class="lineno">  105</span>  <span class="comment">// Number of objects we have in total if each event has *EVERY* spline. Needed for some arrays</span></div>
<div class="line"><span class="lineno">  106</span>  <a class="code hl_variable" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a> = <a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>*<a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event_size_max = <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> * <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><span class="lineno">  109</span>  <span class="comment">// Declare the {x}, {y,b,c,d} arrays for all possible splines which the event has</span></div>
<div class="line"><span class="lineno">  110</span>  <span class="comment">// We&#39;ll filter off the flat and &quot;disabled&quot; (e.g. CCQE event should not have MARES spline) ones in the next for loop, but need to declare these beasts here</span></div>
<div class="line"><span class="lineno">  111</span> </div>
<div class="line"><span class="lineno">  112</span>  <span class="comment">// Declare the {y,b,c,d} for each knot</span></div>
<div class="line"><span class="lineno">  113</span>  <span class="comment">// float because GPU precision (could change to double, but will incur significant speed reduction on GPU unless you&#39;re very rich!)</span></div>
<div class="line"><span class="lineno">  114</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>.resize(<a class="code hl_variable" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>); <span class="comment">// *4 because we store y,b,c,d parameters in this array</span></div>
<div class="line"><span class="lineno">  115</span>  <span class="comment">//KS: For x coeff we assume that for given dial (MAQE) spacing is identical, here we are sloppy and assume each dial has the same number of knots, not a big problem</span></div>
<div class="line"><span class="lineno">  116</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>.resize(event_size_max);</div>
<div class="line"><span class="lineno">  117</span> </div>
<div class="line"><span class="lineno">  118</span>  <span class="comment">// Set all the big arrays to -999 to keep us safe...</span></div>
<div class="line"><span class="lineno">  119</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; event_size_max; j++) {</div>
<div class="line"><span class="lineno">  120</span>    <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>[j] = -999;</div>
<div class="line"><span class="lineno">  121</span>  }</div>
<div class="line"><span class="lineno">  122</span> </div>
<div class="line"><span class="lineno">  123</span>  <span class="comment">//CW: With TF1 we only save the coefficients and the order of the polynomial</span></div>
<div class="line"><span class="lineno">  124</span>  <span class="comment">// Makes most sense to have one large monolithic array, but then it becomes impossible to tell apart a coefficient from a &quot;number of points&quot;. So have two arrays: one of coefficients and one of number of points</span></div>
<div class="line"><span class="lineno">  125</span>  <span class="comment">// Let&#39;s first assume all are of _max_knots size</span></div>
<div class="line"><span class="lineno">  126</span>  <span class="comment">// Now declare the arrays for each point in the valid splines which the event actually has (i.e. include the splines that the event undergoes)</span></div>
<div class="line"><span class="lineno">  127</span>  <span class="comment">// Also make array with the number of points per spline (not per spline point!)</span></div>
<div class="line"><span class="lineno">  128</span>  <span class="comment">// float because GPU precision (could change to double, but will incur significant speed reduction on GPU unless you&#39;re very rich!)</span></div>
<div class="line"><span class="lineno">  129</span>  <a class="code hl_variable" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>.resize(<a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>);</div>
<div class="line"><span class="lineno">  130</span>  <a class="code hl_variable" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>.resize(<a class="code hl_variable" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>); <span class="comment">// *5 because this array holds  a,b,c,d,e parameters</span></div>
<div class="line"><span class="lineno">  131</span> </div>
<div class="line"><span class="lineno">  132</span><span class="preprocessor">  #ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><span class="lineno">  133</span>  <span class="comment">// This holds the index of each spline</span></div>
<div class="line"><span class="lineno">  134</span>  <a class="code hl_variable" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code hl_variable" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a>];</div>
<div class="line"><span class="lineno">  135</span>  <a class="code hl_variable" href="classSMonolith.html#a1aa70cce5867e7e784e97eacebe6bfbd">index_TF1_cpu</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code hl_variable" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a>];</div>
<div class="line"><span class="lineno">  136</span> </div>
<div class="line"><span class="lineno">  137</span><span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><span class="lineno">  138</span><span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><span class="lineno">  139</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno">  140</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; <a class="code hl_variable" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a>; j++) {</div>
<div class="line"><span class="lineno">  141</span>    <a class="code hl_variable" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a>[j] = -1;</div>
<div class="line"><span class="lineno">  142</span>    <a class="code hl_variable" href="classSMonolith.html#a1aa70cce5867e7e784e97eacebe6bfbd">index_TF1_cpu</a>[j] = -1;</div>
<div class="line"><span class="lineno">  143</span>  }</div>
<div class="line"><span class="lineno">  144</span>  <span class="comment">// This holds the total CPU weights that gets read in samplePDFND</span></div>
<div class="line"><span class="lineno">  145</span>  <a class="code hl_variable" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_variable" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a>];</div>
<div class="line"><span class="lineno">  146</span><span class="preprocessor">  #else</span></div>
<div class="line"><span class="lineno">  147</span>  <span class="comment">//KS: Map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}</span></div>
<div class="line"><span class="lineno">  148</span>  <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.resize(2*<a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><span class="lineno">  149</span>  <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>.resize(2*<a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><span class="lineno">  150</span><span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><span class="lineno">  151</span><span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><span class="lineno">  152</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno">  153</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 2*<a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>; j++) {</div>
<div class="line"><span class="lineno">  154</span>    <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[j] = -1;</div>
<div class="line"><span class="lineno">  155</span>    <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[j] = -1;</div>
<div class="line"><span class="lineno">  156</span>  }</div>
<div class="line"><span class="lineno">  157</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno">  158</span> </div>
<div class="line"><span class="lineno">  159</span>  <span class="comment">// Make array with the number of points per spline (not per spline point!)</span></div>
<div class="line"><span class="lineno">  160</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>.resize(<a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><span class="lineno">  161</span>  <span class="comment">//KS: And array which tells where each spline stars in a big monolith array, sort of knot map</span></div>
<div class="line"><span class="lineno">  162</span>  <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>.resize(<a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><span class="lineno">  163</span>  <a class="code hl_variable" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a>.resize(<a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>);</div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>  <span class="comment">// Temporary arrays to hold the coefficients for each spline</span></div>
<div class="line"><span class="lineno">  166</span>  <span class="comment">// We get one x, one y, one b,... for each point, so only need to be _max_knots big</span></div>
<div class="line"><span class="lineno">  167</span>  <span class="comment">//KS: Some params has less splines but this is all right main array will get proper number while this temp will be deleted</span></div>
<div class="line"><span class="lineno">  168</span>  <span class="keywordtype">float</span> *x_tmp = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>]();</div>
<div class="line"><span class="lineno">  169</span>  <span class="keywordtype">float</span> *many_tmp = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>]();</div>
<div class="line"><span class="lineno">  170</span>  <span class="keywordtype">float</span> *temp_coeffs = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_define" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>]();</div>
<div class="line"><span class="lineno">  171</span> </div>
<div class="line"><span class="lineno">  172</span>  <span class="comment">// Count the number of events</span></div>
<div class="line"><span class="lineno">  173</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> KnotCounter = 0;</div>
<div class="line"><span class="lineno">  174</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> TF1PointsCounter = 0;</div>
<div class="line"><span class="lineno">  175</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NSplinesCounter = 0;</div>
<div class="line"><span class="lineno">  176</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> TF1sCounter = 0;</div>
<div class="line"><span class="lineno">  177</span>  <span class="keywordtype">int</span> ParamCounter = 0;</div>
<div class="line"><span class="lineno">  178</span>  <span class="keywordtype">int</span> ParamCounterGlobal = 0;</div>
<div class="line"><span class="lineno">  179</span>  <span class="keywordtype">int</span> ParamCounter_TF1 = 0;</div>
<div class="line"><span class="lineno">  180</span>  <span class="keywordtype">int</span> ParamCounterGlobalTF1 = 0;</div>
<div class="line"><span class="lineno">  181</span>  <span class="comment">// Loop over events and extract the spline coefficients</span></div>
<div class="line"><span class="lineno">  182</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EventCounter = 0; EventCounter &lt; MasterSpline.size(); ++EventCounter) {</div>
<div class="line"><span class="lineno">  183</span>    <span class="comment">// Structure of MasterSpline is std::vector&lt;std::vector&lt;TSpline3*&gt;&gt;</span></div>
<div class="line"><span class="lineno">  184</span>    <span class="comment">// A conventional iterator to count which parameter a given spline should be applied to</span></div>
<div class="line"><span class="lineno">  185</span>    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ParamNumber = 0; ParamNumber &lt; MasterSpline[EventCounter].size(); ++ParamNumber) {</div>
<div class="line"><span class="lineno">  186</span> </div>
<div class="line"><span class="lineno">  187</span>      <span class="comment">// If NULL we don&#39;t have this spline for the event, so move to next spline</span></div>
<div class="line"><span class="lineno">  188</span>      <span class="keywordflow">if</span> (MasterSpline[EventCounter][ParamNumber] == NULL) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  189</span> </div>
<div class="line"><span class="lineno">  190</span>      <span class="keywordflow">if</span>(SplineType[ParamNumber] == <a class="code hl_enumvalue" href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da8bea6994e011cc85a5a88b50c97ce7b2">kTSpline3_red</a>)</div>
<div class="line"><span class="lineno">  191</span>      {</div>
<div class="line"><span class="lineno">  192</span>        <span class="comment">//KS: how much knots each spline has</span></div>
<div class="line"><span class="lineno">  193</span>        <span class="keywordtype">int</span> nPoints_tmp = 0;</div>
<div class="line"><span class="lineno">  194</span>        <span class="comment">// Get a pointer to the current spline for this event</span></div>
<div class="line"><span class="lineno">  195</span>        <a class="code hl_class" href="classTResponseFunction__red.html">TResponseFunction_red</a>* TespFunc = MasterSpline[EventCounter][ParamNumber];</div>
<div class="line"><span class="lineno">  196</span>        <a class="code hl_class" href="classTSpline3__red.html">TSpline3_red</a>* CurrSpline = <span class="keyword">static_cast&lt;</span><a class="code hl_class" href="classTSpline3__red.html">TSpline3_red</a>*<span class="keyword">&gt;</span>(TespFunc);</div>
<div class="line"><span class="lineno">  197</span> </div>
<div class="line"><span class="lineno">  198</span>        <span class="comment">// If the number of knots are greater than 2 the spline is not a dummy and we should extract coefficients to load onto the GPU</span></div>
<div class="line"><span class="lineno">  199</span>        <a class="code hl_function" href="classSMonolith.html#acbbe3398718d0d02d65a1e92a91c112c">getSplineCoeff_SepMany</a>(CurrSpline, nPoints_tmp, x_tmp, many_tmp);</div>
<div class="line"><span class="lineno">  200</span> </div>
<div class="line"><span class="lineno">  201</span>        <span class="comment">//KS: One knot means flat spline so ignore</span></div>
<div class="line"><span class="lineno">  202</span>        <span class="keywordflow">if</span> (nPoints_tmp == 1) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  203</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>; ++j) {</div>
<div class="line"><span class="lineno">  204</span>          <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>[ParamNumber*<a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> + j] = x_tmp[j];</div>
<div class="line"><span class="lineno">  205</span>        }</div>
<div class="line"><span class="lineno">  206</span>        <span class="comment">//KS: Contrary to X coeff we keep for other coeff only filled knots, there is no much gain for doing so for x coeff</span></div>
<div class="line"><span class="lineno">  207</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nPoints_tmp; ++j) {</div>
<div class="line"><span class="lineno">  208</span>          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; <a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>; k++) {</div>
<div class="line"><span class="lineno">  209</span>            <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>[KnotCounter*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a> + j*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a> + k] = many_tmp[j*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+k];</div>
<div class="line"><span class="lineno">  210</span>          }</div>
<div class="line"><span class="lineno">  211</span>        }</div>
<div class="line"><span class="lineno">  212</span>        <span class="comment">// Set the parameter number for this spline</span></div>
<div class="line"><span class="lineno">  213</span>        <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>[NSplinesCounter] = short(ParamNumber);</div>
<div class="line"><span class="lineno">  214</span>        <span class="comment">//KS: Fill map when each spline starts</span></div>
<div class="line"><span class="lineno">  215</span>        <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>[NSplinesCounter] = KnotCounter;</div>
<div class="line"><span class="lineno">  216</span>        KnotCounter += nPoints_tmp;</div>
<div class="line"><span class="lineno">  217</span> </div>
<div class="line"><span class="lineno">  218</span><span class="preprocessor">        #ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><span class="lineno">  219</span>        <span class="comment">// Set the index of the spline so we can tell apart from flat splines</span></div>
<div class="line"><span class="lineno">  220</span>        <a class="code hl_variable" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a>[EventCounter*<a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a> + ParamNumber] = NSplinesCounter;</div>
<div class="line"><span class="lineno">  221</span><span class="preprocessor">        #else</span></div>
<div class="line"><span class="lineno">  222</span>        ++ParamCounter;</div>
<div class="line"><span class="lineno">  223</span><span class="preprocessor">        #endif</span></div>
<div class="line"><span class="lineno">  224</span>        <span class="comment">// Increment the counter for the number of good splines we have</span></div>
<div class="line"><span class="lineno">  225</span>        ++NSplinesCounter;</div>
<div class="line"><span class="lineno">  226</span>      }</div>
<div class="line"><span class="lineno">  227</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SplineType[ParamNumber] == <a class="code hl_enumvalue" href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da847a18b0a859ce2b3b87a98f455855b1">kTF1_red</a>)</div>
<div class="line"><span class="lineno">  228</span>      {</div>
<div class="line"><span class="lineno">  229</span>        <span class="comment">// Don&#39;t actually use this ever -- we give each spline the maximum number of points found in all splines</span></div>
<div class="line"><span class="lineno">  230</span>        <span class="keywordtype">int</span> nPoints_tmp = 0;</div>
<div class="line"><span class="lineno">  231</span>        <span class="comment">// Get a pointer to the current spline for this event</span></div>
<div class="line"><span class="lineno">  232</span>        <a class="code hl_class" href="classTF1__red.html">TF1_red</a>* CurrSpline = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classTF1__red.html">TF1_red</a>*<span class="keyword">&gt;</span>(MasterSpline[EventCounter][ParamNumber]);</div>
<div class="line"><span class="lineno">  233</span> </div>
<div class="line"><span class="lineno">  234</span>        <span class="comment">// If the number of knots are greater than 2 the spline is not a dummy and we should extract coefficients to load onto the GPU</span></div>
<div class="line"><span class="lineno">  235</span>        <a class="code hl_function" href="classSplineBase.html#ac8a5f86ac6f156a7e11ef188b06f425f">getTF1Coeff</a>(CurrSpline, nPoints_tmp, temp_coeffs);</div>
<div class="line"><span class="lineno">  236</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code hl_define" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>; ++j) {</div>
<div class="line"><span class="lineno">  237</span>          <a class="code hl_variable" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>[TF1PointsCounter+j] = temp_coeffs[j];</div>
<div class="line"><span class="lineno">  238</span>        }</div>
<div class="line"><span class="lineno">  239</span>        <span class="comment">// Save the number of points for this spline</span></div>
<div class="line"><span class="lineno">  240</span>        <a class="code hl_variable" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>[TF1sCounter] = short(nPoints_tmp);</div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>        TF1PointsCounter += nPoints_tmp;</div>
<div class="line"><span class="lineno">  243</span>        <span class="comment">// Set the parameter number for this spline</span></div>
<div class="line"><span class="lineno">  244</span>        <a class="code hl_variable" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a>[TF1sCounter] = short(ParamNumber);</div>
<div class="line"><span class="lineno">  245</span><span class="preprocessor">        #ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><span class="lineno">  246</span>        <span class="comment">// Set the index of the spline so we can tell apart from flat splines</span></div>
<div class="line"><span class="lineno">  247</span>        <a class="code hl_variable" href="classSMonolith.html#a1aa70cce5867e7e784e97eacebe6bfbd">index_TF1_cpu</a>[EventCounter*<a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a> + ParamNumber] = TF1sCounter;</div>
<div class="line"><span class="lineno">  248</span><span class="preprocessor">        #else</span></div>
<div class="line"><span class="lineno">  249</span>        ++ParamCounter_TF1;</div>
<div class="line"><span class="lineno">  250</span><span class="preprocessor">        #endif</span></div>
<div class="line"><span class="lineno">  251</span>        <span class="comment">// Increment the counter for the number of good splines we have</span></div>
<div class="line"><span class="lineno">  252</span>        ++TF1sCounter;</div>
<div class="line"><span class="lineno">  253</span>      }</div>
<div class="line"><span class="lineno">  254</span>      <span class="comment">//KS: Don&#39;t delete in debug</span></div>
<div class="line"><span class="lineno">  255</span><span class="preprocessor">      #ifndef DEBUG</span></div>
<div class="line"><span class="lineno">  256</span>      <span class="keyword">delete</span> MasterSpline[EventCounter][ParamNumber];</div>
<div class="line"><span class="lineno">  257</span>      MasterSpline[EventCounter][ParamNumber] = NULL;</div>
<div class="line"><span class="lineno">  258</span><span class="preprocessor">      #endif</span></div>
<div class="line"><span class="lineno">  259</span>    } <span class="comment">// End the loop over the parameters in the MasterSpline</span></div>
<div class="line"><span class="lineno">  260</span><span class="preprocessor">    #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><span class="lineno">  261</span>    <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[2*EventCounter] = ParamCounter;</div>
<div class="line"><span class="lineno">  262</span>    <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[2*EventCounter+1] = ParamCounterGlobal;</div>
<div class="line"><span class="lineno">  263</span>    ParamCounterGlobal += ParamCounter;</div>
<div class="line"><span class="lineno">  264</span> </div>
<div class="line"><span class="lineno">  265</span>    <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[2*EventCounter] = ParamCounter_TF1;</div>
<div class="line"><span class="lineno">  266</span>    <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[2*EventCounter+1] = ParamCounterGlobalTF1;</div>
<div class="line"><span class="lineno">  267</span>    ParamCounterGlobalTF1 += ParamCounter_TF1;</div>
<div class="line"><span class="lineno">  268</span> </div>
<div class="line"><span class="lineno">  269</span>    ParamCounter = 0;</div>
<div class="line"><span class="lineno">  270</span>    ParamCounter_TF1 = 0;</div>
<div class="line"><span class="lineno">  271</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno">  272</span>  } <span class="comment">// End the loop over the number of events</span></div>
<div class="line"><span class="lineno">  273</span>  <span class="keyword">delete</span>[] many_tmp;</div>
<div class="line"><span class="lineno">  274</span>  <span class="keyword">delete</span>[] x_tmp;</div>
<div class="line"><span class="lineno">  275</span>  <span class="keyword">delete</span>[] temp_coeffs;</div>
<div class="line"><span class="lineno">  276</span> </div>
<div class="line"><span class="lineno">  277</span>  <span class="keywordtype">int</span> BadXCounter = 0;</div>
<div class="line"><span class="lineno">  278</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; event_size_max; j++) {</div>
<div class="line"><span class="lineno">  279</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>[j] == -999) BadXCounter++;</div>
<div class="line"><span class="lineno">  280</span>    <span class="comment">// Perform checks that all entries have been modified from initial values</span></div>
<div class="line"><span class="lineno">  281</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>[j] == -999 &amp;&amp; BadXCounter &lt; 5) {</div>
<div class="line"><span class="lineno">  282</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;***** BAD X !! *****&quot;</span>);</div>
<div class="line"><span class="lineno">  283</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;Indicates some parameter doesn&#39;t have a single spline&quot;</span>);</div>
<div class="line"><span class="lineno">  284</span>      <a class="code hl_define" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;j = {}&quot;</span>, j);</div>
<div class="line"><span class="lineno">  285</span>      <span class="comment">//throw MaCh3Exception(__FILE__ , __LINE__ );</span></div>
<div class="line"><span class="lineno">  286</span>    }</div>
<div class="line"><span class="lineno">  287</span>    <span class="keywordflow">if</span>(BadXCounter == 5) <a class="code hl_define" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;There is more unutilised knots although I will stop spamming&quot;</span>);</div>
<div class="line"><span class="lineno">  288</span>  }</div>
<div class="line"><span class="lineno">  289</span> </div>
<div class="line"><span class="lineno">  290</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;Found in total {} BAD X&quot;</span>, BadXCounter);</div>
<div class="line"><span class="lineno">  291</span><span class="preprocessor">  #ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><span class="lineno">  292</span>  <span class="comment">// Make the array that holds all the returned weights from the GPU to pass to the CPU</span></div>
<div class="line"><span class="lineno">  293</span>  <a class="code hl_variable" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>]();</div>
<div class="line"><span class="lineno">  294</span>  <a class="code hl_variable" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>]();</div>
<div class="line"><span class="lineno">  295</span><span class="preprocessor">  #else</span></div>
<div class="line"><span class="lineno">  296</span>    <span class="comment">//KS: This is tricky as this variable use both by CPU and GPU, however if use CUDA we use cudaMallocHost</span></div>
<div class="line"><span class="lineno">  297</span><span class="preprocessor">    #ifndef CUDA</span></div>
<div class="line"><span class="lineno">  298</span>    <a class="code hl_variable" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>]();</div>
<div class="line"><span class="lineno">  299</span>    <a class="code hl_variable" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>]();</div>
<div class="line"><span class="lineno">  300</span>    <a class="code hl_variable" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>]();</div>
<div class="line"><span class="lineno">  301</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno">  302</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno">  303</span> </div>
<div class="line"><span class="lineno">  304</span>  <span class="comment">// Print some info; could probably make this to a separate function</span></div>
<div class="line"><span class="lineno">  305</span>  <a class="code hl_function" href="classSMonolith.html#a5c374d4505de53ad68d176a5644568e6">PrintInitialsiation</a>();</div>
<div class="line"><span class="lineno">  306</span> </div>
<div class="line"><span class="lineno">  307</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">SaveSplineFile</a>) <a class="code hl_function" href="classSMonolith.html#a79f4bf0cac279cf57ab8f06698052922">PrepareSplineFile</a>();</div>
<div class="line"><span class="lineno">  308</span> </div>
<div class="line"><span class="lineno">  309</span>  <a class="code hl_function" href="classSMonolith.html#aac73a1089592c5f22755b7427869827f">MoveToGPU</a>();</div>
<div class="line"><span class="lineno">  310</span>}</div>
<div class="ttc" id="aMaCh3Logger_8h_html_ad5b2eb6377721e3ac95def22c2386bb1"><div class="ttname"><a href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a></div><div class="ttdeci">#define MACH3LOG_WARN</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Logger_8h_source.html#l00017">MaCh3Logger.h:17</a></div></div>
<div class="ttc" id="aStructs_8h_html_a6a73aa1ad819973a9c421c17c2a7f36da847a18b0a859ce2b3b87a98f455855b1"><div class="ttname"><a href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da847a18b0a859ce2b3b87a98f455855b1">kTF1_red</a></div><div class="ttdeci">@ kTF1_red</div><div class="ttdoc">Uses TF1_red for interpolation.</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00121">Structs.h:121</a></div></div>
<div class="ttc" id="aStructs_8h_html_a6a73aa1ad819973a9c421c17c2a7f36da8bea6994e011cc85a5a88b50c97ce7b2"><div class="ttname"><a href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da8bea6994e011cc85a5a88b50c97ce7b2">kTSpline3_red</a></div><div class="ttdeci">@ kTSpline3_red</div><div class="ttdoc">Uses TSpline3_red for interpolation.</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00120">Structs.h:120</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a12cddfcbec851b468cba86dc9b223c78"><div class="ttname"><a href="classSMonolith.html#a12cddfcbec851b468cba86dc9b223c78">SMonolith::ScanMasterSpline</a></div><div class="ttdeci">void ScanMasterSpline(std::vector&lt; std::vector&lt; TResponseFunction_red * &gt; &gt; &amp;MasterSpline, unsigned int &amp;nEvents, int &amp;MaxPoints, short int &amp;numParams, int &amp;nSplines, unsigned int &amp;NSplinesValid, unsigned int &amp;numKnots, unsigned int &amp;nTF1Valid, unsigned int &amp;nTF1_coeff, const std::vector&lt; RespFuncType &gt; &amp;SplineType)</div><div class="ttdoc">CW: Function to scan through the MasterSpline of TSpline3.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00399">SplineMonolith.cpp:399</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a79f4bf0cac279cf57ab8f06698052922"><div class="ttname"><a href="classSMonolith.html#a79f4bf0cac279cf57ab8f06698052922">SMonolith::PrepareSplineFile</a></div><div class="ttdeci">void PrepareSplineFile()</div><div class="ttdoc">KS: Prepare spline file that can be used for fast loading.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00680">SplineMonolith.cpp:680</a></div></div>
<div class="ttc" id="aclassSMonolith_html_acbbe3398718d0d02d65a1e92a91c112c"><div class="ttname"><a href="classSMonolith.html#acbbe3398718d0d02d65a1e92a91c112c">SMonolith::getSplineCoeff_SepMany</a></div><div class="ttdeci">void getSplineCoeff_SepMany(TSpline3_red *&amp;spl, int &amp;nPoints, float *&amp;xArray, float *&amp;manyArray)</div><div class="ttdoc">CW: This loads up coefficients into two arrays: one x array and one yabcd array.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00871">SplineMonolith.cpp:871</a></div></div>
<div class="ttc" id="aclassSplineBase_html_ac8a5f86ac6f156a7e11ef188b06f425f"><div class="ttname"><a href="classSplineBase.html#ac8a5f86ac6f156a7e11ef188b06f425f">SplineBase::getTF1Coeff</a></div><div class="ttdeci">void getTF1Coeff(TF1_red *&amp;spl, int &amp;nPoints, float *&amp;coeffs)</div><div class="ttdoc">CW: Gets the polynomial coefficients for TF1.</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8cpp_source.html#l00025">SplineBase.cpp:25</a></div></div>
<div class="ttc" id="aclassTF1__red_html"><div class="ttname"><a href="classTF1__red.html">TF1_red</a></div><div class="ttdoc">CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00119">SplineStructs.h:119</a></div></div>
<div class="ttc" id="aclassTResponseFunction__red_html"><div class="ttname"><a href="classTResponseFunction__red.html">TResponseFunction_red</a></div><div class="ttdoc">KS: A reduced ResponseFunction Generic function used for evaluating weight.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00102">SplineStructs.h:102</a></div></div>
<div class="ttc" id="aclassTSpline3__red_html"><div class="ttname"><a href="classTSpline3__red.html">TSpline3_red</a></div><div class="ttdoc">CW: Reduced TSpline3 class.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00236">SplineStructs.h:236</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a79f4bf0cac279cf57ab8f06698052922" name="a79f4bf0cac279cf57ab8f06698052922"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79f4bf0cac279cf57ab8f06698052922">&#9670;&#160;</a></span>PrepareSplineFile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::PrepareSplineFile </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Prepare spline file that can be used for fast loading. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00680">680</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  680</span>                                  {</div>
<div class="line"><span class="lineno">  681</span><span class="comment">// *****************************************</span></div>
<div class="line"><span class="lineno">  682</span>  std::string FileName = <span class="stringliteral">&quot;SplineFile.root&quot;</span>;</div>
<div class="line"><span class="lineno">  683</span>  <span class="keywordflow">if</span> (std::getenv(<span class="stringliteral">&quot;MACH3&quot;</span>) != NULL) {</div>
<div class="line"><span class="lineno">  684</span>      FileName.insert(0, std::string(std::getenv(<span class="stringliteral">&quot;MACH3&quot;</span>))+<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><span class="lineno">  685</span>   }</div>
<div class="line"><span class="lineno">  686</span> </div>
<div class="line"><span class="lineno">  687</span>  TFile *SplineFile = <span class="keyword">new</span> TFile(FileName.c_str(), <span class="stringliteral">&quot;recreate&quot;</span>);</div>
<div class="line"><span class="lineno">  688</span>  TTree *Settings = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;Settings&quot;</span>, <span class="stringliteral">&quot;Settings&quot;</span>);</div>
<div class="line"><span class="lineno">  689</span>  TTree *Monolith = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;Monolith&quot;</span>, <span class="stringliteral">&quot;Monolith&quot;</span>);</div>
<div class="line"><span class="lineno">  690</span>  TTree *Monolith_TF1 = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;Monolith_TF1&quot;</span>, <span class="stringliteral">&quot;Monolith_TF1&quot;</span>);</div>
<div class="line"><span class="lineno">  691</span>  TTree *ParamInfo = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;ParamInfo&quot;</span>, <span class="stringliteral">&quot;ParamInfo&quot;</span>);</div>
<div class="line"><span class="lineno">  692</span>  TTree *XKnots = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;XKnots&quot;</span>, <span class="stringliteral">&quot;XKnots&quot;</span>);</div>
<div class="line"><span class="lineno">  693</span>  TTree *EventInfo = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;EventInfo&quot;</span>, <span class="stringliteral">&quot;EventInfo&quot;</span>);</div>
<div class="line"><span class="lineno">  694</span>  TTree *FastSplineInfoTree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;FastSplineInfoTree&quot;</span>, <span class="stringliteral">&quot;FastSplineInfoTree&quot;</span>);</div>
<div class="line"><span class="lineno">  695</span> </div>
<div class="line"><span class="lineno">  696</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NEvents_temp = <a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>;</div>
<div class="line"><span class="lineno">  697</span>  <span class="keywordtype">short</span> <span class="keywordtype">int</span> nParams_temp = <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><span class="lineno">  698</span>  <span class="keywordtype">int</span> _max_knots_temp = <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>;</div>
<div class="line"><span class="lineno">  699</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nKnots_temp = <a class="code hl_variable" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>;</div>
<div class="line"><span class="lineno">  700</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NSplines_valid_temp = <a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>;</div>
<div class="line"><span class="lineno">  701</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nTF1Valid_temp = <a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>;</div>
<div class="line"><span class="lineno">  702</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nTF1coeff_temp = <a class="code hl_variable" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>;</div>
<div class="line"><span class="lineno">  703</span> </div>
<div class="line"><span class="lineno">  704</span>  Settings-&gt;Branch(<span class="stringliteral">&quot;NEvents&quot;</span>, &amp;NEvents_temp, <span class="stringliteral">&quot;NEvents/i&quot;</span>);</div>
<div class="line"><span class="lineno">  705</span>  Settings-&gt;Branch(<span class="stringliteral">&quot;nParams&quot;</span>, &amp;nParams_temp, <span class="stringliteral">&quot;nParams/S&quot;</span>);</div>
<div class="line"><span class="lineno">  706</span>  Settings-&gt;Branch(<span class="stringliteral">&quot;_max_knots&quot;</span>, &amp;_max_knots_temp, <span class="stringliteral">&quot;_max_knots/I&quot;</span>);</div>
<div class="line"><span class="lineno">  707</span>  Settings-&gt;Branch(<span class="stringliteral">&quot;nKnots&quot;</span>, &amp;nKnots_temp, <span class="stringliteral">&quot;nKnots/i&quot;</span>);</div>
<div class="line"><span class="lineno">  708</span>  Settings-&gt;Branch(<span class="stringliteral">&quot;NSplines_valid&quot;</span>, &amp;NSplines_valid_temp, <span class="stringliteral">&quot;NSplines_valid/i&quot;</span>);</div>
<div class="line"><span class="lineno">  709</span>  Settings-&gt;Branch(<span class="stringliteral">&quot;NTF1_valid&quot;</span>, &amp;nTF1Valid_temp, <span class="stringliteral">&quot;NTF1_valid/i&quot;</span>);</div>
<div class="line"><span class="lineno">  710</span>  Settings-&gt;Branch(<span class="stringliteral">&quot;nTF1coeff&quot;</span>, &amp;nTF1coeff_temp, <span class="stringliteral">&quot;nTF1coeff/i&quot;</span>);</div>
<div class="line"><span class="lineno">  711</span> </div>
<div class="line"><span class="lineno">  712</span>  Settings-&gt;Fill();</div>
<div class="line"><span class="lineno">  713</span> </div>
<div class="line"><span class="lineno">  714</span>  SplineFile-&gt;cd();</div>
<div class="line"><span class="lineno">  715</span>  Settings-&gt;Write();</div>
<div class="line"><span class="lineno">  716</span> </div>
<div class="line"><span class="lineno">  717</span>  <span class="keywordtype">float</span> coeff = 0.;</div>
<div class="line"><span class="lineno">  718</span>  Monolith-&gt;Branch(<span class="stringliteral">&quot;cpu_coeff_many&quot;</span>, &amp;coeff, <span class="stringliteral">&quot;cpu_coeff_many/F&quot;</span>);</div>
<div class="line"><span class="lineno">  719</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>; i++)</div>
<div class="line"><span class="lineno">  720</span>  {</div>
<div class="line"><span class="lineno">  721</span>    coeff = <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>[i];</div>
<div class="line"><span class="lineno">  722</span>    Monolith-&gt;Fill();</div>
<div class="line"><span class="lineno">  723</span>  }</div>
<div class="line"><span class="lineno">  724</span>  SplineFile-&gt;cd();</div>
<div class="line"><span class="lineno">  725</span>  Monolith-&gt;Write();</div>
<div class="line"><span class="lineno">  726</span> </div>
<div class="line"><span class="lineno">  727</span> </div>
<div class="line"><span class="lineno">  728</span>  <span class="keywordtype">float</span> coeff_tf1 = 0.;</div>
<div class="line"><span class="lineno">  729</span>  Monolith_TF1-&gt;Branch(<span class="stringliteral">&quot;cpu_coeff_TF1_many&quot;</span>, &amp;coeff_tf1, <span class="stringliteral">&quot;cpu_coeff_TF1_many/F&quot;</span>);</div>
<div class="line"><span class="lineno">  730</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>; i++)</div>
<div class="line"><span class="lineno">  731</span>  {</div>
<div class="line"><span class="lineno">  732</span>    coeff_tf1 = <a class="code hl_variable" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>[i];</div>
<div class="line"><span class="lineno">  733</span>    Monolith_TF1-&gt;Fill();</div>
<div class="line"><span class="lineno">  734</span>  }</div>
<div class="line"><span class="lineno">  735</span>  SplineFile-&gt;cd();</div>
<div class="line"><span class="lineno">  736</span>  Monolith_TF1-&gt;Write();</div>
<div class="line"><span class="lineno">  737</span> </div>
<div class="line"><span class="lineno">  738</span>  <span class="keywordtype">short</span> <span class="keywordtype">int</span> paramNo_arr = 0;</div>
<div class="line"><span class="lineno">  739</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nKnots_arr = 0;</div>
<div class="line"><span class="lineno">  740</span>  ParamInfo-&gt;Branch(<span class="stringliteral">&quot;cpu_paramNo_arr&quot;</span>, &amp;paramNo_arr, <span class="stringliteral">&quot;cpu_paramNo_arr/S&quot;</span>);</div>
<div class="line"><span class="lineno">  741</span>  ParamInfo-&gt;Branch(<span class="stringliteral">&quot;cpu_nKnots_arr&quot;</span>, &amp;nKnots_arr, <span class="stringliteral">&quot;cpu_nKnots_arr/i&quot;</span>);</div>
<div class="line"><span class="lineno">  742</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>; i++)</div>
<div class="line"><span class="lineno">  743</span>  {</div>
<div class="line"><span class="lineno">  744</span>    paramNo_arr = <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>[i];</div>
<div class="line"><span class="lineno">  745</span>    nKnots_arr = <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>[i];</div>
<div class="line"><span class="lineno">  746</span> </div>
<div class="line"><span class="lineno">  747</span>    ParamInfo-&gt;Fill();</div>
<div class="line"><span class="lineno">  748</span>  }</div>
<div class="line"><span class="lineno">  749</span>  SplineFile-&gt;cd();</div>
<div class="line"><span class="lineno">  750</span>  ParamInfo-&gt;Write();</div>
<div class="line"><span class="lineno">  751</span> </div>
<div class="line"><span class="lineno">  752</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event_size_max = <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> * <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><span class="lineno">  753</span> </div>
<div class="line"><span class="lineno">  754</span>  <span class="keywordtype">float</span> coeff_x = 0.;</div>
<div class="line"><span class="lineno">  755</span>  XKnots-&gt;Branch(<span class="stringliteral">&quot;cpu_coeff_x&quot;</span>, &amp;coeff_x, <span class="stringliteral">&quot;cpu_coeff_x/F&quot;</span>);</div>
<div class="line"><span class="lineno">  756</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; event_size_max; i++)</div>
<div class="line"><span class="lineno">  757</span>  {</div>
<div class="line"><span class="lineno">  758</span>    coeff_x = <a class="code hl_variable" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code hl_variable" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>[i];</div>
<div class="line"><span class="lineno">  759</span>    XKnots-&gt;Fill();</div>
<div class="line"><span class="lineno">  760</span>  }</div>
<div class="line"><span class="lineno">  761</span>  SplineFile-&gt;cd();</div>
<div class="line"><span class="lineno">  762</span>  XKnots-&gt;Write();</div>
<div class="line"><span class="lineno">  763</span> </div>
<div class="line"><span class="lineno">  764</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nParamPerEvent = 0;</div>
<div class="line"><span class="lineno">  765</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nParamPerEvent_tf1 = 0;</div>
<div class="line"><span class="lineno">  766</span> </div>
<div class="line"><span class="lineno">  767</span>  EventInfo-&gt;Branch(<span class="stringliteral">&quot;cpu_nParamPerEvent&quot;</span>, &amp;nParamPerEvent, <span class="stringliteral">&quot;cpu_nParamPerEvent/i&quot;</span>);</div>
<div class="line"><span class="lineno">  768</span>  EventInfo-&gt;Branch(<span class="stringliteral">&quot;cpu_nParamPerEvent_tf1&quot;</span>, &amp;nParamPerEvent_tf1, <span class="stringliteral">&quot;cpu_nParamPerEvent_tf1/i&quot;</span>);</div>
<div class="line"><span class="lineno">  769</span> </div>
<div class="line"><span class="lineno">  770</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 2*<a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>; i++)</div>
<div class="line"><span class="lineno">  771</span>  {</div>
<div class="line"><span class="lineno">  772</span>    nParamPerEvent = <a class="code hl_variable" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[i];</div>
<div class="line"><span class="lineno">  773</span>    nParamPerEvent_tf1 = <a class="code hl_variable" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[i];</div>
<div class="line"><span class="lineno">  774</span>    EventInfo-&gt;Fill();</div>
<div class="line"><span class="lineno">  775</span>  }</div>
<div class="line"><span class="lineno">  776</span>  SplineFile-&gt;cd();</div>
<div class="line"><span class="lineno">  777</span>  EventInfo-&gt;Write();</div>
<div class="line"><span class="lineno">  778</span> </div>
<div class="line"><span class="lineno">  779</span>  <a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> nPoints = 0;</div>
<div class="line"><span class="lineno">  780</span>  <span class="keywordtype">float</span> xtemp[20];</div>
<div class="line"><span class="lineno">  781</span>  FastSplineInfoTree-&gt;Branch(<span class="stringliteral">&quot;nPts&quot;</span>, &amp;nPoints, <span class="stringliteral">&quot;nPts/I&quot;</span>);</div>
<div class="line"><span class="lineno">  782</span>  FastSplineInfoTree-&gt;Branch(<span class="stringliteral">&quot;xPts&quot;</span>, xtemp, <span class="stringliteral">&quot;xPts[nPts]/F&quot;</span>);</div>
<div class="line"><span class="lineno">  783</span> </div>
<div class="line"><span class="lineno">  784</span>  <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> i = 0; i &lt; <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>; ++i)</div>
<div class="line"><span class="lineno">  785</span>  {</div>
<div class="line"><span class="lineno">  786</span>    nPoints = <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="structFastSplineInfo.html#ac8538a8e3438ae06d8f467cc0fd5ce0d">nPts</a>;</div>
<div class="line"><span class="lineno">  787</span> </div>
<div class="line"><span class="lineno">  788</span>    <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> k = 0; k &lt; <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="structFastSplineInfo.html#ac8538a8e3438ae06d8f467cc0fd5ce0d">nPts</a>; ++k)</div>
<div class="line"><span class="lineno">  789</span>    {</div>
<div class="line"><span class="lineno">  790</span>      xtemp[k] = float(<a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].xPts[k]);</div>
<div class="line"><span class="lineno">  791</span>    }</div>
<div class="line"><span class="lineno">  792</span>    FastSplineInfoTree-&gt;Fill();</div>
<div class="line"><span class="lineno">  793</span>  }</div>
<div class="line"><span class="lineno">  794</span> </div>
<div class="line"><span class="lineno">  795</span>  SplineFile-&gt;cd();</div>
<div class="line"><span class="lineno">  796</span>  FastSplineInfoTree-&gt;Write();</div>
<div class="line"><span class="lineno">  797</span> </div>
<div class="line"><span class="lineno">  798</span>  <span class="keyword">delete</span> Settings;</div>
<div class="line"><span class="lineno">  799</span>  <span class="keyword">delete</span> Monolith;</div>
<div class="line"><span class="lineno">  800</span>  <span class="keyword">delete</span> Monolith_TF1;</div>
<div class="line"><span class="lineno">  801</span>  <span class="keyword">delete</span> ParamInfo;</div>
<div class="line"><span class="lineno">  802</span>  <span class="keyword">delete</span> XKnots;</div>
<div class="line"><span class="lineno">  803</span>  <span class="keyword">delete</span> EventInfo;</div>
<div class="line"><span class="lineno">  804</span>  <span class="keyword">delete</span> FastSplineInfoTree;</div>
<div class="line"><span class="lineno">  805</span>  SplineFile-&gt;Close();</div>
<div class="line"><span class="lineno">  806</span>  <span class="keyword">delete</span> SplineFile;</div>
<div class="line"><span class="lineno">  807</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a5c374d4505de53ad68d176a5644568e6" name="a5c374d4505de53ad68d176a5644568e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c374d4505de53ad68d176a5644568e6">&#9670;&#160;</a></span>PrintInitialsiation()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::PrintInitialsiation </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Print info about how much knots etc has been initialised. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01184">1184</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1184</span>                                    {</div>
<div class="line"><span class="lineno"> 1185</span><span class="comment">//*********************************************************</span></div>
<div class="line"><span class="lineno"> 1186</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event_size_max = <a class="code hl_variable" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> * <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><span class="lineno"> 1187</span> </div>
<div class="line"><span class="lineno"> 1188</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;--- INITIALISED Spline Monolith ---&quot;</span>);</div>
<div class="line"><span class="lineno"> 1189</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;{} events with {} splines&quot;</span>, <a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>, <a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><span class="lineno"> 1190</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;On average {:.2f} splines per event ({}/{})&quot;</span>, <span class="keywordtype">float</span>(<a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)/<span class="keywordtype">float</span>(<a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>), <a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>, <a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><span class="lineno"> 1191</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of x array = {:.4f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*event_size_max)/1.E6);</div>
<div class="line"><span class="lineno"> 1192</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of coefficient (y,b,c,d) array = {:.2f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code hl_variable" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>*<a class="code hl_define" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>)/1.E6);</div>
<div class="line"><span class="lineno"> 1193</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of parameter # array = {:.2f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>)*<a class="code hl_variable" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)/1.E6);</div>
<div class="line"><span class="lineno"> 1194</span> </div>
<div class="line"><span class="lineno"> 1195</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;On average {:.2f} TF1 per event ({}/{})&quot;</span>, <span class="keywordtype">float</span>(<a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>)/<span class="keywordtype">float</span>(<a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>), <a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>, <a class="code hl_variable" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><span class="lineno"> 1196</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of TF1 coefficient (a,b,c,d,e) array = {:.2f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code hl_variable" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>*<a class="code hl_define" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>)/1.E6);</div>
<div class="line"><span class="lineno"> 1197</span> </div>
<div class="line"><span class="lineno"> 1198</span>  <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1199</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a51bbc20cfe4ebed21f6d9f91a86ea0ee" name="a51bbc20cfe4ebed21f6d9f91a86ea0ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51bbc20cfe4ebed21f6d9f91a86ea0ee">&#9670;&#160;</a></span>retPointer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const float * SMonolith::retPointer </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Get pointer to total weight to make fit faster wrooom! </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>Name event number in used MC </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to the total weight </dd></dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00040">40</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   40</span>{<span class="keywordflow">return</span> &amp;<a class="code hl_variable" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>[event];}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a12cddfcbec851b468cba86dc9b223c78" name="a12cddfcbec851b468cba86dc9b223c78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12cddfcbec851b468cba86dc9b223c78">&#9670;&#160;</a></span>ScanMasterSpline()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::ScanMasterSpline </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classTResponseFunction__red.html">TResponseFunction_red</a> * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>nEvents</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>MaxPoints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short int &amp;&#160;</td>
          <td class="paramname"><em>numParams</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>nSplines</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>NSplinesValid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>numKnots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>nTF1Valid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>nTF1_coeff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36d">RespFuncType</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>SplineType</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Function to scan through the MasterSpline of TSpline3. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> pointers which we strip back </td></tr>
    <tr><td class="paramname">NEvents</td><td>Number of MC events </td></tr>
    <tr><td class="paramname">MaxPoints</td><td>Maximal number of knots per splines </td></tr>
    <tr><td class="paramname">numParams</td><td>Total number of parameters </td></tr>
    <tr><td class="paramname">numKnots</td><td>Total number of knots, which is sum of individual knots per each spline </td></tr>
    <tr><td class="paramname">nTF1_coeff</td><td>Number of TF1 coefficients in all TF1 objects </td></tr>
    <tr><td class="paramname">SplineType</td><td>Whether object is TSpline3 or TF1 </td></tr>
    <tr><td class="paramname">NSplinesValid</td><td>Total number of valid (not null) TSpline3 </td></tr>
    <tr><td class="paramname">nTF1Valid</td><td>Total number of valid (not null) TF1 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00399">399</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  408</span>                                                                            {</div>
<div class="line"><span class="lineno">  409</span><span class="comment">// *****************************************</span></div>
<div class="line"><span class="lineno">  410</span>  <span class="comment">// Need to extract: the total number of events</span></div>
<div class="line"><span class="lineno">  411</span>  <span class="comment">//                  number of parameters</span></div>
<div class="line"><span class="lineno">  412</span>  <span class="comment">//                  maximum number of knots</span></div>
<div class="line"><span class="lineno">  413</span>  MaxPoints = 0;</div>
<div class="line"><span class="lineno">  414</span>  nEvents   = 0;</div>
<div class="line"><span class="lineno">  415</span>  numParams   = 0;</div>
<div class="line"><span class="lineno">  416</span>  nSplines = 0;</div>
<div class="line"><span class="lineno">  417</span>  numKnots = 0;</div>
<div class="line"><span class="lineno">  418</span>  NSplinesValid = 0;</div>
<div class="line"><span class="lineno">  419</span>  nTF1Valid = 0;</div>
<div class="line"><span class="lineno">  420</span>  nTF1_coeff = 0;</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>  <span class="comment">// Check the number of events</span></div>
<div class="line"><span class="lineno">  423</span>  nEvents = int(MasterSpline.size());</div>
<div class="line"><span class="lineno">  424</span> </div>
<div class="line"><span class="lineno">  425</span>  <span class="comment">// Maximum number of splines one event can have (scan through and find this number)</span></div>
<div class="line"><span class="lineno">  426</span>  <span class="keywordtype">int</span> nMaxSplines_PerEvent = 0;</div>
<div class="line"><span class="lineno">  427</span> </div>
<div class="line"><span class="lineno">  428</span>  <span class="comment">//KS: We later check that each event has the same number of splines so this is fine</span></div>
<div class="line"><span class="lineno">  429</span>  numParams = short(MasterSpline[0].<a class="code hl_variable" href="GetPenaltyTerm_8cpp.html#a439227feff9d7f55384e8780cfc2eb82">size</a>());</div>
<div class="line"><span class="lineno">  430</span>  <span class="comment">// Initialise</span></div>
<div class="line"><span class="lineno">  431</span>  <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a> = <span class="keyword">new</span> <a class="code hl_struct" href="structFastSplineInfo.html">FastSplineInfo</a>[numParams];</div>
<div class="line"><span class="lineno">  432</span> </div>
<div class="line"><span class="lineno">  433</span>  <span class="comment">// Loop over each parameter</span></div>
<div class="line"><span class="lineno">  434</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EventCounter = 0; EventCounter &lt; MasterSpline.size(); ++EventCounter) {</div>
<div class="line"><span class="lineno">  435</span>    <span class="comment">// Check that each event has each spline saved</span></div>
<div class="line"><span class="lineno">  436</span>    <span class="keywordflow">if</span> (numParams &gt; 0) {</div>
<div class="line"><span class="lineno">  437</span>      <span class="keywordtype">int</span> TempSize = int(MasterSpline[EventCounter].<a class="code hl_variable" href="GetPenaltyTerm_8cpp.html#a439227feff9d7f55384e8780cfc2eb82">size</a>());</div>
<div class="line"><span class="lineno">  438</span>      <span class="keywordflow">if</span> (TempSize != numParams) {</div>
<div class="line"><span class="lineno">  439</span>        <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Found {} parameters for event {}&quot;</span>, TempSize, EventCounter);</div>
<div class="line"><span class="lineno">  440</span>        <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;but was expecting {} since that&#39;s what I found for the previous event&quot;</span>, numParams);</div>
<div class="line"><span class="lineno">  441</span>        <a class="code hl_define" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Somehow this event has a different number of spline parameters... Please study further!&quot;</span>);</div>
<div class="line"><span class="lineno">  442</span>        <span class="keywordflow">throw</span> <a class="code hl_class" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__ , __LINE__ );</div>
<div class="line"><span class="lineno">  443</span>      }</div>
<div class="line"><span class="lineno">  444</span>    }</div>
<div class="line"><span class="lineno">  445</span>    numParams = short(MasterSpline[EventCounter].<a class="code hl_variable" href="GetPenaltyTerm_8cpp.html#a439227feff9d7f55384e8780cfc2eb82">size</a>());</div>
<div class="line"><span class="lineno">  446</span> </div>
<div class="line"><span class="lineno">  447</span>    <span class="keywordtype">int</span> nSplines_SingleEvent = 0;</div>
<div class="line"><span class="lineno">  448</span>    <span class="comment">// Loop over each pointer</span></div>
<div class="line"><span class="lineno">  449</span>    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ParamNumber = 0; ParamNumber &lt; MasterSpline[EventCounter].size(); ++ParamNumber) {</div>
<div class="line"><span class="lineno">  450</span>      <span class="comment">// If NULL we don&#39;t have this spline for the event, so move to next spline</span></div>
<div class="line"><span class="lineno">  451</span>      <span class="keywordflow">if</span> (MasterSpline[EventCounter][ParamNumber] == NULL) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  452</span> </div>
<div class="line"><span class="lineno">  453</span>      <span class="keywordflow">if</span>(SplineType[ParamNumber] == <a class="code hl_enumvalue" href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da8bea6994e011cc85a5a88b50c97ce7b2">kTSpline3_red</a>)</div>
<div class="line"><span class="lineno">  454</span>      {</div>
<div class="line"><span class="lineno">  455</span>        <a class="code hl_class" href="classTResponseFunction__red.html">TResponseFunction_red</a>* TespFunc = MasterSpline[EventCounter][ParamNumber];</div>
<div class="line"><span class="lineno">  456</span>        <a class="code hl_class" href="classTSpline3__red.html">TSpline3_red</a>* CurrSpline = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classTSpline3__red.html">TSpline3_red</a>*<span class="keyword">&gt;</span>(TespFunc);</div>
<div class="line"><span class="lineno">  457</span>        <span class="keywordtype">int</span> nPoints = CurrSpline-&gt;<a class="code hl_function" href="classTSpline3__red.html#a6b680cfb96e11c55b8325e1274251b91">GetNp</a>();</div>
<div class="line"><span class="lineno">  458</span>        <span class="keywordflow">if</span> (nPoints &gt; MaxPoints) {</div>
<div class="line"><span class="lineno">  459</span>          MaxPoints = nPoints;</div>
<div class="line"><span class="lineno">  460</span>        }</div>
<div class="line"><span class="lineno">  461</span>        numKnots += nPoints;</div>
<div class="line"><span class="lineno">  462</span>        nSplines_SingleEvent++;</div>
<div class="line"><span class="lineno">  463</span> </div>
<div class="line"><span class="lineno">  464</span>        <span class="comment">// Fill the SplineInfoArray entries with information on each splinified parameter</span></div>
<div class="line"><span class="lineno">  465</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[ParamNumber].xPts == NULL)</div>
<div class="line"><span class="lineno">  466</span>        {</div>
<div class="line"><span class="lineno">  467</span>          <span class="comment">// Fill the number of points</span></div>
<div class="line"><span class="lineno">  468</span>          <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[ParamNumber].<a class="code hl_variable" href="structFastSplineInfo.html#ac8538a8e3438ae06d8f467cc0fd5ce0d">nPts</a> = CurrSpline-&gt;<a class="code hl_function" href="classTSpline3__red.html#a6b680cfb96e11c55b8325e1274251b91">GetNp</a>();</div>
<div class="line"><span class="lineno">  469</span> </div>
<div class="line"><span class="lineno">  470</span>          <span class="comment">// Fill the x points</span></div>
<div class="line"><span class="lineno">  471</span>          <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[ParamNumber].<a class="code hl_variable" href="structFastSplineInfo.html#a9e9d432eb250bba227d31022ac9c5779">xPts</a> = <span class="keyword">new</span> <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a>[<a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[ParamNumber].<a class="code hl_variable" href="structFastSplineInfo.html#ac8538a8e3438ae06d8f467cc0fd5ce0d">nPts</a>];</div>
<div class="line"><span class="lineno">  472</span>          <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> k = 0; k &lt; <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[ParamNumber].<a class="code hl_variable" href="structFastSplineInfo.html#ac8538a8e3438ae06d8f467cc0fd5ce0d">nPts</a>; ++k)</div>
<div class="line"><span class="lineno">  473</span>          {</div>
<div class="line"><span class="lineno">  474</span>            <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a> xtemp = <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a>(-999.99);</div>
<div class="line"><span class="lineno">  475</span>            <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a> ytemp = <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a>(-999.99);</div>
<div class="line"><span class="lineno">  476</span>            CurrSpline-&gt;<a class="code hl_function" href="classTSpline3__red.html#a2c3cba5b93df5a08a8b6c1aee5ebb727">GetKnot</a>(k, xtemp, ytemp);</div>
<div class="line"><span class="lineno">  477</span>            <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[ParamNumber].<a class="code hl_variable" href="structFastSplineInfo.html#a9e9d432eb250bba227d31022ac9c5779">xPts</a>[k] = xtemp;</div>
<div class="line"><span class="lineno">  478</span>          }</div>
<div class="line"><span class="lineno">  479</span>        }</div>
<div class="line"><span class="lineno">  480</span>        NSplinesValid++;</div>
<div class="line"><span class="lineno">  481</span>      }</div>
<div class="line"><span class="lineno">  482</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SplineType[ParamNumber] == <a class="code hl_enumvalue" href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da847a18b0a859ce2b3b87a98f455855b1">kTF1_red</a>)</div>
<div class="line"><span class="lineno">  483</span>      {</div>
<div class="line"><span class="lineno">  484</span>        <a class="code hl_class" href="classTResponseFunction__red.html">TResponseFunction_red</a>* TespFunc = MasterSpline[EventCounter][ParamNumber];</div>
<div class="line"><span class="lineno">  485</span>        <a class="code hl_class" href="classTF1__red.html">TF1_red</a>* CurrSpline = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classTF1__red.html">TF1_red</a>*<span class="keyword">&gt;</span>(TespFunc);</div>
<div class="line"><span class="lineno">  486</span>        <span class="keywordtype">int</span> nPoints = CurrSpline-&gt;<a class="code hl_function" href="classTF1__red.html#af9e3b0e8d2edad0e7e08f3bf215525c9">GetSize</a>();</div>
<div class="line"><span class="lineno">  487</span>        nTF1_coeff += nPoints;</div>
<div class="line"><span class="lineno">  488</span>        nTF1Valid++;</div>
<div class="line"><span class="lineno">  489</span>      }</div>
<div class="line"><span class="lineno">  490</span>    }</div>
<div class="line"><span class="lineno">  491</span>    <span class="keywordflow">if</span> (nSplines_SingleEvent &gt; nMaxSplines_PerEvent) nMaxSplines_PerEvent = nSplines_SingleEvent;</div>
<div class="line"><span class="lineno">  492</span>  }</div>
<div class="line"><span class="lineno">  493</span>  nSplines = nMaxSplines_PerEvent;</div>
<div class="line"><span class="lineno">  494</span> </div>
<div class="line"><span class="lineno">  495</span>  <span class="keywordtype">int</span> Counter = 0;</div>
<div class="line"><span class="lineno">  496</span>  <span class="comment">//KS: Sanity check that everything was set correctly</span></div>
<div class="line"><span class="lineno">  497</span>  <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> i = 0; i &lt; numParams; ++i)</div>
<div class="line"><span class="lineno">  498</span>  {</div>
<div class="line"><span class="lineno">  499</span>    <span class="comment">// KS: We don&#39;t find segment for TF1, so ignore this</span></div>
<div class="line"><span class="lineno">  500</span>    <span class="keywordflow">if</span> (SplineType[i] == <a class="code hl_enumvalue" href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da847a18b0a859ce2b3b87a98f455855b1">kTF1_red</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  501</span> </div>
<div class="line"><span class="lineno">  502</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> nPoints = <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="structFastSplineInfo.html#ac8538a8e3438ae06d8f467cc0fd5ce0d">nPts</a>;</div>
<div class="line"><span class="lineno">  503</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a>* xArray = <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="structFastSplineInfo.html#a9e9d432eb250bba227d31022ac9c5779">xPts</a>;</div>
<div class="line"><span class="lineno">  504</span>    <span class="keywordflow">if</span> (nPoints == -999 || xArray == NULL) {</div>
<div class="line"><span class="lineno">  505</span>      Counter++;</div>
<div class="line"><span class="lineno">  506</span>      <span class="keywordflow">if</span>(Counter &lt; 5) {</div>
<div class="line"><span class="lineno">  507</span>        <a class="code hl_define" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;SplineInfoArray[{}] isn&#39;t set yet&quot;</span>, i);</div>
<div class="line"><span class="lineno">  508</span>      }</div>
<div class="line"><span class="lineno">  509</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  510</span>      <span class="comment">//throw MaCh3Exception(__FILE__ , __LINE__ );</span></div>
<div class="line"><span class="lineno">  511</span>    }</div>
<div class="line"><span class="lineno">  512</span>  }</div>
<div class="line"><span class="lineno">  513</span>  <a class="code hl_define" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;In total SplineInfoArray for {} hasn&#39;t been initialised&quot;</span>, Counter);</div>
<div class="line"><span class="lineno">  514</span>}</div>
<div class="ttc" id="aGetPenaltyTerm_8cpp_html_a439227feff9d7f55384e8780cfc2eb82"><div class="ttname"><a href="GetPenaltyTerm_8cpp.html#a439227feff9d7f55384e8780cfc2eb82">size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition:</b> <a href="GetPenaltyTerm_8cpp_source.html#l00038">GetPenaltyTerm.cpp:38</a></div></div>
<div class="ttc" id="aclassTF1__red_html_af9e3b0e8d2edad0e7e08f3bf215525c9"><div class="ttname"><a href="classTF1__red.html#af9e3b0e8d2edad0e7e08f3bf215525c9">TF1_red::GetSize</a></div><div class="ttdeci">int GetSize()</div><div class="ttdoc">Get the size.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00206">SplineStructs.h:206</a></div></div>
<div class="ttc" id="aclassTSpline3__red_html_a2c3cba5b93df5a08a8b6c1aee5ebb727"><div class="ttname"><a href="classTSpline3__red.html#a2c3cba5b93df5a08a8b6c1aee5ebb727">TSpline3_red::GetKnot</a></div><div class="ttdeci">void GetKnot(int i, M3::float_t &amp;xtmp, M3::float_t &amp;ytmp)</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00615">SplineStructs.h:615</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a40f6b9256a18fa59009e5961aec776ff" name="a40f6b9256a18fa59009e5961aec776ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40f6b9256a18fa59009e5961aec776ff">&#9670;&#160;</a></span>setSplinePointers()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::setSplinePointers </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; const double * &gt;&#160;</td>
          <td class="paramname"><em>spline_ParsPointers</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Set pointers to spline params. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spline_ParsPointers</td><td>Vector of pointers to spline params </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00044">44</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   44</span>                                                                                  {</div>
<div class="line"><span class="lineno">   45</span>      <a class="code hl_variable" href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">splineParsPointer</a> = spline_ParsPointers;</div>
<div class="line"><span class="lineno">   46</span>      <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> i = 0; i &lt; <a class="code hl_variable" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>; ++i) <a class="code hl_variable" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code hl_variable" href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">splineParsPointer</a> = spline_ParsPointers[i];</div>
<div class="line"><span class="lineno">   47</span>    };</div>
</div><!-- fragment -->
</div>
</div>
<a id="a68e18d73ed1ac524ceaea79d2a5460ce" name="a68e18d73ed1ac524ceaea79d2a5460ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68e18d73ed1ac524ceaea79d2a5460ce">&#9670;&#160;</a></span>SynchroniseMemTransfer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::SynchroniseMemTransfer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>KS: After calculations are done on GPU we copy memory to CPU. This operation is asynchronous meaning while memory is being copied some operations are being carried. Memory must be copied before actual reweight. This function make sure all has been copied. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01203">1203</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1203</span>                                       {</div>
<div class="line"><span class="lineno"> 1204</span><span class="comment">//*********************************************************</span></div>
<div class="line"><span class="lineno"> 1205</span><span class="preprocessor">  #ifdef CUDA</span></div>
<div class="line"><span class="lineno"> 1206</span>  <a class="code hl_function" href="gpuSplineUtils_8cu.html#a953e5c5aecebd908f5d8c6ad64de482c">SynchroniseSplines</a>();</div>
<div class="line"><span class="lineno"> 1207</span><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="lineno"> 1208</span>  <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1209</span>}</div>
<div class="ttc" id="agpuSplineUtils_8cu_html_a953e5c5aecebd908f5d8c6ad64de482c"><div class="ttname"><a href="gpuSplineUtils_8cu.html#a953e5c5aecebd908f5d8c6ad64de482c">SynchroniseSplines</a></div><div class="ttdeci">__host__ void SynchroniseSplines()</div><div class="ttdoc">Make sure all Cuda threads finished execution.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00073">gpuSplineUtils.cu:73</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ac0d1df54649909e4cee3385f68132799" name="ac0d1df54649909e4cee3385f68132799"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0d1df54649909e4cee3385f68132799">&#9670;&#160;</a></span>_max_knots</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int SMonolith::_max_knots</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Max knots for production. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00124">124</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a456dd14e1693e445ad6dddd5a8b9794f" name="a456dd14e1693e445ad6dddd5a8b9794f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a456dd14e1693e445ad6dddd5a8b9794f">&#9670;&#160;</a></span>cpu_coeff_TF1_many</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;float&gt; SMonolith::cpu_coeff_TF1_many</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU arrays to hold TF1 coefficients. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00162">162</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a0a6599372d1e3d38105478a68308d9a6" name="a0a6599372d1e3d38105478a68308d9a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a6599372d1e3d38105478a68308d9a6">&#9670;&#160;</a></span>cpu_nParamPerEvent</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;unsigned int&gt; SMonolith::cpu_nParamPerEvent</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00150">150</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a66eecc550dea893c60a435a034e7ebf5" name="a66eecc550dea893c60a435a034e7ebf5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66eecc550dea893c60a435a034e7ebf5">&#9670;&#160;</a></span>cpu_nParamPerEvent_tf1</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;unsigned int&gt; SMonolith::cpu_nParamPerEvent_tf1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number of TF1 per event, index where TF1 start for a given event}. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00153">153</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a14b9c21186a53196f49c8d8d3555fbf2" name="a14b9c21186a53196f49c8d8d3555fbf2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14b9c21186a53196f49c8d8d3555fbf2">&#9670;&#160;</a></span>cpu_nPoints_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;short int&gt; SMonolith::cpu_nPoints_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU arrays to hold number of points. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00165">165</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="af87cf7ae888eb7d4c56f8b6c41c9fd02" name="af87cf7ae888eb7d4c56f8b6c41c9fd02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af87cf7ae888eb7d4c56f8b6c41c9fd02">&#9670;&#160;</a></span>cpu_paramNo_TF1_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;short int&gt; SMonolith::cpu_paramNo_TF1_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: CPU array with the number of points per spline (not per spline point!) </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00168">168</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a48d0e5e5b4130fcd191c3e8f1d841eb7" name="a48d0e5e5b4130fcd191c3e8f1d841eb7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48d0e5e5b4130fcd191c3e8f1d841eb7">&#9670;&#160;</a></span>cpu_spline_handler</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structSplineMonoStruct.html">SplineMonoStruct</a>* SMonolith::cpu_spline_handler</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Store info about Spline monolith, this allow to obtain better step time. As all necessary information for spline weight calculation are here meaning better cache hits. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00156">156</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ab572dd7e0a46caf44eb925a89cbfb0cf" name="ab572dd7e0a46caf44eb925a89cbfb0cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab572dd7e0a46caf44eb925a89cbfb0cf">&#9670;&#160;</a></span>cpu_total_weights</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::cpu_total_weights</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>KS: This holds the total CPU weights that gets read in samplePDFND. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00052">52</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a8614e8ef07431d99f62ab88d9ebdad16" name="a8614e8ef07431d99f62ab88d9ebdad16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8614e8ef07431d99f62ab88d9ebdad16">&#9670;&#160;</a></span>cpu_weights</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::cpu_weights</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The returned gpu weights, read by the GPU. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00050">50</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a4a1d45d273cc40cb4f684400812dcb60" name="a4a1d45d273cc40cb4f684400812dcb60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a1d45d273cc40cb4f684400812dcb60">&#9670;&#160;</a></span>cpu_weights_tf1_var</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::cpu_weights_tf1_var</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU arrays to hold weight for each TF1. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00147">147</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ab6a29f13d8e6efb380f2b9d59cfa88fc" name="ab6a29f13d8e6efb380f2b9d59cfa88fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6a29f13d8e6efb380f2b9d59cfa88fc">&#9670;&#160;</a></span>cpu_weights_var</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::cpu_weights_var</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU arrays to hold weight for each spline. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00144">144</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a03444cbed8a9d9a7798d0ef2b26bd702" name="a03444cbed8a9d9a7798d0ef2b26bd702"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03444cbed8a9d9a7798d0ef2b26bd702">&#9670;&#160;</a></span>gpu_spline_handler</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classSMonolithGPU.html">SMonolithGPU</a>* SMonolith::gpu_spline_handler</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Store info about Spline monolith, this allow to obtain better step time. As all necessary information for spline weight calculation are here meaning better cache hits. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00159">159</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ae9fa50f60f717558f517faea6a38d251" name="ae9fa50f60f717558f517faea6a38d251"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9fa50f60f717558f517faea6a38d251">&#9670;&#160;</a></span>index_cpu</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int* SMonolith::index_cpu</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>holds the index for good splines; don't do unsigned since starts with negative value! </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00126">126</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a1aa70cce5867e7e784e97eacebe6bfbd" name="a1aa70cce5867e7e784e97eacebe6bfbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1aa70cce5867e7e784e97eacebe6bfbd">&#9670;&#160;</a></span>index_TF1_cpu</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int* SMonolith::index_TF1_cpu</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>holds the index for good TF1; don't do unsigned since starts with negative value! </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00128">128</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ac86282b04659bae5cccb6073c9edc0a5" name="ac86282b04659bae5cccb6073c9edc0a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac86282b04659bae5cccb6073c9edc0a5">&#9670;&#160;</a></span>NEvents</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::NEvents</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of events. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00120">120</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="afc0e3d1eafd575cf7628319a66925d5b" name="afc0e3d1eafd575cf7628319a66925d5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc0e3d1eafd575cf7628319a66925d5b">&#9670;&#160;</a></span>nKnots</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::nKnots</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sum of all knots over all splines. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00139">139</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a4606b53f321992377d420a838c76ab3b" name="a4606b53f321992377d420a838c76ab3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4606b53f321992377d420a838c76ab3b">&#9670;&#160;</a></span>nParams</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">short int SMonolith::nParams</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of NIWG parameters that have splines. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00122">122</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="aee3c18513f8209f1ac940b492cd3ed68" name="aee3c18513f8209f1ac940b492cd3ed68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee3c18513f8209f1ac940b492cd3ed68">&#9670;&#160;</a></span>NSplines_total_large</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::NSplines_total_large</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of total splines if each event had every parameter's spline. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00136">136</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ab72795333d6f632565b0f7eb0ca8a658" name="ab72795333d6f632565b0f7eb0ca8a658"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab72795333d6f632565b0f7eb0ca8a658">&#9670;&#160;</a></span>NSplines_valid</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::NSplines_valid</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of valid splines. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00131">131</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a13699796db31517edba3a8009317f779" name="a13699796db31517edba3a8009317f779"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13699796db31517edba3a8009317f779">&#9670;&#160;</a></span>NTF1_valid</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::NTF1_valid</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of valid TF1. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00133">133</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a403e7cf909f98d4c59b5f6c7ff8aac5b" name="a403e7cf909f98d4c59b5f6c7ff8aac5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a403e7cf909f98d4c59b5f6c7ff8aac5b">&#9670;&#160;</a></span>nTF1coeff</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::nTF1coeff</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sum of all coefficients over all TF1. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00141">141</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ab5692081772ca14bd012eb125e2ccfd4" name="ab5692081772ca14bd012eb125e2ccfd4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5692081772ca14bd012eb125e2ccfd4">&#9670;&#160;</a></span>SaveSplineFile</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool SMonolith::SaveSplineFile</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Flag telling whether we are saving spline monolith into handy root file. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00171">171</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a53ab5b2235fd697f27556f1a1a7a5354" name="a53ab5b2235fd697f27556f1a1a7a5354"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53ab5b2235fd697f27556f1a1a7a5354">&#9670;&#160;</a></span>segments</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">short int* SMonolith::segments</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Store currently found segment they are not in <a class="el" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.">FastSplineInfo</a> as in case of GPU we need to copy paste it to GPU. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00113">113</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a50a4ad58aebffdb820626f855bae6821" name="a50a4ad58aebffdb820626f855bae6821"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50a4ad58aebffdb820626f855bae6821">&#9670;&#160;</a></span>SplineInfoArray</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structFastSplineInfo.html">FastSplineInfo</a>* SMonolith::SplineInfoArray</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Array of <a class="el" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.">FastSplineInfo</a> structs: keeps information on each xsec spline for fast evaluation Method identical to TSpline3::Eval(double) but faster because less operations </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00111">111</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="afa782652b0b3da923c5b20bb1319aadd" name="afa782652b0b3da923c5b20bb1319aadd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa782652b0b3da923c5b20bb1319aadd">&#9670;&#160;</a></span>splineParsPointer</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; const double* &gt; SMonolith::splineParsPointer</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This holds pointer to parameter position which we later copy paste it to GPU. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00117">117</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="aa2a793b82a6c650a6fad52510e49b6b0" name="aa2a793b82a6c650a6fad52510e49b6b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2a793b82a6c650a6fad52510e49b6b0">&#9670;&#160;</a></span>vals</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::vals</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Store parameter values they are not in <a class="el" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.">FastSplineInfo</a> as in case of GPU we need to copy paste it to GPU. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00115">115</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/runner/work/MaCh3/MaCh3/splines/<a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a></li>
<li>/home/runner/work/MaCh3/MaCh3/splines/<a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
