<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MaCh3: Implementing Samples and Parameters</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="MaCh3.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mach3logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MaCh3
   &#160;<span id="projectnumber">2.4.2</span>
   </div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle">
<div class="title">Implementing Samples and Parameters</div>  </div>
</div><!--header-->
<div class="contents">

<p>Classes responsible for handling samples and parameters.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structEventInfo.html">EventInfo</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores info about each MC event used during reweighting routine.  <a href="structEventInfo.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSampleHandlerFD.html">SampleHandlerFD</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class responsible for handling implementation of samples used in analysis, reweighting and returning LLH.  <a href="classSampleHandlerFD.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classParameterHandlerGeneric.html">ParameterHandlerGeneric</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class responsible for handling of systematic error parameters with different types defined in the config. Like spline, normalisation parameters etc.  <a href="classParameterHandlerGeneric.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTypeParameterBase.html">TypeParameterBase</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Base class storing info for parameters types, helping unify codebase.  <a href="structTypeParameterBase.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Classes responsible for handling samples and parameters. </p>
<h1><a class="anchor" id="autotoc_md60"></a>
Introduction</h1>
<p>The SampleHandler classes are the main interface for storing information about the samples used in analysis. Practically, this involves storing the number of events predicted in each analysis bin for each sample, as well as modifying this for a given set of systematic and oscillation parameter values (i.e., "reweighting" the nominal Monte-Carlo prediction). Therefore, the SampleHandler class also interacts with many other classes in MaCh3, especially the <a class="el" href="classParameterHandlerGeneric.html">ParameterHandlerGeneric</a> and <a class="el" href="classSplineBase.html">SplineBase</a>. In turn, the <a class="el" href="classFitterBase.html">FitterBase</a> class obtains likelihood values by comparing the MC prediction with data in the SampleHandler class.</p>
<p>Each experiment needs to create a SampleHandler experiment class that inherits from the <a class="el" href="classSampleHandlerFD.html">SampleHandlerFD</a> class in the core repository.</p>
<dl class="section warning"><dt>Warning</dt><dd>The <a class="el" href="classSampleHandlerFD.html" title="Class responsible for handling implementation of samples used in analysis, reweighting and returning ...">SampleHandlerFD</a> class will be renamed in the future to avoid confusion, as it can be used for the Near Detector as well, not only the Far Detector (FD).</dd></dl>
<h1><a class="anchor" id="autotoc_md61"></a>
Constructing a SampleHandler Experiment Class</h1>
<p>The main purpose of any SampleHandler class is to contain all information required to make MC predictions for a given set of systematic parameter values. To achieve this, the SampleHandler object reads information from different input files and keeps track of them in internal data structures. For flexibility in loading various experiment formats, the function <a class="el" href="classSampleHandlerFD.html#a330f801dfd7c0d14326048e93c5a51ae">SampleHandlerFD::SetupExperimentMC</a> is declared pure virtual.</p>
<h2><a class="anchor" id="autotoc_md62"></a>
The Event Struct</h2>
<p>The <a class="el" href="classSampleHandlerFD.html">SampleHandlerFD</a> class stores MC information using the <a class="el" href="structEventInfo.html">EventInfo</a> struct. Some variables of <a class="el" href="structEventInfo.html">EventInfo</a>, such as <a class="el" href="structEventInfo.html#af70176e75d0ff7d1f5e9fc88e620bf65">EventInfo::KinVar</a>, need to refer to experiment-specific structures. This is mostly handled via <a class="el" href="classSampleHandlerFD.html#a889f8aeb4ab9e6b6441dabcc484c91c2">SampleHandlerFD::GetPointerToKinematicParameter</a>.</p>
<h1><a class="anchor" id="autotoc_md63"></a>
Setting Up Systematics</h1>
<p>Systematic parameters are handled via <a class="el" href="structTypeParameterBase.html">TypeParameterBase</a>. Note that the actual parameters, including prior values and errors, are defined in <a class="el" href="classParameterHandlerGeneric.html">ParameterHandlerGeneric</a>. However, their impact on samples is largely implemented in <a class="el" href="classSampleHandlerFD.html">SampleHandlerFD</a>.</p>
<h2><a class="anchor" id="autotoc_md64"></a>
Norm Parameters</h2>
<p><a class="el" href="structNormParameter.html">NormParameter</a> are Simple parameters that work as normalizations for subsets of events. Events are selected based on kinematic cuts. For example, events with TrueQ2 in the range [0.5, 1.0] can be selected.</p>
<p>Example YAML configuration: </p><div class="fragment"><div class="line">- Systematic:</div>
<div class="line">    Names:</div>
<div class="line">      FancyName: Norm_Param_1</div>
<div class="line">    KinematicCuts:</div>
<div class="line">      - TrueQ2: [0.5, 1.0]</div>
<div class="line">    Type: Norm</div>
</div><!-- fragment --><p>The actual bins are defined when calling <a class="el" href="classSampleHandlerFD.html#a5fa55fd1e82f8c4fccd5cd77b814f86a">SampleHandlerFD::SetupNormParameters</a>, while the actual values of TrueQ2 are returned using <a class="el" href="classSampleHandlerFD.html#ad0f549802b5625871e11d86905989697">SampleHandlerFD::ReturnKinematicParameter</a>.</p>
<h2><a class="anchor" id="autotoc_md65"></a>
Spline Parameters</h2>
<p><a class="el" href="structSplineParameter.html">SplineParameter</a> or response functions are parameters with more complex behavior, often requiring calculations of higher-order polynomials. Several types of interpolation are available via <a class="el" href="ParameterStructs_8h.html#a6720d732608767153550aebebcf8fbf4">SplineInterpolation</a>. Actual weights are calculated via the Spline class, either in a binned approach via <a class="el" href="classBinnedSplineHandler.html">BinnedSplineHandler</a> or event-by-event via <a class="el" href="classSMonolith.html">SMonolith</a>. Initialization is handled via <a class="el" href="classSampleHandlerFD.html#a1a984c564107c7207a2611d0bf67d9cc">SampleHandlerFD::SetupSplines</a>.</p>
<h2><a class="anchor" id="autotoc_md66"></a>
Oscillation Parameter</h2>
<p><a class="el" href="structOscillationParameter.html">OscillationParameter</a> are handled via <a class="el" href="classOscillationHandler.html">OscillationHandler</a>, which is a wrapper around <a href="https://github.com/dbarrow257/NuOscillator">NuOscillator</a>. This library provides access to a variety of oscillation engines. </p><dl class="section warning"><dt>Warning</dt><dd>Parameters must be defined exactly as expected by <a href="https://github.com/dbarrow257/NuOscillator">NuOscillator</a>!</dd></dl>
<h2><a class="anchor" id="autotoc_md67"></a>
FunctionalParameters</h2>
<p><a class="el" href="structFunctionalParameter.html">FunctionalParameter</a> represent shifts to kinematical variables or other complex responses that are not handled by other parameter types. Shifts are applied via <a class="el" href="classSampleHandlerFD.html#adaa2f3489afd3d80356649d439e88298">SampleHandlerFD::ApplyShifts</a> (virtual), which can be overridden to implement custom responses. Functional parameters must be registered via <a class="el" href="classSampleHandlerFD.html#aa2626d0d48874d1aff1a107f62f1f02d">SampleHandlerFD::RegisterIndividualFunctionalParameter</a>. This informs MaCh3 which functional parameters are available; the configuration file determines which are actually used.</p>
<h2><a class="anchor" id="autotoc_md68"></a>
Special Step Proposal</h2>
<p>Most parameters are assumed to have Gaussian or flat priors. However, some require special treatment, mostly for oscillation parameters, though any parameter can be affected. Handled <a class="el" href="classParameterHandlerBase.html#aedd56c5e3dbe17586e6fe05a79728fe5">ParameterHandlerBase::SpecialStepProposal</a></p>
<h3><a class="anchor" id="autotoc_md69"></a>
Circular Bounds</h3>
<p>Parameters like delta_CP are defined between -π and +π but can wrap around continuously. Hence are called <a class="el" href="classParameterHandlerBase.html#a824f4ae78215b14c8894e2ced281798e">ParameterHandlerBase::CircularParBounds</a></p>
<p>Example YAML configuration: </p><div class="fragment"><div class="line">- Systematic:</div>
<div class="line">    Names:</div>
<div class="line">      FancyName: delta_cp</div>
<div class="line">    SpecialProposal:</div>
<div class="line">      CircularBounds: [-3.141592, 3.141592]</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md70"></a>
Flip Parameter Value</h3>
<p>Parameters like delta_M2_32 can <a class="el" href="classParameterHandlerBase.html#a8ed8388f3d07e1a7a1918bae1074ff1d">ParameterHandlerBase::FlipParameterValue</a> between normal and inverted ordering.</p>
<p>Example YAML configuration: </p><div class="fragment"><div class="line">- Systematic:</div>
<div class="line">    Names:</div>
<div class="line">      FancyName: sin2th_23</div>
<div class="line">    SpecialProposal:</div>
<div class="line">      FlipParameter: 0.5112  # Flip octant around point of maximal disappearance</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- Footer for MaCh3 Doxygen documentation -->
<footer class="mach3-footer" style="text-align: center;">
    <div style="margin-bottom: 15px;">
        <span style="font-weight: bold;">The MaCh3 Collaboration</span>
    </div>
    <!-- Dropdown to jump between doc versions -->
    <div style="margin-bottom: 10px;">
        <span>Select Software Version: </span>
        <select id="versionSelector" onchange="window.location.href=this.value" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="">-- Select --</option>
            <option value="https://mach3-software.github.io/MaCh3/">develop</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.4.0/index.html">v2.4.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.3.0/index.html">v2.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.2.0/index.html">v2.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.1.0/index.html">v2.1.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.0.0/index.html">v2.0.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.5.0/index.html">v1.5.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.4.0/index.html">v1.4.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.3.0/index.html">v1.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.2.0/index.html">v1.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.1.0/index.html">v1.1.0</option>
        </select>
    </div>
    <!-- Footer info about doxygen -->
    <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
        Documentation generated with
        <a href="https://www.doxygen.nl/" target="_blank" style="color: #666;">Doxygen</a>
        <span id="doxygenVersion"></span>
    </div>
    <!-- Now grab doxygen version from metadata -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const meta = document.querySelector('meta[name="generator"]');
        if (meta) {
            const version = meta.getAttribute("content").replace("Doxygen ", "");
            document.getElementById("doxygenVersion").textContent = " " + version;
        }
    });
    </script>
</footer>
