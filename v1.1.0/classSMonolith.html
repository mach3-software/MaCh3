<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MaCh3: SMonolith Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mach3logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MaCh3
   &#160;<span id="projectnumber">1.1.0</span>
   </div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classSMonolith-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">SMonolith Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Even-by-event class calculating response for spline parameters. It is possible to use GPU acceleration.  
 <a href="classSMonolith.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="SplineMonolith_8h_source.html">/hosthome/v1.1.0/splines/SplineMonolith.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for SMonolith:</div>
<div class="dyncontent">
<div class="center"><img src="classSMonolith__inherit__graph.png" border="0" usemap="#aSMonolith_inherit__map" alt="Inheritance graph"/></div>
<map name="aSMonolith_inherit__map" id="aSMonolith_inherit__map">
<area shape="rect" title="Even&#45;by&#45;event class calculating response for spline parameters. It is possible to use GPU acceleratio..." alt="" coords="9,80,89,107"/>
<area shape="rect" href="classSplineBase.html" title="Base class for calculating weight from spline." alt="" coords="5,5,93,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for SMonolith:</div>
<div class="dyncontent">
<div class="center"><img src="classSMonolith__coll__graph.png" border="0" usemap="#aSMonolith_coll__map" alt="Collaboration graph"/></div>
<map name="aSMonolith_coll__map" id="aSMonolith_coll__map">
<area shape="rect" title="Even&#45;by&#45;event class calculating response for spline parameters. It is possible to use GPU acceleratio..." alt="" coords="325,148,405,175"/>
<area shape="rect" href="classSplineBase.html" title="Base class for calculating weight from spline." alt="" coords="35,5,123,32"/>
<area shape="rect" title=" " alt="" coords="15,57,142,98"/>
<area shape="rect" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment." alt="" coords="25,123,132,149"/>
<area shape="rect" title=" " alt="" coords="13,177,145,204"/>
<area shape="rect" title=" " alt="" coords="5,230,152,271"/>
<area shape="rect" title=" " alt="" coords="16,295,141,337"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a20ae764ad15b91319da76c8eb8ba73d9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a20ae764ad15b91319da76c8eb8ba73d9">SMonolith</a> (std::vector&lt; std::vector&lt; TSpline3 * &gt; &gt; &amp;MasterSpline)</td></tr>
<tr class="memdesc:a20ae764ad15b91319da76c8eb8ba73d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="classSMonolith.html#a20ae764ad15b91319da76c8eb8ba73d9">More...</a><br /></td></tr>
<tr class="separator:a20ae764ad15b91319da76c8eb8ba73d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add144325f3dbacbd11d1596cf1639b17"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#add144325f3dbacbd11d1596cf1639b17">SMonolith</a> (std::vector&lt; std::vector&lt; <a class="el" href="classTSpline3__red.html">TSpline3_red</a> * &gt; &gt; &amp;MasterSpline)</td></tr>
<tr class="memdesc:add144325f3dbacbd11d1596cf1639b17"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="classSMonolith.html#add144325f3dbacbd11d1596cf1639b17">More...</a><br /></td></tr>
<tr class="separator:add144325f3dbacbd11d1596cf1639b17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59ef52d97c185955534e8af69ba31f29"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a59ef52d97c185955534e8af69ba31f29">SMonolith</a> (std::vector&lt; std::vector&lt; TF1 * &gt; &gt; &amp;MasterSpline)</td></tr>
<tr class="memdesc:a59ef52d97c185955534e8af69ba31f29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="classSMonolith.html#a59ef52d97c185955534e8af69ba31f29">More...</a><br /></td></tr>
<tr class="separator:a59ef52d97c185955534e8af69ba31f29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59a63f3b0eb101f871e84d0730960b67"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a59a63f3b0eb101f871e84d0730960b67">SMonolith</a> (std::vector&lt; std::vector&lt; <a class="el" href="classTF1__red.html">TF1_red</a> * &gt; &gt; &amp;MasterSpline)</td></tr>
<tr class="memdesc:a59a63f3b0eb101f871e84d0730960b67"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="classSMonolith.html#a59a63f3b0eb101f871e84d0730960b67">More...</a><br /></td></tr>
<tr class="separator:a59a63f3b0eb101f871e84d0730960b67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac622c355f630c12438b547bbb9fe212c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac622c355f630c12438b547bbb9fe212c">SMonolith</a> (std::string FileName)</td></tr>
<tr class="memdesc:ac622c355f630c12438b547bbb9fe212c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor where you pass path to preprocessed root FileName.  <a href="classSMonolith.html#ac622c355f630c12438b547bbb9fe212c">More...</a><br /></td></tr>
<tr class="separator:ac622c355f630c12438b547bbb9fe212c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0ae7f110fa4c6e46e808d8c1ae979b6"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac0ae7f110fa4c6e46e808d8c1ae979b6">~SMonolith</a> ()</td></tr>
<tr class="memdesc:ac0ae7f110fa4c6e46e808d8c1ae979b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor for <a class="el" href="classSMonolith.html" title="Even-by-event class calculating response for spline parameters. It is possible to use GPU acceleratio...">SMonolith</a> class.  <a href="classSMonolith.html#ac0ae7f110fa4c6e46e808d8c1ae979b6">More...</a><br /></td></tr>
<tr class="separator:ac0ae7f110fa4c6e46e808d8c1ae979b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d1128bb78b165d94721407a124f516b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a3d1128bb78b165d94721407a124f516b">Evaluate</a> () override</td></tr>
<tr class="memdesc:a3d1128bb78b165d94721407a124f516b"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: This Eval should be used when using two separate x,{y,a,b,c,d} arrays to store the weights; probably the best one here! Same thing but pass parameter spline segments instead of variations.  <a href="classSMonolith.html#a3d1128bb78b165d94721407a124f516b">More...</a><br /></td></tr>
<tr class="separator:a3d1128bb78b165d94721407a124f516b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfe89403e2b71f0691b87e5e3611ccdf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#acfe89403e2b71f0691b87e5e3611ccdf">Evaluate_TF1</a> ()</td></tr>
<tr class="memdesc:acfe89403e2b71f0691b87e5e3611ccdf"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Evaluate weights on the CPU/GPU.  <a href="classSMonolith.html#acfe89403e2b71f0691b87e5e3611ccdf">More...</a><br /></td></tr>
<tr class="separator:acfe89403e2b71f0691b87e5e3611ccdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad85cab15f5dfdd47e1123b5bd1815a05"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ad85cab15f5dfdd47e1123b5bd1815a05">GetName</a> () const</td></tr>
<tr class="memdesc:ad85cab15f5dfdd47e1123b5bd1815a05"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get class name.  <a href="classSMonolith.html#ad85cab15f5dfdd47e1123b5bd1815a05">More...</a><br /></td></tr>
<tr class="separator:ad85cab15f5dfdd47e1123b5bd1815a05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68e18d73ed1ac524ceaea79d2a5460ce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a68e18d73ed1ac524ceaea79d2a5460ce">SynchroniseMemTransfer</a> ()</td></tr>
<tr class="memdesc:a68e18d73ed1ac524ceaea79d2a5460ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: After calculations are done on GPU we copy memory to CPU. This operation is asynchronous meaning while memory is being copied some operations are being carried. Memory must be copied before actual reweight. This function make sure all has been copied.  <a href="classSMonolith.html#a68e18d73ed1ac524ceaea79d2a5460ce">More...</a><br /></td></tr>
<tr class="separator:a68e18d73ed1ac524ceaea79d2a5460ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80a8b4afea2815cf3bbf29342df7dfd5"><td class="memItemLeft" align="right" valign="top">const float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a80a8b4afea2815cf3bbf29342df7dfd5">retPointer</a> (const int event)</td></tr>
<tr class="memdesc:a80a8b4afea2815cf3bbf29342df7dfd5"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Get pointer to total weight to make fit faster wrooom!  <a href="classSMonolith.html#a80a8b4afea2815cf3bbf29342df7dfd5">More...</a><br /></td></tr>
<tr class="separator:a80a8b4afea2815cf3bbf29342df7dfd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40f6b9256a18fa59009e5961aec776ff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a40f6b9256a18fa59009e5961aec776ff">setSplinePointers</a> (std::vector&lt; const double * &gt; spline_ParsPointers)</td></tr>
<tr class="memdesc:a40f6b9256a18fa59009e5961aec776ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Set pointers to spline params.  <a href="classSMonolith.html#a40f6b9256a18fa59009e5961aec776ff">More...</a><br /></td></tr>
<tr class="separator:a40f6b9256a18fa59009e5961aec776ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classSplineBase"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classSplineBase')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classSplineBase.html">SplineBase</a></td></tr>
<tr class="memitem:aa6965d1522cc68ecf81ac3bfd2dcd6f1 inherit pub_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase</a> ()</td></tr>
<tr class="memdesc:aa6965d1522cc68ecf81ac3bfd2dcd6f1 inherit pub_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">More...</a><br /></td></tr>
<tr class="separator:aa6965d1522cc68ecf81ac3bfd2dcd6f1 inherit pub_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0de19b2322edb4197380506d594456bd inherit pub_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#a0de19b2322edb4197380506d594456bd">~SplineBase</a> ()</td></tr>
<tr class="memdesc:a0de19b2322edb4197380506d594456bd inherit pub_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <a href="classSplineBase.html#a0de19b2322edb4197380506d594456bd">More...</a><br /></td></tr>
<tr class="separator:a0de19b2322edb4197380506d594456bd inherit pub_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a8614e8ef07431d99f62ab88d9ebdad16"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a></td></tr>
<tr class="memdesc:a8614e8ef07431d99f62ab88d9ebdad16"><td class="mdescLeft">&#160;</td><td class="mdescRight">The returned gpu weights, read by the GPU.  <a href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">More...</a><br /></td></tr>
<tr class="separator:a8614e8ef07431d99f62ab88d9ebdad16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab572dd7e0a46caf44eb925a89cbfb0cf"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a></td></tr>
<tr class="memdesc:ab572dd7e0a46caf44eb925a89cbfb0cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: This holds the total CPU weights that gets read in samplePDFND.  <a href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">More...</a><br /></td></tr>
<tr class="separator:ab572dd7e0a46caf44eb925a89cbfb0cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a45cece9dcbe699e00a7b5fdff4806c1e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">Initialise</a> ()</td></tr>
<tr class="memdesc:a45cece9dcbe699e00a7b5fdff4806c1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Set everything to null etc.  <a href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">More...</a><br /></td></tr>
<tr class="separator:a45cece9dcbe699e00a7b5fdff4806c1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98a140b54edcdb31e80d6e7b2f14c4cb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a98a140b54edcdb31e80d6e7b2f14c4cb">ScanMasterSpline</a> (std::vector&lt; std::vector&lt; <a class="el" href="classTSpline3__red.html">TSpline3_red</a> * &gt; &gt; &amp;MasterSpline, unsigned int &amp;<a class="el" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>, int &amp;MaxPoints, short int &amp;numParams, int &amp;nSplines, unsigned int &amp;numKnots)</td></tr>
<tr class="memdesc:a98a140b54edcdb31e80d6e7b2f14c4cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Function to scan through the MasterSpline of TSpline3.  <a href="classSMonolith.html#a98a140b54edcdb31e80d6e7b2f14c4cb">More...</a><br /></td></tr>
<tr class="separator:a98a140b54edcdb31e80d6e7b2f14c4cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c13fbe5906362cc6e7954cb367b7c11"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a5c13fbe5906362cc6e7954cb367b7c11">ScanMasterSpline</a> (std::vector&lt; std::vector&lt; <a class="el" href="classTF1__red.html">TF1_red</a> * &gt; &gt; &amp;MasterSpline, unsigned int &amp;<a class="el" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>, int &amp;MaxPoints, short int &amp;numParams)</td></tr>
<tr class="memdesc:a5c13fbe5906362cc6e7954cb367b7c11"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Function to scan through the MasterSpline of TF1.  <a href="classSMonolith.html#a5c13fbe5906362cc6e7954cb367b7c11">More...</a><br /></td></tr>
<tr class="separator:a5c13fbe5906362cc6e7954cb367b7c11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58165d265d676f7052a1b125117e1a1b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a58165d265d676f7052a1b125117e1a1b">PrepareForGPU</a> (std::vector&lt; std::vector&lt; <a class="el" href="classTSpline3__red.html">TSpline3_red</a> * &gt; &gt; &amp;MasterSpline)</td></tr>
<tr class="memdesc:a58165d265d676f7052a1b125117e1a1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Prepare the <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> objects for the GPU.  <a href="classSMonolith.html#a58165d265d676f7052a1b125117e1a1b">More...</a><br /></td></tr>
<tr class="separator:a58165d265d676f7052a1b125117e1a1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b2a29e485f1f35fd2bcb207c47c2469"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a3b2a29e485f1f35fd2bcb207c47c2469">PrepareForGPU_TSpline3</a> ()</td></tr>
<tr class="memdesc:a3b2a29e485f1f35fd2bcb207c47c2469"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: The shared initialiser from constructors of TSpline3 and <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a>.  <a href="classSMonolith.html#a3b2a29e485f1f35fd2bcb207c47c2469">More...</a><br /></td></tr>
<tr class="separator:a3b2a29e485f1f35fd2bcb207c47c2469"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65beed5bb2984530aa497b7faeb54d1e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a65beed5bb2984530aa497b7faeb54d1e">PrepareForGPU</a> (std::vector&lt; std::vector&lt; <a class="el" href="classTF1__red.html">TF1_red</a> * &gt; &gt; &amp;MasterSpline)</td></tr>
<tr class="memdesc:a65beed5bb2984530aa497b7faeb54d1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Prepare the <a class="el" href="classTF1__red.html" title="CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...">TF1_red</a> objects for the GPU.  <a href="classSMonolith.html#a65beed5bb2984530aa497b7faeb54d1e">More...</a><br /></td></tr>
<tr class="separator:a65beed5bb2984530aa497b7faeb54d1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5dc91d304260fab18e7d7eb1cebe032"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac5dc91d304260fab18e7d7eb1cebe032">PrepareForGPU_TF1</a> ()</td></tr>
<tr class="memdesc:ac5dc91d304260fab18e7d7eb1cebe032"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: The shared initialiser from constructors of TF1 and <a class="el" href="classTF1__red.html" title="CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...">TF1_red</a>.  <a href="classSMonolith.html#ac5dc91d304260fab18e7d7eb1cebe032">More...</a><br /></td></tr>
<tr class="separator:ac5dc91d304260fab18e7d7eb1cebe032"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3638cd29cc7013868d75d7173a29944b"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::vector&lt; <a class="el" href="classTSpline3__red.html">TSpline3_red</a> * &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a3638cd29cc7013868d75d7173a29944b">ReduceTSpline3</a> (std::vector&lt; std::vector&lt; TSpline3 * &gt; &gt; &amp;MasterSpline)</td></tr>
<tr class="memdesc:a3638cd29cc7013868d75d7173a29944b"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Reduced the TSpline3 to <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a>.  <a href="classSMonolith.html#a3638cd29cc7013868d75d7173a29944b">More...</a><br /></td></tr>
<tr class="separator:a3638cd29cc7013868d75d7173a29944b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c71919669fbcd9a2b1cbc0d4a463b84"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::vector&lt; <a class="el" href="classTF1__red.html">TF1_red</a> * &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a8c71919669fbcd9a2b1cbc0d4a463b84">ReduceTF1</a> (std::vector&lt; std::vector&lt; TF1 * &gt; &gt; &amp;MasterSpline)</td></tr>
<tr class="memdesc:a8c71919669fbcd9a2b1cbc0d4a463b84"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Reduced the TF1 to <a class="el" href="classTF1__red.html" title="CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...">TF1_red</a>.  <a href="classSMonolith.html#a8c71919669fbcd9a2b1cbc0d4a463b84">More...</a><br /></td></tr>
<tr class="separator:a8c71919669fbcd9a2b1cbc0d4a463b84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbbe3398718d0d02d65a1e92a91c112c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#acbbe3398718d0d02d65a1e92a91c112c">getSplineCoeff_SepMany</a> (<a class="el" href="classTSpline3__red.html">TSpline3_red</a> *&amp;spl, int &amp;nPoints, float *&amp;xArray, float *&amp;manyArray)</td></tr>
<tr class="memdesc:acbbe3398718d0d02d65a1e92a91c112c"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: This loads up coefficients into two arrays: one x array and one yabcd array.  <a href="classSMonolith.html#acbbe3398718d0d02d65a1e92a91c112c">More...</a><br /></td></tr>
<tr class="separator:acbbe3398718d0d02d65a1e92a91c112c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac69a542d8c48acd8faf797c20cad4590"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac69a542d8c48acd8faf797c20cad4590">isFlat</a> (<a class="el" href="classTSpline3__red.html">TSpline3_red</a> *&amp;spl)</td></tr>
<tr class="memdesc:ac69a542d8c48acd8faf797c20cad4590"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Helper function used in the constructor, tests to see if the spline is flat.  <a href="classSMonolith.html#ac69a542d8c48acd8faf797c20cad4590">More...</a><br /></td></tr>
<tr class="separator:ac69a542d8c48acd8faf797c20cad4590"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87230e35c15ce4523bc3d630416e30f3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a87230e35c15ce4523bc3d630416e30f3">getTF1Coeff</a> (<a class="el" href="classTF1__red.html">TF1_red</a> *&amp;spl, int &amp;nPoints, float *&amp;coeffs)</td></tr>
<tr class="memdesc:a87230e35c15ce4523bc3d630416e30f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Gets the polynomial coefficients for TF1.  <a href="classSMonolith.html#a87230e35c15ce4523bc3d630416e30f3">More...</a><br /></td></tr>
<tr class="separator:a87230e35c15ce4523bc3d630416e30f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7128a7c13b10f331df8946a0a87c4b33"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a7128a7c13b10f331df8946a0a87c4b33">FindSplineSegment</a> () override</td></tr>
<tr class="memdesc:a7128a7c13b10f331df8946a0a87c4b33"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW:Code used in step by step reweighting, Find Spline Segment for each param.  <a href="classSMonolith.html#a7128a7c13b10f331df8946a0a87c4b33">More...</a><br /></td></tr>
<tr class="separator:a7128a7c13b10f331df8946a0a87c4b33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa36be17828281e1412a93c0e239cdbc0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aa36be17828281e1412a93c0e239cdbc0">CalcSplineWeights</a> () override</td></tr>
<tr class="memdesc:aa36be17828281e1412a93c0e239cdbc0"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU based code which eval weight for each spline.  <a href="classSMonolith.html#aa36be17828281e1412a93c0e239cdbc0">More...</a><br /></td></tr>
<tr class="separator:aa36be17828281e1412a93c0e239cdbc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a335ea2a499d2b2c7f1410b24b25456a1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a335ea2a499d2b2c7f1410b24b25456a1">CalcSplineWeights_TF1</a> ()</td></tr>
<tr class="memdesc:a335ea2a499d2b2c7f1410b24b25456a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Same but TF1.  <a href="classSMonolith.html#a335ea2a499d2b2c7f1410b24b25456a1">More...</a><br /></td></tr>
<tr class="separator:a335ea2a499d2b2c7f1410b24b25456a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac37ee525aa57316f652433a4e393afaf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac37ee525aa57316f652433a4e393afaf">ModifyWeights</a> () override</td></tr>
<tr class="memdesc:ac37ee525aa57316f652433a4e393afaf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calc total event weight.  <a href="classSMonolith.html#ac37ee525aa57316f652433a4e393afaf">More...</a><br /></td></tr>
<tr class="separator:ac37ee525aa57316f652433a4e393afaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72cd282322bdaadb23d8a376efa9e2c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a72cd282322bdaadb23d8a376efa9e2c1">ModifyWeights_GPU</a> ()</td></tr>
<tr class="memdesc:a72cd282322bdaadb23d8a376efa9e2c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Conversion from valid splines to all.  <a href="classSMonolith.html#a72cd282322bdaadb23d8a376efa9e2c1">More...</a><br /></td></tr>
<tr class="separator:a72cd282322bdaadb23d8a376efa9e2c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79f4bf0cac279cf57ab8f06698052922"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a79f4bf0cac279cf57ab8f06698052922">PrepareSplineFile</a> ()</td></tr>
<tr class="memdesc:a79f4bf0cac279cf57ab8f06698052922"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Prepare spline file that can be used for fast loading.  <a href="classSMonolith.html#a79f4bf0cac279cf57ab8f06698052922">More...</a><br /></td></tr>
<tr class="separator:a79f4bf0cac279cf57ab8f06698052922"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6783cdc3c485378ca21852e1a7b02482"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a6783cdc3c485378ca21852e1a7b02482">LoadSplineFile</a> (std::string FileName)</td></tr>
<tr class="memdesc:a6783cdc3c485378ca21852e1a7b02482"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Load preprocessed spline file.  <a href="classSMonolith.html#a6783cdc3c485378ca21852e1a7b02482">More...</a><br /></td></tr>
<tr class="separator:a6783cdc3c485378ca21852e1a7b02482"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a50a4ad58aebffdb820626f855bae6821"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structFastSplineInfo.html">FastSplineInfo</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a></td></tr>
<tr class="separator:a50a4ad58aebffdb820626f855bae6821"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53ab5b2235fd697f27556f1a1a7a5354"><td class="memItemLeft" align="right" valign="top">short int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a></td></tr>
<tr class="memdesc:a53ab5b2235fd697f27556f1a1a7a5354"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store currently found segment they are not in <a class="el" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.">FastSplineInfo</a> as in case of GPU we need to copy paste it to GPU.  <a href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">More...</a><br /></td></tr>
<tr class="separator:a53ab5b2235fd697f27556f1a1a7a5354"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2a793b82a6c650a6fad52510e49b6b0"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a></td></tr>
<tr class="memdesc:aa2a793b82a6c650a6fad52510e49b6b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store parameter values they are not in <a class="el" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.">FastSplineInfo</a> as in case of GPU we need to copy paste it to GPU.  <a href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">More...</a><br /></td></tr>
<tr class="separator:aa2a793b82a6c650a6fad52510e49b6b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa782652b0b3da923c5b20bb1319aadd"><td class="memItemLeft" align="right" valign="top">std::vector&lt; const double * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">splineParsPointer</a></td></tr>
<tr class="memdesc:afa782652b0b3da923c5b20bb1319aadd"><td class="mdescLeft">&#160;</td><td class="mdescRight">This holds pointer to parameter position which we later copy paste it to GPU.  <a href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">More...</a><br /></td></tr>
<tr class="separator:afa782652b0b3da923c5b20bb1319aadd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac86282b04659bae5cccb6073c9edc0a5"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a></td></tr>
<tr class="memdesc:ac86282b04659bae5cccb6073c9edc0a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of events.  <a href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">More...</a><br /></td></tr>
<tr class="separator:ac86282b04659bae5cccb6073c9edc0a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4606b53f321992377d420a838c76ab3b"><td class="memItemLeft" align="right" valign="top">short int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a></td></tr>
<tr class="memdesc:a4606b53f321992377d420a838c76ab3b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of NIWG parameters that have splines.  <a href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">More...</a><br /></td></tr>
<tr class="separator:a4606b53f321992377d420a838c76ab3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0d1df54649909e4cee3385f68132799"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a></td></tr>
<tr class="memdesc:ac0d1df54649909e4cee3385f68132799"><td class="mdescLeft">&#160;</td><td class="mdescRight">Max knots for production.  <a href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">More...</a><br /></td></tr>
<tr class="separator:ac0d1df54649909e4cee3385f68132799"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9fa50f60f717558f517faea6a38d251"><td class="memItemLeft" align="right" valign="top">int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a></td></tr>
<tr class="memdesc:ae9fa50f60f717558f517faea6a38d251"><td class="mdescLeft">&#160;</td><td class="mdescRight">holds the index for good splines; don't do unsigned since starts with negative value!  <a href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">More...</a><br /></td></tr>
<tr class="separator:ae9fa50f60f717558f517faea6a38d251"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab72795333d6f632565b0f7eb0ca8a658"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a></td></tr>
<tr class="memdesc:ab72795333d6f632565b0f7eb0ca8a658"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of valid splines.  <a href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">More...</a><br /></td></tr>
<tr class="separator:ab72795333d6f632565b0f7eb0ca8a658"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a419c7eb29dfa7187b52d18c430763721"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a></td></tr>
<tr class="memdesc:a419c7eb29dfa7187b52d18c430763721"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of total splines we can maximally have, if each event had the maximum number of splines found across all events.  <a href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">More...</a><br /></td></tr>
<tr class="separator:a419c7eb29dfa7187b52d18c430763721"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee3c18513f8209f1ac940b492cd3ed68"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a></td></tr>
<tr class="memdesc:aee3c18513f8209f1ac940b492cd3ed68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of total splines if each event had every parameter's spline.  <a href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">More...</a><br /></td></tr>
<tr class="separator:aee3c18513f8209f1ac940b492cd3ed68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc0e3d1eafd575cf7628319a66925d5b"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a></td></tr>
<tr class="memdesc:afc0e3d1eafd575cf7628319a66925d5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sum of all knots over all splines.  <a href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">More...</a><br /></td></tr>
<tr class="separator:afc0e3d1eafd575cf7628319a66925d5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1317bac1e66e5400c59bc4dd9ff3cdd9"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a1317bac1e66e5400c59bc4dd9ff3cdd9">gpu_weights</a></td></tr>
<tr class="memdesc:a1317bac1e66e5400c59bc4dd9ff3cdd9"><td class="mdescLeft">&#160;</td><td class="mdescRight">GPU arrays to hold weight for each spline.  <a href="classSMonolith.html#a1317bac1e66e5400c59bc4dd9ff3cdd9">More...</a><br /></td></tr>
<tr class="separator:a1317bac1e66e5400c59bc4dd9ff3cdd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43ffa53dafb6006e7bd23597a402e8b4"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a43ffa53dafb6006e7bd23597a402e8b4">gpu_total_weights</a></td></tr>
<tr class="memdesc:a43ffa53dafb6006e7bd23597a402e8b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">GPU arrays to hold weight for event.  <a href="classSMonolith.html#a43ffa53dafb6006e7bd23597a402e8b4">More...</a><br /></td></tr>
<tr class="separator:a43ffa53dafb6006e7bd23597a402e8b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6a29f13d8e6efb380f2b9d59cfa88fc"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a></td></tr>
<tr class="memdesc:ab6a29f13d8e6efb380f2b9d59cfa88fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU arrays to hold weight for each spline.  <a href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">More...</a><br /></td></tr>
<tr class="separator:ab6a29f13d8e6efb380f2b9d59cfa88fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a6599372d1e3d38105478a68308d9a6"><td class="memItemLeft" align="right" valign="top">std::vector&lt; unsigned int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a></td></tr>
<tr class="memdesc:a0a6599372d1e3d38105478a68308d9a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}.  <a href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">More...</a><br /></td></tr>
<tr class="separator:a0a6599372d1e3d38105478a68308d9a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6656d53aaefa0db75f4cf57aa517dbf"><td class="memItemLeft" align="right" valign="top">unsigned int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac6656d53aaefa0db75f4cf57aa517dbf">gpu_nParamPerEvent</a></td></tr>
<tr class="memdesc:ac6656d53aaefa0db75f4cf57aa517dbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: GPU map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}.  <a href="classSMonolith.html#ac6656d53aaefa0db75f4cf57aa517dbf">More...</a><br /></td></tr>
<tr class="separator:ac6656d53aaefa0db75f4cf57aa517dbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14b9c21186a53196f49c8d8d3555fbf2"><td class="memItemLeft" align="right" valign="top">std::vector&lt; short int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a></td></tr>
<tr class="memdesc:a14b9c21186a53196f49c8d8d3555fbf2"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU arrays to hold number of points.  <a href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">More...</a><br /></td></tr>
<tr class="separator:a14b9c21186a53196f49c8d8d3555fbf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e36f546602e0d375dcbacd8771369c7"><td class="memItemLeft" align="right" valign="top">short int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a2e36f546602e0d375dcbacd8771369c7">gpu_nPoints_arr</a></td></tr>
<tr class="memdesc:a2e36f546602e0d375dcbacd8771369c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">GPU arrays to hold number of points.  <a href="classSMonolith.html#a2e36f546602e0d375dcbacd8771369c7">More...</a><br /></td></tr>
<tr class="separator:a2e36f546602e0d375dcbacd8771369c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ff1205fce2c0f5a8066fa531c49615c"><td class="memItemLeft" align="right" valign="top">std::vector&lt; short int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a></td></tr>
<tr class="memdesc:a2ff1205fce2c0f5a8066fa531c49615c"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: CPU array with the number of points per spline (not per spline point!)  <a href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">More...</a><br /></td></tr>
<tr class="separator:a2ff1205fce2c0f5a8066fa531c49615c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6aaa90b9158e01743235a465fd80caaf"><td class="memItemLeft" align="right" valign="top">short int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a6aaa90b9158e01743235a465fd80caaf">gpu_paramNo_arr</a></td></tr>
<tr class="memdesc:a6aaa90b9158e01743235a465fd80caaf"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: GPU array with the number of points per spline (not per spline point!)  <a href="classSMonolith.html#a6aaa90b9158e01743235a465fd80caaf">More...</a><br /></td></tr>
<tr class="separator:a6aaa90b9158e01743235a465fd80caaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81d1bc991ef8d4739174b8d6abe26635"><td class="memItemLeft" align="right" valign="top">std::vector&lt; unsigned int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">cpu_nKnots_arr</a></td></tr>
<tr class="memdesc:a81d1bc991ef8d4739174b8d6abe26635"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: CPU Number of knots per spline.  <a href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">More...</a><br /></td></tr>
<tr class="separator:a81d1bc991ef8d4739174b8d6abe26635"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ff9a70ffa877c13f6aa53a44e447e39"><td class="memItemLeft" align="right" valign="top">unsigned int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a0ff9a70ffa877c13f6aa53a44e447e39">gpu_nKnots_arr</a></td></tr>
<tr class="memdesc:a0ff9a70ffa877c13f6aa53a44e447e39"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: GPU Number of knots per spline.  <a href="classSMonolith.html#a0ff9a70ffa877c13f6aa53a44e447e39">More...</a><br /></td></tr>
<tr class="separator:a0ff9a70ffa877c13f6aa53a44e447e39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef5fe64b8717e8e336acf95b79d3007e"><td class="memItemLeft" align="right" valign="top">std::vector&lt; float &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a></td></tr>
<tr class="memdesc:aef5fe64b8717e8e336acf95b79d3007e"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: CPU arrays to hold X coefficient.  <a href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">More...</a><br /></td></tr>
<tr class="separator:aef5fe64b8717e8e336acf95b79d3007e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3eb59435b695f7f9653f027e49e4b33f"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a3eb59435b695f7f9653f027e49e4b33f">gpu_coeff_x</a></td></tr>
<tr class="memdesc:a3eb59435b695f7f9653f027e49e4b33f"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: GPU arrays to hold X coefficient.  <a href="classSMonolith.html#a3eb59435b695f7f9653f027e49e4b33f">More...</a><br /></td></tr>
<tr class="separator:a3eb59435b695f7f9653f027e49e4b33f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40b079264ca625f263c6016826a8a3d3"><td class="memItemLeft" align="right" valign="top">std::vector&lt; float &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a></td></tr>
<tr class="memdesc:a40b079264ca625f263c6016826a8a3d3"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU arrays to hold other coefficients.  <a href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">More...</a><br /></td></tr>
<tr class="separator:a40b079264ca625f263c6016826a8a3d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad48ce38bdd62d27df5405fdbf7dbc0c7"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ad48ce38bdd62d27df5405fdbf7dbc0c7">gpu_coeff_many</a></td></tr>
<tr class="memdesc:ad48ce38bdd62d27df5405fdbf7dbc0c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">GPU arrays to hold other coefficients.  <a href="classSMonolith.html#ad48ce38bdd62d27df5405fdbf7dbc0c7">More...</a><br /></td></tr>
<tr class="separator:ad48ce38bdd62d27df5405fdbf7dbc0c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5692081772ca14bd012eb125e2ccfd4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">SaveSplineFile</a></td></tr>
<tr class="memdesc:ab5692081772ca14bd012eb125e2ccfd4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag telling whether we are saving spline monolith into handy root file.  <a href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">More...</a><br /></td></tr>
<tr class="separator:ab5692081772ca14bd012eb125e2ccfd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Even-by-event class calculating response for spline parameters. It is possible to use GPU acceleration. </p>
<dl class="section see"><dt>See also</dt><dd>For more details, visit the <a href="https://github.com/mach3-software/MaCh3/wiki/05.-Splines">Wiki</a>. </dd></dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00011">11</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a20ae764ad15b91319da76c8eb8ba73d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20ae764ad15b91319da76c8eb8ba73d9">&#9670;&nbsp;</a></span>SMonolith() <span class="overload">[1/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SMonolith::SMonolith </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; TSpline3 * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of TSpline3 pointers which we strip back </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00190">190</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;          : <a class="code" href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase</a>() {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <a class="code" href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">Initialise</a>();</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Using full TSpline3, about to reduce it and send to GPU&quot;</span>);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="comment">// Convert the TSpline3 pointers to the reduced form and call the reduced constructor</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  std::vector&lt;std::vector&lt;TSpline3_red*&gt; &gt; ReducedSpline = <a class="code" href="classSMonolith.html#a3638cd29cc7013868d75d7173a29944b">ReduceTSpline3</a>(MasterSpline);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <a class="code" href="classSMonolith.html#a58165d265d676f7052a1b125117e1a1b">PrepareForGPU</a>(ReducedSpline);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div>
<div class="ttc" id="aMaCh3Logger_8h_html_a95fa4dffc648e4c5536c9292c2bdcac3"><div class="ttname"><a href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a></div><div class="ttdeci">#define MACH3LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Logger_8h_source.html#l00016">MaCh3Logger.h:16</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a3638cd29cc7013868d75d7173a29944b"><div class="ttname"><a href="classSMonolith.html#a3638cd29cc7013868d75d7173a29944b">SMonolith::ReduceTSpline3</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; TSpline3_red * &gt; &gt; ReduceTSpline3(std::vector&lt; std::vector&lt; TSpline3 * &gt; &gt; &amp;MasterSpline)</div><div class="ttdoc">CW: Reduced the TSpline3 to TSpline3_red.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01279">SplineMonolith.cpp:1279</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a45cece9dcbe699e00a7b5fdff4806c1e"><div class="ttname"><a href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">SMonolith::Initialise</a></div><div class="ttdeci">void Initialise()</div><div class="ttdoc">KS: Set everything to null etc.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00147">SplineMonolith.cpp:147</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a58165d265d676f7052a1b125117e1a1b"><div class="ttname"><a href="classSMonolith.html#a58165d265d676f7052a1b125117e1a1b">SMonolith::PrepareForGPU</a></div><div class="ttdeci">void PrepareForGPU(std::vector&lt; std::vector&lt; TSpline3_red * &gt; &gt; &amp;MasterSpline)</div><div class="ttdoc">CW: Prepare the TSpline3_red objects for the GPU.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00251">SplineMonolith.cpp:251</a></div></div>
<div class="ttc" id="aclassSplineBase_html_aa6965d1522cc68ecf81ac3bfd2dcd6f1"><div class="ttname"><a href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase::SplineBase</a></div><div class="ttdeci">SplineBase()</div><div class="ttdoc">Constructor.</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8cpp_source.html#l00005">SplineBase.cpp:5</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="add144325f3dbacbd11d1596cf1639b17"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add144325f3dbacbd11d1596cf1639b17">&#9670;&nbsp;</a></span>SMonolith() <span class="overload">[2/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SMonolith::SMonolith </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classTSpline3__red.html">TSpline3_red</a> * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> pointers which we strip back </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00203">203</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;          : <a class="code" href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase</a>() {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <a class="code" href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">Initialise</a>();</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;-- GPUING WITH {X} and {Y,B,C,D} arrays and master spline containing TSpline3_red&quot;</span>);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <a class="code" href="classSMonolith.html#a58165d265d676f7052a1b125117e1a1b">PrepareForGPU</a>(MasterSpline);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a59ef52d97c185955534e8af69ba31f29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59ef52d97c185955534e8af69ba31f29">&#9670;&nbsp;</a></span>SMonolith() <span class="overload">[3/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SMonolith::SMonolith </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; TF1 * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of TF1 pointers which we strip back </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00214">214</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;          : <a class="code" href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase</a>() {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <a class="code" href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">Initialise</a>();</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Using full TF1, about to reduce it and send to GPU&quot;</span>);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="comment">// Convert the TSpline3 pointers to the reduced form and call the reduced constructor</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  std::vector&lt;std::vector&lt;TF1_red*&gt; &gt; ReducedSpline = <a class="code" href="classSMonolith.html#a8c71919669fbcd9a2b1cbc0d4a463b84">ReduceTF1</a>(MasterSpline);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <a class="code" href="classSMonolith.html#a58165d265d676f7052a1b125117e1a1b">PrepareForGPU</a>(ReducedSpline);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div>
<div class="ttc" id="aclassSMonolith_html_a8c71919669fbcd9a2b1cbc0d4a463b84"><div class="ttname"><a href="classSMonolith.html#a8c71919669fbcd9a2b1cbc0d4a463b84">SMonolith::ReduceTF1</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; TF1_red * &gt; &gt; ReduceTF1(std::vector&lt; std::vector&lt; TF1 * &gt; &gt; &amp;MasterSpline)</div><div class="ttdoc">CW: Reduced the TF1 to TF1_red.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01316">SplineMonolith.cpp:1316</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a59a63f3b0eb101f871e84d0730960b67"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59a63f3b0eb101f871e84d0730960b67">&#9670;&nbsp;</a></span>SMonolith() <span class="overload">[4/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SMonolith::SMonolith </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classTF1__red.html">TF1_red</a> * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of <a class="el" href="classTF1__red.html" title="CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...">TF1_red</a> pointers which we strip back </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00228">228</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;          : <a class="code" href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase</a>() {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <a class="code" href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">Initialise</a>();</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;-- GPUING WITH TF1_red&quot;</span>);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="comment">// Convert the TSpline3 pointers to the reduced form and call the reduced constructor</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <a class="code" href="classSMonolith.html#a58165d265d676f7052a1b125117e1a1b">PrepareForGPU</a>(MasterSpline);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac622c355f630c12438b547bbb9fe212c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac622c355f630c12438b547bbb9fe212c">&#9670;&nbsp;</a></span>SMonolith() <span class="overload">[5/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SMonolith::SMonolith </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>FileName</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor where you pass path to preprocessed root FileName. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">FileName</td><td>path to pre-processed root file containing stripped monolith info </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00240">240</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;          : <a class="code" href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase</a>() {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <a class="code" href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">Initialise</a>();</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;-- GPUING WITH {X} and {Y,B,C,D} arrays and master spline containing TSpline3_red&quot;</span>);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">// Convert the TSpline3 pointers to the reduced form and call the reduced constructor</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <a class="code" href="classSMonolith.html#a6783cdc3c485378ca21852e1a7b02482">LoadSplineFile</a>(FileName);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;}</div>
<div class="ttc" id="aclassSMonolith_html_a6783cdc3c485378ca21852e1a7b02482"><div class="ttname"><a href="classSMonolith.html#a6783cdc3c485378ca21852e1a7b02482">SMonolith::LoadSplineFile</a></div><div class="ttdeci">void LoadSplineFile(std::string FileName)</div><div class="ttdoc">KS: Load preprocessed spline file.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00484">SplineMonolith.cpp:484</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac0ae7f110fa4c6e46e808d8c1ae979b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0ae7f110fa4c6e46e808d8c1ae979b6">&#9670;&nbsp;</a></span>~SMonolith()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">SMonolith::~SMonolith </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor for <a class="el" href="classSMonolith.html" title="Even-by-event class calculating response for spline parameters. It is possible to use GPU acceleratio...">SMonolith</a> class. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01229">1229</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;                      {</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160; </div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="preprocessor">#ifdef CUDA</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <a class="code" href="gpuSplineUtils_8cu.html#ac999450ca921ec45990ab785e1d0f179">CleanupGPU_SepMany</a>(</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      <a class="code" href="classSMonolith.html#a6aaa90b9158e01743235a465fd80caaf">gpu_paramNo_arr</a>,</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      <a class="code" href="classSMonolith.html#a0ff9a70ffa877c13f6aa53a44e447e39">gpu_nKnots_arr</a>,</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160; </div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      <a class="code" href="classSMonolith.html#a3eb59435b695f7f9653f027e49e4b33f">gpu_coeff_x</a>,</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      <a class="code" href="classSMonolith.html#ad48ce38bdd62d27df5405fdbf7dbc0c7">gpu_coeff_many</a>,</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      </div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  #ifndef Weight_On_SplineBySpline_Basis</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;      <a class="code" href="classSMonolith.html#a43ffa53dafb6006e7bd23597a402e8b4">gpu_total_weights</a>,</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      <a class="code" href="classSMonolith.html#ac6656d53aaefa0db75f4cf57aa517dbf">gpu_nParamPerEvent</a>,</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;      <a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>,</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  #endif</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      <a class="code" href="classSMonolith.html#a1317bac1e66e5400c59bc4dd9ff3cdd9">gpu_weights</a>);</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  </div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="comment">//KS: Since we declared them using CUDA alloc we have to free memory using also cuda functions</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <a class="code" href="gpuSplineUtils_8cu.html#ae17e68e55fea24bcac1dde0ef11fe299">CleanupGPU_Segments</a>(<a class="code" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>, <a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>);</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a> != NULL) <span class="keyword">delete</span>[] <a class="code" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a> != NULL) <span class="keyword">delete</span>[] <a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a> != NULL) <span class="keyword">delete</span>[] <a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160; </div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a> != NULL) <span class="keyword">delete</span>[] <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a> != NULL) <span class="keyword">delete</span>[] <a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a>;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a> != NULL) <span class="keyword">delete</span>[] <a class="code" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a>;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a> != NULL) <span class="keyword">delete</span>[] <a class="code" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a>;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160; </div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="comment">//KS: Those might be deleted or not depending on GPU/CPU TSpline3/TF1 DEBUG or not hence we check if not NULL</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>.clear();</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  <a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>.shrink_to_fit();</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>.clear();</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>.shrink_to_fit();</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>.clear();</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>.shrink_to_fit();</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <a class="code" href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">cpu_nKnots_arr</a>.clear();</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  <a class="code" href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">cpu_nKnots_arr</a>.shrink_to_fit();</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="preprocessor">  #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.clear();</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.shrink_to_fit();</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <a class="code" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>.clear();</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <a class="code" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>.shrink_to_fit();</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;}</div>
<div class="ttc" id="aclassSMonolith_html_a0a6599372d1e3d38105478a68308d9a6"><div class="ttname"><a href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">SMonolith::cpu_nParamPerEvent</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; cpu_nParamPerEvent</div><div class="ttdoc">KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00171">SplineMonolith.h:171</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a0ff9a70ffa877c13f6aa53a44e447e39"><div class="ttname"><a href="classSMonolith.html#a0ff9a70ffa877c13f6aa53a44e447e39">SMonolith::gpu_nKnots_arr</a></div><div class="ttdeci">unsigned int * gpu_nKnots_arr</div><div class="ttdoc">KS: GPU Number of knots per spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00187">SplineMonolith.h:187</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a1317bac1e66e5400c59bc4dd9ff3cdd9"><div class="ttname"><a href="classSMonolith.html#a1317bac1e66e5400c59bc4dd9ff3cdd9">SMonolith::gpu_weights</a></div><div class="ttdeci">float * gpu_weights</div><div class="ttdoc">GPU arrays to hold weight for each spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00164">SplineMonolith.h:164</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a14b9c21186a53196f49c8d8d3555fbf2"><div class="ttname"><a href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">SMonolith::cpu_nPoints_arr</a></div><div class="ttdeci">std::vector&lt; short int &gt; cpu_nPoints_arr</div><div class="ttdoc">CPU arrays to hold number of points.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00176">SplineMonolith.h:176</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a2ff1205fce2c0f5a8066fa531c49615c"><div class="ttname"><a href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">SMonolith::cpu_paramNo_arr</a></div><div class="ttdeci">std::vector&lt; short int &gt; cpu_paramNo_arr</div><div class="ttdoc">CW: CPU array with the number of points per spline (not per spline point!)</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00181">SplineMonolith.h:181</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a3eb59435b695f7f9653f027e49e4b33f"><div class="ttname"><a href="classSMonolith.html#a3eb59435b695f7f9653f027e49e4b33f">SMonolith::gpu_coeff_x</a></div><div class="ttdeci">float * gpu_coeff_x</div><div class="ttdoc">KS: GPU arrays to hold X coefficient.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00191">SplineMonolith.h:191</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a40b079264ca625f263c6016826a8a3d3"><div class="ttname"><a href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">SMonolith::cpu_coeff_many</a></div><div class="ttdeci">std::vector&lt; float &gt; cpu_coeff_many</div><div class="ttdoc">CPU arrays to hold other coefficients.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00193">SplineMonolith.h:193</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a43ffa53dafb6006e7bd23597a402e8b4"><div class="ttname"><a href="classSMonolith.html#a43ffa53dafb6006e7bd23597a402e8b4">SMonolith::gpu_total_weights</a></div><div class="ttdeci">float * gpu_total_weights</div><div class="ttdoc">GPU arrays to hold weight for event.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00166">SplineMonolith.h:166</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a50a4ad58aebffdb820626f855bae6821"><div class="ttname"><a href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SMonolith::SplineInfoArray</a></div><div class="ttdeci">FastSplineInfo * SplineInfoArray</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00135">SplineMonolith.h:135</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a53ab5b2235fd697f27556f1a1a7a5354"><div class="ttname"><a href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">SMonolith::segments</a></div><div class="ttdeci">short int * segments</div><div class="ttdoc">Store currently found segment they are not in FastSplineInfo as in case of GPU we need to copy paste ...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00137">SplineMonolith.h:137</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a6aaa90b9158e01743235a465fd80caaf"><div class="ttname"><a href="classSMonolith.html#a6aaa90b9158e01743235a465fd80caaf">SMonolith::gpu_paramNo_arr</a></div><div class="ttdeci">short int * gpu_paramNo_arr</div><div class="ttdoc">CW: GPU array with the number of points per spline (not per spline point!)</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00183">SplineMonolith.h:183</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a81d1bc991ef8d4739174b8d6abe26635"><div class="ttname"><a href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">SMonolith::cpu_nKnots_arr</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; cpu_nKnots_arr</div><div class="ttdoc">KS: CPU Number of knots per spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00185">SplineMonolith.h:185</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a8614e8ef07431d99f62ab88d9ebdad16"><div class="ttname"><a href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">SMonolith::cpu_weights</a></div><div class="ttdeci">float * cpu_weights</div><div class="ttdoc">The returned gpu weights, read by the GPU.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00062">SplineMonolith.h:59</a></div></div>
<div class="ttc" id="aclassSMonolith_html_aa2a793b82a6c650a6fad52510e49b6b0"><div class="ttname"><a href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">SMonolith::vals</a></div><div class="ttdeci">float * vals</div><div class="ttdoc">Store parameter values they are not in FastSplineInfo as in case of GPU we need to copy paste it to G...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00139">SplineMonolith.h:139</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ab572dd7e0a46caf44eb925a89cbfb0cf"><div class="ttname"><a href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">SMonolith::cpu_total_weights</a></div><div class="ttdeci">float * cpu_total_weights</div><div class="ttdoc">KS: This holds the total CPU weights that gets read in samplePDFND.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00064">SplineMonolith.h:64</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ab6a29f13d8e6efb380f2b9d59cfa88fc"><div class="ttname"><a href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">SMonolith::cpu_weights_var</a></div><div class="ttdeci">float * cpu_weights_var</div><div class="ttdoc">CPU arrays to hold weight for each spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00168">SplineMonolith.h:168</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ac6656d53aaefa0db75f4cf57aa517dbf"><div class="ttname"><a href="classSMonolith.html#ac6656d53aaefa0db75f4cf57aa517dbf">SMonolith::gpu_nParamPerEvent</a></div><div class="ttdeci">unsigned int * gpu_nParamPerEvent</div><div class="ttdoc">KS: GPU map keeping track how many parameters applies to each event, we keep two numbers here {number...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00173">SplineMonolith.h:173</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ad48ce38bdd62d27df5405fdbf7dbc0c7"><div class="ttname"><a href="classSMonolith.html#ad48ce38bdd62d27df5405fdbf7dbc0c7">SMonolith::gpu_coeff_many</a></div><div class="ttdeci">float * gpu_coeff_many</div><div class="ttdoc">GPU arrays to hold other coefficients.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00195">SplineMonolith.h:195</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ae9fa50f60f717558f517faea6a38d251"><div class="ttname"><a href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">SMonolith::index_cpu</a></div><div class="ttdeci">int * index_cpu</div><div class="ttdoc">holds the index for good splines; don't do unsigned since starts with negative value!</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00150">SplineMonolith.h:150</a></div></div>
<div class="ttc" id="aclassSMonolith_html_aef5fe64b8717e8e336acf95b79d3007e"><div class="ttname"><a href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">SMonolith::cpu_coeff_x</a></div><div class="ttdeci">std::vector&lt; float &gt; cpu_coeff_x</div><div class="ttdoc">KS: CPU arrays to hold X coefficient.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00189">SplineMonolith.h:189</a></div></div>
<div class="ttc" id="agpuSplineUtils_8cu_html_ac999450ca921ec45990ab785e1d0f179"><div class="ttname"><a href="gpuSplineUtils_8cu.html#ac999450ca921ec45990ab785e1d0f179">CleanupGPU_SepMany</a></div><div class="ttdeci">__host__ void CleanupGPU_SepMany(short int *gpu_paramNo_arr, unsigned int *gpu_nKnots_arr, float *gpu_x_array, float *gpu_many_array, float *gpu_total_weights, unsigned int *gpu_nParamPerEvent, float *cpu_total_weights, float *gpu_weights)</div><div class="ttdoc">Clean up the {x},{ybcd} arrays.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00807">gpuSplineUtils.cu:807</a></div></div>
<div class="ttc" id="agpuSplineUtils_8cu_html_ae17e68e55fea24bcac1dde0ef11fe299"><div class="ttname"><a href="gpuSplineUtils_8cu.html#ae17e68e55fea24bcac1dde0ef11fe299">CleanupGPU_Segments</a></div><div class="ttdeci">__host__ void CleanupGPU_Segments(short int *segment, float *vals)</div><div class="ttdoc">Clean up pinned variables at CPU.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00843">gpuSplineUtils.cu:843</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aa36be17828281e1412a93c0e239cdbc0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa36be17828281e1412a93c0e239cdbc0">&#9670;&nbsp;</a></span>CalcSplineWeights()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::CalcSplineWeights </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">private</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU based code which eval weight for each spline. </p>

<p>Implements <a class="el" href="classSplineBase.html#a1ceacf5fee1fc8438501582bef93a9b5">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01596">1596</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;                                  {</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">//*********************************************************</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="preprocessor">  #pragma omp parallel for simd</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> splineNum = 0; splineNum &lt; <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>; ++splineNum)</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  {</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    <span class="comment">//CW: Which Parameter we are accessing</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> Param = <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>[splineNum];</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160; </div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <span class="comment">//CW: Avoids doing costly binary search on GPU</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> segment = <a class="code" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>[Param];</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160; </div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <span class="comment">//KS: Segment for coeff_x is simply parameter*max knots + segment as each parameters has the same spacing</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> segment_X = Param*<a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>+segment;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160; </div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    <span class="comment">//KS: Find knot position in out monolithical structure</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CurrentKnotPos = <a class="code" href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">cpu_nKnots_arr</a>[splineNum]*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+segment*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>;</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160; </div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    <span class="comment">// We&#39;ve read the segment straight from CPU and is saved in segment_gpu</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    <span class="comment">// polynomial parameters from the monolithic splineMonolith</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> fY = <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[CurrentKnotPos];</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> fB = <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[CurrentKnotPos+1];</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> fC = <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[CurrentKnotPos+2];</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> fD = <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[CurrentKnotPos+3];</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    <span class="comment">// The is the variation itself (needed to evaluate variation - stored spline point = dx)</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> dx = <a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>[Param] - <a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>[segment_X];</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160; </div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    <span class="comment">//CW: Wooow, let&#39;s use some fancy intrinsic and pull down the processing time by &lt;1% from normal multiplication! HURRAY</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    <a class="code" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a>[splineNum] = fmaf(dx, fmaf(dx, fmaf(dx, fD, fC), fB), fY);</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    <span class="comment">// Or for the more &quot;easy to read&quot; version:</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="comment">//cpu_weights_var[splineNum] = (fY+dx*(fB+dx*(fC+dx*fD)));</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  }</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;}</div>
<div class="ttc" id="aSplineCommon_8h_html_a283177311bade7400c6088e8fad71a1f"><div class="ttname"><a href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a></div><div class="ttdeci">#define _nCoeff_</div><div class="ttdoc">KS: We store coefficients {y,b,c,d} in one array one by one, this is only to define it once rather th...</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00008">SplineCommon.h:8</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ab72795333d6f632565b0f7eb0ca8a658"><div class="ttname"><a href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">SMonolith::NSplines_valid</a></div><div class="ttdeci">unsigned int NSplines_valid</div><div class="ttdoc">Number of valid splines.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00153">SplineMonolith.h:153</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ac0d1df54649909e4cee3385f68132799"><div class="ttname"><a href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">SMonolith::_max_knots</a></div><div class="ttdeci">int _max_knots</div><div class="ttdoc">Max knots for production.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00148">SplineMonolith.h:148</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a335ea2a499d2b2c7f1410b24b25456a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a335ea2a499d2b2c7f1410b24b25456a1">&#9670;&nbsp;</a></span>CalcSplineWeights_TF1()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::CalcSplineWeights_TF1 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Same but TF1. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01687">1687</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                                      {</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="comment">//*********************************************************</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160; </div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> splineNum = 0; splineNum &lt; <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>; ++splineNum)</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  {</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    <span class="comment">// The is the variation itself (needed to evaluate variation - stored spline point = dx)</span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> x = <a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>[<a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>[splineNum]];</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160; </div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    <span class="comment">// Read the coefficients</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> a = <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[splineNum*<a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>];</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> b = <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[splineNum*<a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>+1];</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> c = <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[splineNum*<a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>+2];</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> d = <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[splineNum*<a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>+3];</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> e = <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[splineNum*<a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>+4];</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160; </div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="comment">// Match these with form in SetSplines</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <span class="comment">// Might not be great to have this if statement: maybe split two kernels?</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#a2e36f546602e0d375dcbacd8771369c7">gpu_nPoints_arr</a>[splineNum] == 5) {</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;      <a class="code" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a>[splineNum] = 1 + a*x + b*x*x + c*x*x*x + d*x*x*x*x + e*x*x*x*x*x;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#a2e36f546602e0d375dcbacd8771369c7">gpu_nPoints_arr</a>[splineNum] == 2) {</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;      <a class="code" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a>[splineNum] = (x&lt;=0)*(1+a*x) + (x&gt;0)*(1+b*x);</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;      printf(<span class="stringliteral">&quot;Big problems, I found a nPoints array which is not 5 or 2 on GPU!\n&quot;</span>);</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    }</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  }</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;}</div>
<div class="ttc" id="aclassSMonolith_html_a2e36f546602e0d375dcbacd8771369c7"><div class="ttname"><a href="classSMonolith.html#a2e36f546602e0d375dcbacd8771369c7">SMonolith::gpu_nPoints_arr</a></div><div class="ttdeci">short int * gpu_nPoints_arr</div><div class="ttdoc">GPU arrays to hold number of points.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00178">SplineMonolith.h:178</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3d1128bb78b165d94721407a124f516b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d1128bb78b165d94721407a124f516b">&#9670;&nbsp;</a></span>Evaluate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::Evaluate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: This Eval should be used when using two separate x,{y,a,b,c,d} arrays to store the weights; probably the best one here! Same thing but pass parameter spline segments instead of variations. </p>

<p>Implements <a class="el" href="classSplineBase.html#a86e629f3eef59b2f3800136c86fe90c3">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01493">1493</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;                         {</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160; </div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  <span class="comment">// There&#39;s a parameter mapping that goes from spline parameter to a global parameter index</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  <span class="comment">// Find the spline segments</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  <a class="code" href="classSMonolith.html#a7128a7c13b10f331df8946a0a87c4b33">FindSplineSegment</a>();</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160; </div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  <span class="comment">//KS: Huge MP loop over all valid splines</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  <a class="code" href="classSMonolith.html#aa36be17828281e1412a93c0e239cdbc0">CalcSplineWeights</a>();</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160; </div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  <span class="comment">//KS: Huge MP loop over all events calculating total weight</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <a class="code" href="classSMonolith.html#ac37ee525aa57316f652433a4e393afaf">ModifyWeights</a>();</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160; </div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;}</div>
<div class="ttc" id="aclassSMonolith_html_a7128a7c13b10f331df8946a0a87c4b33"><div class="ttname"><a href="classSMonolith.html#a7128a7c13b10f331df8946a0a87c4b33">SMonolith::FindSplineSegment</a></div><div class="ttdeci">void FindSplineSegment() override</div><div class="ttdoc">CW:Code used in step by step reweighting, Find Spline Segment for each param.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01514">SplineMonolith.cpp:1514</a></div></div>
<div class="ttc" id="aclassSMonolith_html_aa36be17828281e1412a93c0e239cdbc0"><div class="ttname"><a href="classSMonolith.html#aa36be17828281e1412a93c0e239cdbc0">SMonolith::CalcSplineWeights</a></div><div class="ttdeci">void CalcSplineWeights() override</div><div class="ttdoc">CPU based code which eval weight for each spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01596">SplineMonolith.cpp:1596</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ac37ee525aa57316f652433a4e393afaf"><div class="ttname"><a href="classSMonolith.html#ac37ee525aa57316f652433a4e393afaf">SMonolith::ModifyWeights</a></div><div class="ttdeci">void ModifyWeights() override</div><div class="ttdoc">Calc total event weight.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01720">SplineMonolith.cpp:1720</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acfe89403e2b71f0691b87e5e3611ccdf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acfe89403e2b71f0691b87e5e3611ccdf">&#9670;&nbsp;</a></span>Evaluate_TF1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::Evaluate_TF1 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CW: Evaluate weights on the CPU/GPU. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01667">1667</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                             {</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160; </div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  <span class="comment">// Feed the parameter variations</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> i = 0; i &lt; <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>; ++i) {</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    <span class="comment">// Update the values and which segment it belongs to</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    <a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>[i] = *<a class="code" href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">splineParsPointer</a>[i];</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  }</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  </div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  <span class="comment">//KS: Huge MP loop over all valid splines</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  <a class="code" href="classSMonolith.html#a335ea2a499d2b2c7f1410b24b25456a1">CalcSplineWeights_TF1</a>();</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160; </div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  <span class="comment">//KS: Huge MP loop over all events calculating total weight</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  <a class="code" href="classSMonolith.html#ac37ee525aa57316f652433a4e393afaf">ModifyWeights</a>();</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160; </div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;}</div>
<div class="ttc" id="aStructs_8h_html_a030da8f8f9cd4bb0517b2cc0de3a9d5f"><div class="ttname"><a href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a></div><div class="ttdeci">#define _int_</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00015">Structs.h:15</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a335ea2a499d2b2c7f1410b24b25456a1"><div class="ttname"><a href="classSMonolith.html#a335ea2a499d2b2c7f1410b24b25456a1">SMonolith::CalcSplineWeights_TF1</a></div><div class="ttdeci">void CalcSplineWeights_TF1()</div><div class="ttdoc">Same but TF1.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01687">SplineMonolith.cpp:1687</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a4606b53f321992377d420a838c76ab3b"><div class="ttname"><a href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">SMonolith::nParams</a></div><div class="ttdeci">short int nParams</div><div class="ttdoc">Number of NIWG parameters that have splines.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00146">SplineMonolith.h:146</a></div></div>
<div class="ttc" id="aclassSMonolith_html_afa782652b0b3da923c5b20bb1319aadd"><div class="ttname"><a href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">SMonolith::splineParsPointer</a></div><div class="ttdeci">std::vector&lt; const double * &gt; splineParsPointer</div><div class="ttdoc">This holds pointer to parameter position which we later copy paste it to GPU.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00141">SplineMonolith.h:141</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7128a7c13b10f331df8946a0a87c4b33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7128a7c13b10f331df8946a0a87c4b33">&#9670;&nbsp;</a></span>FindSplineSegment()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::FindSplineSegment </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">private</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW:Code used in step by step reweighting, Find Spline Segment for each param. </p>

<p>Implements <a class="el" href="classSplineBase.html#ae18e490295762416c8627d2db11ee98d">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01514">1514</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;                                  {</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="comment">// *************************</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160; </div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  <span class="comment">// Loop over the splines</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  <span class="comment">//KS: Tried multithreading here with 48 splines and it is faster with one thread, maybe in future multithreading will be worth revisiting</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> i = 0; i &lt; <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>; ++i)</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  {</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <span class="keyword">const</span> <a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> nPoints = <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#a2644b71e4993fba6cabe5f21c9ab44de">nPts</a>;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <span class="keyword">const</span> <a class="code" href="Structs_8h.html#a44b939bf69f41920331b7d7a74d2d436">_float_</a>* xArray = <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#aefbec11dd80b991ec507f4dc2fbefea0">xPts</a>;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160; </div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <span class="comment">// EM: if we have a parameter that has no response for any event (i.e. all splines have just one knot), then skip it and avoid a seg fault here</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="comment">//     In principle, such parameters shouldn&#39;t really be included in the first place, but with new det syst splines this</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <span class="comment">//     could happen if say you were just running on one FHC run, then all RHC parameters would be flat and the code below would break.</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <span class="keywordflow">if</span>(xArray == NULL) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160; </div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    <span class="comment">// Get the variation for this reconfigure for the ith parameter</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keyword">const</span> <a class="code" href="Structs_8h.html#a44b939bf69f41920331b7d7a74d2d436">_float_</a> xvar = *<a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#a768e33415a2a6b50e9019d6a74fa5509">splineParsPointer</a>;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    <a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>[i] = xvar;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160; </div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <span class="comment">// The segment we&#39;re interested in (klow in ROOT code)</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> segment = 0;</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    <a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> kHigh = nPoints-1;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    <span class="comment">//KS: We expect new segment is very close to previous</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="keyword">const</span> <a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> PreviousSegment = <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#abbaf75f4c41bd333cae72bf59856becb">CurrSegment</a>;</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160; </div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <span class="comment">// If the variation is below the lowest saved spline point</span></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    <span class="keywordflow">if</span> (xvar &lt;= xArray[0]) {</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;      segment = 0;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;      <span class="comment">// If the variation is above the highest saved spline point</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xvar &gt;= xArray[nPoints-1]) {</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;      <span class="comment">//CW: Yes, the -2 is indeed correct, see TSpline.cxx:814 and //see: https://savannah.cern.ch/bugs/?71651</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      segment = kHigh;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      <span class="comment">//KS: It is quite probable the new segment is same as in previous step so try to avoid binary search, first we have to check if it is in bounds to avoid seg fault</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( xArray[PreviousSegment+1] &gt; xvar &amp;&amp; xvar &gt;= xArray[PreviousSegment] ) {</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;      segment = PreviousSegment;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;      <span class="comment">// If the variation is between the maximum and minimum, perform a binary search</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;      <span class="comment">// The top point we&#39;ve got</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      <a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> kHalf = 0;</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;      <span class="comment">// While there is still a difference in the points (we haven&#39;t yet found the segment)</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      <span class="comment">// This is a binary search, incrementing segment and decrementing kHalf until we&#39;ve found the segment</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;      <span class="keywordflow">while</span> (kHigh - segment &gt; 1) {</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;        <span class="comment">// Increment the half-step</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        kHalf = (segment + kHigh)/2;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        <span class="comment">// If our variation is above the kHalf, set the segment to kHalf</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;        <span class="keywordflow">if</span> (xvar &gt; xArray[kHalf]) {</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;          segment = kHalf;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;          <span class="comment">// Else move kHigh down</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;          kHigh = kHalf;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;        }</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;      } <span class="comment">// End the while: we&#39;ve now done our binary search</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    } <span class="comment">// End the else: we&#39;ve now found our point</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160; </div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordflow">if</span> (segment &gt;= nPoints-1 &amp;&amp; nPoints &gt; 1) segment = nPoints-2;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160; </div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    <span class="comment">//CW: This way we avoid doing 1.2M+ binary searches on the GPU</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    <span class="comment">// and literally just multiply lots of numbers together on the GPU without any algorithm</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="comment">// Update the values and which segment it belongs to</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#abbaf75f4c41bd333cae72bf59856becb">CurrSegment</a> = segment;</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <a class="code" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>[i] = <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#abbaf75f4c41bd333cae72bf59856becb">CurrSegment</a>;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160; </div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].xPts[segment] &gt; xvar &amp;&amp; segment != 0) {</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;Found a segment which is _ABOVE_ the variation!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;IT SHOULD ALWAYS BE BELOW! (except when segment 0)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;Spline: &quot;</span>&lt;&lt; i &lt;&lt; std::endl;</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160; </div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;Found segment   = &quot;</span> &lt;&lt; segment &lt;&lt; std::endl;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;Doing variation = &quot;</span> &lt;&lt; xvar &lt;&lt; std::endl;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;x in spline     = &quot;</span> &lt;&lt; <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#aefbec11dd80b991ec507f4dc2fbefea0">xPts</a>[segment] &lt;&lt; std::endl;</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> j = 0; j &lt; <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[j].<a class="code" href="structFastSplineInfo.html#a2644b71e4993fba6cabe5f21c9ab44de">nPts</a>; ++j) {</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#aefbec11dd80b991ec507f4dc2fbefea0">xPts</a>[j] &lt;&lt; std::endl;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      }</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;      std::cerr &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; __LINE__ &lt;&lt; std::endl;</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    }</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  } <span class="comment">//end loop over params</span></div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;}</div>
<div class="ttc" id="aStructs_8h_html_a44b939bf69f41920331b7d7a74d2d436"><div class="ttname"><a href="Structs_8h.html#a44b939bf69f41920331b7d7a74d2d436">_float_</a></div><div class="ttdeci">#define _float_</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00014">Structs.h:14</a></div></div>
<div class="ttc" id="astructFastSplineInfo_html_a2644b71e4993fba6cabe5f21c9ab44de"><div class="ttname"><a href="structFastSplineInfo.html#a2644b71e4993fba6cabe5f21c9ab44de">FastSplineInfo::nPts</a></div><div class="ttdeci">_int_ nPts</div><div class="ttdoc">Number of points in spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00026">SplineStructs.h:26</a></div></div>
<div class="ttc" id="astructFastSplineInfo_html_a768e33415a2a6b50e9019d6a74fa5509"><div class="ttname"><a href="structFastSplineInfo.html#a768e33415a2a6b50e9019d6a74fa5509">FastSplineInfo::splineParsPointer</a></div><div class="ttdeci">const double * splineParsPointer</div><div class="ttdoc">Array of the knots positions.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00035">SplineStructs.h:35</a></div></div>
<div class="ttc" id="astructFastSplineInfo_html_abbaf75f4c41bd333cae72bf59856becb"><div class="ttname"><a href="structFastSplineInfo.html#abbaf75f4c41bd333cae72bf59856becb">FastSplineInfo::CurrSegment</a></div><div class="ttdeci">_int_ CurrSegment</div><div class="ttdoc">Array of what segment of spline we're currently interested in. Gets updated once per MCMC iteration.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00032">SplineStructs.h:32</a></div></div>
<div class="ttc" id="astructFastSplineInfo_html_aefbec11dd80b991ec507f4dc2fbefea0"><div class="ttname"><a href="structFastSplineInfo.html#aefbec11dd80b991ec507f4dc2fbefea0">FastSplineInfo::xPts</a></div><div class="ttdeci">_float_ * xPts</div><div class="ttdoc">Array of the knots positions.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00029">SplineStructs.h:29</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad85cab15f5dfdd47e1123b5bd1815a05"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad85cab15f5dfdd47e1123b5bd1815a05">&#9670;&nbsp;</a></span>GetName()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string SMonolith::GetName </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get class name. </p>

<p>Reimplemented from <a class="el" href="classSplineBase.html#a2e1534f622ae1976b21df1ebf984eec5">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00038">38</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;{<span class="keywordflow">return</span> <span class="stringliteral">&quot;SplineMonolith&quot;</span>;};</div>
</div><!-- fragment -->
</div>
</div>
<a id="acbbe3398718d0d02d65a1e92a91c112c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acbbe3398718d0d02d65a1e92a91c112c">&#9670;&nbsp;</a></span>getSplineCoeff_SepMany()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::getSplineCoeff_SepMany </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classTSpline3__red.html">TSpline3_red</a> *&amp;&#160;</td>
          <td class="paramname"><em>spl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>nPoints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&amp;&#160;</td>
          <td class="paramname"><em>xArray</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&amp;&#160;</td>
          <td class="paramname"><em>manyArray</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: This loads up coefficients into two arrays: one x array and one yabcd array. </p>
<p>CW: This should maximize our cache hits! </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spl</td><td>pointer to <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> </td></tr>
    <tr><td class="paramname">nPoints</td><td>number of knots </td></tr>
    <tr><td class="paramname">xArray</td><td>array X value for each knot </td></tr>
    <tr><td class="paramname">manyArray</td><td>Array holding coefficients for each knot </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01355">1355</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                                                                                                            {</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;  <span class="comment">// Initialise all arrays to 1.0</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>; ++i) {</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    xArray[i] = 1.0;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>; j++) {</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      manyArray[i*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+j] = 1.0;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    }</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  }</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  <span class="comment">// Get number of points in spline</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <span class="keywordtype">int</span> Np = spl-&gt;<a class="code" href="classTSpline3__red.html#a9d09b9ada9990a6f33d9ff005c977535">GetNp</a>();</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  <span class="comment">// If spline is flat, set number of knots to 1.0,</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  <span class="comment">// This is used later to expedite the calculations for flat splines</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  <span class="comment">// tmpArray[0] is number of knots</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#ac69a542d8c48acd8faf797c20cad4590">isFlat</a>(spl)) {</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    nPoints = 1;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    nPoints = Np;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="keywordflow">if</span> (Np &gt; <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>) {</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Error, number of points is greater than saved {}&quot;</span>, <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>);</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;This _WILL_ cause problems with GPU splines and _SHOULD_ be fixed!&quot;</span>);</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;nPoints = {}, _max_knots = {}&quot;</span>, nPoints, <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>);</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;      <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    }</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  }</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160; </div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="comment">// The coefficients we&#39;re writing to</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <a class="code" href="Structs_8h.html#a44b939bf69f41920331b7d7a74d2d436">_float_</a> x, y, b, c, d;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="comment">// TSpline3 can only take doubles, not floats</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  <span class="comment">// But our GPU is slow with doubles, so need to cast to float</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; Np; i++) {</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="comment">// Get the coefficients from the TSpline3 object</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    spl-&gt;<a class="code" href="classTSpline3__red.html#a77c5ebd1559cee2911d14fa025e4143d">GetCoeff</a>(i, x, y, b, c, d);</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    <span class="comment">// Write the arrays</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    xArray[i] = float(x);</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    manyArray[i*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>] = float(y); <span class="comment">// 4 because manyArray stores y,b,c,d</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    manyArray[i*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+1] = float(b);</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    manyArray[i*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+2] = float(c);</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    manyArray[i*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+3] = float(d);</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    </div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="keywordflow">if</span>((xArray[i] == -999) | (manyArray[i*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>] == -999) | (manyArray[i*4+1] == -999) | (manyArray[i*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+2] == -999) | (manyArray[i*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+3] == -999)){</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;*********** Bad params in getSplineCoeff_SepMany() ************&quot;</span>);</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;pre cast to float (x, y, b, c, d) = {:.2f}, {:.2f}, {:.2f}, {:.2f}, {:.2f}&quot;</span>, x, y, b, c, d);</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;pre cast to float (x, y, b, c, d) = {:.2f}, {:.2f}, {:.2f}, {:.2f}, {:.2f}&quot;</span>, xArray[i], manyArray[i*4], manyArray[i*4+1], manyArray[i*4+2], manyArray[i*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+3]);</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;This will cause problems when preparing for GPU&quot;</span>);</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;***************************************************************&quot;</span>);</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    }</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  }</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  <span class="comment">// The structure is now xarray  ={x1,x2,x3} </span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  <span class="comment">//                      manyArr ={y1,y2,y3, b1,b2,b3, c1,c2,c3, d1,d2,d3}</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="preprocessor">  #ifndef DEBUG</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="keyword">delete</span> spl;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  spl = NULL;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;}</div>
<div class="ttc" id="aMaCh3Logger_8h_html_a61052119a625282d0ec6d4a97adf3ee2"><div class="ttname"><a href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a></div><div class="ttdeci">#define MACH3LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Logger_8h_source.html#l00018">MaCh3Logger.h:18</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ac69a542d8c48acd8faf797c20cad4590"><div class="ttname"><a href="classSMonolith.html#ac69a542d8c48acd8faf797c20cad4590">SMonolith::isFlat</a></div><div class="ttdeci">bool isFlat(TSpline3_red *&amp;spl)</div><div class="ttdoc">CW: Helper function used in the constructor, tests to see if the spline is flat.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01438">SplineMonolith.cpp:1438</a></div></div>
<div class="ttc" id="aclassTSpline3__red_html_a77c5ebd1559cee2911d14fa025e4143d"><div class="ttname"><a href="classTSpline3__red.html#a77c5ebd1559cee2911d14fa025e4143d">TSpline3_red::GetCoeff</a></div><div class="ttdeci">void GetCoeff(int segment, _float_ &amp;x, _float_ &amp;y, _float_ &amp;b, _float_ &amp;c, _float_ &amp;d)</div><div class="ttdoc">CW: Get the coefficient of a given segment.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00634">SplineStructs.h:634</a></div></div>
<div class="ttc" id="aclassTSpline3__red_html_a9d09b9ada9990a6f33d9ff005c977535"><div class="ttname"><a href="classTSpline3__red.html#a9d09b9ada9990a6f33d9ff005c977535">TSpline3_red::GetNp</a></div><div class="ttdeci">int GetNp()</div><div class="ttdoc">CW: Get the number of points.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00626">SplineStructs.h:626</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a87230e35c15ce4523bc3d630416e30f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87230e35c15ce4523bc3d630416e30f3">&#9670;&nbsp;</a></span>getTF1Coeff()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::getTF1Coeff </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classTF1__red.html">TF1_red</a> *&amp;&#160;</td>
          <td class="paramname"><em>spl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>nPoints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&amp;&#160;</td>
          <td class="paramname"><em>coeffs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Gets the polynomial coefficients for TF1. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spl</td><td>pointer to <a class="el" href="classTF1__red.html" title="CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...">TF1_red</a> that will be checked </td></tr>
    <tr><td class="paramname">nPoints</td><td>number of knots </td></tr>
    <tr><td class="paramname">coeffs</td><td>Array holding coefficients for each knot </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01415">1415</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                                                                        {</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160; </div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  <span class="comment">// Initialise all arrays to 1.0</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>; ++i) {</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    coeffs[i] = 0.0;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  }</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160; </div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  <span class="comment">// Get number of points in spline</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  nPoints = spl-&gt;<a class="code" href="classTF1__red.html#af9e3b0e8d2edad0e7e08f3bf215525c9">GetSize</a>();</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160; </div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  <span class="comment">// TSpline3 can only take doubles, not floats</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  <span class="comment">// But our GPU is slow with doubles, so need to cast to float</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nPoints; i++) {</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    coeffs[i] = spl-&gt;<a class="code" href="classTF1__red.html#aaea5cf4c9b9fa4307e2b63dfdf58fc1b">GetParameter</a>(i);</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  }</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  <span class="comment">// The structure is now coeffs  = {a,b,c,d,e}</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  <span class="keyword">delete</span> spl;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  spl = NULL;</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;}</div>
<div class="ttc" id="aclassTF1__red_html_aaea5cf4c9b9fa4307e2b63dfdf58fc1b"><div class="ttname"><a href="classTF1__red.html#aaea5cf4c9b9fa4307e2b63dfdf58fc1b">TF1_red::GetParameter</a></div><div class="ttdeci">double GetParameter(_int_ Parameter)</div><div class="ttdoc">Get a parameter value.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00223">SplineStructs.h:223</a></div></div>
<div class="ttc" id="aclassTF1__red_html_af9e3b0e8d2edad0e7e08f3bf215525c9"><div class="ttname"><a href="classTF1__red.html#af9e3b0e8d2edad0e7e08f3bf215525c9">TF1_red::GetSize</a></div><div class="ttdeci">int GetSize()</div><div class="ttdoc">Get the size.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00238">SplineStructs.h:238</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a45cece9dcbe699e00a7b5fdff4806c1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45cece9dcbe699e00a7b5fdff4806c1e">&#9670;&nbsp;</a></span>Initialise()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::Initialise </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Set everything to null etc. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00147">147</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                           {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor">#ifdef CUDA</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Using GPU version event by event monolith&quot;</span>);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="comment">//KS: If true it will save spline monolith into huge ROOT file</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <a class="code" href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">SaveSplineFile</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a> = 0;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a> = 0;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> = 0;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a> = 0;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a> = 0;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a> = 0;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a> = 0;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <a class="code" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a> = NULL;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a> = NULL;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a> = NULL;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <a class="code" href="classSMonolith.html#a1317bac1e66e5400c59bc4dd9ff3cdd9">gpu_weights</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a> = NULL;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <a class="code" href="classSMonolith.html#a43ffa53dafb6006e7bd23597a402e8b4">gpu_total_weights</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <a class="code" href="classSMonolith.html#ac6656d53aaefa0db75f4cf57aa517dbf">gpu_nParamPerEvent</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <a class="code" href="classSMonolith.html#a2e36f546602e0d375dcbacd8771369c7">gpu_nPoints_arr</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <a class="code" href="classSMonolith.html#a6aaa90b9158e01743235a465fd80caaf">gpu_paramNo_arr</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <a class="code" href="classSMonolith.html#a0ff9a70ffa877c13f6aa53a44e447e39">gpu_nKnots_arr</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <a class="code" href="classSMonolith.html#a3eb59435b695f7f9653f027e49e4b33f">gpu_coeff_x</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <a class="code" href="classSMonolith.html#ad48ce38bdd62d27df5405fdbf7dbc0c7">gpu_coeff_many</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a> = NULL;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <a class="code" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a> = NULL;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a> = NULL;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;}</div>
<div class="ttc" id="aclassSMonolith_html_a419c7eb29dfa7187b52d18c430763721"><div class="ttname"><a href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">SMonolith::NSplines_total</a></div><div class="ttdeci">unsigned int NSplines_total</div><div class="ttdoc">Number of total splines we can maximally have, if each event had the maximum number of splines found ...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00155">SplineMonolith.h:155</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ab5692081772ca14bd012eb125e2ccfd4"><div class="ttname"><a href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">SMonolith::SaveSplineFile</a></div><div class="ttdeci">bool SaveSplineFile</div><div class="ttdoc">Flag telling whether we are saving spline monolith into handy root file.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00198">SplineMonolith.h:198</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ac86282b04659bae5cccb6073c9edc0a5"><div class="ttname"><a href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">SMonolith::NEvents</a></div><div class="ttdeci">unsigned int NEvents</div><div class="ttdoc">Number of events.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00144">SplineMonolith.h:144</a></div></div>
<div class="ttc" id="aclassSMonolith_html_aee3c18513f8209f1ac940b492cd3ed68"><div class="ttname"><a href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">SMonolith::NSplines_total_large</a></div><div class="ttdeci">unsigned int NSplines_total_large</div><div class="ttdoc">Number of total splines if each event had every parameter's spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00158">SplineMonolith.h:158</a></div></div>
<div class="ttc" id="aclassSMonolith_html_afc0e3d1eafd575cf7628319a66925d5b"><div class="ttname"><a href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">SMonolith::nKnots</a></div><div class="ttdeci">unsigned int nKnots</div><div class="ttdoc">Sum of all knots over all splines.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00161">SplineMonolith.h:161</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac69a542d8c48acd8faf797c20cad4590"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac69a542d8c48acd8faf797c20cad4590">&#9670;&nbsp;</a></span>isFlat()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool SMonolith::isFlat </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classTSpline3__red.html">TSpline3_red</a> *&amp;&#160;</td>
          <td class="paramname"><em>spl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Helper function used in the constructor, tests to see if the spline is flat. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spl</td><td>pointer to <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> that will be checked </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01438">1438</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;                                         {</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="keywordtype">int</span> Np = spl-&gt;<a class="code" href="classTSpline3__red.html#a9d09b9ada9990a6f33d9ff005c977535">GetNp</a>();</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <a class="code" href="Structs_8h.html#a44b939bf69f41920331b7d7a74d2d436">_float_</a> x, y, b, c, d;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <span class="comment">// Go through spline segment parameters,</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  <span class="comment">// Get y values for each spline knot,</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="comment">// Every knot must evaluate to 1.0 to create a flat spline</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; Np; i++) {</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    spl-&gt;<a class="code" href="classTSpline3__red.html#a77c5ebd1559cee2911d14fa025e4143d">GetCoeff</a>(i, x, y, b, c, d);</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="keywordflow">if</span> (y != 1) {</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    }</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  }</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6783cdc3c485378ca21852e1a7b02482"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6783cdc3c485378ca21852e1a7b02482">&#9670;&nbsp;</a></span>LoadSplineFile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::LoadSplineFile </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>FileName</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Load preprocessed spline file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">FileName</td><td>Path to ROOT file with predefined reduced Spline Monolith </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00484">484</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                                                 {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="preprocessor">  #ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Trying to load Monolith from file using weight by weight base, this is not supported right now, sorry&quot;</span>);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="keywordflow">if</span> (std::getenv(<span class="stringliteral">&quot;MACH3&quot;</span>) != NULL) {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      FileName.insert(0, std::string(std::getenv(<span class="stringliteral">&quot;MACH3&quot;</span>))+<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;   }</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160; </div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  TFile *SplineFile = <span class="keyword">new</span> TFile(FileName.c_str(), <span class="stringliteral">&quot;OPEN&quot;</span>);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  TTree *Settings = (TTree*)SplineFile-&gt;Get(<span class="stringliteral">&quot;Settings&quot;</span>);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  TTree *Monolith = (TTree*)SplineFile-&gt;Get(<span class="stringliteral">&quot;Monolith&quot;</span>);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  TTree *ParamInfo = (TTree*)SplineFile-&gt;Get(<span class="stringliteral">&quot;ParamInfo&quot;</span>);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  TTree *XKnots = (TTree*)SplineFile-&gt;Get(<span class="stringliteral">&quot;XKnots&quot;</span>);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  TTree *EventInfo = (TTree*)SplineFile-&gt;Get(<span class="stringliteral">&quot;EventInfo&quot;</span>);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  TTree *FastSplineInfoTree = (TTree*)SplineFile-&gt;Get(<span class="stringliteral">&quot;FastSplineInfoTree&quot;</span>);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NEvents_temp;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keywordtype">short</span> <span class="keywordtype">int</span> nParams_temp;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="keywordtype">int</span> _max_knots_temp;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nKnots_temp;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NSplines_valid_temp;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;NEvents&quot;</span>, &amp;NEvents_temp);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;nParams&quot;</span>, &amp;nParams_temp);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;_max_knots&quot;</span>, &amp;_max_knots_temp);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;nKnots&quot;</span>, &amp;nKnots_temp);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;NSplines_valid&quot;</span>, &amp;NSplines_valid_temp);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  Settings-&gt;GetEntry(0);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a> = NEvents_temp;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a> = nParams_temp;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> = _max_knots_temp;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a> = nKnots_temp;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a> = NSplines_valid_temp;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event_size_max = <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> * <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a> = <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a> * <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="comment">//KS: Since we are going to copy it each step use fancy CUDA memory allocation</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="preprocessor">#ifdef CUDA</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <a class="code" href="gpuSplineUtils_8cu.html#a619be845847738447535c5628ff72c4c">InitGPU_Segments</a>(&amp;<a class="code" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <a class="code" href="gpuSplineUtils_8cu.html#acc3b24da038d746b5ccfcee61ba26b90">InitGPU_Vals</a>(&amp;<a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <a class="code" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a> = <span class="keyword">new</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>[<a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>]();</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>]();</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.resize(2*<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>.resize(<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="comment">//KS: And array which tells where each spline stars in a big monolith array, sort of knot map</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <a class="code" href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">cpu_nKnots_arr</a>.resize(<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>.resize(<a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>); <span class="comment">// *4 because we store y,b,c,d parameters in this array</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>.resize(event_size_max);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="comment">//KS: This is tricky as this variable use both by CPU and GPU, however if use CUDA we use cudaMallocHost</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="preprocessor">#ifndef CUDA</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>]();</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <a class="code" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>]();</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keywordtype">float</span> coeff = 0.;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  Monolith-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_coeff_many&quot;</span>, &amp;coeff);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>; i++)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    Monolith-&gt;GetEntry(i);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[i] = coeff;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordtype">short</span> <span class="keywordtype">int</span> paramNo_arr = 0;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nKnots_arr = 0;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  ParamInfo-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_paramNo_arr&quot;</span>, &amp;paramNo_arr);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  ParamInfo-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_nKnots_arr&quot;</span>, &amp;nKnots_arr);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>; i++)</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    ParamInfo-&gt;GetEntry(i);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>[i] = paramNo_arr;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <a class="code" href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">cpu_nKnots_arr</a>[i] = nKnots_arr;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keywordtype">float</span> coeff_x = 0.;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  XKnots-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_coeff_x&quot;</span>, &amp;coeff_x);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; event_size_max; i++)</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    XKnots-&gt;GetEntry(i);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>[i] = coeff_x;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  }</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nParamPerEvent = 0;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  EventInfo-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_nParamPerEvent&quot;</span>, &amp;nParamPerEvent);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 2*<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>; i++)</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    EventInfo-&gt;GetEntry(i);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[i] = nParamPerEvent;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> nPoints = 0;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordtype">float</span> xtemp[20];</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  FastSplineInfoTree-&gt;SetBranchAddress(<span class="stringliteral">&quot;nPts&quot;</span>, &amp;nPoints);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  FastSplineInfoTree-&gt;SetBranchAddress(<span class="stringliteral">&quot;xPts&quot;</span>, &amp;xtemp);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a> = <span class="keyword">new</span> <a class="code" href="structFastSplineInfo.html">FastSplineInfo</a>[<a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>];</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> i = 0; i &lt; <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>; ++i) {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    FastSplineInfoTree-&gt;GetEntry(i);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160; </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="comment">// Fill the number of points</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#a2644b71e4993fba6cabe5f21c9ab44de">nPts</a> = nPoints;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">if</span>(nPoints == -999) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#aefbec11dd80b991ec507f4dc2fbefea0">xPts</a> = <span class="keyword">new</span> <a class="code" href="Structs_8h.html#a44b939bf69f41920331b7d7a74d2d436">_float_</a>[<a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#a2644b71e4993fba6cabe5f21c9ab44de">nPts</a>];</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> k = 0; k &lt; <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#a2644b71e4993fba6cabe5f21c9ab44de">nPts</a>; ++k)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#aefbec11dd80b991ec507f4dc2fbefea0">xPts</a>[k] = xtemp[k];</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  SplineFile-&gt;Close();</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keyword">delete</span> SplineFile;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="comment">// Print some info; could probably make this to a separate function</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;--- INITIALISED (X), (YBCD) ARRAYS ---&quot;</span>);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;{} events with {} splines&quot;</span>, <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>, <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;On average {:.2f} splines per event ({}/{})&quot;</span>, <span class="keywordtype">float</span>(<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)/<span class="keywordtype">float</span>(<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>), <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>, <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of x array = {:.4f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*event_size_max)/1.E6);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of coefficient (y,b,c,d) array = {:.2f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>)/1.E6);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of parameter # array = {:.2f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>)*<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)/1.E6);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <a class="code" href="classSMonolith.html#a3b2a29e485f1f35fd2bcb207c47c2469">PrepareForGPU_TSpline3</a>();</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;}</div>
<div class="ttc" id="aclassSMonolith_html_a3b2a29e485f1f35fd2bcb207c47c2469"><div class="ttname"><a href="classSMonolith.html#a3b2a29e485f1f35fd2bcb207c47c2469">SMonolith::PrepareForGPU_TSpline3</a></div><div class="ttdeci">void PrepareForGPU_TSpline3()</div><div class="ttdoc">CW: The shared initialiser from constructors of TSpline3 and TSpline3_red.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00731">SplineMonolith.cpp:731</a></div></div>
<div class="ttc" id="agpuSplineUtils_8cu_html_a619be845847738447535c5628ff72c4c"><div class="ttname"><a href="gpuSplineUtils_8cu.html#a619be845847738447535c5628ff72c4c">InitGPU_Segments</a></div><div class="ttdeci">__host__ void InitGPU_Segments(short int **segment)</div><div class="ttdoc">Allocate memory for spline segments.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00232">gpuSplineUtils.cu:232</a></div></div>
<div class="ttc" id="agpuSplineUtils_8cu_html_acc3b24da038d746b5ccfcee61ba26b90"><div class="ttname"><a href="gpuSplineUtils_8cu.html#acc3b24da038d746b5ccfcee61ba26b90">InitGPU_Vals</a></div><div class="ttdeci">__host__ void InitGPU_Vals(float **vals)</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00241">gpuSplineUtils.cu:241</a></div></div>
<div class="ttc" id="astructFastSplineInfo_html"><div class="ttname"><a href="structFastSplineInfo.html">FastSplineInfo</a></div><div class="ttdoc">CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00009">SplineStructs.h:9</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac37ee525aa57316f652433a4e393afaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac37ee525aa57316f652433a4e393afaf">&#9670;&nbsp;</a></span>ModifyWeights()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::ModifyWeights </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">private</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calc total event weight. </p>

<p>Implements <a class="el" href="classSplineBase.html#a49665d2712b61b038085d25ace96a568">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01720">1720</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                             {</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="comment">//*********************************************************</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="preprocessor">#ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EventNum = 0; EventNum &lt; <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>; ++EventNum)</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  {</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <span class="keywordtype">float</span> totalWeight = 1.0f; <span class="comment">// Initialize total weight for each event</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160; </div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    <span class="comment">// Extract the parameters for the current event</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> startIndex = <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[2 * EventNum + 1];</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numParams = <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[2 * EventNum];</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160; </div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    <span class="comment">// Compute total weight for the current event</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; numParams; ++id)</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    {</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;      totalWeight *= <a class="code" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a>[startIndex + id];</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    }</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160; </div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    <span class="comment">// Store the total weight for the current event</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    <a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>[EventNum] = totalWeight;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  }</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  <span class="comment">//KS: Name is confusing but what it does it make a nice mapping used for debugging</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  <a class="code" href="classSMonolith.html#a72cd282322bdaadb23d8a376efa9e2c1">ModifyWeights_GPU</a>();</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;}</div>
<div class="ttc" id="aclassSMonolith_html_a72cd282322bdaadb23d8a376efa9e2c1"><div class="ttname"><a href="classSMonolith.html#a72cd282322bdaadb23d8a376efa9e2c1">SMonolith::ModifyWeights_GPU</a></div><div class="ttdeci">void ModifyWeights_GPU()</div><div class="ttdoc">Conversion from valid splines to all.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01752">SplineMonolith.cpp:1752</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a72cd282322bdaadb23d8a376efa9e2c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72cd282322bdaadb23d8a376efa9e2c1">&#9670;&nbsp;</a></span>ModifyWeights_GPU()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::ModifyWeights_GPU </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Conversion from valid splines to all. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01752">1752</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;                                 {</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="comment">//*********************************************************</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160; </div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="preprocessor">#ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="comment">// Multi-thread here because _numIndex is really quite large!</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>; ++i) {</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a>[i] &gt;= 0) {</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;      <a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a>[i] = <a class="code" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a>[<a class="code" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a>[i]];</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;      <a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a>[i] = 1.;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    }</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;  }</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a65beed5bb2984530aa497b7faeb54d1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65beed5bb2984530aa497b7faeb54d1e">&#9670;&nbsp;</a></span>PrepareForGPU() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::PrepareForGPU </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classTF1__red.html">TF1_red</a> * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Prepare the <a class="el" href="classTF1__red.html" title="CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...">TF1_red</a> objects for the GPU. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of <a class="el" href="classTF1__red.html" title="CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...">TF1_red</a> pointers which we strip back </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00816">816</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                                                                           {</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="comment">// Scan for the max number of knots, the number of events (number of splines), and number of parameters</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <a class="code" href="classSMonolith.html#a98a140b54edcdb31e80d6e7b2f14c4cb">ScanMasterSpline</a>(MasterSpline, <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>, <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>, <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} events&quot;</span>, <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} polynomial at max&quot;</span>, <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>);</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} parameters&quot;</span>, <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="comment">// Can pass the spline segments to the GPU instead of the values</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="comment">// Make these here and only refill them for each loop, avoiding unnecessary new/delete on each reconfigure</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="comment">//KS: Since we are going to copy it each step use fancy CUDA memory allocation</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="preprocessor">#ifdef CUDA</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <a class="code" href="gpuSplineUtils_8cu.html#acc3b24da038d746b5ccfcee61ba26b90">InitGPU_Vals</a>(&amp;<a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>);</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>]();</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> j = 0; j &lt; <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>; j++)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>[j] = -999;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  }</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="comment">// Every event maximally has nParams TF1s which we&#39;ve saved</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a> = <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a> * <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160; </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="comment">//CW: With TF1 we only save the coefficients and the order of the polynomial</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="comment">// Makes most sense to have one large monolithic array, but then it becomes impossible to tell apart a coefficient from a &quot;number of points&quot;. So have two arrays: one of coefficients and one of number of points</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="comment">// Let&#39;s first assume all are of _max_knots size</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keywordtype">short</span> <span class="keywordtype">int</span> *nPoints_big = <span class="keyword">new</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>[<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>];</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keywordtype">float</span> *coeffs_big = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>*<a class="code" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>]; <span class="comment">// *5 because we store a,b,c,d,e coefficients of fifth order polynomial in this array</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160; </div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="comment">// Set all the big arrays to -999 to keep us safe...</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="preprocessor">#ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="preprocessor">#pragma omp parallel for</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>; j++) {</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="comment">// 1 number of points for each spline</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    nPoints_big[j] = -999;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="comment">// 5 coefficients for each spline</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; <a class="code" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>; k++) {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      coeffs_big[j*<a class="code" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>+k] = -999;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  }</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="comment">// Will hold what spline number a certain spline has</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keywordtype">short</span> <span class="keywordtype">int</span> *paramNo_big = <span class="keyword">new</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>[<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>];</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160; </div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="comment">// This holds the index of each spline</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <a class="code" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>];</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="preprocessor">#ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="comment">//This holds the CPU weights for EACH SPLINE that gets read in samplePDFND</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>];</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="comment">//KS: Map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.resize(2*<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="keywordtype">int</span> ParamCounter = 0;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="keywordtype">int</span> ParamCounterGlobal = 0;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 2*<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>; j++) {</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[j] = -1;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="preprocessor">#endif </span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="comment">// Set index array and number of points arrays to something silly, again to be safe...</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="preprocessor">#ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="preprocessor">#pragma omp parallel for</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>; j++) {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <a class="code" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a>[j] = -1;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    paramNo_big[j] = -1;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="preprocessor">    #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[j*2] = -1;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[j*2+1] = -1;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  }</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160; </div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="comment">// Temporary arrays to hold the coefficients for each spline</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="comment">// We get one a,b,c,d,e for each spline so need 5 </span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="keywordtype">float</span> *temp_coeffs = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>]();</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a> = 0;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; </div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  std::vector&lt;std::vector&lt;TF1_red*&gt; &gt;::iterator OuterIt;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  std::vector&lt;TF1_red*&gt;::iterator InnerIt;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EventCounter = 0;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="comment">// Loop over events and extract the spline coefficients</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="keywordflow">for</span> (OuterIt = MasterSpline.begin(); OuterIt != MasterSpline.end(); ++OuterIt, ++EventCounter) {</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="comment">// Structure of MasterSpline is std::vector&lt;std::vector&lt;TSpline3*&gt;&gt;</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="comment">// A conventional iterator to count which parameter a given spline should be applied to</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordtype">int</span> ParamNumber = 0;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="keywordflow">for</span> (InnerIt = (*OuterIt).begin(); InnerIt != (*OuterIt).end(); ++InnerIt, ++ParamNumber) {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      <span class="comment">// Don&#39;t actually use this ever -- we give each spline the maximum number of points found in all splines</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <span class="keywordtype">int</span> nPoints_tmp = 0;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      <span class="comment">// Get a pointer to the current spline for this event</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      <a class="code" href="classTF1__red.html">TF1_red</a>* CurrSpline = (*InnerIt);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      <span class="comment">// If NULL we don&#39;t have this spline for the event, so move to next spline</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="keywordflow">if</span> (CurrSpline == NULL) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160; </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="comment">// If the number of knots are greater than 2 the spline is not a dummy and we should extract coefficients to load onto the GPU</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <a class="code" href="classSMonolith.html#a87230e35c15ce4523bc3d630416e30f3">getTF1Coeff</a>(CurrSpline, nPoints_tmp, temp_coeffs);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      (*InnerIt) = CurrSpline;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>; ++j) {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        coeffs_big[<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>*<a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>+j] = temp_coeffs[j];</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      }</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <span class="comment">// Save the number of points for this spline</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      nPoints_big[<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>] = nPoints_tmp;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160; </div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <span class="comment">// Set the parameter number for this spline</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      paramNo_big[<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>] = ParamNumber;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="comment">// Set the index of the spline so we can tell apart from flat splines</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <a class="code" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a>[EventCounter*<a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a> + ParamNumber] = <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="comment">// Increment the counter for the number of good splines we have</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      ++<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="preprocessor">      #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      ParamCounter++;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="preprocessor">      #endif</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    } <span class="comment">// End the loop over the parameters in the MasterSpline</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="preprocessor">      #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[2*EventCounter] = ParamCounter;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      ParamCounterGlobal += ParamCounter;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[2*EventCounter+1] = ParamCounterGlobal;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      ParamCounter = 0;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="preprocessor">      #endif</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  } <span class="comment">// End the loop over the number of events</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="comment">// Delete the temporary arrays</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="keyword">delete</span>[] temp_coeffs;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160; </div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="comment">// Now that we have looped through all events we can make the number of splines smaller</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <span class="comment">// Going from number of events * number of points per spline * number of NIWG params to spln_counter (=valid splines)</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Number of splines = {}&quot;</span>, <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160; </div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="comment">// Now declare the arrays for each point in the valid splines which the event actually has (i.e. include the splines that the event undergoes)</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="comment">// Also make array with the number of points per spline (not per spline point!)</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <span class="comment">// float because GPU precision (could change to double, but will incur significant speed reduction on GPU unless you&#39;re very rich!)</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <a class="code" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>.resize(<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>.resize(<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>*<a class="code" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>); <span class="comment">// *5 because this array holds  a,b,c,d,e parameters</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>.resize(<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160; </div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="preprocessor">#ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="preprocessor">#pragma omp parallel for</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>; i++) {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <a class="code" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>[i] = nPoints_big[i];</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>[i] = paramNo_big[i];</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>; ++j) {</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[i*<a class="code" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>+j] = coeffs_big[i*<a class="code" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>+j];</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[i*<a class="code" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>+j] == -999) {</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;***** BAD COEFFICIENT OF POLY!!! ***** \n&quot;</span> &lt;&lt; <span class="stringliteral">&quot;On spline &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[i*<a class="code" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>+j] &lt;&lt; std::endl;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;Indicates bad reading and stripping back of splines pre-GPU&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        std::cerr &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; __LINE__ &lt;&lt; std::endl;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;      }</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    }</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160; </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="comment">// Perform checks that all array entries have been changed from negative numbers and no number of points is greater than max knots, inputted by user</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="comment">// Don&#39;t do this for the index array since some entries there should be -1 so we know what splines to include and not include in each event for loading onto the GPU</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>[i] &lt; 0) {</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;***** NEGATIVE PARAMETER NUMBER!!! ***** \n&quot;</span> &lt;&lt; <span class="stringliteral">&quot;On spline &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>[i] &lt;&lt; std::endl;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;Indicates bad reading and stripping back of splines pre-GPU&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      std::cerr &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; __LINE__ &lt;&lt; std::endl;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    }</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160; </div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>[i] &lt; 0) {</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;***** NEGATIVE NUMBER OF POINTS!!! ***** \n&quot;</span> &lt;&lt; <span class="stringliteral">&quot;On spline &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; <a class="code" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>[i] &lt;&lt; std::endl;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;Indicates bad reading and stripping back of splines pre-GPU&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      std::cerr &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; __LINE__ &lt;&lt; std::endl;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    }</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  }  </div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="comment">// Delete allocated memory</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keyword">delete</span>[] paramNo_big;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="keyword">delete</span>[] nPoints_big;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="keyword">delete</span>[] coeffs_big;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160; </div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="comment">// Print some info; could probably make this to a separate function</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;--- INITIALISED TF1 ARRAYS ---&quot;</span>);</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a> &lt;&lt; <span class="stringliteral">&quot; events with &quot;</span> &lt;&lt; <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a> &lt;&lt; <span class="stringliteral">&quot; splines&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160; </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;  On average &quot;</span> &lt;&lt; float(<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)/float(<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>) &lt;&lt; <span class="stringliteral">&quot; splines per event (&quot;</span> &lt;&lt; <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a> &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;  Size of coefficient {a,b,c,d,e} array = &quot;</span> &lt;&lt; double(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>*<a class="code" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>)/1.E6 &lt;&lt; <span class="stringliteral">&quot; MB&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;  Size of parameter # array = &quot;</span> &lt;&lt; double(<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>)*<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)/1.E6 &lt;&lt; <span class="stringliteral">&quot; MB&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;  Size of polynomial type array = &quot;</span> &lt;&lt; double(<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>)*<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)/1.E6 &lt;&lt; <span class="stringliteral">&quot; MB&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="preprocessor">  #ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="comment">// Make the array that holds all the returned weights from the GPU to pass to the CPU</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <a class="code" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>]();</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="comment">//KS: This is tricky as this variable use both by CPU and GPU, however if use CUDA we use cudaMallocHost</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="preprocessor">  #ifndef CUDA</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>]();</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <a class="code" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>]();</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160; </div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <a class="code" href="classSMonolith.html#ac5dc91d304260fab18e7d7eb1cebe032">PrepareForGPU_TF1</a>();</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;}</div>
<div class="ttc" id="aSplineCommon_8h_html_a911160077ffa38727e0494f178ce380a"><div class="ttname"><a href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a></div><div class="ttdeci">#define _nTF1Coeff_</div><div class="ttdoc">KS: For TF1 we store at most 5 coefficients, we could make it more flexible but for now define it her...</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00010">SplineCommon.h:10</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a87230e35c15ce4523bc3d630416e30f3"><div class="ttname"><a href="classSMonolith.html#a87230e35c15ce4523bc3d630416e30f3">SMonolith::getTF1Coeff</a></div><div class="ttdeci">void getTF1Coeff(TF1_red *&amp;spl, int &amp;nPoints, float *&amp;coeffs)</div><div class="ttdoc">CW: Gets the polynomial coefficients for TF1.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01415">SplineMonolith.cpp:1415</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a98a140b54edcdb31e80d6e7b2f14c4cb"><div class="ttname"><a href="classSMonolith.html#a98a140b54edcdb31e80d6e7b2f14c4cb">SMonolith::ScanMasterSpline</a></div><div class="ttdeci">void ScanMasterSpline(std::vector&lt; std::vector&lt; TSpline3_red * &gt; &gt; &amp;MasterSpline, unsigned int &amp;NEvents, int &amp;MaxPoints, short int &amp;numParams, int &amp;nSplines, unsigned int &amp;numKnots)</div><div class="ttdoc">CW: Function to scan through the MasterSpline of TSpline3.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01086">SplineMonolith.cpp:1086</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ac5dc91d304260fab18e7d7eb1cebe032"><div class="ttname"><a href="classSMonolith.html#ac5dc91d304260fab18e7d7eb1cebe032">SMonolith::PrepareForGPU_TF1</a></div><div class="ttdeci">void PrepareForGPU_TF1()</div><div class="ttdoc">CW: The shared initialiser from constructors of TF1 and TF1_red.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01017">SplineMonolith.cpp:1017</a></div></div>
<div class="ttc" id="aclassTF1__red_html"><div class="ttname"><a href="classTF1__red.html">TF1_red</a></div><div class="ttdoc">CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00157">SplineStructs.h:157</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a58165d265d676f7052a1b125117e1a1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58165d265d676f7052a1b125117e1a1b">&#9670;&nbsp;</a></span>PrepareForGPU() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::PrepareForGPU </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classTSpline3__red.html">TSpline3_red</a> * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Prepare the <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> objects for the GPU. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> pointers which we strip back </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00251">251</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                                                                                {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="comment">// Scan for the max number of knots, the number of events (number of splines), and number of parameters</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordtype">int</span> nSplines = 0;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <a class="code" href="classSMonolith.html#a98a140b54edcdb31e80d6e7b2f14c4cb">ScanMasterSpline</a>(MasterSpline, <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>, <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>, <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>, nSplines, <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} events&quot;</span>, <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} knots at max&quot;</span>, <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} parameters&quot;</span>, <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} maximum number of splines in an event&quot;</span>, nSplines);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found total {} knots in all splines&quot;</span>, <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="comment">// Can pass the spline segments to the GPU instead of the values</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="comment">// Make these here and only refill them for each loop, avoiding unnecessary new/delete on each reconfigure</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="comment">//KS: Since we are going to copy it each step use fancy CUDA memory allocation</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="preprocessor">#ifdef CUDA</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="code" href="gpuSplineUtils_8cu.html#a619be845847738447535c5628ff72c4c">InitGPU_Segments</a>(&amp;<a class="code" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <a class="code" href="gpuSplineUtils_8cu.html#acc3b24da038d746b5ccfcee61ba26b90">InitGPU_Vals</a>(&amp;<a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <a class="code" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a> = <span class="keyword">new</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>[<a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>]();</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>]();</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> j = 0; j &lt; <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>; j++)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="classSMonolith.html#a53ab5b2235fd697f27556f1a1a7a5354">segments</a>[j] = 0;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <a class="code" href="classSMonolith.html#aa2a793b82a6c650a6fad52510e49b6b0">vals</a>[j] = -999;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="comment">// Total number of events in our Spline, read from TSpline3 entries</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="comment">// Number of TSpline3 we have in total if each event had the maximal number of splines (nSplines written by ScanMasterSpline)</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a> = <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a> * nSplines;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">// Number of TSpline3 we have in total if each event has *EVERY* spline. Needed for some arrays</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <a class="code" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a> = <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>*<a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event_size_max = <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> * <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="comment">// Declare the {x}, {y,b,c,d} arrays for all possible splines which the event has</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">// We&#39;ll filter off the flat and &quot;disabled&quot; (e.g. CCQE event should not have MARES spline) ones in the next for loop, but need to declare these beasts here</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="comment">// Declare the {y,b,c,d} for each knot</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="comment">// float because GPU precision (could change to double, but will incur significant speed reduction on GPU unless you&#39;re very rich!)</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>.resize(<a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>); <span class="comment">// *4 because we store y,b,c,d parameters in this array</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">//KS: For x coeff we assume that for given dial (MAQE) spacing is identical, here we are sloppy and assume each dial has the same number of knots, not a big problem</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>.resize(event_size_max);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="comment">// Set all the big arrays to -999 to keep us safe...</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="preprocessor">#ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="preprocessor">#pragma omp parallel for</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>; j++) {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; <a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>; k++) {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[j*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+k] = -999;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; event_size_max; j++) {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>[j] = -999;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="comment">// Will hold what spline number a certain spline has</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordtype">short</span> <span class="keywordtype">int</span> *paramNo_big = <span class="keyword">new</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>[<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>];</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="comment">// Will hold map where given spline starts</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *knotNo_big = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>];</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="comment">// This holds the index of each spline</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <a class="code" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a>];</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="comment">// This holds the total CPU weights that gets read in samplePDFND</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="preprocessor">#ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;   <a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a>];</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="comment">//KS: Map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.resize(2*<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keywordtype">int</span> ParamCounter = 0;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordtype">int</span> ParamCounterGlobal = 0;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 2*<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>; j++) {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[j] = -1;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  }</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="preprocessor">#endif </span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="comment">// Set index array and number of points arrays to something silly, again to be safe...</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="preprocessor">#ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="preprocessor">#pragma omp parallel</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;{</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">//KS: Gain from nowait is minimal mostly done as I am learning how to better utilise OMP</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="preprocessor">  #pragma omp for nowait</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a>; j++) {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a>[j] = -1;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="preprocessor">  #pragma omp for</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>; j++) {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    paramNo_big[j] = -1;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    knotNo_big[j] = -1;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="preprocessor">#ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;} <span class="comment">//end parallel region</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="comment">// Temporary arrays to hold the coefficients for each spline</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="comment">// We get one x, one y, one b,... for each point, so only need to be _max_knots big</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="comment">//KS: Some params has less splines but this is all right main array will get proper number while this temp will be deleted</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keywordtype">float</span> *x_tmp = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>]();</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keywordtype">float</span> *many_tmp = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>]();</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="comment">// Number of valid splines in total for our entire ensemble of events</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a> = 0;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  std::vector&lt;std::vector&lt;TSpline3_red*&gt; &gt;::iterator OuterIt;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  std::vector&lt;TSpline3_red*&gt;::iterator InnerIt;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="comment">// Count the number of events</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EventCounter = 0;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> KnotCounter = 0;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="comment">// Loop over events and extract the spline coefficients</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordflow">for</span> (OuterIt = MasterSpline.begin(); OuterIt != MasterSpline.end(); ++OuterIt, ++EventCounter) {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="comment">// Structure of MasterSpline is std::vector&lt;std::vector&lt;TSpline3*&gt;&gt;</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="comment">// A conventional iterator to count which parameter a given spline should be applied to</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordtype">int</span> ParamNumber = 0;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">for</span> (InnerIt = (*OuterIt).begin(); InnerIt != (*OuterIt).end(); ++InnerIt, ++ParamNumber) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <span class="comment">//KS: how much knots each spline has</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="keywordtype">int</span> nPoints_tmp = 0;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="comment">// Get a pointer to the current spline for this event</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <a class="code" href="classTSpline3__red.html">TSpline3_red</a>* CurrSpline = (*InnerIt);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="comment">// If NULL we don&#39;t have this spline for the event, so move to next spline</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="keywordflow">if</span> (CurrSpline == NULL) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="comment">// If the number of knots are greater than 2 the spline is not a dummy and we should extract coefficients to load onto the GPU</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <a class="code" href="classSMonolith.html#acbbe3398718d0d02d65a1e92a91c112c">getSplineCoeff_SepMany</a>(CurrSpline, nPoints_tmp, x_tmp, many_tmp);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="comment">//KS: One knot means flat spline so ignore</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <span class="keywordflow">if</span> (nPoints_tmp == 1) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      (*InnerIt) = CurrSpline;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>; ++j) {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>[ParamNumber*<a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> + j] = x_tmp[j];</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="comment">//KS: Contrary to X coeff we keep for other coeff only filled knots, there is no much gain for doing so for x coeff</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nPoints_tmp; ++j) {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; <a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>; k++) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;          <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[KnotCounter*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a> + j*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a> + k] = many_tmp[j*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>+k];</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="comment">// Set the parameter number for this spline</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      paramNo_big[<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>] = ParamNumber;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="comment">//KS: Fill map when each spline starts</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      knotNo_big[<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>] = KnotCounter;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      KnotCounter += nPoints_tmp;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="comment">// Set the index of the spline so we can tell apart from flat splines</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <a class="code" href="classSMonolith.html#ae9fa50f60f717558f517faea6a38d251">index_cpu</a>[EventCounter*<a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a> + ParamNumber] = <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="preprocessor">      #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      ParamCounter++;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="preprocessor">      #endif</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="comment">// Increment the counter for the number of good splines we have</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      ++<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    } <span class="comment">// End the loop over the parameters in the MasterSpline</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="preprocessor">      #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[2*EventCounter] = ParamCounter;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[2*EventCounter+1] = ParamCounterGlobal;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      ParamCounterGlobal += ParamCounter;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      ParamCounter = 0;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="preprocessor">      #endif</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  } <span class="comment">// End the loop over the number of events</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keyword">delete</span>[] many_tmp;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keyword">delete</span>[] x_tmp;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="comment">// Now that we have looped through all events we can make the number of splines smaller</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="comment">// Going from number of events * number of points per spline * number of NIWG params to spln_counter (=valid splines)</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Number of splines = {}&quot;</span>, <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="comment">// Make array with the number of points per spline (not per spline point!)</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>.resize(<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="comment">//KS: And array which tells where each spline stars in a big monolith array, sort of knot map</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <a class="code" href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">cpu_nKnots_arr</a>.resize(<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="preprocessor">#ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="preprocessor">#pragma omp parallel for</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>; i++) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>[i] = paramNo_big[i];</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <a class="code" href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">cpu_nKnots_arr</a>[i] = knotNo_big[i];</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="comment">// Perform checks that all array entries have been changed from negative numbers and no number of points is greater than max knots, inputted by user</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="comment">// Don&#39;t do this for the index array since some entries there should be -1 so we know what splines to include and not include in each event for loading onto the GPU</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>[i] &lt; 0) {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;***** NEGATIVE PARAMETER NUMBER!!! ***** \n&quot;</span> &lt;&lt; <span class="stringliteral">&quot;On spline &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>[i] &lt;&lt; std::endl;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;Indicates bad reading and stripping back of splines pre-GPU&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      std::cerr &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; __LINE__ &lt;&lt; std::endl;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keyword">delete</span>[] paramNo_big;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keyword">delete</span>[] knotNo_big;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordtype">int</span> BadXCounter = 0;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; event_size_max; j++) {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>[j] == -999) BadXCounter++;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">// Perform checks that all entries have been modified from initial values</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>[j] == -999 &amp;&amp; BadXCounter &lt; 5) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;***** BAD X !! *****&quot;</span>);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;Indicates some parameter doesn&#39;t have a single spline&quot;</span>);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;j = {}&quot;</span>);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="comment">//throw;</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">if</span>(BadXCounter == 5) <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;There is more unutilised knots although I will stop spamming&quot;</span>);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;Found in total {} BAD X&quot;</span>, BadXCounter);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="preprocessor">#ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="comment">// Make the array that holds all the returned weights from the GPU to pass to the CPU</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <a class="code" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>]();</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="comment">//KS: This is tricky as this variable use both by CPU and GPU, however if use CUDA we use cudaMallocHost</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="preprocessor">  #ifndef CUDA</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>]();</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <a class="code" href="classSMonolith.html#ab6a29f13d8e6efb380f2b9d59cfa88fc">cpu_weights_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>]();</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="comment">// Print some info; could probably make this to a separate function</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;--- INITIALISED (X), (YBCD) ARRAYS ---&quot;</span>);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;{} events with {} splines&quot;</span>, <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>, <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;On average {:.2f} splines per event ({}/{})&quot;</span>, <span class="keywordtype">float</span>(<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)/<span class="keywordtype">float</span>(<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>), <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>, <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of x array = {:.4f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*event_size_max)/1.E6);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of coefficient (y,b,c,d) array = {:.2f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>)/1.E6);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of parameter # array = {:.2f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>)*<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)/1.E6);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">SaveSplineFile</a>) <a class="code" href="classSMonolith.html#a79f4bf0cac279cf57ab8f06698052922">PrepareSplineFile</a>();</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <a class="code" href="classSMonolith.html#a3b2a29e485f1f35fd2bcb207c47c2469">PrepareForGPU_TSpline3</a>();</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;}</div>
<div class="ttc" id="aMaCh3Logger_8h_html_ad5b2eb6377721e3ac95def22c2386bb1"><div class="ttname"><a href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a></div><div class="ttdeci">#define MACH3LOG_WARN</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Logger_8h_source.html#l00017">MaCh3Logger.h:17</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a79f4bf0cac279cf57ab8f06698052922"><div class="ttname"><a href="classSMonolith.html#a79f4bf0cac279cf57ab8f06698052922">SMonolith::PrepareSplineFile</a></div><div class="ttdeci">void PrepareSplineFile()</div><div class="ttdoc">KS: Prepare spline file that can be used for fast loading.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00620">SplineMonolith.cpp:620</a></div></div>
<div class="ttc" id="aclassSMonolith_html_acbbe3398718d0d02d65a1e92a91c112c"><div class="ttname"><a href="classSMonolith.html#acbbe3398718d0d02d65a1e92a91c112c">SMonolith::getSplineCoeff_SepMany</a></div><div class="ttdeci">void getSplineCoeff_SepMany(TSpline3_red *&amp;spl, int &amp;nPoints, float *&amp;xArray, float *&amp;manyArray)</div><div class="ttdoc">CW: This loads up coefficients into two arrays: one x array and one yabcd array.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01355">SplineMonolith.cpp:1355</a></div></div>
<div class="ttc" id="aclassTSpline3__red_html"><div class="ttname"><a href="classTSpline3__red.html">TSpline3_red</a></div><div class="ttdoc">CW: Reduced TSpline3 class.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00260">SplineStructs.h:260</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac5dc91d304260fab18e7d7eb1cebe032"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5dc91d304260fab18e7d7eb1cebe032">&#9670;&nbsp;</a></span>PrepareForGPU_TF1()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::PrepareForGPU_TF1 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: The shared initialiser from constructors of TF1 and <a class="el" href="classTF1__red.html" title="CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...">TF1_red</a>. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01017">1017</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                                  {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160; </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="preprocessor">#ifdef CUDA</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;  Total size = &quot;</span> &lt;&lt; (double(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>*<a class="code" href="SplineCommon_8h.html#a911160077ffa38727e0494f178ce380a">_nTF1Coeff_</a>)+double(2.0*<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>)*<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>))/1.E6 &lt;&lt; <span class="stringliteral">&quot; MB memory on CPU to move to GPU&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;  GPU weight array (GPU-&gt;CPU every step) = &quot;</span> &lt;&lt; double(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)/1.E6 &lt;&lt; <span class="stringliteral">&quot; MB&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;  Parameter value array (CPU-&gt;GPU every step) = &quot;</span> &lt;&lt; double(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>)/1.E6 &lt;&lt; <span class="stringliteral">&quot; MB&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="comment">// With the new set-up we have:   1 coefficient array of size coeff_array_size, all same size</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="comment">//                                1 coefficient array of size coeff_array_size*4, holding y,b,c,d in order (y11,b11,c11,d11; y12,b12,c12,d12;...) where ynm is n = spline number, m = spline point. Should really make array so that order is (y11,b11,c11,d11; y21,b21,c21,d21;...) because it will optimise cache hits I think; try this if you have time</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <span class="comment">//                                return gpu_weights</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160; </div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="comment">// The gpu_XY arrays don&#39;t actually need initialising, since they are only placeholders for what we&#39;ll move onto the GPU. As long as we cudaMalloc the size of the arrays correctly there shouldn&#39;t be any problems</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <span class="comment">// Can probably make this a bit prettier but will do for now</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="comment">// Could be a lot smaller of a function...</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <a class="code" href="gpuSplineUtils_8cu.html#a477d39804560c8f066b91a5f79fbfa0b">InitGPU_TF1</a>(</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      &amp;<a class="code" href="classSMonolith.html#ad48ce38bdd62d27df5405fdbf7dbc0c7">gpu_coeff_many</a>,</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      &amp;<a class="code" href="classSMonolith.html#a6aaa90b9158e01743235a465fd80caaf">gpu_paramNo_arr</a>,</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      &amp;<a class="code" href="classSMonolith.html#a2e36f546602e0d375dcbacd8771369c7">gpu_nPoints_arr</a>,</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160; </div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      &amp;<a class="code" href="classSMonolith.html#a1317bac1e66e5400c59bc4dd9ff3cdd9">gpu_weights</a>,</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160; </div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;#ifndef Weight_On_SplineBySpline_Basis</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      &amp;<a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>,</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      &amp;<a class="code" href="classSMonolith.html#a43ffa53dafb6006e7bd23597a402e8b4">gpu_total_weights</a>,</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>,</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      &amp;<a class="code" href="classSMonolith.html#ac6656d53aaefa0db75f4cf57aa517dbf">gpu_nParamPerEvent</a>,</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;#endif</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>); <span class="comment">// What&#39;s the number of splines we have (also number of entries in gpu_nPoints_arr)</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160; </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="comment">// Move number of splines and spline size to constant GPU memory; every thread does not need a copy...</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <span class="comment">// The implementation lives in splines/gpuSplineUtils.cu</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <span class="comment">// The GPU splines don&#39;t actually need declaring but is good for demonstration, kind of</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="comment">// fixed by passing const reference</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <a class="code" href="gpuSplineUtils_8cu.html#a44452c7b7fdb280a47e1a74f7b982816">CopyToGPU_TF1</a>(</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      <a class="code" href="classSMonolith.html#ad48ce38bdd62d27df5405fdbf7dbc0c7">gpu_coeff_many</a>,</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      <a class="code" href="classSMonolith.html#a6aaa90b9158e01743235a465fd80caaf">gpu_paramNo_arr</a>,</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <a class="code" href="classSMonolith.html#a2e36f546602e0d375dcbacd8771369c7">gpu_nPoints_arr</a>,</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160; </div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>,</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>,</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      <a class="code" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>,</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;#ifndef Weight_On_SplineBySpline_Basis</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>,</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>,</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <a class="code" href="classSMonolith.html#ac6656d53aaefa0db75f4cf57aa517dbf">gpu_nParamPerEvent</a>,</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;#endif</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>,</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>,</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>);</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160; </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <span class="comment">// Delete all the coefficient arrays from the CPU once they are on the GPU</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>.clear();</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>.shrink_to_fit();</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <a class="code" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>.clear();</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  <a class="code" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>.shrink_to_fit();</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>.clear();</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>.shrink_to_fit();</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="preprocessor">  #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.clear();</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.shrink_to_fit();</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Good TF1 GPU loading&quot;</span>);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;}</div>
<div class="ttc" id="agpuSplineUtils_8cu_html_a44452c7b7fdb280a47e1a74f7b982816"><div class="ttname"><a href="gpuSplineUtils_8cu.html#a44452c7b7fdb280a47e1a74f7b982816">CopyToGPU_TF1</a></div><div class="ttdeci">__host__ void CopyToGPU_TF1(float *gpu_coeffs, short int *gpu_paramNo_arr, short int *gpu_nPoints_arr, std::vector&lt; float &gt; cpu_coeffs, std::vector&lt; short int &gt; paramNo_arr, std::vector&lt; short int &gt; nPoints_arr, int n_events, std::vector&lt; unsigned int &gt; cpu_nParamPerEvent, unsigned int *gpu_nParamPerEvent, int n_params, unsigned int n_splines, short int _max_knots)</div><div class="ttdoc">Copy to GPU for x array and separate ybcd array.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00362">gpuSplineUtils.cu:362</a></div></div>
<div class="ttc" id="agpuSplineUtils_8cu_html_a477d39804560c8f066b91a5f79fbfa0b"><div class="ttname"><a href="gpuSplineUtils_8cu.html#a477d39804560c8f066b91a5f79fbfa0b">InitGPU_TF1</a></div><div class="ttdeci">__host__ void InitGPU_TF1(float **gpu_coeffs, short int **gpu_paramNo_arr, short int **gpu_nPoints_arr, float **gpu_weights, float **cpu_total_weights, float **gpu_total_weights, int n_events, unsigned int **gpu_nParamPerEvent, unsigned int n_splines)</div><div class="ttdoc">Initialiser when using the x array and combined y,b,c,d array.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00174">gpuSplineUtils.cu:174</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3b2a29e485f1f35fd2bcb207c47c2469"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b2a29e485f1f35fd2bcb207c47c2469">&#9670;&nbsp;</a></span>PrepareForGPU_TSpline3()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::PrepareForGPU_TSpline3 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: The shared initialiser from constructors of TSpline3 and <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a>. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00731">731</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                                       {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="preprocessor">  #ifdef CUDA</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event_size_max = <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> * <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Total size = {:.2f} MB memory on CPU to move to GPU&quot;</span>,</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;              (<span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a> * <a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>) + <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * event_size_max) / 1.E6 +</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;              <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>) * <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)) / 1.E6);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;GPU weight array (GPU-&gt;CPU every step) = {:.2f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>) / 1.E6);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="preprocessor">  #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Since you are running Total event weight mode then GPU weight array (GPU-&gt;CPU every step) = {:.2f} MB&quot;</span>,</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;              <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>) / 1.E6);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Parameter value array (CPU-&gt;GPU every step) = {:.4f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>) / 1.E6);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <span class="comment">//CW: With the new set-up we have:   1 coefficient array of size coeff_array_size, all same size</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="comment">//                                1 coefficient array of size coeff_array_size*4, holding y,b,c,d in order (y11,b11,c11,d11; y12,b12,c12,d12;...) where ynm is n = spline number, m = spline point. Should really make array so that order is (y11,b11,c11,d11; y21,b21,c21,d21;...) because it will optimise cache hits I think; try this if you have time</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="comment">//                                return gpu_weights</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="comment">// The gpu_XY arrays don&#39;t actually need initialising, since they are only placeholders for what we&#39;ll move onto the GPU. As long as we cudaMalloc the size of the arrays correctly there shouldn&#39;t be any problems</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="comment">// Can probably make this a bit prettier but will do for now</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="comment">// Could be a lot smaller of a function...</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <a class="code" href="gpuSplineUtils_8cu.html#a1d9ccd919e57eb2e2939932bca23e205">InitGPU_SepMany</a>(</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      &amp;<a class="code" href="classSMonolith.html#a3eb59435b695f7f9653f027e49e4b33f">gpu_coeff_x</a>,</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      &amp;<a class="code" href="classSMonolith.html#ad48ce38bdd62d27df5405fdbf7dbc0c7">gpu_coeff_many</a>,</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      &amp;<a class="code" href="classSMonolith.html#a1317bac1e66e5400c59bc4dd9ff3cdd9">gpu_weights</a>,</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160; </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      &amp;<a class="code" href="classSMonolith.html#a6aaa90b9158e01743235a465fd80caaf">gpu_paramNo_arr</a>,</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      &amp;<a class="code" href="classSMonolith.html#a0ff9a70ffa877c13f6aa53a44e447e39">gpu_nKnots_arr</a>,</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;#ifndef Weight_On_SplineBySpline_Basis</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      &amp;<a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>,</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      &amp;<a class="code" href="classSMonolith.html#a43ffa53dafb6006e7bd23597a402e8b4">gpu_total_weights</a>,</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>,</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160; </div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      &amp;<a class="code" href="classSMonolith.html#ac6656d53aaefa0db75f4cf57aa517dbf">gpu_nParamPerEvent</a>,</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;#endif</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>, <span class="comment">// How many entries in coefficient array (*4 for the &quot;many&quot; array)</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>, <span class="comment">// What&#39;s the number of splines we have (also number of entries in gpu_nPoints_arr)</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      event_size_max <span class="comment">//Knots times event number of unique splines</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="comment">// Move number of splines and spline size to constant GPU memory; every thread does not need a copy...</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="comment">// The implementation lives in splines/gpuSplineUtils.cu</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="comment">// The GPU splines don&#39;t actually need declaring but is good for demonstration, kind of</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="comment">// fixed by passing const reference</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <a class="code" href="gpuSplineUtils_8cu.html#a1b13a9af140a7b044a220055f2c68c3a">CopyToGPU_SepMany</a>(</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      <a class="code" href="classSMonolith.html#a6aaa90b9158e01743235a465fd80caaf">gpu_paramNo_arr</a>,</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <a class="code" href="classSMonolith.html#a0ff9a70ffa877c13f6aa53a44e447e39">gpu_nKnots_arr</a>,</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <a class="code" href="classSMonolith.html#a3eb59435b695f7f9653f027e49e4b33f">gpu_coeff_x</a>,</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <a class="code" href="classSMonolith.html#ad48ce38bdd62d27df5405fdbf7dbc0c7">gpu_coeff_many</a>,</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160; </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>,</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <a class="code" href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">cpu_nKnots_arr</a>,</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>,</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>,</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;#ifndef Weight_On_SplineBySpline_Basis</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>,</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>,</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      <a class="code" href="classSMonolith.html#ac6656d53aaefa0db75f4cf57aa517dbf">gpu_nParamPerEvent</a>,</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;#endif</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>,</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>,</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>,</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="comment">// Delete all the coefficient arrays from the CPU once they are on the GPU</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>.clear();</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>.shrink_to_fit();</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>.clear();</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>.shrink_to_fit();</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>.clear();</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>.shrink_to_fit();</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <a class="code" href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">cpu_nKnots_arr</a>.clear();</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <a class="code" href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">cpu_nKnots_arr</a>.shrink_to_fit();</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="preprocessor">  #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.clear();</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.shrink_to_fit();</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Good GPU loading&quot;</span>);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;}</div>
<div class="ttc" id="agpuSplineUtils_8cu_html_a1b13a9af140a7b044a220055f2c68c3a"><div class="ttname"><a href="gpuSplineUtils_8cu.html#a1b13a9af140a7b044a220055f2c68c3a">CopyToGPU_SepMany</a></div><div class="ttdeci">__host__ void CopyToGPU_SepMany(short int *gpu_paramNo_arr, unsigned int *gpu_nKnots_arr, float *gpu_x_array, float *gpu_many_array, std::vector&lt; short int &gt; paramNo_arr, std::vector&lt; unsigned int &gt; nKnots_arr, std::vector&lt; float &gt; cpu_x_array, std::vector&lt; float &gt; cpu_many_array, int n_events, std::vector&lt; unsigned int &gt; cpu_nParamPerEvent, unsigned int *gpu_nParamPerEvent, int n_params, unsigned int n_splines, short int spline_size, unsigned int sizeof_array)</div><div class="ttdoc">Copy to GPU for x array and separate ybcd array.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00256">gpuSplineUtils.cu:256</a></div></div>
<div class="ttc" id="agpuSplineUtils_8cu_html_a1d9ccd919e57eb2e2939932bca23e205"><div class="ttname"><a href="gpuSplineUtils_8cu.html#a1d9ccd919e57eb2e2939932bca23e205">InitGPU_SepMany</a></div><div class="ttdeci">__host__ void InitGPU_SepMany(float **gpu_x_array, float **gpu_many_array, float **gpu_weights, short int **gpu_paramNo_arr, unsigned int **gpu_nKnots_arr, float **cpu_total_weights, float **gpu_total_weights, int n_events, unsigned int **gpu_nParamPerEvent, unsigned int sizeof_array, unsigned int n_splines, int Eve_size)</div><div class="ttdoc">Initialiser when using the x array and combined y,b,c,d array.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00112">gpuSplineUtils.cu:112</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a79f4bf0cac279cf57ab8f06698052922"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79f4bf0cac279cf57ab8f06698052922">&#9670;&nbsp;</a></span>PrepareSplineFile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::PrepareSplineFile </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Prepare spline file that can be used for fast loading. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00620">620</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                                  {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  std::string FileName = <span class="stringliteral">&quot;inputs/SplineFile.root&quot;</span>;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="keywordflow">if</span> (std::getenv(<span class="stringliteral">&quot;MACH3&quot;</span>) != NULL) {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      FileName.insert(0, std::string(std::getenv(<span class="stringliteral">&quot;MACH3&quot;</span>))+<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;   }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  TFile *SplineFile = <span class="keyword">new</span> TFile(FileName.c_str(), <span class="stringliteral">&quot;recreate&quot;</span>);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  TTree *Settings = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;Settings&quot;</span>, <span class="stringliteral">&quot;Settings&quot;</span>);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  TTree *Monolith = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;Monolith&quot;</span>, <span class="stringliteral">&quot;Monolith&quot;</span>);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  TTree *ParamInfo = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;ParamInfo&quot;</span>, <span class="stringliteral">&quot;ParamInfo&quot;</span>);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  TTree *XKnots = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;XKnots&quot;</span>, <span class="stringliteral">&quot;XKnots&quot;</span>);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  TTree *EventInfo = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;EventInfo&quot;</span>, <span class="stringliteral">&quot;EventInfo&quot;</span>);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  TTree *FastSplineInfoTree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;FastSplineInfoTree&quot;</span>, <span class="stringliteral">&quot;FastSplineInfoTree&quot;</span>);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160; </div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NEvents_temp = <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="keywordtype">short</span> <span class="keywordtype">int</span> nParams_temp = <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="keywordtype">int</span> _max_knots_temp = <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a>;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nKnots_temp = <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NSplines_valid_temp = <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  Settings-&gt;Branch(<span class="stringliteral">&quot;NEvents&quot;</span>, &amp;NEvents_temp, <span class="stringliteral">&quot;NEvents/i&quot;</span>);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  Settings-&gt;Branch(<span class="stringliteral">&quot;nParams&quot;</span>, &amp;nParams_temp, <span class="stringliteral">&quot;nParams/S&quot;</span>);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  Settings-&gt;Branch(<span class="stringliteral">&quot;_max_knots&quot;</span>, &amp;_max_knots_temp, <span class="stringliteral">&quot;_max_knots/I&quot;</span>);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  Settings-&gt;Branch(<span class="stringliteral">&quot;nKnots&quot;</span>, &amp;nKnots_temp, <span class="stringliteral">&quot;nKnots/i&quot;</span>);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  Settings-&gt;Branch(<span class="stringliteral">&quot;NSplines_valid&quot;</span>, &amp;NSplines_valid_temp, <span class="stringliteral">&quot;NSplines_valid/i&quot;</span>);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  Settings-&gt;Fill();</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  SplineFile-&gt;cd();</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  Settings-&gt;Write();</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160; </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="keywordtype">float</span> coeff = 0.;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  Monolith-&gt;Branch(<span class="stringliteral">&quot;cpu_coeff_many&quot;</span>, &amp;coeff, <span class="stringliteral">&quot;cpu_coeff_many/F&quot;</span>);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>*<a class="code" href="SplineCommon_8h.html#a283177311bade7400c6088e8fad71a1f">_nCoeff_</a>; i++)</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    coeff = <a class="code" href="classSMonolith.html#a40b079264ca625f263c6016826a8a3d3">cpu_coeff_many</a>[i];</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    Monolith-&gt;Fill();</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  SplineFile-&gt;cd();</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  Monolith-&gt;Write();</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordtype">short</span> <span class="keywordtype">int</span> paramNo_arr = 0;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nKnots_arr = 0;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  ParamInfo-&gt;Branch(<span class="stringliteral">&quot;cpu_paramNo_arr&quot;</span>, &amp;paramNo_arr, <span class="stringliteral">&quot;cpu_paramNo_arr/S&quot;</span>);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  ParamInfo-&gt;Branch(<span class="stringliteral">&quot;cpu_nKnots_arr&quot;</span>, &amp;nKnots_arr, <span class="stringliteral">&quot;cpu_nKnots_arr/i&quot;</span>);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>; i++)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    paramNo_arr = <a class="code" href="classSMonolith.html#a2ff1205fce2c0f5a8066fa531c49615c">cpu_paramNo_arr</a>[i];</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    nKnots_arr = <a class="code" href="classSMonolith.html#a81d1bc991ef8d4739174b8d6abe26635">cpu_nKnots_arr</a>[i];</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    ParamInfo-&gt;Fill();</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  SplineFile-&gt;cd();</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  ParamInfo-&gt;Write();</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event_size_max = <a class="code" href="classSMonolith.html#ac0d1df54649909e4cee3385f68132799">_max_knots</a> * <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="keywordtype">float</span> coeff_x = 0.;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  XKnots-&gt;Branch(<span class="stringliteral">&quot;cpu_coeff_x&quot;</span>, &amp;coeff_x, <span class="stringliteral">&quot;cpu_coeff_x/F&quot;</span>);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; event_size_max; i++)</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  {</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    coeff_x = <a class="code" href="classSMonolith.html#aef5fe64b8717e8e336acf95b79d3007e">cpu_coeff_x</a>[i];</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    XKnots-&gt;Fill();</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  SplineFile-&gt;cd();</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  XKnots-&gt;Write();</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nParamPerEvent = 0;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  EventInfo-&gt;Branch(<span class="stringliteral">&quot;cpu_nParamPerEvent&quot;</span>, &amp;nParamPerEvent, <span class="stringliteral">&quot;cpu_nParamPerEvent/i&quot;</span>);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 2*<a class="code" href="classSMonolith.html#a419c7eb29dfa7187b52d18c430763721">NSplines_total</a>; i++)</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  {</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    nParamPerEvent = <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[i];</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    EventInfo-&gt;Fill();</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  SplineFile-&gt;cd();</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  EventInfo-&gt;Write();</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> nPoints = 0;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="keywordtype">float</span> xtemp[20];</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  FastSplineInfoTree-&gt;Branch(<span class="stringliteral">&quot;nPts&quot;</span>, &amp;nPoints, <span class="stringliteral">&quot;nPts/I&quot;</span>);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  FastSplineInfoTree-&gt;Branch(<span class="stringliteral">&quot;xPts&quot;</span>, xtemp, <span class="stringliteral">&quot;xPts[nPts]/F&quot;</span>);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> i = 0; i &lt; <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>; ++i)</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    nPoints = <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#a2644b71e4993fba6cabe5f21c9ab44de">nPts</a>;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> k = 0; k &lt; <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#a2644b71e4993fba6cabe5f21c9ab44de">nPts</a>; ++k)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      xtemp[k] = <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#aefbec11dd80b991ec507f4dc2fbefea0">xPts</a>[k];</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    FastSplineInfoTree-&gt;Fill();</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  SplineFile-&gt;cd();</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  FastSplineInfoTree-&gt;Write();</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160; </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="keyword">delete</span> Settings;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keyword">delete</span> Monolith;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keyword">delete</span> ParamInfo;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keyword">delete</span> XKnots;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keyword">delete</span> EventInfo;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keyword">delete</span> FastSplineInfoTree;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  SplineFile-&gt;Close();</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keyword">delete</span> SplineFile;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8c71919669fbcd9a2b1cbc0d4a463b84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c71919669fbcd9a2b1cbc0d4a463b84">&#9670;&nbsp;</a></span>ReduceTF1()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; std::vector&lt; <a class="el" href="classTF1__red.html">TF1_red</a> * &gt; &gt; SMonolith::ReduceTF1 </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; TF1 * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Reduced the TF1 to <a class="el" href="classTF1__red.html" title="CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...">TF1_red</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of <a class="el" href="classTF1__red.html" title="CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...">TF1_red</a> pointers which we strip back </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01316">1316</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;                                                                                              {</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment">// *********************************</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  std::vector&lt;std::vector&lt;TF1*&gt; &gt;::iterator OuterIt;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  std::vector&lt;TF1*&gt;::iterator InnerIt;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160; </div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  <span class="comment">// The return vector</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  std::vector&lt;std::vector&lt;TF1_red*&gt; &gt; ReducedVector;</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  ReducedVector.reserve(MasterSpline.size());</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160; </div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  <span class="comment">// Loop over each parameter</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <span class="keywordtype">int</span> OuterCounter = 0;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="keywordflow">for</span> (OuterIt = MasterSpline.begin(); OuterIt != MasterSpline.end(); ++OuterIt, ++OuterCounter) {</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="comment">// Make the temp vector</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    std::vector&lt;TF1_red*&gt; TempVector;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    TempVector.reserve(OuterIt-&gt;size());</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="keywordtype">int</span> InnerCounter = 0;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="comment">// Loop over each TSpline3 pointer</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <span class="keywordflow">for</span> (InnerIt = OuterIt-&gt;begin(); InnerIt != OuterIt-&gt;end(); ++InnerIt, ++InnerCounter) {</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;      <span class="comment">// Here&#39;s our delicious TSpline3 object</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      TF1* spline = (*InnerIt);</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      <span class="comment">// Now make the reduced TSpline3 pointer (which deleted TSpline3)</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;      <a class="code" href="classTF1__red.html">TF1_red</a>* red = NULL;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;      <span class="keywordflow">if</span> (spline != NULL) {</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        red = <span class="keyword">new</span> <a class="code" href="classTF1__red.html">TF1_red</a>(spline);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        (*InnerIt) = spline;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;      }</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      <span class="comment">// Push back onto new vector</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      TempVector.push_back(red);</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    } <span class="comment">// End inner for loop</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    ReducedVector.push_back(TempVector);</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  } <span class="comment">// End outer for loop</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  <span class="comment">// Now have the reduced vector</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  <span class="keywordflow">return</span> ReducedVector;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3638cd29cc7013868d75d7173a29944b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3638cd29cc7013868d75d7173a29944b">&#9670;&nbsp;</a></span>ReduceTSpline3()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; std::vector&lt; <a class="el" href="classTSpline3__red.html">TSpline3_red</a> * &gt; &gt; SMonolith::ReduceTSpline3 </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; TSpline3 * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Reduced the TSpline3 to <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> pointers which we strip back </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01279">1279</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;                                                                                                             {</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="comment">// *********************************</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  std::vector&lt;std::vector&lt;TSpline3*&gt; &gt;::iterator OuterIt;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  std::vector&lt;TSpline3*&gt;::iterator InnerIt;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160; </div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="comment">// The return vector</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  std::vector&lt;std::vector&lt;TSpline3_red*&gt; &gt; ReducedVector;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  ReducedVector.reserve(MasterSpline.size());</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160; </div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="comment">// Loop over each parameter</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="keywordtype">int</span> OuterCounter = 0;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  <span class="keywordflow">for</span> (OuterIt = MasterSpline.begin(); OuterIt != MasterSpline.end(); ++OuterIt, ++OuterCounter) {</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <span class="comment">// Make the temp vector</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    std::vector&lt;TSpline3_red*&gt; TempVector;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    TempVector.reserve(OuterIt-&gt;size());</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <span class="keywordtype">int</span> InnerCounter = 0;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="comment">// Loop over each TSpline3 pointer</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="keywordflow">for</span> (InnerIt = OuterIt-&gt;begin(); InnerIt != OuterIt-&gt;end(); ++InnerIt, ++InnerCounter) {</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      <span class="comment">// Here&#39;s our delicious TSpline3 object</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      TSpline3 *spline = (*InnerIt);</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      <span class="comment">// Now make the reduced TSpline3 pointer</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      <a class="code" href="classTSpline3__red.html">TSpline3_red</a> *red = NULL;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;      <span class="keywordflow">if</span> (spline != NULL) {</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        red = <span class="keyword">new</span> <a class="code" href="classTSpline3__red.html">TSpline3_red</a>(spline);</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        (*InnerIt) = spline;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;      }</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      <span class="comment">// Push back onto new vector</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      TempVector.push_back(red);</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    } <span class="comment">// End inner for loop</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    ReducedVector.push_back(TempVector);</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  } <span class="comment">// End outer for loop</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <span class="comment">// Now have the reduced vector</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  <span class="keywordflow">return</span> ReducedVector;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a80a8b4afea2815cf3bbf29342df7dfd5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80a8b4afea2815cf3bbf29342df7dfd5">&#9670;&nbsp;</a></span>retPointer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const float* SMonolith::retPointer </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Get pointer to total weight to make fit faster wrooom! </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>Name event number in used MC </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to the total weight </dd></dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00052">52</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;{<span class="keywordflow">return</span> &amp;<a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>[event];}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a5c13fbe5906362cc6e7954cb367b7c11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c13fbe5906362cc6e7954cb367b7c11">&#9670;&nbsp;</a></span>ScanMasterSpline() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::ScanMasterSpline </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classTF1__red.html">TF1_red</a> * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>NEvents</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>MaxPoints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short int &amp;&#160;</td>
          <td class="paramname"><em>numParams</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Function to scan through the MasterSpline of TF1. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of <a class="el" href="classTF1__red.html" title="CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...">TF1_red</a> pointers which we strip back </td></tr>
    <tr><td class="paramname">NEvents</td><td>Number of MC events </td></tr>
    <tr><td class="paramname">MaxPoints</td><td>Maximal number of knots per splines </td></tr>
    <tr><td class="paramname">numParams</td><td>Total number of parameters </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01183">1183</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                                                                                                                                            {</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160; </div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  <span class="comment">// Need to extract: the total number of events</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="comment">//                  number of parameters</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="comment">//                  maximum number of knots</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  MaxPoints = 0;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  nEvents   = 0;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  numParams   = 0;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160; </div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  std::vector&lt;std::vector&lt;TF1_red*&gt; &gt;::iterator OuterIt;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  std::vector&lt;TF1_red*&gt;::iterator InnerIt;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160; </div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="comment">// Check the number of events</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  nEvents = MasterSpline.size();</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EventCounter = 0;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="comment">// Loop over each parameter</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  <span class="keywordflow">for</span> (OuterIt = MasterSpline.begin(); OuterIt != MasterSpline.end(); ++OuterIt) {</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="comment">// Check that each event has each spline saved</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="keywordflow">if</span> (numParams &gt; 0) {</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      <span class="keywordtype">int</span> TempSize = (*OuterIt).size();</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      <span class="keywordflow">if</span> (TempSize != numParams) {</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Found {} parameters for event {}&quot;</span>, TempSize, EventCounter);</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;but was expecting {} since that&#39;s what I found for the previous event&quot;</span>, numParams);</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Somehow this event has a different number of spline parameters... Please study further!&quot;</span>);</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      }</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    }</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    numParams = (*OuterIt).size();</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160; </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="comment">// Loop over each pointer</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="keywordflow">for</span> (InnerIt = OuterIt-&gt;begin(); InnerIt != OuterIt-&gt;end(); ++InnerIt) {</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      <span class="keywordflow">if</span> ((*InnerIt) == NULL) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      <span class="keywordtype">int</span> nPoints = (*InnerIt)-&gt;GetSize();</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;      <span class="keywordflow">if</span> (nPoints &gt; MaxPoints) {</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        MaxPoints = nPoints;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    }</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    EventCounter++;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  }</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a98a140b54edcdb31e80d6e7b2f14c4cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98a140b54edcdb31e80d6e7b2f14c4cb">&#9670;&nbsp;</a></span>ScanMasterSpline() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::ScanMasterSpline </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classTSpline3__red.html">TSpline3_red</a> * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>NEvents</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>MaxPoints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short int &amp;&#160;</td>
          <td class="paramname"><em>numParams</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>nSplines</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>numKnots</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Function to scan through the MasterSpline of TSpline3. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> pointers which we strip back </td></tr>
    <tr><td class="paramname">NEvents</td><td>Number of MC events </td></tr>
    <tr><td class="paramname">MaxPoints</td><td>Maximal number of knots per splines </td></tr>
    <tr><td class="paramname">numParams</td><td>Total number of parameters </td></tr>
    <tr><td class="paramname">numKnots</td><td>Total number of knots, which is sum of individual knots per each spline </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l01086">1086</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                                                                                                                                                                                        {</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="comment">// Need to extract: the total number of events</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="comment">//                  number of parameters</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="comment">//                  maximum number of knots</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  MaxPoints = 0;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  nEvents   = 0;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  numParams   = 0;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  nSplines = 0;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  numKnots = 0;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  std::vector&lt;std::vector&lt;TSpline3_red*&gt; &gt;::iterator OuterIt;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  std::vector&lt;TSpline3_red*&gt;::iterator InnerIt;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160; </div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="comment">// Check the number of events</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  nEvents = MasterSpline.size();</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160; </div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <span class="comment">// Maximum number of splines one event can have (scan through and find this number)</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  <span class="keywordtype">int</span> nMaxSplines_PerEvent = 0;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  <span class="comment">//KS: We later check that each event has the same number of splines so this is fine</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  numParams = MasterSpline[0].size();</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <span class="comment">// Initialise</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a> = <span class="keyword">new</span> <a class="code" href="structFastSplineInfo.html">FastSplineInfo</a>[numParams];</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160; </div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EventCounter = 0;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  <span class="comment">// Loop over each parameter</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <span class="keywordflow">for</span> (OuterIt = MasterSpline.begin(); OuterIt != MasterSpline.end(); ++OuterIt) {</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="comment">// Check that each event has each spline saved</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="keywordflow">if</span> (numParams &gt; 0) {</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <span class="keywordtype">int</span> TempSize = (*OuterIt).size();</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      <span class="keywordflow">if</span> (TempSize != numParams) {</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Found {} parameters for event {}&quot;</span>, TempSize, EventCounter);</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;but was expecting {} since that&#39;s what I found for the previous event&quot;</span>, numParams);</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Somehow this event has a different number of spline parameters... Please study further!&quot;</span>);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      }</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    }</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    numParams = (*OuterIt).size();</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160; </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="keywordtype">int</span> nSplines_SingleEvent = 0;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="comment">// Loop over each pointer</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <span class="keywordtype">int</span> ij = 0;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="keywordflow">for</span> (InnerIt = OuterIt-&gt;begin(); InnerIt != OuterIt-&gt;end(); ++InnerIt, ij++) {</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      <span class="keywordflow">if</span> ((*InnerIt) == NULL) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      <span class="keywordtype">int</span> nPoints = (*InnerIt)-&gt;GetNp();</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      <span class="keywordflow">if</span> (nPoints &gt; MaxPoints) {</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        MaxPoints = nPoints;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      }</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      numKnots += nPoints;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      nSplines_SingleEvent++;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      </div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      <span class="comment">// Fill the SplineInfoArray entries with information on each splinified parameter</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[ij].xPts == NULL)</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      {</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        <span class="comment">// Fill the number of points</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[ij].<a class="code" href="structFastSplineInfo.html#a2644b71e4993fba6cabe5f21c9ab44de">nPts</a> = (*InnerIt)-&gt;GetNp();</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; </div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <span class="comment">// Fill the x points</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[ij].<a class="code" href="structFastSplineInfo.html#aefbec11dd80b991ec507f4dc2fbefea0">xPts</a> = <span class="keyword">new</span> <a class="code" href="Structs_8h.html#a44b939bf69f41920331b7d7a74d2d436">_float_</a>[<a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[ij].<a class="code" href="structFastSplineInfo.html#a2644b71e4993fba6cabe5f21c9ab44de">nPts</a>];</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> k = 0; k &lt; <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[ij].<a class="code" href="structFastSplineInfo.html#a2644b71e4993fba6cabe5f21c9ab44de">nPts</a>; ++k)</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        {</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;          <a class="code" href="Structs_8h.html#a44b939bf69f41920331b7d7a74d2d436">_float_</a> xtemp = -999.99;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;          <a class="code" href="Structs_8h.html#a44b939bf69f41920331b7d7a74d2d436">_float_</a> ytemp = -999.99;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;          (*InnerIt)-&gt;GetKnot(k, xtemp, ytemp);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;          <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[ij].<a class="code" href="structFastSplineInfo.html#aefbec11dd80b991ec507f4dc2fbefea0">xPts</a>[k] = xtemp;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        }</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      }</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160; </div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <span class="keywordflow">if</span> (nSplines_SingleEvent &gt; nMaxSplines_PerEvent) nMaxSplines_PerEvent = nSplines_SingleEvent;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    EventCounter++;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  }</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  nSplines = nMaxSplines_PerEvent;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="keywordtype">int</span> Counter = 0;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="comment">//KS: Sanity check that everything was set correctly</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> i = 0; i &lt; numParams; ++i)</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  {</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keyword">const</span> <a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> nPoints = <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#a2644b71e4993fba6cabe5f21c9ab44de">nPts</a>;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="keyword">const</span> <a class="code" href="Structs_8h.html#a44b939bf69f41920331b7d7a74d2d436">_float_</a>* xArray = <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="structFastSplineInfo.html#aefbec11dd80b991ec507f4dc2fbefea0">xPts</a>;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">if</span> (nPoints == -999 || xArray == NULL) {</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      Counter++;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      <span class="keywordflow">if</span>(Counter &lt; 5)</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      {</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;SplineInfoArray[{}] isn&#39;t set yet&quot;</span>, i);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      }</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <span class="comment">//throw;</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    }</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  }</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;In total SplineInfoArray for {} hasn&#39;t been initialised&quot;</span>, Counter);</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a40f6b9256a18fa59009e5961aec776ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40f6b9256a18fa59009e5961aec776ff">&#9670;&nbsp;</a></span>setSplinePointers()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::setSplinePointers </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; const double * &gt;&#160;</td>
          <td class="paramname"><em>spline_ParsPointers</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Set pointers to spline params. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spline_ParsPointers</td><td>Vector of pointers to spline params </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00056">56</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                                                                                  {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <a class="code" href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">splineParsPointer</a> = spline_ParsPointers;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="Structs_8h.html#a030da8f8f9cd4bb0517b2cc0de3a9d5f">_int_</a> i = 0; i &lt; <a class="code" href="classSMonolith.html#a4606b53f321992377d420a838c76ab3b">nParams</a>; ++i) <a class="code" href="classSMonolith.html#a50a4ad58aebffdb820626f855bae6821">SplineInfoArray</a>[i].<a class="code" href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">splineParsPointer</a> = spline_ParsPointers[i];</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    };</div>
</div><!-- fragment -->
</div>
</div>
<a id="a68e18d73ed1ac524ceaea79d2a5460ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68e18d73ed1ac524ceaea79d2a5460ce">&#9670;&nbsp;</a></span>SynchroniseMemTransfer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::SynchroniseMemTransfer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: After calculations are done on GPU we copy memory to CPU. This operation is asynchronous meaning while memory is being copied some operations are being carried. Memory must be copied before actual reweight. This function make sure all has been copied. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00041">41</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">      #ifdef CUDA</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      <a class="code" href="gpuSplineUtils_8cu.html#a953e5c5aecebd908f5d8c6ad64de482c">SynchroniseSplines</a>();</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">      #endif</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    };</div>
<div class="ttc" id="agpuSplineUtils_8cu_html_a953e5c5aecebd908f5d8c6ad64de482c"><div class="ttname"><a href="gpuSplineUtils_8cu.html#a953e5c5aecebd908f5d8c6ad64de482c">SynchroniseSplines</a></div><div class="ttdeci">__host__ void SynchroniseSplines()</div><div class="ttdoc">Make sure all Cuda threads finished execution.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00797">gpuSplineUtils.cu:797</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ac0d1df54649909e4cee3385f68132799"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0d1df54649909e4cee3385f68132799">&#9670;&nbsp;</a></span>_max_knots</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int SMonolith::_max_knots</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Max knots for production. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00148">148</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a40b079264ca625f263c6016826a8a3d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40b079264ca625f263c6016826a8a3d3">&#9670;&nbsp;</a></span>cpu_coeff_many</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;float&gt; SMonolith::cpu_coeff_many</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU arrays to hold other coefficients. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00193">193</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="aef5fe64b8717e8e336acf95b79d3007e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef5fe64b8717e8e336acf95b79d3007e">&#9670;&nbsp;</a></span>cpu_coeff_x</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;float&gt; SMonolith::cpu_coeff_x</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: CPU arrays to hold X coefficient. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00189">189</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a81d1bc991ef8d4739174b8d6abe26635"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81d1bc991ef8d4739174b8d6abe26635">&#9670;&nbsp;</a></span>cpu_nKnots_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;unsigned int&gt; SMonolith::cpu_nKnots_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: CPU Number of knots per spline. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00185">185</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a0a6599372d1e3d38105478a68308d9a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a6599372d1e3d38105478a68308d9a6">&#9670;&nbsp;</a></span>cpu_nParamPerEvent</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;unsigned int&gt; SMonolith::cpu_nParamPerEvent</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00171">171</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a14b9c21186a53196f49c8d8d3555fbf2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14b9c21186a53196f49c8d8d3555fbf2">&#9670;&nbsp;</a></span>cpu_nPoints_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;short int&gt; SMonolith::cpu_nPoints_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU arrays to hold number of points. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00176">176</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a2ff1205fce2c0f5a8066fa531c49615c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ff1205fce2c0f5a8066fa531c49615c">&#9670;&nbsp;</a></span>cpu_paramNo_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;short int&gt; SMonolith::cpu_paramNo_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: CPU array with the number of points per spline (not per spline point!) </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00181">181</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ab572dd7e0a46caf44eb925a89cbfb0cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab572dd7e0a46caf44eb925a89cbfb0cf">&#9670;&nbsp;</a></span>cpu_total_weights</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::cpu_total_weights</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>KS: This holds the total CPU weights that gets read in samplePDFND. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00064">64</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a8614e8ef07431d99f62ab88d9ebdad16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8614e8ef07431d99f62ab88d9ebdad16">&#9670;&nbsp;</a></span>cpu_weights</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::cpu_weights</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The returned gpu weights, read by the GPU. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00062">62</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ab6a29f13d8e6efb380f2b9d59cfa88fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6a29f13d8e6efb380f2b9d59cfa88fc">&#9670;&nbsp;</a></span>cpu_weights_var</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::cpu_weights_var</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU arrays to hold weight for each spline. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00168">168</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ad48ce38bdd62d27df5405fdbf7dbc0c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad48ce38bdd62d27df5405fdbf7dbc0c7">&#9670;&nbsp;</a></span>gpu_coeff_many</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::gpu_coeff_many</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>GPU arrays to hold other coefficients. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00195">195</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a3eb59435b695f7f9653f027e49e4b33f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3eb59435b695f7f9653f027e49e4b33f">&#9670;&nbsp;</a></span>gpu_coeff_x</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::gpu_coeff_x</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: GPU arrays to hold X coefficient. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00191">191</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a0ff9a70ffa877c13f6aa53a44e447e39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ff9a70ffa877c13f6aa53a44e447e39">&#9670;&nbsp;</a></span>gpu_nKnots_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int* SMonolith::gpu_nKnots_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: GPU Number of knots per spline. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00187">187</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ac6656d53aaefa0db75f4cf57aa517dbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6656d53aaefa0db75f4cf57aa517dbf">&#9670;&nbsp;</a></span>gpu_nParamPerEvent</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int* SMonolith::gpu_nParamPerEvent</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: GPU map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00173">173</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a2e36f546602e0d375dcbacd8771369c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e36f546602e0d375dcbacd8771369c7">&#9670;&nbsp;</a></span>gpu_nPoints_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">short int* SMonolith::gpu_nPoints_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>GPU arrays to hold number of points. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00178">178</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a6aaa90b9158e01743235a465fd80caaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6aaa90b9158e01743235a465fd80caaf">&#9670;&nbsp;</a></span>gpu_paramNo_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">short int* SMonolith::gpu_paramNo_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: GPU array with the number of points per spline (not per spline point!) </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00183">183</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a43ffa53dafb6006e7bd23597a402e8b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43ffa53dafb6006e7bd23597a402e8b4">&#9670;&nbsp;</a></span>gpu_total_weights</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::gpu_total_weights</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>GPU arrays to hold weight for event. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00166">166</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a1317bac1e66e5400c59bc4dd9ff3cdd9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1317bac1e66e5400c59bc4dd9ff3cdd9">&#9670;&nbsp;</a></span>gpu_weights</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::gpu_weights</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>GPU arrays to hold weight for each spline. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00164">164</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ae9fa50f60f717558f517faea6a38d251"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9fa50f60f717558f517faea6a38d251">&#9670;&nbsp;</a></span>index_cpu</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int* SMonolith::index_cpu</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>holds the index for good splines; don't do unsigned since starts with negative value! </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00150">150</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ac86282b04659bae5cccb6073c9edc0a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac86282b04659bae5cccb6073c9edc0a5">&#9670;&nbsp;</a></span>NEvents</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::NEvents</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of events. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00144">144</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="afc0e3d1eafd575cf7628319a66925d5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc0e3d1eafd575cf7628319a66925d5b">&#9670;&nbsp;</a></span>nKnots</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::nKnots</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sum of all knots over all splines. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00161">161</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a4606b53f321992377d420a838c76ab3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4606b53f321992377d420a838c76ab3b">&#9670;&nbsp;</a></span>nParams</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">short int SMonolith::nParams</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of NIWG parameters that have splines. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00146">146</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a419c7eb29dfa7187b52d18c430763721"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a419c7eb29dfa7187b52d18c430763721">&#9670;&nbsp;</a></span>NSplines_total</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::NSplines_total</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of total splines we can maximally have, if each event had the maximum number of splines found across all events. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00155">155</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="aee3c18513f8209f1ac940b492cd3ed68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee3c18513f8209f1ac940b492cd3ed68">&#9670;&nbsp;</a></span>NSplines_total_large</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::NSplines_total_large</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of total splines if each event had every parameter's spline. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00158">158</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ab72795333d6f632565b0f7eb0ca8a658"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab72795333d6f632565b0f7eb0ca8a658">&#9670;&nbsp;</a></span>NSplines_valid</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::NSplines_valid</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of valid splines. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00153">153</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ab5692081772ca14bd012eb125e2ccfd4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5692081772ca14bd012eb125e2ccfd4">&#9670;&nbsp;</a></span>SaveSplineFile</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool SMonolith::SaveSplineFile</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Flag telling whether we are saving spline monolith into handy root file. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00198">198</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a53ab5b2235fd697f27556f1a1a7a5354"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53ab5b2235fd697f27556f1a1a7a5354">&#9670;&nbsp;</a></span>segments</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">short int* SMonolith::segments</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Store currently found segment they are not in <a class="el" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.">FastSplineInfo</a> as in case of GPU we need to copy paste it to GPU. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00137">137</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a50a4ad58aebffdb820626f855bae6821"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50a4ad58aebffdb820626f855bae6821">&#9670;&nbsp;</a></span>SplineInfoArray</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structFastSplineInfo.html">FastSplineInfo</a>* SMonolith::SplineInfoArray</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Array of <a class="el" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.">FastSplineInfo</a> structs: keeps information on each xsec spline for fast evaluation Method identical to TSpline3::Eval(double) but faster because less operations </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00135">135</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="afa782652b0b3da923c5b20bb1319aadd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa782652b0b3da923c5b20bb1319aadd">&#9670;&nbsp;</a></span>splineParsPointer</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; const double* &gt; SMonolith::splineParsPointer</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This holds pointer to parameter position which we later copy paste it to GPU. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00141">141</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="aa2a793b82a6c650a6fad52510e49b6b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2a793b82a6c650a6fad52510e49b6b0">&#9670;&nbsp;</a></span>vals</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::vals</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Store parameter values they are not in <a class="el" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.">FastSplineInfo</a> as in case of GPU we need to copy paste it to GPU. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00139">139</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/hosthome/v1.1.0/splines/<a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a></li>
<li>/hosthome/v1.1.0/splines/<a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a></li>
</ul>
</div><!-- contents -->
<footer class="mach3-footer" style="text-align: center;">
    <div style="margin-bottom: 15px;">
        <span style="font-weight: bold;">The MaCh3 Collaboration</span>
    </div>
    <div style="margin-bottom: 10px;">
        <span>Select Software Version: </span>
        <select id="versionSelector" onchange="window.location.href=this.value" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="">-- Select --</option>
            <option value="https://mach3-software.github.io/MaCh3/">develop</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.2.0/index.html">v2.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.1.0/index.html">v2.1.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.0.0/index.html">v2.0.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.5.0/index.html">v1.5.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.4.0/index.html">v1.4.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.3.0/index.html">v1.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.2.0/index.html">v1.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.1.0/index.html">v1.1.0</option>
        </select>
    </div>
    <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
        Documentation generated with <a href="https://www.doxygen.nl/" target="_blank" style="color: #666;">Doxygen</a>
    </div>
</footer>
