<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MaCh3: MaCh3 &lt;img src=&quot;Doc/mach3logo.png&quot; alt=&quot;MaCh3&quot; align=&quot;center&quot; width=&quot;100&quot;/&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mach3logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MaCh3
   &#160;<span id="projectnumber">1.1.0</span>
   </div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">MaCh3 <img src="Doc/mach3logo.png" alt="MaCh3" align="center" width="100" class="inline"/> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Markov Chain 3 flavour is a framework born in 2013 as a Bayesian MCMC fitter for <a href="https://t2k-experiment.org/pl/">T2K</a> oscillation analysis. It has now been used for multiple T2K Oscillation analyses both at the Near and Far detectors throughout the years and is also used by the DUNE and HK oscillation analysis groups as well as for joint fits between T2K and NOvA and T2K and SK's atmospheric data.</p>
<p>The framework has also evolved to allow non MCMC modules to interrogate the likelihoods implemented.</p>
<p><a href="https://github.com/mach3-software/MaCh3/blob/develop/LICENSE.txt"><img src="https://img.shields.io/badge/License-BSD_3--Clause-blue.svg" alt="License" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/mach3-software/MaCh3/releases"><img src="https://img.shields.io/badge/Release-v1.0.0-2ea44f" alt="Release - v1.0.0" class="inline"/></a> <a href="https://github.com/mach3-software/MaCh3/pkgs/container/mach3"><img src="https://img.shields.io/badge/Container-Image-brightgreen" alt="Container Image" class="inline"/></a> <a href="https://github.com/mach3-software/MaCh3/wiki"><img src="https://img.shields.io/badge/Code-Documented-2ea44f" alt="Code - Documented" class="inline"/></a> <a href="https://mach3-software.github.io/MaCh3/index.html"><img src="https://img.shields.io/badge/Code-Doxygen-2ea44f" alt="Code - Doxygen" class="inline"/></a> <a href="https://github.com/mach3-software/MaCh3/actions/workflows/CIBuild.yml"><img src="https://github.com/mach3-software/MaCh3/actions/workflows/CIBuild.yml/badge.svg" alt="Build CI" style="pointer-events: none;" class="inline"/></a> </p>
<h1><a class="anchor" id="autotoc_md9"></a>
Famous Plots</h1>
<p>Example of plots made using MaCh3 apparent in scientific publications, for more see <a href="https://github.com/mach3-software/MaCh3/wiki/14.-MaCh3-in-the-Field">here</a> <img src="Doc/Plots/delta.png" alt="MaCh3" align="left" width="200" class="inline"/> <img src="Doc/Plots/Jarlskog.png" alt="MaCh3" align="center" width="200" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md10"></a>
Cite</h1>
<p>When citing MaCh3, please use <a href="https://zenodo.org/records/10949376">on Zenodo</a> <a href="https://doi.org/10.5281/zenodo.10949376"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.10949376.svg" alt="DOI" style="pointer-events: none;" class="inline"/></a>.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
How to Compile</h1>
<p>MaCh3 follows standard cmake pattern. By default you should get most optimal build setting although below we list many configurable options: </p><div class="fragment"><div class="line">mkdir build;</div>
<div class="line">cd build;</div>
<div class="line">cmake ../</div>
<div class="line">make -jN [set number of threads]</div>
<div class="line">make install</div>
</div><!-- fragment --><p>Don't forget to: </p><div class="fragment"><div class="line">source bin/setup.MaCh3.sh</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md12"></a>
Building against MaCh3</h2>
<p>If you compiled MaCh3 and sourced it you can simply call </p><div class="fragment"><div class="line">find_package(MaCh3)</div>
</div><!-- fragment --><p> and cmake will find it. Alternatively, you can use CPM, for example: </p><div class="fragment"><div class="line">CPMFindPackage(</div>
<div class="line">  NAME MaCh3</div>
<div class="line">  GIT_TAG &quot;blarb&quot;</div>
<div class="line">  GITHUB_REPOSITORY mach3-software/MaCh3</div>
<div class="line">)</div>
</div><!-- fragment --><p> Once you found MaCh3 you might want to link your library against MaCh3. You can do this as follows: </p><div class="fragment"><div class="line">target_link_libraries(blarb MaCh3::All)</div>
</div><!-- fragment --><p>Some functionalities rely on setting <code>Env{MACH3}</code> which should point to path experiment specific MaCh3. This way MaCh3 can easily find <code>Env{MACH3}/inputs/SomeInput.root</code> for example.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Python</h2>
<p>MaCh3 can be compiled with a python interface by specifying the cmake option </p><div class="fragment"><div class="line">cmake ../ MaCh3_PYTHON_ENABLED=ON</div>
<div class="line">make &amp;&amp; make install</div>
</div><!-- fragment --><p> and then adding the path to the installed module to your <code>PYTHONPATH</code> environment variable: </p><div class="fragment"><div class="line">export PYTHONPATH=$PYTHONPATH:&lt;path&gt;/&lt;to&gt;/&lt;MaCh3&gt;/build/python</div>
</div><!-- fragment --><p> Currently the python module only contains an interface to the plotting library (see <a href="https://github.com/mach3-software/MaCh3/blob/develop/plotting/README.md#python">here</a> for more information on how to use it)</p>
<h3><a class="anchor" id="autotoc_md14"></a>
Building with Pip</h3>
<p>Additionally you can build just the python module by doing </p><div class="fragment"><div class="line">pip install -t &lt;install location&gt; .</div>
</div><!-- fragment --><p> The -t option specifies an install location which can be useful if you are on a computing cluster and don't have write access to the default install location. If you specify a non-standard location you will need to add it to your <code>PYTHONPATH</code> as above so that python can find the module.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Multithreading</h2>
<p>MaCh3 quite heavily relies on Multithreading, it is turned on by default. If for debugging purposes you would like to turn it off please use</p>
<div class="fragment"><div class="line">cmake ../ [-DMaCh3_MULTITHREAD_ENABLED=&lt;OFF&gt;]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
CUDA</h2>
<p>If the system has access to GPU, MaCh3 will enable GPU functionality automatically. If you would like to CPU only despite having access to CUDA </p><div class="fragment"><div class="line">mkdir build; cd build;</div>
<div class="line">cmake ../ [-USE_CPU=ON]</div>
</div><!-- fragment --><p> MaCh3 supports quite a high range of CUDA architectures if something doesn't work on your GPU let us know. MaCh3 supports only NVIDIA GPUs.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
Oscillator</h2>
<p>MaCh3 uses several neutrino oscillation calculators. By default, CUDAProb3 is used. If you would like to use Prob3++</p>
<div class="fragment"><div class="line">cmake ../ [-DUSE_PROB3=&lt;ON,OFF&gt;]</div>
</div><!-- fragment --><p> Following neutrino oscillation calculators are available:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a class="el" href="classOscillator.html">Oscillator</a>   </th><th class="markdownTableHeadNone">Hardware   </th><th class="markdownTableHeadNone">Source    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CUDAProb3   </td><td class="markdownTableBodyNone">CPU/GPU   </td><td class="markdownTableBodyNone">Beam/Atm    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Prob3++   </td><td class="markdownTableBodyNone">CPU   </td><td class="markdownTableBodyNone">Beam    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">probGPU   </td><td class="markdownTableBodyNone">GPU   </td><td class="markdownTableBodyNone">Beam   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md18"></a>
Fitting algorithms</h2>
<p>The following fitting algorithms are available:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Algorithm   </th><th class="markdownTableHeadNone">Need Ext Library    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MR2T2   </td><td class="markdownTableBodyNone">No    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">MINUIT2   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="classPSO.html" title="Class PSO, consist of a vector of object Class Particle and global best Takes in the size (number of ...">PSO</a>   </td><td class="markdownTableBodyNone">No   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md19"></a>
Debug</h2>
<p>Several debugging options are available which are heavy for RAM and performance and, therefore not used by default. To enable it: </p><div class="fragment"><div class="line">cmake ../ [-DMaCh3_DEBUG_ENABLED=&lt;ON,OFF&gt;]</div>
</div><!-- fragment --><p> There are several debug modes, to enable more detailed but very heavy specific debug levels. Level 1 is the default debug activated by the above.</p>
<div class="fragment"><div class="line">cmake ../ [-DMaCh3_DEBUG_ENABLED=&lt;ON,OFF&gt;] [-DDEBUG_LEVEL=&lt;1,2,3&gt;]</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md20"></a>
System Requirements</h2>
<p>Most of external libraries are being handled through CPM. The only external library that is not being handled through CPM and is required is <a href="https://root.cern/">ROOT</a>. Currently used external dependencies include:</p>
<ol type="1">
<li><a href="https://github.com/jbeder/yaml-cpp">yaml-cpp</a></li>
<li><a href="https://github.com/gabime/spdlog">spdlog</a></li>
</ol>
<p>Based on several test here are recommended version: </p><div class="fragment"><div class="line">GCC: &gt;= 8.5 [lower versions may work]</div>
<div class="line">CMake: &gt;= 3.14</div>
<div class="line">ROOT: &gt;= 6.18</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md21"></a>
Supported operational systems</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Status    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Alma9   </td><td class="markdownTableBodyNone">✅    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Ubuntu22.04   </td><td class="markdownTableBodyNone">✅    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Fedora32   </td><td class="markdownTableBodyNone">✅    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">CentOS7   </td><td class="markdownTableBodyNone">❔    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Windows   </td><td class="markdownTableBodyNone">❌   </td></tr>
</table>
<p>✅ - Part of CI/CD <br  />
 ❔ - Not part of CI/CD but used by some users/developers so it might work <br  />
 ❌ - Not supported and no plans right now <br  />
</p>
<h1><a class="anchor" id="autotoc_md22"></a>
How To Use</h1>
<p>This is an example how your executable can look like using MaCh3: </p><div class="fragment"><div class="line">manager *fitMan = nullptr; //Manager is responsible for reading from config</div>
<div class="line"> </div>
<div class="line">std::vector&lt;samplePDFBase*&gt; sample; //vector storing information about sample for different detector</div>
<div class="line">std::vector&lt;covarianceBase*&gt; Cov; // vector with systematic implementation</div>
<div class="line">mcmc *markovChain = nullptr; // MCMC class, can be replaced with other fitting method</div>
<div class="line">MakeMaCh3Instance(fitMan, sample, Cov, markovChain); //Factory like function which initialises everything</div>
<div class="line"> </div>
<div class="line">//Adding samples and covariances to the Fitter class could be in the factory</div>
<div class="line">for(unsigned int i = 0; sample.size(); i++)</div>
<div class="line">  markovChain-&gt;addSamplePDF(sample[i]);</div>
<div class="line">for(unsigned int i = 0; Cov.size(); i++)</div>
<div class="line">  markovChain-&gt;addSystObj(Cov[i]);</div>
<div class="line"> </div>
<div class="line">markovChain-&gt;RunLLHScan(); // can run LLH scan</div>
<div class="line">markovChain-&gt;runMCMC(); //or run actual fit</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md23"></a>
Help and Guidelines</h2>
<ul>
<li><a href="https://github.com/mach3-software/MaCh3/blob/develop/CONTRIBUTING.md">How to contribute</a></li>
<li><a href="https://github.com/mach3-software/MaCh3/wiki">Wiki</a></li>
<li><a href="https://www.jiscmail.ac.uk/cgi-bin/webadmin?A0=MACH3">Mailing lists</a></li>
<li><a href="https://t2k-experiment.slack.com/archives/C06EM0C6D7W/p1705599931356889">Slack</a></li>
<li><a href="https://github.com/mach3-software/MaCh3/discussions">Discussions</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md24"></a>
Plotting and Diagnostic</h3>
<p>Example of chain diagnostic utils can be found <a href="https://github.com/mach3-software/MaCh3/tree/develop/Diagnostics">here</a> with example of config. The MaCh3 core plotting library code can be found <a href="https://github.com/mach3-software/MaCh3/tree/develop/plotting">here</a> along with example config files and some apps for making standard plots. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<footer class="mach3-footer" style="text-align: center;">
    <div style="margin-bottom: 15px;">
        <span style="font-weight: bold;">The MaCh3 Collaboration</span>
    </div>
    <div style="margin-bottom: 10px;">
        <span>Select Software Version: </span>
        <select id="versionSelector" onchange="window.location.href=this.value" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="">-- Select --</option>
            <option value="https://mach3-software.github.io/MaCh3/">develop</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.2.0/index.html">v2.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.1.0/index.html">v2.1.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.0.0/index.html">v2.0.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.5.0/index.html">v1.5.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.4.0/index.html">v1.4.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.3.0/index.html">v1.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.2.0/index.html">v1.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.1.0/index.html">v1.1.0</option>
        </select>
    </div>
    <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
        Documentation generated with <a href="https://www.doxygen.nl/" target="_blank" style="color: #666;">Doxygen</a>
    </div>
</footer>
