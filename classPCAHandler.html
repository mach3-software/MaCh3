<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MaCh3: PCAHandler Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="MaCh3.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mach3logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MaCh3
   &#160;<span id="projectnumber">2.4.2</span>
   </div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classPCAHandler-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">PCAHandler Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Class responsible for handling Principal Component Analysis (PCA) of covariance matrix.  
 <a href="classPCAHandler.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="PCAHandler_8h_source.html">Parameters/PCAHandler.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for PCAHandler:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="classPCAHandler__coll__graph.svg" width="348" height="186"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aabaaecfe5909a6cffbcc0e1a385615fa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#aabaaecfe5909a6cffbcc0e1a385615fa">PCAHandler</a> ()</td></tr>
<tr class="memdesc:aabaaecfe5909a6cffbcc0e1a385615fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="classPCAHandler.html#aabaaecfe5909a6cffbcc0e1a385615fa">More...</a><br /></td></tr>
<tr class="separator:aabaaecfe5909a6cffbcc0e1a385615fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f9957719671d1c673c74b5cd003dc76"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a7f9957719671d1c673c74b5cd003dc76">~PCAHandler</a> ()</td></tr>
<tr class="memdesc:a7f9957719671d1c673c74b5cd003dc76"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <a href="classPCAHandler.html#a7f9957719671d1c673c74b5cd003dc76">More...</a><br /></td></tr>
<tr class="separator:a7f9957719671d1c673c74b5cd003dc76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebcdb9437110e45b8ba844c00f97f184"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#aebcdb9437110e45b8ba844c00f97f184">Print</a> () const</td></tr>
<tr class="memdesc:aebcdb9437110e45b8ba844c00f97f184"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Print info about PCA parameters.  <a href="classPCAHandler.html#aebcdb9437110e45b8ba844c00f97f184">More...</a><br /></td></tr>
<tr class="separator:aebcdb9437110e45b8ba844c00f97f184"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68ca4b7ae6ffe46eea112ed22b0d6dcf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a68ca4b7ae6ffe46eea112ed22b0d6dcf">GetNumberPCAedParameters</a> () const</td></tr>
<tr class="memdesc:a68ca4b7ae6ffe46eea112ed22b0d6dcf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve number of parameters in PCA base.  <a href="classPCAHandler.html#a68ca4b7ae6ffe46eea112ed22b0d6dcf">More...</a><br /></td></tr>
<tr class="separator:a68ca4b7ae6ffe46eea112ed22b0d6dcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a842edaaee2eacb613891ba5bb2f31d9a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a842edaaee2eacb613891ba5bb2f31d9a">SetupPointers</a> (std::vector&lt; double &gt; *fCurr_Val, std::vector&lt; double &gt; *fProp_Val)</td></tr>
<tr class="memdesc:a842edaaee2eacb613891ba5bb2f31d9a"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Setup pointers to current and proposed parameter value which we need to convert them to PCA base each step.  <a href="classPCAHandler.html#a842edaaee2eacb613891ba5bb2f31d9a">More...</a><br /></td></tr>
<tr class="separator:a842edaaee2eacb613891ba5bb2f31d9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7a1ae0e3fcfc6e319c86ae9cec2ac15"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#af7a1ae0e3fcfc6e319c86ae9cec2ac15">ConstructPCA</a> (TMatrixDSym *CovMatrix, const int firstPCAd, const int lastPCAd, const double eigen_thresh, const int _fNumPar)</td></tr>
<tr class="memdesc:af7a1ae0e3fcfc6e319c86ae9cec2ac15"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Calculate eigen values, prepare transition matrices and remove param based on defined threshold.  <a href="classPCAHandler.html#af7a1ae0e3fcfc6e319c86ae9cec2ac15">More...</a><br /></td></tr>
<tr class="separator:af7a1ae0e3fcfc6e319c86ae9cec2ac15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7782b7f998d5a53ab88d76a41ff73fe4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a7782b7f998d5a53ab88d76a41ff73fe4">TransferToPCA</a> ()</td></tr>
<tr class="memdesc:a7782b7f998d5a53ab88d76a41ff73fe4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transfer param values from normal base to PCA base.  <a href="classPCAHandler.html#a7782b7f998d5a53ab88d76a41ff73fe4">More...</a><br /></td></tr>
<tr class="separator:a7782b7f998d5a53ab88d76a41ff73fe4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93e5548b530c1cc6158e62f497ca3c59"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a93e5548b530c1cc6158e62f497ca3c59">TransferToParam</a> ()</td></tr>
<tr class="memdesc:a93e5548b530c1cc6158e62f497ca3c59"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transfer param values from PCA base to normal base.  <a href="classPCAHandler.html#a93e5548b530c1cc6158e62f497ca3c59">More...</a><br /></td></tr>
<tr class="separator:a93e5548b530c1cc6158e62f497ca3c59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1316d16755cb320ea053b4351dbec7b1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a1316d16755cb320ea053b4351dbec7b1">ThrowParameters</a> (const std::vector&lt; std::unique_ptr&lt; TRandom3 &gt;&gt; &amp;random_number, double **throwMatrixCholDecomp, double *randParams, double *corr_throw, const std::vector&lt; double &gt; &amp;fPreFitValue, const std::vector&lt; double &gt; &amp;fLowBound, const std::vector&lt; double &gt; &amp;fUpBound, int _fNumPar)</td></tr>
<tr class="memdesc:a1316d16755cb320ea053b4351dbec7b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Throw the parameters according to the covariance matrix. This shouldn't be used in MCMC code ase it can break Detailed Balance;.  <a href="classPCAHandler.html#a1316d16755cb320ea053b4351dbec7b1">More...</a><br /></td></tr>
<tr class="separator:a1316d16755cb320ea053b4351dbec7b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7298eb3c337becf349d628c3049834f7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a7298eb3c337becf349d628c3049834f7">AcceptStep</a> () <a class="el" href="Core_8h.html#a2abc3d82639661d84964bed9e2df0e68">_noexcept_</a></td></tr>
<tr class="memdesc:a7298eb3c337becf349d628c3049834f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accepted this step.  <a href="classPCAHandler.html#a7298eb3c337becf349d628c3049834f7">More...</a><br /></td></tr>
<tr class="separator:a7298eb3c337becf349d628c3049834f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a733d8b6619a657223113f020db1327a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a733d8b6619a657223113f020db1327a7">CorrelateSteps</a> (const std::vector&lt; double &gt; &amp;IndivStepScale, const double GlobalStepScale, const double *<a class="el" href="Core_8h.html#ab6a7e23420f0bcfb04f42f45f8283101">_restrict_</a> randParams, const double *<a class="el" href="Core_8h.html#ab6a7e23420f0bcfb04f42f45f8283101">_restrict_</a> corr_throw) <a class="el" href="Core_8h.html#a2abc3d82639661d84964bed9e2df0e68">_noexcept_</a></td></tr>
<tr class="memdesc:a733d8b6619a657223113f020db1327a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use Cholesky throw matrix for better step proposal.  <a href="classPCAHandler.html#a733d8b6619a657223113f020db1327a7">More...</a><br /></td></tr>
<tr class="separator:a733d8b6619a657223113f020db1327a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6394496144bfd3d5c7c9ff84e088c05c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a6394496144bfd3d5c7c9ff84e088c05c">SetInitialParameters</a> ()</td></tr>
<tr class="memdesc:a6394496144bfd3d5c7c9ff84e088c05c"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Transfer the starting parameters to the PCA basis, you don't want to start with zero..  <a href="classPCAHandler.html#a6394496144bfd3d5c7c9ff84e088c05c">More...</a><br /></td></tr>
<tr class="separator:a6394496144bfd3d5c7c9ff84e088c05c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30e81eb270628240460a20e2417a4dfc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a30e81eb270628240460a20e2417a4dfc">SetBranches</a> (TTree &amp;tree, const bool SaveProposal, const std::vector&lt; std::string &gt; &amp;Names)</td></tr>
<tr class="memdesc:a30e81eb270628240460a20e2417a4dfc"><td class="mdescLeft">&#160;</td><td class="mdescRight">set branches for output file  <a href="classPCAHandler.html#a30e81eb270628240460a20e2417a4dfc">More...</a><br /></td></tr>
<tr class="separator:a30e81eb270628240460a20e2417a4dfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17507b0213fe0c49a3a8b40dc7d1031e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a17507b0213fe0c49a3a8b40dc7d1031e">ToggleFixAllParameters</a> (const std::vector&lt; std::string &gt; &amp;Names)</td></tr>
<tr class="memdesc:a17507b0213fe0c49a3a8b40dc7d1031e"><td class="mdescLeft">&#160;</td><td class="mdescRight">fix parameters at prior values  <a href="classPCAHandler.html#a17507b0213fe0c49a3a8b40dc7d1031e">More...</a><br /></td></tr>
<tr class="separator:a17507b0213fe0c49a3a8b40dc7d1031e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3f1dcc5f5cf931dbfeefa077c8f74ef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#ac3f1dcc5f5cf931dbfeefa077c8f74ef">ToggleFixParameter</a> (const int i, const std::vector&lt; std::string &gt; &amp;Names)</td></tr>
<tr class="memdesc:ac3f1dcc5f5cf931dbfeefa077c8f74ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">fix parameters at prior values  <a href="classPCAHandler.html#ac3f1dcc5f5cf931dbfeefa077c8f74ef">More...</a><br /></td></tr>
<tr class="separator:ac3f1dcc5f5cf931dbfeefa077c8f74ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af50dcfe6ab3715d66c5b26d6c621b7f4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#af50dcfe6ab3715d66c5b26d6c621b7f4">SetParametersPCA</a> (const std::vector&lt; double &gt; &amp;pars)</td></tr>
<tr class="memdesc:af50dcfe6ab3715d66c5b26d6c621b7f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set values for PCA parameters in PCA base.  <a href="classPCAHandler.html#af50dcfe6ab3715d66c5b26d6c621b7f4">More...</a><br /></td></tr>
<tr class="separator:af50dcfe6ab3715d66c5b26d6c621b7f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5087aa5aba191f31170c1108210cdb26"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a5087aa5aba191f31170c1108210cdb26">IsParameterFixedPCA</a> (const int i) const</td></tr>
<tr class="memdesc:a5087aa5aba191f31170c1108210cdb26"><td class="mdescLeft">&#160;</td><td class="mdescRight">Is parameter fixed in PCA base or not.  <a href="classPCAHandler.html#a5087aa5aba191f31170c1108210cdb26">More...</a><br /></td></tr>
<tr class="separator:a5087aa5aba191f31170c1108210cdb26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd2534e2f1eb2b54e26af6a6da937b3c"><td class="memItemLeft" align="right" valign="top">const TMatrixD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#afd2534e2f1eb2b54e26af6a6da937b3c">GetEigenVectors</a> () const</td></tr>
<tr class="memdesc:afd2534e2f1eb2b54e26af6a6da937b3c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get eigen vectors of covariance matrix, only works with PCA.  <a href="classPCAHandler.html#afd2534e2f1eb2b54e26af6a6da937b3c">More...</a><br /></td></tr>
<tr class="separator:afd2534e2f1eb2b54e26af6a6da937b3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a737c5cad5cdff60c0a945aaddd2a6da3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a737c5cad5cdff60c0a945aaddd2a6da3">SetParPropPCA</a> (const int i, const double value)</td></tr>
<tr class="memdesc:a737c5cad5cdff60c0a945aaddd2a6da3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set proposed value for parameter in PCA base.  <a href="classPCAHandler.html#a737c5cad5cdff60c0a945aaddd2a6da3">More...</a><br /></td></tr>
<tr class="separator:a737c5cad5cdff60c0a945aaddd2a6da3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae232ab07ae839b755912c7e23f3c835f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#ae232ab07ae839b755912c7e23f3c835f">SetParCurrPCA</a> (const int i, const double value)</td></tr>
<tr class="memdesc:ae232ab07ae839b755912c7e23f3c835f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set current value for parameter in PCA base.  <a href="classPCAHandler.html#ae232ab07ae839b755912c7e23f3c835f">More...</a><br /></td></tr>
<tr class="separator:ae232ab07ae839b755912c7e23f3c835f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a42efb45ecf02e0369ca02df5c2d7e7"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a5a42efb45ecf02e0369ca02df5c2d7e7">GetParPropPCA</a> (const int i) const</td></tr>
<tr class="memdesc:a5a42efb45ecf02e0369ca02df5c2d7e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get current parameter value using PCA.  <a href="classPCAHandler.html#a5a42efb45ecf02e0369ca02df5c2d7e7">More...</a><br /></td></tr>
<tr class="separator:a5a42efb45ecf02e0369ca02df5c2d7e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86b25b9f099bf94ab18c20857358d9a2"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a86b25b9f099bf94ab18c20857358d9a2">GetPreFitValuePCA</a> (const int i) const</td></tr>
<tr class="memdesc:a86b25b9f099bf94ab18c20857358d9a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get current parameter value using PCA.  <a href="classPCAHandler.html#a86b25b9f099bf94ab18c20857358d9a2">More...</a><br /></td></tr>
<tr class="separator:a86b25b9f099bf94ab18c20857358d9a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25aceab12943cd55812e80b64adba9d6"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a25aceab12943cd55812e80b64adba9d6">GetParCurrPCA</a> (const int i) const</td></tr>
<tr class="memdesc:a25aceab12943cd55812e80b64adba9d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get current parameter value using PCA.  <a href="classPCAHandler.html#a25aceab12943cd55812e80b64adba9d6">More...</a><br /></td></tr>
<tr class="separator:a25aceab12943cd55812e80b64adba9d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2465505aca46f8c0503ad97126684a1e"><td class="memItemLeft" align="right" valign="top">const TMatrixD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a2465505aca46f8c0503ad97126684a1e">GetTransferMatrix</a> () const</td></tr>
<tr class="memdesc:a2465505aca46f8c0503ad97126684a1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get transfer matrix allowing to go from PCA base to normal base.  <a href="classPCAHandler.html#a2465505aca46f8c0503ad97126684a1e">More...</a><br /></td></tr>
<tr class="separator:a2465505aca46f8c0503ad97126684a1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa56af9e5ecb46813de98c51acb4325a0"><td class="memItemLeft" align="right" valign="top">const TVectorD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#aa56af9e5ecb46813de98c51acb4325a0">GetEigenValues</a> () const</td></tr>
<tr class="memdesc:aa56af9e5ecb46813de98c51acb4325a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get eigen values for all parameters, if you want for decomposed only parameters use GetEigenValuesMaster.  <a href="classPCAHandler.html#aa56af9e5ecb46813de98c51acb4325a0">More...</a><br /></td></tr>
<tr class="separator:aa56af9e5ecb46813de98c51acb4325a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25852f69dbfb5d9a39e4ef94a660e344"><td class="memItemLeft" align="right" valign="top">const std::vector&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a25852f69dbfb5d9a39e4ef94a660e344">GetEigenValuesMaster</a> () const</td></tr>
<tr class="memdesc:a25852f69dbfb5d9a39e4ef94a660e344"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get eigen value of only decomposed parameters, if you want for all parameters use GetEigenValues.  <a href="classPCAHandler.html#a25852f69dbfb5d9a39e4ef94a660e344">More...</a><br /></td></tr>
<tr class="separator:a25852f69dbfb5d9a39e4ef94a660e344"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88a89e8955f06dff98ac343d0f5e84e4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a88a89e8955f06dff98ac343d0f5e84e4">IsParameterDecomposed</a> (const int i) const</td></tr>
<tr class="memdesc:a88a89e8955f06dff98ac343d0f5e84e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if parameter in PCA base is decomposed or not.  <a href="classPCAHandler.html#a88a89e8955f06dff98ac343d0f5e84e4">More...</a><br /></td></tr>
<tr class="separator:a88a89e8955f06dff98ac343d0f5e84e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:af4ec4fac1abdd47240f7f5c041f7722a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#af4ec4fac1abdd47240f7f5c041f7722a">SanitisePCA</a> (TMatrixDSym *CovMatrix)</td></tr>
<tr class="memdesc:af4ec4fac1abdd47240f7f5c041f7722a"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Make sure decomposed matrix isn't correlated with undecomposed.  <a href="classPCAHandler.html#af4ec4fac1abdd47240f7f5c041f7722a">More...</a><br /></td></tr>
<tr class="separator:af4ec4fac1abdd47240f7f5c041f7722a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ac0bd8123d71c40d713048ec4131d6b13"><td class="memItemLeft" align="right" valign="top">std::vector&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#ac0bd8123d71c40d713048ec4131d6b13">_fPreFitValuePCA</a></td></tr>
<tr class="memdesc:ac0bd8123d71c40d713048ec4131d6b13"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prefit value for PCA params.  <a href="classPCAHandler.html#ac0bd8123d71c40d713048ec4131d6b13">More...</a><br /></td></tr>
<tr class="separator:ac0bd8123d71c40d713048ec4131d6b13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a407f24e3c76f3651a5f20cc2cab274f8"><td class="memItemLeft" align="right" valign="top">TVectorD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a407f24e3c76f3651a5f20cc2cab274f8">_fParPropPCA</a></td></tr>
<tr class="memdesc:a407f24e3c76f3651a5f20cc2cab274f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Current parameter value in PCA base.  <a href="classPCAHandler.html#a407f24e3c76f3651a5f20cc2cab274f8">More...</a><br /></td></tr>
<tr class="separator:a407f24e3c76f3651a5f20cc2cab274f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1cd7c1c4471d99395efe53610a5357a"><td class="memItemLeft" align="right" valign="top">TVectorD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#af1cd7c1c4471d99395efe53610a5357a">_fParCurrPCA</a></td></tr>
<tr class="memdesc:af1cd7c1c4471d99395efe53610a5357a"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Proposed parameter value in PCA base.  <a href="classPCAHandler.html#af1cd7c1c4471d99395efe53610a5357a">More...</a><br /></td></tr>
<tr class="separator:af1cd7c1c4471d99395efe53610a5357a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9b859239b5e5c8e2bd35ad2118bf2dc"><td class="memItemLeft" align="right" valign="top">std::vector&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#aa9b859239b5e5c8e2bd35ad2118bf2dc">_fErrorPCA</a></td></tr>
<tr class="memdesc:aa9b859239b5e5c8e2bd35ad2118bf2dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tells if parameter is fixed in PCA base or not.  <a href="classPCAHandler.html#aa9b859239b5e5c8e2bd35ad2118bf2dc">More...</a><br /></td></tr>
<tr class="separator:aa9b859239b5e5c8e2bd35ad2118bf2dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10fecf91a038d034f55a08332dec0f4a"><td class="memItemLeft" align="right" valign="top">std::vector&lt; int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a10fecf91a038d034f55a08332dec0f4a">isDecomposedPCA</a></td></tr>
<tr class="memdesc:a10fecf91a038d034f55a08332dec0f4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">If param is decomposed this will return -1, if not this will return enumerator to param in normal base. This way we can map stuff like step scale etc between normal base and undecomposed param in eigen base.  <a href="classPCAHandler.html#a10fecf91a038d034f55a08332dec0f4a">More...</a><br /></td></tr>
<tr class="separator:a10fecf91a038d034f55a08332dec0f4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f08019f3db758953464fb1d0db71ea0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a></td></tr>
<tr class="memdesc:a5f08019f3db758953464fb1d0db71ea0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of parameters in PCA base.  <a href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">More...</a><br /></td></tr>
<tr class="separator:a5f08019f3db758953464fb1d0db71ea0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d9302633ed96ec57fbe26d25cbcee61"><td class="memItemLeft" align="right" valign="top">TMatrixD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a1d9302633ed96ec57fbe26d25cbcee61">TransferMat</a></td></tr>
<tr class="memdesc:a1d9302633ed96ec57fbe26d25cbcee61"><td class="mdescLeft">&#160;</td><td class="mdescRight">Matrix used to converting from PCA base to normal base.  <a href="classPCAHandler.html#a1d9302633ed96ec57fbe26d25cbcee61">More...</a><br /></td></tr>
<tr class="separator:a1d9302633ed96ec57fbe26d25cbcee61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f6443a487bb544e6a6e458d86f35f27"><td class="memItemLeft" align="right" valign="top">TMatrixD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a6f6443a487bb544e6a6e458d86f35f27">TransferMatT</a></td></tr>
<tr class="memdesc:a6f6443a487bb544e6a6e458d86f35f27"><td class="mdescLeft">&#160;</td><td class="mdescRight">Matrix used to converting from normal base to PCA base.  <a href="classPCAHandler.html#a6f6443a487bb544e6a6e458d86f35f27">More...</a><br /></td></tr>
<tr class="separator:a6f6443a487bb544e6a6e458d86f35f27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d95ecb29e091e9b09c5011691516c28"><td class="memItemLeft" align="right" valign="top">TVectorD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a8d95ecb29e091e9b09c5011691516c28">eigen_values</a></td></tr>
<tr class="memdesc:a8d95ecb29e091e9b09c5011691516c28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Eigen value only of particles which are being decomposed.  <a href="classPCAHandler.html#a8d95ecb29e091e9b09c5011691516c28">More...</a><br /></td></tr>
<tr class="separator:a8d95ecb29e091e9b09c5011691516c28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ba9d34343ce0d0eeb4c020fa70486e2"><td class="memItemLeft" align="right" valign="top">TMatrixD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a3ba9d34343ce0d0eeb4c020fa70486e2">eigen_vectors</a></td></tr>
<tr class="memdesc:a3ba9d34343ce0d0eeb4c020fa70486e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Eigen vectors only of params which are being decomposed.  <a href="classPCAHandler.html#a3ba9d34343ce0d0eeb4c020fa70486e2">More...</a><br /></td></tr>
<tr class="separator:a3ba9d34343ce0d0eeb4c020fa70486e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2924386fef0cf65215c51b4f81cdb0d1"><td class="memItemLeft" align="right" valign="top">std::vector&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a2924386fef0cf65215c51b4f81cdb0d1">eigen_values_master</a></td></tr>
<tr class="memdesc:a2924386fef0cf65215c51b4f81cdb0d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Eigen values which have dimension equal to _fNumParPCA, and can be used in CorrelateSteps.  <a href="classPCAHandler.html#a2924386fef0cf65215c51b4f81cdb0d1">More...</a><br /></td></tr>
<tr class="separator:a2924386fef0cf65215c51b4f81cdb0d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa39db9118399bebcdb784fe9c9fea458"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#aa39db9118399bebcdb784fe9c9fea458">nKeptPCApars</a></td></tr>
<tr class="memdesc:aa39db9118399bebcdb784fe9c9fea458"><td class="mdescLeft">&#160;</td><td class="mdescRight">Total number that remained after applying PCA Threshold.  <a href="classPCAHandler.html#aa39db9118399bebcdb784fe9c9fea458">More...</a><br /></td></tr>
<tr class="separator:aa39db9118399bebcdb784fe9c9fea458"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc00f628b947fd407d05790f4d0eaaec"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a></td></tr>
<tr class="memdesc:afc00f628b947fd407d05790f4d0eaaec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Index of the first param that is being decomposed.  <a href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">More...</a><br /></td></tr>
<tr class="separator:afc00f628b947fd407d05790f4d0eaaec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a954eeb975f1d7f9528ed7e027a54b21a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a></td></tr>
<tr class="memdesc:a954eeb975f1d7f9528ed7e027a54b21a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Index of the last param that is being decomposed.  <a href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">More...</a><br /></td></tr>
<tr class="separator:a954eeb975f1d7f9528ed7e027a54b21a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdf5f929fe9211a2ce05f6bab2b8633a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#afdf5f929fe9211a2ce05f6bab2b8633a">eigen_threshold</a></td></tr>
<tr class="memdesc:afdf5f929fe9211a2ce05f6bab2b8633a"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Threshold based on which we remove parameters in eigen base.  <a href="classPCAHandler.html#afdf5f929fe9211a2ce05f6bab2b8633a">More...</a><br /></td></tr>
<tr class="separator:afdf5f929fe9211a2ce05f6bab2b8633a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bea0a66f8f09ec08ee398a377a1f437"><td class="memItemLeft" align="right" valign="top">std::vector&lt; double &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a6bea0a66f8f09ec08ee398a377a1f437">_pCurrVal</a></td></tr>
<tr class="memdesc:a6bea0a66f8f09ec08ee398a377a1f437"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer to current value of the parameter.  <a href="classPCAHandler.html#a6bea0a66f8f09ec08ee398a377a1f437">More...</a><br /></td></tr>
<tr class="separator:a6bea0a66f8f09ec08ee398a377a1f437"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86d7b6c405ee97ebad2f5c8fe47ce4ee"><td class="memItemLeft" align="right" valign="top">std::vector&lt; double &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPCAHandler.html#a86d7b6c405ee97ebad2f5c8fe47ce4ee">_pPropVal</a></td></tr>
<tr class="memdesc:a86d7b6c405ee97ebad2f5c8fe47ce4ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer to proposed value of the parameter.  <a href="classPCAHandler.html#a86d7b6c405ee97ebad2f5c8fe47ce4ee">More...</a><br /></td></tr>
<tr class="separator:a86d7b6c405ee97ebad2f5c8fe47ce4ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class responsible for handling Principal Component Analysis (PCA) of covariance matrix. </p>
<dl class="section author"><dt>Author</dt><dd>Clarence Wret</dd></dl>
<h1><a class="anchor" id="autotoc_md87"></a>
Introduction</h1>
<p>This class applies Principal Component Analysis (PCA) to covariance matrices using eigen-decomposition. The main benefit is that PCA rotates the parameter space into a basis where parameters are uncorrelated. In practice, this helps MCMC fits move more efficiently, since correlated directions in the original space often slow down convergence.</p>
<h1><a class="anchor" id="autotoc_md88"></a>
Dimensionality Reduction</h1>
<p>PCA makes it possible to drop directions in parameter space with very small eigenvalues. These correspond to combinations of parameters that are poorly constrained or dominated by statistical noise. By applying a threshold (e.g. discarding eigenvalues smaller than <code>1e-4</code> of the largest one), the effective number of parameters can be reduced.</p>
<p>This is particularly useful in large MCMC fits, where many parameters may contribute little information. Removing them reduces dimensionality while keeping the dominant structure of the parameter space intact, often leading to faster and more stable fits.</p>
<h1><a class="anchor" id="autotoc_md89"></a>
Partial Decomposition</h1>
<p>PCA does not need to be applied to the full covariance matrix. This class supports eigen-decomposition of only a submatrix. This is useful when only a subset of parameters is strongly correlated and benefits from PCA, while the rest remain in the original parameter basis. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00058">58</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="aabaaecfe5909a6cffbcc0e1a385615fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabaaecfe5909a6cffbcc0e1a385615fa">&#9670;&nbsp;</a></span>PCAHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PCAHandler::PCAHandler </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00005">5</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;                       {</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  <a class="code" href="classPCAHandler.html#a6bea0a66f8f09ec08ee398a377a1f437">_pCurrVal</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <a class="code" href="classPCAHandler.html#a86d7b6c405ee97ebad2f5c8fe47ce4ee">_pPropVal</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;}</div>
<div class="ttc" id="aclassPCAHandler_html_a6bea0a66f8f09ec08ee398a377a1f437"><div class="ttname"><a href="classPCAHandler.html#a6bea0a66f8f09ec08ee398a377a1f437">PCAHandler::_pCurrVal</a></div><div class="ttdeci">std::vector&lt; double &gt; * _pCurrVal</div><div class="ttdoc">Pointer to current value of the parameter.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00260">PCAHandler.h:260</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a86d7b6c405ee97ebad2f5c8fe47ce4ee"><div class="ttname"><a href="classPCAHandler.html#a86d7b6c405ee97ebad2f5c8fe47ce4ee">PCAHandler::_pPropVal</a></div><div class="ttdeci">std::vector&lt; double &gt; * _pPropVal</div><div class="ttdoc">Pointer to proposed value of the parameter.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00262">PCAHandler.h:262</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7f9957719671d1c673c74b5cd003dc76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f9957719671d1c673c74b5cd003dc76">&#9670;&nbsp;</a></span>~PCAHandler()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PCAHandler::~PCAHandler </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00012">12</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                        {</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a7298eb3c337becf349d628c3049834f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7298eb3c337becf349d628c3049834f7">&#9670;&nbsp;</a></span>AcceptStep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::AcceptStep </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accepted this step. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00179">179</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                                       {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="comment">// Update the book-keeping for the output</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>; ++i) {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="classPCAHandler.html#af1cd7c1c4471d99395efe53610a5357a">_fParCurrPCA</a>(i) = <a class="code" href="classPCAHandler.html#a407f24e3c76f3651a5f20cc2cab274f8">_fParPropPCA</a>(i);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="comment">// Then update the parameter basis</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <a class="code" href="classPCAHandler.html#a93e5548b530c1cc6158e62f497ca3c59">TransferToParam</a>();</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div>
<div class="ttc" id="aclassPCAHandler_html_a407f24e3c76f3651a5f20cc2cab274f8"><div class="ttname"><a href="classPCAHandler.html#a407f24e3c76f3651a5f20cc2cab274f8">PCAHandler::_fParPropPCA</a></div><div class="ttdeci">TVectorD _fParPropPCA</div><div class="ttdoc">CW: Current parameter value in PCA base.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00229">PCAHandler.h:229</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a5f08019f3db758953464fb1d0db71ea0"><div class="ttname"><a href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">PCAHandler::NumParPCA</a></div><div class="ttdeci">int NumParPCA</div><div class="ttdoc">Number of parameters in PCA base.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00237">PCAHandler.h:237</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a93e5548b530c1cc6158e62f497ca3c59"><div class="ttname"><a href="classPCAHandler.html#a93e5548b530c1cc6158e62f497ca3c59">PCAHandler::TransferToParam</a></div><div class="ttdeci">void TransferToParam()</div><div class="ttdoc">Transfer param values from PCA base to normal base.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8cpp_source.html#l00255">PCAHandler.cpp:255</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_af1cd7c1c4471d99395efe53610a5357a"><div class="ttname"><a href="classPCAHandler.html#af1cd7c1c4471d99395efe53610a5357a">PCAHandler::_fParCurrPCA</a></div><div class="ttdeci">TVectorD _fParCurrPCA</div><div class="ttdoc">CW: Proposed parameter value in PCA base.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00231">PCAHandler.h:231</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af7a1ae0e3fcfc6e319c86ae9cec2ac15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7a1ae0e3fcfc6e319c86ae9cec2ac15">&#9670;&nbsp;</a></span>ConstructPCA()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::ConstructPCA </td>
          <td>(</td>
          <td class="paramtype">TMatrixDSym *&#160;</td>
          <td class="paramname"><em>CovMatrix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>firstPCAd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>lastPCAd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>eigen_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>_fNumPar</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CW: Calculate eigen values, prepare transition matrices and remove param based on defined threshold. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">CovMatrix</td><td>Symmetric covariance matrix used for eigen decomposition. </td></tr>
    <tr><td class="paramname">firstPCAd</td><td>Index of the first PCA component to include. </td></tr>
    <tr><td class="paramname">lastPCAd</td><td>Index of the last PCA component to include. </td></tr>
    <tr><td class="paramname">eigen_thresh</td><td>Threshold for eigenvalues below which parameters are discarded. </td></tr>
    <tr><td class="paramname">_fNumPar</td><td>Total number of parameters in the original (non-PCA) basis. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00025">25</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;                                                                             {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a> = firstPCAd;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a> = lastPCAd;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <a class="code" href="classPCAHandler.html#afdf5f929fe9211a2ce05f6bab2b8633a">eigen_threshold</a> = eigen_thresh;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="comment">// Check that covariance matrix exists</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordflow">if</span> (CovMatrix == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Covariance matrix for has not yet been set&quot;</span>);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Can not construct PCA until it is set&quot;</span>);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__ , __LINE__ );</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a> &gt; CovMatrix-&gt;GetNrows()-1 || <a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a>&gt;CovMatrix-&gt;GetNrows()-1) {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;FirstPCAdpar and LastPCAdpar are higher than the number of parameters&quot;</span>);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;first: {} last: {}, params: {}&quot;</span>, <a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>, <a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a>, CovMatrix-&gt;GetNrows()-1);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__ , __LINE__ );</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  }</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a> &lt; 0 || <a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a> &lt; 0){</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;FirstPCAdpar and LastPCAdpar are less than 0 but not default -999&quot;</span>);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;first: {} last: {}&quot;</span>, <a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>, <a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__ , __LINE__ );</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;PCAing parameters {} through {} inclusive&quot;</span>, <a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>, <a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a>);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordtype">int</span> NumUnPCAdPars = CovMatrix-&gt;GetNrows()-(<a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a>-<a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>+1);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="comment">// KS: Make sure we are not doing anything silly with PCA</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <a class="code" href="classPCAHandler.html#af4ec4fac1abdd47240f7f5c041f7722a">SanitisePCA</a>(CovMatrix);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  TMatrixDSym submat(CovMatrix-&gt;GetSub(<a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>,<a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a>,<a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>,<a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a>));</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="comment">//CW: Calculate how many eigen values this threshold corresponds to</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  TMatrixDSymEigen eigen(submat);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <a class="code" href="classPCAHandler.html#a8d95ecb29e091e9b09c5011691516c28">eigen_values</a>.ResizeTo(eigen.GetEigenValues());</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <a class="code" href="classPCAHandler.html#a3ba9d34343ce0d0eeb4c020fa70486e2">eigen_vectors</a>.ResizeTo(eigen.GetEigenVectors());</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="classPCAHandler.html#a8d95ecb29e091e9b09c5011691516c28">eigen_values</a> = eigen.GetEigenValues();</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <a class="code" href="classPCAHandler.html#a3ba9d34343ce0d0eeb4c020fa70486e2">eigen_vectors</a> = eigen.GetEigenVectors();</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordtype">double</span> sum = 0;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="comment">// Loop over eigen values and sum them up</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPCAHandler.html#a8d95ecb29e091e9b09c5011691516c28">eigen_values</a>.GetNrows(); ++i) {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    sum += <a class="code" href="classPCAHandler.html#a8d95ecb29e091e9b09c5011691516c28">eigen_values</a>(i);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  }</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <a class="code" href="classPCAHandler.html#aa39db9118399bebcdb784fe9c9fea458">nKeptPCApars</a> = <a class="code" href="classPCAHandler.html#a8d95ecb29e091e9b09c5011691516c28">eigen_values</a>.GetNrows();</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">//CW: Now go through again and see how many eigen values correspond to threshold</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPCAHandler.html#a8d95ecb29e091e9b09c5011691516c28">eigen_values</a>.GetNrows(); ++i) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// Get the relative size of the eigen value</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordtype">double</span> sig = <a class="code" href="classPCAHandler.html#a8d95ecb29e091e9b09c5011691516c28">eigen_values</a>(i)/sum;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// Check against the threshold</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">if</span> (sig &lt; <a class="code" href="classPCAHandler.html#afdf5f929fe9211a2ce05f6bab2b8633a">eigen_threshold</a>) {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      <a class="code" href="classPCAHandler.html#aa39db9118399bebcdb784fe9c9fea458">nKeptPCApars</a> = i;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a> = NumUnPCAdPars+<a class="code" href="classPCAHandler.html#aa39db9118399bebcdb784fe9c9fea458">nKeptPCApars</a>;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Threshold of {} on eigen values relative sum of eigen value ({}) generates {} eigen vectors, plus we have {} unpcad pars, for a total of {}&quot;</span>, <a class="code" href="classPCAHandler.html#afdf5f929fe9211a2ce05f6bab2b8633a">eigen_threshold</a>, sum, <a class="code" href="classPCAHandler.html#aa39db9118399bebcdb784fe9c9fea458">nKeptPCApars</a>, NumUnPCAdPars, <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">//DB Create array of correct size so eigen_values can be used in CorrelateSteps</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <a class="code" href="classPCAHandler.html#a2924386fef0cf65215c51b4f81cdb0d1">eigen_values_master</a> = std::vector&lt;double&gt;(<a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>, 1.0);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = <a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>; i &lt; <a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>+<a class="code" href="classPCAHandler.html#aa39db9118399bebcdb784fe9c9fea458">nKeptPCApars</a>; ++i) {<a class="code" href="classPCAHandler.html#a2924386fef0cf65215c51b4f81cdb0d1">eigen_values_master</a>[i] = <a class="code" href="classPCAHandler.html#a8d95ecb29e091e9b09c5011691516c28">eigen_values</a>(i-<a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>);}</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">// Now construct the transfer matrices</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="comment">//These matrices will be as big as number of unPCAd pars plus number of eigenvalues kept</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <a class="code" href="classPCAHandler.html#a1d9302633ed96ec57fbe26d25cbcee61">TransferMat</a>.ResizeTo(CovMatrix-&gt;GetNrows(), <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="classPCAHandler.html#a6f6443a487bb544e6a6e458d86f35f27">TransferMatT</a>.ResizeTo(CovMatrix-&gt;GetNrows(), <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">// Get a subset of the eigen vector matrix</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  TMatrixD temp(<a class="code" href="classPCAHandler.html#a3ba9d34343ce0d0eeb4c020fa70486e2">eigen_vectors</a>.GetSub(0, <a class="code" href="classPCAHandler.html#a3ba9d34343ce0d0eeb4c020fa70486e2">eigen_vectors</a>.GetNrows()-1, 0, <a class="code" href="classPCAHandler.html#aa39db9118399bebcdb784fe9c9fea458">nKeptPCApars</a>-1));</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">//Make transfer matrix which is two blocks of identity with a block of the PCA transfer matrix in between</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  TMatrixD temp2;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  temp2.ResizeTo(CovMatrix-&gt;GetNrows(), <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">//First set the whole thing to 0</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  temp2.Zero();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">//Set the first identity block for non-PCAed params before PCA block, before PCA XRows == YRows</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iRow = 0; iRow &lt; <a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>; iRow++) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    temp2(iRow, iRow) = 1.0;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">//Set the transfer matrix block for the PCAd pars</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  temp2.SetSub(<a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>,<a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>,temp);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">//Set the second identity block starting after PCA block, remember XRows != YRows.</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">// XRows -&gt; normal base, YRows, PCA base</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iRow = 0;iRow &lt; (CovMatrix-&gt;GetNrows()-1)-<a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a>; iRow++) {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> OrigRow = <a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a> + 1 + iRow;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> PCARow = <a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a> + <a class="code" href="classPCAHandler.html#aa39db9118399bebcdb784fe9c9fea458">nKeptPCApars</a> + iRow;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    temp2(OrigRow, PCARow) = 1.;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <a class="code" href="classPCAHandler.html#a1d9302633ed96ec57fbe26d25cbcee61">TransferMat</a> = temp2;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">// Copy the contents</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="classPCAHandler.html#a6f6443a487bb544e6a6e458d86f35f27">TransferMatT</a> = <a class="code" href="classPCAHandler.html#a1d9302633ed96ec57fbe26d25cbcee61">TransferMat</a>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="comment">// And then transpose</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <a class="code" href="classPCAHandler.html#a6f6443a487bb544e6a6e458d86f35f27">TransferMatT</a>.T();</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="comment">// Make the PCA parameter arrays</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <a class="code" href="classPCAHandler.html#af1cd7c1c4471d99395efe53610a5357a">_fParCurrPCA</a>.ResizeTo(<a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <a class="code" href="classPCAHandler.html#a407f24e3c76f3651a5f20cc2cab274f8">_fParPropPCA</a>.ResizeTo(<a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <a class="code" href="classPCAHandler.html#ac0bd8123d71c40d713048ec4131d6b13">_fPreFitValuePCA</a>.resize(<a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="comment">//KS: make easy map so we could easily find un-decomposed parameters</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <a class="code" href="classPCAHandler.html#aa9b859239b5e5c8e2bd35ad2118bf2dc">_fErrorPCA</a>.assign(<a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>, 1);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <a class="code" href="classPCAHandler.html#a10fecf91a038d034f55a08332dec0f4a">isDecomposedPCA</a>.assign(<a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>, -1);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">// First non PCA-ed block, since this is before PCA-ed block we don&#39;t need any mapping</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>; ++i) {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="classPCAHandler.html#a10fecf91a038d034f55a08332dec0f4a">isDecomposedPCA</a>[i] = i;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">// Second non-PCA-ed block, keep in mind this is in PCA base so we cannot use LastPCAdpar</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">// we must shift them back into the original parameter index range.</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> shift = _fNumPar - <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = <a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a> + <a class="code" href="classPCAHandler.html#aa39db9118399bebcdb784fe9c9fea458">nKeptPCApars</a>; i &lt; <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>; ++i) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="classPCAHandler.html#a10fecf91a038d034f55a08332dec0f4a">isDecomposedPCA</a>[i] = i + shift;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="preprocessor">  #ifdef DEBUG_PCA</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">//KS: Let&#39;s dump all useful matrices to properly validate PCA</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  DebugPCA(sum, temp, submat, CovMatrix-&gt;GetNrows());</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div>
<div class="ttc" id="aMaCh3Logger_8h_html_a61052119a625282d0ec6d4a97adf3ee2"><div class="ttname"><a href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a></div><div class="ttdeci">#define MACH3LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Logger_8h_source.html#l00037">MaCh3Logger.h:37</a></div></div>
<div class="ttc" id="aMaCh3Logger_8h_html_a95fa4dffc648e4c5536c9292c2bdcac3"><div class="ttname"><a href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a></div><div class="ttdeci">#define MACH3LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Logger_8h_source.html#l00035">MaCh3Logger.h:35</a></div></div>
<div class="ttc" id="aclassMaCh3Exception_html"><div class="ttname"><a href="classMaCh3Exception.html">MaCh3Exception</a></div><div class="ttdoc">Custom exception class used throughout MaCh3.</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Exception_8h_source.html#l00023">MaCh3Exception.h:23</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a10fecf91a038d034f55a08332dec0f4a"><div class="ttname"><a href="classPCAHandler.html#a10fecf91a038d034f55a08332dec0f4a">PCAHandler::isDecomposedPCA</a></div><div class="ttdeci">std::vector&lt; int &gt; isDecomposedPCA</div><div class="ttdoc">If param is decomposed this will return -1, if not this will return enumerator to param in normal bas...</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00235">PCAHandler.h:235</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a1d9302633ed96ec57fbe26d25cbcee61"><div class="ttname"><a href="classPCAHandler.html#a1d9302633ed96ec57fbe26d25cbcee61">PCAHandler::TransferMat</a></div><div class="ttdeci">TMatrixD TransferMat</div><div class="ttdoc">Matrix used to converting from PCA base to normal base.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00240">PCAHandler.h:240</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a2924386fef0cf65215c51b4f81cdb0d1"><div class="ttname"><a href="classPCAHandler.html#a2924386fef0cf65215c51b4f81cdb0d1">PCAHandler::eigen_values_master</a></div><div class="ttdeci">std::vector&lt; double &gt; eigen_values_master</div><div class="ttdoc">Eigen values which have dimension equal to _fNumParPCA, and can be used in CorrelateSteps.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00248">PCAHandler.h:248</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a3ba9d34343ce0d0eeb4c020fa70486e2"><div class="ttname"><a href="classPCAHandler.html#a3ba9d34343ce0d0eeb4c020fa70486e2">PCAHandler::eigen_vectors</a></div><div class="ttdeci">TMatrixD eigen_vectors</div><div class="ttdoc">Eigen vectors only of params which are being decomposed.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00246">PCAHandler.h:246</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a6f6443a487bb544e6a6e458d86f35f27"><div class="ttname"><a href="classPCAHandler.html#a6f6443a487bb544e6a6e458d86f35f27">PCAHandler::TransferMatT</a></div><div class="ttdeci">TMatrixD TransferMatT</div><div class="ttdoc">Matrix used to converting from normal base to PCA base.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00242">PCAHandler.h:242</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a8d95ecb29e091e9b09c5011691516c28"><div class="ttname"><a href="classPCAHandler.html#a8d95ecb29e091e9b09c5011691516c28">PCAHandler::eigen_values</a></div><div class="ttdeci">TVectorD eigen_values</div><div class="ttdoc">Eigen value only of particles which are being decomposed.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00244">PCAHandler.h:244</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a954eeb975f1d7f9528ed7e027a54b21a"><div class="ttname"><a href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">PCAHandler::LastPCAdpar</a></div><div class="ttdeci">int LastPCAdpar</div><div class="ttdoc">Index of the last param that is being decomposed.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00255">PCAHandler.h:255</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_aa39db9118399bebcdb784fe9c9fea458"><div class="ttname"><a href="classPCAHandler.html#aa39db9118399bebcdb784fe9c9fea458">PCAHandler::nKeptPCApars</a></div><div class="ttdeci">int nKeptPCApars</div><div class="ttdoc">Total number that remained after applying PCA Threshold.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00251">PCAHandler.h:251</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_aa9b859239b5e5c8e2bd35ad2118bf2dc"><div class="ttname"><a href="classPCAHandler.html#aa9b859239b5e5c8e2bd35ad2118bf2dc">PCAHandler::_fErrorPCA</a></div><div class="ttdeci">std::vector&lt; double &gt; _fErrorPCA</div><div class="ttdoc">Tells if parameter is fixed in PCA base or not.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00233">PCAHandler.h:233</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_ac0bd8123d71c40d713048ec4131d6b13"><div class="ttname"><a href="classPCAHandler.html#ac0bd8123d71c40d713048ec4131d6b13">PCAHandler::_fPreFitValuePCA</a></div><div class="ttdeci">std::vector&lt; double &gt; _fPreFitValuePCA</div><div class="ttdoc">Prefit value for PCA params.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00227">PCAHandler.h:227</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_af4ec4fac1abdd47240f7f5c041f7722a"><div class="ttname"><a href="classPCAHandler.html#af4ec4fac1abdd47240f7f5c041f7722a">PCAHandler::SanitisePCA</a></div><div class="ttdeci">void SanitisePCA(TMatrixDSym *CovMatrix)</div><div class="ttdoc">KS: Make sure decomposed matrix isn't correlated with undecomposed.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8cpp_source.html#l00150">PCAHandler.cpp:150</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_afc00f628b947fd407d05790f4d0eaaec"><div class="ttname"><a href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">PCAHandler::FirstPCAdpar</a></div><div class="ttdeci">int FirstPCAdpar</div><div class="ttdoc">Index of the first param that is being decomposed.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00253">PCAHandler.h:253</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_afdf5f929fe9211a2ce05f6bab2b8633a"><div class="ttname"><a href="classPCAHandler.html#afdf5f929fe9211a2ce05f6bab2b8633a">PCAHandler::eigen_threshold</a></div><div class="ttdeci">double eigen_threshold</div><div class="ttdoc">CW: Threshold based on which we remove parameters in eigen base.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00257">PCAHandler.h:257</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a733d8b6619a657223113f020db1327a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a733d8b6619a657223113f020db1327a7">&#9670;&nbsp;</a></span>CorrelateSteps()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::CorrelateSteps </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>IndivStepScale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>GlobalStepScale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *<a class="el" href="Core_8h.html#ab6a7e23420f0bcfb04f42f45f8283101">_restrict_</a>&#160;</td>
          <td class="paramname"><em>randParams</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *<a class="el" href="Core_8h.html#ab6a7e23420f0bcfb04f42f45f8283101">_restrict_</a>&#160;</td>
          <td class="paramname"><em>corr_throw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Use Cholesky throw matrix for better step proposal. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00194">194</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                                                                {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">// ************************************************</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="comment">// Throw around the current step</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>; ++i)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classPCAHandler.html#aa9b859239b5e5c8e2bd35ad2118bf2dc">_fErrorPCA</a>[i] &gt; 0.)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <span class="keywordtype">double</span> IndStepScale = 1.;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="comment">//KS: If undecomposed parameter apply individual step scale and Cholesky for better acceptance rate</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classPCAHandler.html#a10fecf91a038d034f55a08332dec0f4a">isDecomposedPCA</a>[i] &gt;= 0)</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        IndStepScale *= IndivStepScale[<a class="code" href="classPCAHandler.html#a10fecf91a038d034f55a08332dec0f4a">isDecomposedPCA</a>[i]];</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        IndStepScale *= corr_throw[<a class="code" href="classPCAHandler.html#a10fecf91a038d034f55a08332dec0f4a">isDecomposedPCA</a>[i]];</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="comment">//If decomposed apply only random number</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        IndStepScale *= randParams[i];</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="comment">//KS: All PCA-ed parameters have the same step scale</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        IndStepScale *= IndivStepScale[<a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>];</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <a class="code" href="classPCAHandler.html#a407f24e3c76f3651a5f20cc2cab274f8">_fParPropPCA</a>(i) = <a class="code" href="classPCAHandler.html#af1cd7c1c4471d99395efe53610a5357a">_fParCurrPCA</a>(i)+GlobalStepScale*IndStepScale*<a class="code" href="classPCAHandler.html#a2924386fef0cf65215c51b4f81cdb0d1">eigen_values_master</a>[i];</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">// Then update the parameter basis</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <a class="code" href="classPCAHandler.html#a93e5548b530c1cc6158e62f497ca3c59">TransferToParam</a>();</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa56af9e5ecb46813de98c51acb4325a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa56af9e5ecb46813de98c51acb4325a0">&#9670;&nbsp;</a></span>GetEigenValues()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const TVectorD PCAHandler::GetEigenValues </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get eigen values for all parameters, if you want for decomposed only parameters use GetEigenValuesMaster. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00200">200</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                                        {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classPCAHandler.html#a8d95ecb29e091e9b09c5011691516c28">eigen_values</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a25852f69dbfb5d9a39e4ef94a660e344"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25852f69dbfb5d9a39e4ef94a660e344">&#9670;&nbsp;</a></span>GetEigenValuesMaster()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const std::vector&lt;double&gt; PCAHandler::GetEigenValuesMaster </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get eigen value of only decomposed parameters, if you want for all parameters use GetEigenValues. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00205">205</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                                                       {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classPCAHandler.html#a2924386fef0cf65215c51b4f81cdb0d1">eigen_values_master</a>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="afd2534e2f1eb2b54e26af6a6da937b3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd2534e2f1eb2b54e26af6a6da937b3c">&#9670;&nbsp;</a></span>GetEigenVectors()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const TMatrixD PCAHandler::GetEigenVectors </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get eigen vectors of covariance matrix, only works with PCA. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00148">148</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                                         {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classPCAHandler.html#a3ba9d34343ce0d0eeb4c020fa70486e2">eigen_vectors</a>;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a68ca4b7ae6ffe46eea112ed22b0d6dcf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68ca4b7ae6ffe46eea112ed22b0d6dcf">&#9670;&nbsp;</a></span>GetNumberPCAedParameters()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int PCAHandler::GetNumberPCAedParameters </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieve number of parameters in PCA base. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00069">69</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a25aceab12943cd55812e80b64adba9d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25aceab12943cd55812e80b64adba9d6">&#9670;&nbsp;</a></span>GetParCurrPCA()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double PCAHandler::GetParCurrPCA </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get current parameter value using PCA. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">i</td><td>Parameter index </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00188">188</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                                          {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classPCAHandler.html#af1cd7c1c4471d99395efe53610a5357a">_fParCurrPCA</a>(i);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a5a42efb45ecf02e0369ca02df5c2d7e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a42efb45ecf02e0369ca02df5c2d7e7">&#9670;&nbsp;</a></span>GetParPropPCA()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double PCAHandler::GetParPropPCA </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get current parameter value using PCA. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">i</td><td>Parameter index </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00174">174</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                                          {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classPCAHandler.html#a407f24e3c76f3651a5f20cc2cab274f8">_fParPropPCA</a>(i);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a86b25b9f099bf94ab18c20857358d9a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86b25b9f099bf94ab18c20857358d9a2">&#9670;&nbsp;</a></span>GetPreFitValuePCA()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double PCAHandler::GetPreFitValuePCA </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get current parameter value using PCA. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">i</td><td>Parameter index </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00181">181</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                              {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classPCAHandler.html#ac0bd8123d71c40d713048ec4131d6b13">_fPreFitValuePCA</a>[i];</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a2465505aca46f8c0503ad97126684a1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2465505aca46f8c0503ad97126684a1e">&#9670;&nbsp;</a></span>GetTransferMatrix()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const TMatrixD PCAHandler::GetTransferMatrix </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get transfer matrix allowing to go from PCA base to normal base. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00194">194</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                           {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classPCAHandler.html#a1d9302633ed96ec57fbe26d25cbcee61">TransferMat</a>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a88a89e8955f06dff98ac343d0f5e84e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88a89e8955f06dff98ac343d0f5e84e4">&#9670;&nbsp;</a></span>IsParameterDecomposed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool PCAHandler::IsParameterDecomposed </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if parameter in PCA base is decomposed or not. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">i</td><td>Parameter index </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00212">212</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                                                {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classPCAHandler.html#a10fecf91a038d034f55a08332dec0f4a">isDecomposedPCA</a>[i] &gt;= 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a5087aa5aba191f31170c1108210cdb26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5087aa5aba191f31170c1108210cdb26">&#9670;&nbsp;</a></span>IsParameterFixedPCA()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool PCAHandler::IsParameterFixedPCA </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Is parameter fixed in PCA base or not. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">i</td><td>Parameter index </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00141">141</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                                              {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classPCAHandler.html#aa9b859239b5e5c8e2bd35ad2118bf2dc">_fErrorPCA</a>[i] &lt; 0) { <span class="keywordflow">return</span> <span class="keyword">true</span>;  }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">else</span>                   { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aebcdb9437110e45b8ba844c00f97f184"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aebcdb9437110e45b8ba844c00f97f184">&#9670;&nbsp;</a></span>Print()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::Print </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>KS: Print info about PCA parameters. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00270">270</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                             {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;PCA:&quot;</span>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>; ++i) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;PCA {:&lt;2} Current: {:&lt;10.2f} Proposed: {:&lt;10.2f}&quot;</span>, i, <a class="code" href="classPCAHandler.html#af1cd7c1c4471d99395efe53610a5357a">_fParCurrPCA</a>(i), <a class="code" href="classPCAHandler.html#a407f24e3c76f3651a5f20cc2cab274f8">_fParPropPCA</a>(i));</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="af4ec4fac1abdd47240f7f5c041f7722a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4ec4fac1abdd47240f7f5c041f7722a">&#9670;&nbsp;</a></span>SanitisePCA()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::SanitisePCA </td>
          <td>(</td>
          <td class="paramtype">TMatrixDSym *&#160;</td>
          <td class="paramname"><em>CovMatrix</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Make sure decomposed matrix isn't correlated with undecomposed. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00150">150</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                                                   {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  constexpr <span class="keywordtype">double</span> correlation_threshold = 1e-6;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordtype">bool</span> found_significant_correlation = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordtype">int</span> N = CovMatrix-&gt;GetNrows();</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = <a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>; i &lt;= <a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a>; ++i) {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; N; ++j) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="comment">// Skip if j is inside the decomposed range (we only want cross-correlations)</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="keywordflow">if</span> (j &gt;= <a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a> &amp;&amp; j &lt;= <a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordtype">double</span> corr_val = (*CovMatrix)(i, j);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="keywordflow">if</span> (std::fabs(corr_val) &gt; correlation_threshold) {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        found_significant_correlation = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Significant correlation detected between decomposed parameter &#39;{}&#39; &quot;</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="stringliteral">&quot;and undecomposed parameter &#39;{}&#39;: {:.6e}&quot;</span>, i, j, corr_val);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordflow">if</span> (found_significant_correlation) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;There are correlations between undecomposed and decomposed part of matrices, this will not work&quot;</span>);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__ , __LINE__);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a30e81eb270628240460a20e2417a4dfc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30e81eb270628240460a20e2417a4dfc">&#9670;&nbsp;</a></span>SetBranches()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::SetBranches </td>
          <td>(</td>
          <td class="paramtype">TTree &amp;&#160;</td>
          <td class="paramname"><em>tree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>SaveProposal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>Names</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>set branches for output file </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00279">279</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                                                                                    {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>; ++i) {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    tree.Branch(Form(<span class="stringliteral">&quot;%s_PCA&quot;</span>, Names[i].c_str()), &amp;<a class="code" href="classPCAHandler.html#af1cd7c1c4471d99395efe53610a5357a">_fParCurrPCA</a>.GetMatrixArray()[i], Form(<span class="stringliteral">&quot;%s_PCA/D&quot;</span>, Names[i].c_str()));</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordflow">if</span>(SaveProposal)</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>; ++i) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      tree.Branch(Form(<span class="stringliteral">&quot;%s_PCA_Prop&quot;</span>, Names[i].c_str()), &amp;<a class="code" href="classPCAHandler.html#a407f24e3c76f3651a5f20cc2cab274f8">_fParPropPCA</a>.GetMatrixArray()[i], Form(<span class="stringliteral">&quot;%s_PCA_Prop/D&quot;</span>, Names[i].c_str()));</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6394496144bfd3d5c7c9ff84e088c05c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6394496144bfd3d5c7c9ff84e088c05c">&#9670;&nbsp;</a></span>SetInitialParameters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::SetInitialParameters </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>KS: Transfer the starting parameters to the PCA basis, you don't want to start with zero.. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">IndStepScale</td><td>Per parameter step scale, we set so each PCA param uses same step scale [eigen value takes care of size] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00245">245</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                                      {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <a class="code" href="classPCAHandler.html#a7782b7f998d5a53ab88d76a41ff73fe4">TransferToPCA</a>();</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>; ++i) {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="classPCAHandler.html#ac0bd8123d71c40d713048ec4131d6b13">_fPreFitValuePCA</a>[i] = <a class="code" href="classPCAHandler.html#af1cd7c1c4471d99395efe53610a5357a">_fParCurrPCA</a>(i);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;}</div>
<div class="ttc" id="aclassPCAHandler_html_a7782b7f998d5a53ab88d76a41ff73fe4"><div class="ttname"><a href="classPCAHandler.html#a7782b7f998d5a53ab88d76a41ff73fe4">PCAHandler::TransferToPCA</a></div><div class="ttdeci">void TransferToPCA()</div><div class="ttdoc">Transfer param values from normal base to PCA base.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8cpp_source.html#l00230">PCAHandler.cpp:230</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af50dcfe6ab3715d66c5b26d6c621b7f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af50dcfe6ab3715d66c5b26d6c621b7f4">&#9670;&nbsp;</a></span>SetParametersPCA()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::SetParametersPCA </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>pars</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set values for PCA parameters in PCA base. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pars</td><td>vector with new values of PCA params </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00125">125</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                                                       {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span> (<span class="keywordtype">int</span>(pars.size()) != <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>) {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Parameter arrays of incompatible size! Not changing parameters! has size {} but was expecting {}&quot;</span>, pars.size(), <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="keywordflow">throw</span> <a class="code" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__ , __LINE__ );</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordtype">int</span> parsSize = int(pars.size());</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; parsSize; i++) {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <a class="code" href="classPCAHandler.html#a407f24e3c76f3651a5f20cc2cab274f8">_fParPropPCA</a>(i) = pars[i];</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">//KS: Transfer to normal base</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="classPCAHandler.html#a93e5548b530c1cc6158e62f497ca3c59">TransferToParam</a>();</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae232ab07ae839b755912c7e23f3c835f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae232ab07ae839b755912c7e23f3c835f">&#9670;&nbsp;</a></span>SetParCurrPCA()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::SetParCurrPCA </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set current value for parameter in PCA base. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">i</td><td>Parameter index </td></tr>
    <tr><td class="paramname">value</td><td>new value </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00165">165</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                                                      {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="code" href="classPCAHandler.html#af1cd7c1c4471d99395efe53610a5357a">_fParCurrPCA</a>(i) = value;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// And then transfer back to the parameter basis</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="classPCAHandler.html#a93e5548b530c1cc6158e62f497ca3c59">TransferToParam</a>();</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a737c5cad5cdff60c0a945aaddd2a6da3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a737c5cad5cdff60c0a945aaddd2a6da3">&#9670;&nbsp;</a></span>SetParPropPCA()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::SetParPropPCA </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set proposed value for parameter in PCA base. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">i</td><td>Parameter index </td></tr>
    <tr><td class="paramname">value</td><td>new value </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00156">156</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                                                      {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <a class="code" href="classPCAHandler.html#a407f24e3c76f3651a5f20cc2cab274f8">_fParPropPCA</a>(i) = value;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// And then transfer back to the parameter basis</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <a class="code" href="classPCAHandler.html#a93e5548b530c1cc6158e62f497ca3c59">TransferToParam</a>();</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a842edaaee2eacb613891ba5bb2f31d9a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a842edaaee2eacb613891ba5bb2f31d9a">&#9670;&nbsp;</a></span>SetupPointers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::SetupPointers </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>fCurr_Val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>fProp_Val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>KS: Setup pointers to current and proposed parameter value which we need to convert them to PCA base each step. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fCurr_Val</td><td>pointer to current position of parameter </td></tr>
    <tr><td class="paramname">fProp_Val</td><td>pointer to proposed position of parameter </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00017">17</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;                                                             {</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <a class="code" href="classPCAHandler.html#a6bea0a66f8f09ec08ee398a377a1f437">_pCurrVal</a> = fCurr_Val;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <a class="code" href="classPCAHandler.html#a86d7b6c405ee97ebad2f5c8fe47ce4ee">_pPropVal</a> = fProp_Val;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1316d16755cb320ea053b4351dbec7b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1316d16755cb320ea053b4351dbec7b1">&#9670;&nbsp;</a></span>ThrowParameters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::ThrowParameters </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::unique_ptr&lt; TRandom3 &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>random_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double **&#160;</td>
          <td class="paramname"><em>throwMatrixCholDecomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>randParams</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>corr_throw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>fPreFitValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>fLowBound</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>fUpBound</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>_fNumPar</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Throw the parameters according to the covariance matrix. This shouldn't be used in MCMC code ase it can break Detailed Balance;. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000034">Todo:</a></b></dt><dd>KS: We don't check if param is out of bounds. This is more problematic for PCA params. </dd></dl>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00318">318</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                                                     {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="comment">//KS: Do not multithread!</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>; ++i) {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">// Check if parameter is fixed first: if so don&#39;t randomly throw</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classPCAHandler.html#a5087aa5aba191f31170c1108210cdb26">IsParameterFixedPCA</a>(i)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="classPCAHandler.html#a88a89e8955f06dff98ac343d0f5e84e4">IsParameterDecomposed</a>(i))</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      (*_pPropVal)[i] = fPreFitValue[i] + corr_throw[i];</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="keywordtype">int</span> <span class="keywordflow">throws</span> = 0;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="comment">// Try again if we the initial parameter proposal falls outside of the range of the parameter</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="keywordflow">while</span> ((*<a class="code" href="classPCAHandler.html#a86d7b6c405ee97ebad2f5c8fe47ce4ee">_pPropVal</a>)[i] &gt; fUpBound[i] || (*<a class="code" href="classPCAHandler.html#a86d7b6c405ee97ebad2f5c8fe47ce4ee">_pPropVal</a>)[i] &lt; fLowBound[i]) {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        randParams[i] = random_number[<a class="code" href="namespaceM3.html#a5ed0accdbf66626c16b6c3b00bd5d030">M3::GetThreadIndex</a>()]-&gt;Gaus(0, 1);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> corr_throw_single = <a class="code" href="namespaceM3.html#a99622fe57c7a13d75de4d3c3561b530d">M3::MatrixVectorMultiSingle</a>(throwMatrixCholDecomp, randParams, _fNumPar, i);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        (*_pPropVal)[i] = fPreFitValue[i] + corr_throw_single;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keywordflow">if</span> (<span class="keywordflow">throws</span> &gt; 10000)</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;          <span class="comment">//KS: Since we are multithreading there is danger that those messages</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;          <span class="comment">//will be all over the place, small price to pay for faster code</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;          <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;Tried {} times to throw parameter {} but failed&quot;</span>, <span class="keywordflow">throws</span>, i);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;          <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;Setting _fPropVal:  {} to {}&quot;</span>, (*<a class="code" href="classPCAHandler.html#a86d7b6c405ee97ebad2f5c8fe47ce4ee">_pPropVal</a>)[i], fPreFitValue[i]);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;          <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;I live at {}:{}&quot;</span>, __FILE__, __LINE__);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;         (*_pPropVal)[i] = fPreFitValue[i];</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordflow">throws</span>++;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      (*_pCurrVal)[i] = (*_pPropVal)[i];</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="comment">// KS: We have to multiply by number of parameters in PCA base</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <a class="code" href="classPCAHandler.html#a737c5cad5cdff60c0a945aaddd2a6da3">SetParPropPCA</a>(i, <a class="code" href="classPCAHandler.html#a86b25b9f099bf94ab18c20857358d9a2">GetPreFitValuePCA</a>(i) + randParams[i] * <a class="code" href="classPCAHandler.html#a2924386fef0cf65215c51b4f81cdb0d1">eigen_values_master</a>[i] * (<a class="code" href="classPCAHandler.html#a954eeb975f1d7f9528ed7e027a54b21a">LastPCAdpar</a> - <a class="code" href="classPCAHandler.html#afc00f628b947fd407d05790f4d0eaaec">FirstPCAdpar</a>));</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <a class="code" href="classPCAHandler.html#ae232ab07ae839b755912c7e23f3c835f">SetParCurrPCA</a>(i, <a class="code" href="classPCAHandler.html#a5a42efb45ecf02e0369ca02df5c2d7e7">GetParPropPCA</a>(i));</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  } <span class="comment">// end of parameter loop</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _fNumPar; ++i) {</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    (*_pPropVal)[i] = std::max(fLowBound[i], std::min((*<a class="code" href="classPCAHandler.html#a86d7b6c405ee97ebad2f5c8fe47ce4ee">_pPropVal</a>)[i], fUpBound[i]));</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    (*_pCurrVal)[i] = (*_pPropVal)[i];</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;}</div>
<div class="ttc" id="aMaCh3Logger_8h_html_ad5b2eb6377721e3ac95def22c2386bb1"><div class="ttname"><a href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a></div><div class="ttdeci">#define MACH3LOG_WARN</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Logger_8h_source.html#l00036">MaCh3Logger.h:36</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a5087aa5aba191f31170c1108210cdb26"><div class="ttname"><a href="classPCAHandler.html#a5087aa5aba191f31170c1108210cdb26">PCAHandler::IsParameterFixedPCA</a></div><div class="ttdeci">bool IsParameterFixedPCA(const int i) const</div><div class="ttdoc">Is parameter fixed in PCA base or not.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00141">PCAHandler.h:141</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a5a42efb45ecf02e0369ca02df5c2d7e7"><div class="ttname"><a href="classPCAHandler.html#a5a42efb45ecf02e0369ca02df5c2d7e7">PCAHandler::GetParPropPCA</a></div><div class="ttdeci">double GetParPropPCA(const int i) const</div><div class="ttdoc">Get current parameter value using PCA.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00174">PCAHandler.h:174</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a737c5cad5cdff60c0a945aaddd2a6da3"><div class="ttname"><a href="classPCAHandler.html#a737c5cad5cdff60c0a945aaddd2a6da3">PCAHandler::SetParPropPCA</a></div><div class="ttdeci">void SetParPropPCA(const int i, const double value)</div><div class="ttdoc">Set proposed value for parameter in PCA base.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00156">PCAHandler.h:156</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a86b25b9f099bf94ab18c20857358d9a2"><div class="ttname"><a href="classPCAHandler.html#a86b25b9f099bf94ab18c20857358d9a2">PCAHandler::GetPreFitValuePCA</a></div><div class="ttdeci">double GetPreFitValuePCA(const int i) const</div><div class="ttdoc">Get current parameter value using PCA.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00181">PCAHandler.h:181</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_a88a89e8955f06dff98ac343d0f5e84e4"><div class="ttname"><a href="classPCAHandler.html#a88a89e8955f06dff98ac343d0f5e84e4">PCAHandler::IsParameterDecomposed</a></div><div class="ttdeci">bool IsParameterDecomposed(const int i) const</div><div class="ttdoc">Check if parameter in PCA base is decomposed or not.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00212">PCAHandler.h:212</a></div></div>
<div class="ttc" id="aclassPCAHandler_html_ae232ab07ae839b755912c7e23f3c835f"><div class="ttname"><a href="classPCAHandler.html#ae232ab07ae839b755912c7e23f3c835f">PCAHandler::SetParCurrPCA</a></div><div class="ttdeci">void SetParCurrPCA(const int i, const double value)</div><div class="ttdoc">Set current value for parameter in PCA base.</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8h_source.html#l00165">PCAHandler.h:165</a></div></div>
<div class="ttc" id="anamespaceM3_html_a5ed0accdbf66626c16b6c3b00bd5d030"><div class="ttname"><a href="namespaceM3.html#a5ed0accdbf66626c16b6c3b00bd5d030">M3::GetThreadIndex</a></div><div class="ttdeci">int GetThreadIndex()</div><div class="ttdoc">thread index inside parallel loop</div><div class="ttdef"><b>Definition:</b> <a href="Monitor_8h_source.html#l00086">Monitor.h:86</a></div></div>
<div class="ttc" id="anamespaceM3_html_a99622fe57c7a13d75de4d3c3561b530d"><div class="ttname"><a href="namespaceM3.html#a99622fe57c7a13d75de4d3c3561b530d">M3::MatrixVectorMultiSingle</a></div><div class="ttdeci">double MatrixVectorMultiSingle(double **_restrict_ matrix, const double *_restrict_ vector, const int Length, const int i)</div><div class="ttdoc">KS: Custom function to perform multiplication of matrix and single element which is thread safe.</div><div class="ttdef"><b>Definition:</b> <a href="ParameterHandlerUtils_8h_source.html#l00137">ParameterHandlerUtils.h:137</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a17507b0213fe0c49a3a8b40dc7d1031e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17507b0213fe0c49a3a8b40dc7d1031e">&#9670;&nbsp;</a></span>ToggleFixAllParameters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::ToggleFixAllParameters </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>Names</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>fix parameters at prior values </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00294">294</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                                                         {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>; i++) <a class="code" href="classPCAHandler.html#ac3f1dcc5f5cf931dbfeefa077c8f74ef">ToggleFixParameter</a>(i, Names);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div>
<div class="ttc" id="aclassPCAHandler_html_ac3f1dcc5f5cf931dbfeefa077c8f74ef"><div class="ttname"><a href="classPCAHandler.html#ac3f1dcc5f5cf931dbfeefa077c8f74ef">PCAHandler::ToggleFixParameter</a></div><div class="ttdeci">void ToggleFixParameter(const int i, const std::vector&lt; std::string &gt; &amp;Names)</div><div class="ttdoc">fix parameters at prior values</div><div class="ttdef"><b>Definition:</b> <a href="PCAHandler_8cpp_source.html#l00300">PCAHandler.cpp:300</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac3f1dcc5f5cf931dbfeefa077c8f74ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3f1dcc5f5cf931dbfeefa077c8f74ef">&#9670;&nbsp;</a></span>ToggleFixParameter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::ToggleFixParameter </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>Names</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>fix parameters at prior values </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00300">300</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                                                                                  {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordtype">int</span> isDecom = -1;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> im = 0; im &lt; <a class="code" href="classPCAHandler.html#a5f08019f3db758953464fb1d0db71ea0">NumParPCA</a>; ++im) {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classPCAHandler.html#a10fecf91a038d034f55a08332dec0f4a">isDecomposedPCA</a>[im] == i) {isDecom = im;}</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordflow">if</span>(isDecom &lt; 0) {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Parameter {} is PCA decomposed can&#39;t fix this&quot;</span>, Names[i]);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="comment">//throw MaCh3Exception(__FILE__ , __LINE__ );</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="classPCAHandler.html#aa9b859239b5e5c8e2bd35ad2118bf2dc">_fErrorPCA</a>[isDecom] *= -1.0;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classPCAHandler.html#a5087aa5aba191f31170c1108210cdb26">IsParameterFixedPCA</a>(i)) <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Setting un-decomposed {}(parameter {}/{} in PCA base) to fixed at {}&quot;</span>, Names[i], i, isDecom, (*<a class="code" href="classPCAHandler.html#a6bea0a66f8f09ec08ee398a377a1f437">_pCurrVal</a>)[i]);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">else</span> <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Setting un-decomposed {}(parameter {}/{} in PCA base) free&quot;</span>, Names[i], i, isDecom);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a93e5548b530c1cc6158e62f497ca3c59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93e5548b530c1cc6158e62f497ca3c59">&#9670;&nbsp;</a></span>TransferToParam()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::TransferToParam </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Transfer param values from PCA base to normal base. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00255">255</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                 {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="comment">// Make the temporary vectors</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  TVectorD fParProp_vec = <a class="code" href="classPCAHandler.html#a1d9302633ed96ec57fbe26d25cbcee61">TransferMat</a>*<a class="code" href="classPCAHandler.html#a407f24e3c76f3651a5f20cc2cab274f8">_fParPropPCA</a>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  TVectorD fParCurr_vec = <a class="code" href="classPCAHandler.html#a1d9302633ed96ec57fbe26d25cbcee61">TransferMat</a>*<a class="code" href="classPCAHandler.html#af1cd7c1c4471d99395efe53610a5357a">_fParCurrPCA</a>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; static_cast&lt;int&gt;(<a class="code" href="classPCAHandler.html#a6bea0a66f8f09ec08ee398a377a1f437">_pCurrVal</a>-&gt;size()); ++i) {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    (*_pPropVal)[i] = fParProp_vec(i);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    (*_pCurrVal)[i] = fParCurr_vec(i);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a7782b7f998d5a53ab88d76a41ff73fe4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7782b7f998d5a53ab88d76a41ff73fe4">&#9670;&nbsp;</a></span>TransferToPCA()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PCAHandler::TransferToPCA </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Transfer param values from normal base to PCA base. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8cpp_source.html#l00230">230</a> of file <a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                               {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">// ********************************************</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="comment">// Make the temporary vectors</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  TVectorD fParCurr_vec(<span class="keyword">static_cast&lt;</span>Int_t<span class="keyword">&gt;</span>(<a class="code" href="classPCAHandler.html#a6bea0a66f8f09ec08ee398a377a1f437">_pCurrVal</a>-&gt;size()));</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  TVectorD fParProp_vec(<span class="keyword">static_cast&lt;</span>Int_t<span class="keyword">&gt;</span>(<a class="code" href="classPCAHandler.html#a6bea0a66f8f09ec08ee398a377a1f437">_pCurrVal</a>-&gt;size()));</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; static_cast&lt;int&gt;(<a class="code" href="classPCAHandler.html#a6bea0a66f8f09ec08ee398a377a1f437">_pCurrVal</a>-&gt;size()); ++i) {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    fParCurr_vec(i) = (*_pCurrVal)[i];</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    fParProp_vec(i) = (*_pPropVal)[i];</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <a class="code" href="classPCAHandler.html#af1cd7c1c4471d99395efe53610a5357a">_fParCurrPCA</a> = <a class="code" href="classPCAHandler.html#a6f6443a487bb544e6a6e458d86f35f27">TransferMatT</a>*fParCurr_vec;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <a class="code" href="classPCAHandler.html#a407f24e3c76f3651a5f20cc2cab274f8">_fParPropPCA</a> = <a class="code" href="classPCAHandler.html#a6f6443a487bb544e6a6e458d86f35f27">TransferMatT</a>*fParProp_vec;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="aa9b859239b5e5c8e2bd35ad2118bf2dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9b859239b5e5c8e2bd35ad2118bf2dc">&#9670;&nbsp;</a></span>_fErrorPCA</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;double&gt; PCAHandler::_fErrorPCA</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Tells if parameter is fixed in PCA base or not. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00233">233</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="af1cd7c1c4471d99395efe53610a5357a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1cd7c1c4471d99395efe53610a5357a">&#9670;&nbsp;</a></span>_fParCurrPCA</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">TVectorD PCAHandler::_fParCurrPCA</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Proposed parameter value in PCA base. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00231">231</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="a407f24e3c76f3651a5f20cc2cab274f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a407f24e3c76f3651a5f20cc2cab274f8">&#9670;&nbsp;</a></span>_fParPropPCA</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">TVectorD PCAHandler::_fParPropPCA</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Current parameter value in PCA base. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00229">229</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="ac0bd8123d71c40d713048ec4131d6b13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0bd8123d71c40d713048ec4131d6b13">&#9670;&nbsp;</a></span>_fPreFitValuePCA</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;double&gt; PCAHandler::_fPreFitValuePCA</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prefit value for PCA params. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00227">227</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="a6bea0a66f8f09ec08ee398a377a1f437"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6bea0a66f8f09ec08ee398a377a1f437">&#9670;&nbsp;</a></span>_pCurrVal</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;double&gt;* PCAHandler::_pCurrVal</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Pointer to current value of the parameter. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00260">260</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="a86d7b6c405ee97ebad2f5c8fe47ce4ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86d7b6c405ee97ebad2f5c8fe47ce4ee">&#9670;&nbsp;</a></span>_pPropVal</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;double&gt;* PCAHandler::_pPropVal</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Pointer to proposed value of the parameter. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00262">262</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="afdf5f929fe9211a2ce05f6bab2b8633a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdf5f929fe9211a2ce05f6bab2b8633a">&#9670;&nbsp;</a></span>eigen_threshold</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double PCAHandler::eigen_threshold</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Threshold based on which we remove parameters in eigen base. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00257">257</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="a8d95ecb29e091e9b09c5011691516c28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d95ecb29e091e9b09c5011691516c28">&#9670;&nbsp;</a></span>eigen_values</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">TVectorD PCAHandler::eigen_values</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Eigen value only of particles which are being decomposed. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00244">244</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="a2924386fef0cf65215c51b4f81cdb0d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2924386fef0cf65215c51b4f81cdb0d1">&#9670;&nbsp;</a></span>eigen_values_master</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;double&gt; PCAHandler::eigen_values_master</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Eigen values which have dimension equal to _fNumParPCA, and can be used in CorrelateSteps. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00248">248</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="a3ba9d34343ce0d0eeb4c020fa70486e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ba9d34343ce0d0eeb4c020fa70486e2">&#9670;&nbsp;</a></span>eigen_vectors</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">TMatrixD PCAHandler::eigen_vectors</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Eigen vectors only of params which are being decomposed. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00246">246</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="afc00f628b947fd407d05790f4d0eaaec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc00f628b947fd407d05790f4d0eaaec">&#9670;&nbsp;</a></span>FirstPCAdpar</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int PCAHandler::FirstPCAdpar</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Index of the first param that is being decomposed. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00253">253</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="a10fecf91a038d034f55a08332dec0f4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10fecf91a038d034f55a08332dec0f4a">&#9670;&nbsp;</a></span>isDecomposedPCA</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;int&gt; PCAHandler::isDecomposedPCA</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If param is decomposed this will return -1, if not this will return enumerator to param in normal base. This way we can map stuff like step scale etc between normal base and undecomposed param in eigen base. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00235">235</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="a954eeb975f1d7f9528ed7e027a54b21a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a954eeb975f1d7f9528ed7e027a54b21a">&#9670;&nbsp;</a></span>LastPCAdpar</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int PCAHandler::LastPCAdpar</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Index of the last param that is being decomposed. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00255">255</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="aa39db9118399bebcdb784fe9c9fea458"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa39db9118399bebcdb784fe9c9fea458">&#9670;&nbsp;</a></span>nKeptPCApars</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int PCAHandler::nKeptPCApars</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Total number that remained after applying PCA Threshold. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00251">251</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="a5f08019f3db758953464fb1d0db71ea0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f08019f3db758953464fb1d0db71ea0">&#9670;&nbsp;</a></span>NumParPCA</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int PCAHandler::NumParPCA</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of parameters in PCA base. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00237">237</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="a1d9302633ed96ec57fbe26d25cbcee61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d9302633ed96ec57fbe26d25cbcee61">&#9670;&nbsp;</a></span>TransferMat</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">TMatrixD PCAHandler::TransferMat</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Matrix used to converting from PCA base to normal base. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00240">240</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<a id="a6f6443a487bb544e6a6e458d86f35f27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f6443a487bb544e6a6e458d86f35f27">&#9670;&nbsp;</a></span>TransferMatT</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">TMatrixD PCAHandler::TransferMatT</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Matrix used to converting from normal base to PCA base. </p>

<p class="definition">Definition at line <a class="el" href="PCAHandler_8h_source.html#l00242">242</a> of file <a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>Parameters/<a class="el" href="PCAHandler_8h_source.html">PCAHandler.h</a></li>
<li>Parameters/<a class="el" href="PCAHandler_8cpp_source.html">PCAHandler.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- Footer for MaCh3 Doxygen documentation -->
<footer class="mach3-footer" style="text-align: center;">
    <div style="margin-bottom: 15px;">
        <span style="font-weight: bold;">The MaCh3 Collaboration</span>
    </div>
    <!-- Dropdown to jump between doc versions -->
    <div style="margin-bottom: 10px;">
        <span>Select Software Version: </span>
        <select id="versionSelector" onchange="window.location.href=this.value" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="">-- Select --</option>
            <option value="https://mach3-software.github.io/MaCh3/">develop</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.4.0/index.html">v2.4.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.3.0/index.html">v2.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.2.0/index.html">v2.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.1.0/index.html">v2.1.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.0.0/index.html">v2.0.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.5.0/index.html">v1.5.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.4.0/index.html">v1.4.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.3.0/index.html">v1.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.2.0/index.html">v1.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.1.0/index.html">v1.1.0</option>
        </select>
    </div>
    <!-- Footer info about doxygen -->
    <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
        Documentation generated with
        <a href="https://www.doxygen.nl/" target="_blank" style="color: #666;">Doxygen</a>
        <span id="doxygenVersion"></span>
    </div>
    <!-- Now grab doxygen version from metadata -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const meta = document.querySelector('meta[name="generator"]');
        if (meta) {
            const version = meta.getAttribute("content").replace("Doxygen ", "");
            document.getElementById("doxygenVersion").textContent = " " + version;
        }
    });
    </script>
</footer>
