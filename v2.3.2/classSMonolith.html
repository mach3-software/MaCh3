<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MaCh3: SMonolith Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="MaCh3.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mach3logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MaCh3
   &#160;<span id="projectnumber">2.3.2</span>
   </div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classSMonolith-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">SMonolith Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Even-by-event class calculating response for spline parameters. It is possible to use GPU acceleration.  
 <a href="classSMonolith.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="SplineMonolith_8h_source.html">Splines/SplineMonolith.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for SMonolith:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="classSMonolith__inherit__graph.svg" width="99" height="112"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for SMonolith:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="classSMonolith__coll__graph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab94ae8ed43de245bff67b8e18159b5e1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ab94ae8ed43de245bff67b8e18159b5e1">SMonolith</a> (std::vector&lt; std::vector&lt; <a class="el" href="classTResponseFunction__red.html">TResponseFunction_red</a> * &gt; &gt; &amp;MasterSpline, const std::vector&lt; <a class="el" href="ParameterStructs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36d">RespFuncType</a> &gt; &amp;SplineType, const bool SaveFlatTree=false, const std::string &amp;_FastSplineName=&quot;SplineFile.root&quot;)</td></tr>
<tr class="memdesc:ab94ae8ed43de245bff67b8e18159b5e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="classSMonolith.html#ab94ae8ed43de245bff67b8e18159b5e1">More...</a><br /></td></tr>
<tr class="separator:ab94ae8ed43de245bff67b8e18159b5e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ddb60ccfabbb433c316fde62e93e8df"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a2ddb60ccfabbb433c316fde62e93e8df">SMonolith</a> (const std::string &amp;FileName)</td></tr>
<tr class="memdesc:a2ddb60ccfabbb433c316fde62e93e8df"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor where you pass path to preprocessed root FileName.  <a href="classSMonolith.html#a2ddb60ccfabbb433c316fde62e93e8df">More...</a><br /></td></tr>
<tr class="separator:a2ddb60ccfabbb433c316fde62e93e8df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0ae7f110fa4c6e46e808d8c1ae979b6"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac0ae7f110fa4c6e46e808d8c1ae979b6">~SMonolith</a> ()</td></tr>
<tr class="memdesc:ac0ae7f110fa4c6e46e808d8c1ae979b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor for <a class="el" href="classSMonolith.html" title="Even-by-event class calculating response for spline parameters. It is possible to use GPU acceleratio...">SMonolith</a> class.  <a href="classSMonolith.html#ac0ae7f110fa4c6e46e808d8c1ae979b6">More...</a><br /></td></tr>
<tr class="separator:ac0ae7f110fa4c6e46e808d8c1ae979b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d1128bb78b165d94721407a124f516b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a3d1128bb78b165d94721407a124f516b">Evaluate</a> () override</td></tr>
<tr class="memdesc:a3d1128bb78b165d94721407a124f516b"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: This Eval should be used when using two separate x,{y,a,b,c,d} arrays to store the weights; probably the best one here! Same thing but pass parameter spline segments instead of variations.  <a href="classSMonolith.html#a3d1128bb78b165d94721407a124f516b">More...</a><br /></td></tr>
<tr class="separator:a3d1128bb78b165d94721407a124f516b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff3fd93c09096cc362fb9944306d976f"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aff3fd93c09096cc362fb9944306d976f">GetName</a> () const override</td></tr>
<tr class="memdesc:aff3fd93c09096cc362fb9944306d976f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get class name.  <a href="classSMonolith.html#aff3fd93c09096cc362fb9944306d976f">More...</a><br /></td></tr>
<tr class="separator:aff3fd93c09096cc362fb9944306d976f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68e18d73ed1ac524ceaea79d2a5460ce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a68e18d73ed1ac524ceaea79d2a5460ce">SynchroniseMemTransfer</a> ()</td></tr>
<tr class="memdesc:a68e18d73ed1ac524ceaea79d2a5460ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: After calculations are done on GPU we copy memory to CPU. This operation is asynchronous meaning while memory is being copied some operations are being carried. Memory must be copied before actual reweight. This function make sure all has been copied.  <a href="classSMonolith.html#a68e18d73ed1ac524ceaea79d2a5460ce">More...</a><br /></td></tr>
<tr class="separator:a68e18d73ed1ac524ceaea79d2a5460ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80a8b4afea2815cf3bbf29342df7dfd5"><td class="memItemLeft" align="right" valign="top">const float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a80a8b4afea2815cf3bbf29342df7dfd5">retPointer</a> (const int event)</td></tr>
<tr class="memdesc:a80a8b4afea2815cf3bbf29342df7dfd5"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Get pointer to total weight to make fit faster wrooom!  <a href="classSMonolith.html#a80a8b4afea2815cf3bbf29342df7dfd5">More...</a><br /></td></tr>
<tr class="separator:a80a8b4afea2815cf3bbf29342df7dfd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40f6b9256a18fa59009e5961aec776ff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a40f6b9256a18fa59009e5961aec776ff">setSplinePointers</a> (std::vector&lt; const double * &gt; spline_ParsPointers)</td></tr>
<tr class="memdesc:a40f6b9256a18fa59009e5961aec776ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Set pointers to spline params.  <a href="classSMonolith.html#a40f6b9256a18fa59009e5961aec776ff">More...</a><br /></td></tr>
<tr class="separator:a40f6b9256a18fa59009e5961aec776ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2cacbb68bad46a345672339dd7150b6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#af2cacbb68bad46a345672339dd7150b6">PrepareSplineFile</a> (std::string FileName) override</td></tr>
<tr class="memdesc:af2cacbb68bad46a345672339dd7150b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Prepare spline file that can be used for fast loading.  <a href="classSMonolith.html#af2cacbb68bad46a345672339dd7150b6">More...</a><br /></td></tr>
<tr class="separator:af2cacbb68bad46a345672339dd7150b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adeda10c85b2835adf8219cb460ae2db3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#adeda10c85b2835adf8219cb460ae2db3">LoadSplineFile</a> (std::string FileName) override</td></tr>
<tr class="memdesc:adeda10c85b2835adf8219cb460ae2db3"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Load preprocessed spline file.  <a href="classSMonolith.html#adeda10c85b2835adf8219cb460ae2db3">More...</a><br /></td></tr>
<tr class="separator:adeda10c85b2835adf8219cb460ae2db3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classSplineBase"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classSplineBase')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classSplineBase.html">SplineBase</a></td></tr>
<tr class="memitem:aa6965d1522cc68ecf81ac3bfd2dcd6f1 inherit pub_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase</a> ()</td></tr>
<tr class="memdesc:aa6965d1522cc68ecf81ac3bfd2dcd6f1 inherit pub_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">More...</a><br /></td></tr>
<tr class="separator:aa6965d1522cc68ecf81ac3bfd2dcd6f1 inherit pub_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0de19b2322edb4197380506d594456bd inherit pub_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#a0de19b2322edb4197380506d594456bd">~SplineBase</a> ()</td></tr>
<tr class="memdesc:a0de19b2322edb4197380506d594456bd inherit pub_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <a href="classSplineBase.html#a0de19b2322edb4197380506d594456bd">More...</a><br /></td></tr>
<tr class="separator:a0de19b2322edb4197380506d594456bd inherit pub_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af825e2661f4a52c146973edf35de9afb inherit pub_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">short int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#af825e2661f4a52c146973edf35de9afb">GetNParams</a> () const</td></tr>
<tr class="memdesc:af825e2661f4a52c146973edf35de9afb inherit pub_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get number of spline parameters.  <a href="classSplineBase.html#af825e2661f4a52c146973edf35de9afb">More...</a><br /></td></tr>
<tr class="separator:af825e2661f4a52c146973edf35de9afb inherit pub_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a8614e8ef07431d99f62ab88d9ebdad16"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a></td></tr>
<tr class="memdesc:a8614e8ef07431d99f62ab88d9ebdad16"><td class="mdescLeft">&#160;</td><td class="mdescRight">The returned gpu weights, read by the GPU.  <a href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">More...</a><br /></td></tr>
<tr class="separator:a8614e8ef07431d99f62ab88d9ebdad16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab572dd7e0a46caf44eb925a89cbfb0cf"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a></td></tr>
<tr class="memdesc:ab572dd7e0a46caf44eb925a89cbfb0cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: This holds the total CPU weights that gets read in samplePDFND.  <a href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">More...</a><br /></td></tr>
<tr class="separator:ab572dd7e0a46caf44eb925a89cbfb0cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a45cece9dcbe699e00a7b5fdff4806c1e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">Initialise</a> ()</td></tr>
<tr class="memdesc:a45cece9dcbe699e00a7b5fdff4806c1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Set everything to null etc.  <a href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">More...</a><br /></td></tr>
<tr class="separator:a45cece9dcbe699e00a7b5fdff4806c1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2a015f3d6f4f8a51d27f8cd8a67c229"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#af2a015f3d6f4f8a51d27f8cd8a67c229">ScanMasterSpline</a> (std::vector&lt; std::vector&lt; <a class="el" href="classTResponseFunction__red.html">TResponseFunction_red</a> * &gt; &gt; &amp;MasterSpline, unsigned int &amp;nEvents, short int &amp;MaxPoints, short int &amp;numParams, int &amp;nSplines, unsigned int &amp;NSplinesValid, unsigned int &amp;numKnots, unsigned int &amp;nTF1Valid, unsigned int &amp;nTF1_coeff, const std::vector&lt; <a class="el" href="ParameterStructs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36d">RespFuncType</a> &gt; &amp;SplineType)</td></tr>
<tr class="memdesc:af2a015f3d6f4f8a51d27f8cd8a67c229"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Function to scan through the MasterSpline of TSpline3.  <a href="classSMonolith.html#af2a015f3d6f4f8a51d27f8cd8a67c229">More...</a><br /></td></tr>
<tr class="separator:af2a015f3d6f4f8a51d27f8cd8a67c229"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1bd2dc5c55b7258d5544512659ef9d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aa1bd2dc5c55b7258d5544512659ef9d7">PrepareForGPU</a> (std::vector&lt; std::vector&lt; <a class="el" href="classTResponseFunction__red.html">TResponseFunction_red</a> * &gt; &gt; &amp;MasterSpline, const std::vector&lt; <a class="el" href="ParameterStructs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36d">RespFuncType</a> &gt; &amp;SplineType)</td></tr>
<tr class="memdesc:aa1bd2dc5c55b7258d5544512659ef9d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Prepare the <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> objects for the GPU.  <a href="classSMonolith.html#aa1bd2dc5c55b7258d5544512659ef9d7">More...</a><br /></td></tr>
<tr class="separator:aa1bd2dc5c55b7258d5544512659ef9d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac73a1089592c5f22755b7427869827f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aac73a1089592c5f22755b7427869827f">MoveToGPU</a> ()</td></tr>
<tr class="memdesc:aac73a1089592c5f22755b7427869827f"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: The shared initialiser from constructors of <a class="el" href="classTResponseFunction__red.html" title="KS: A reduced ResponseFunction Generic function used for evaluating weight.">TResponseFunction_red</a>.  <a href="classSMonolith.html#aac73a1089592c5f22755b7427869827f">More...</a><br /></td></tr>
<tr class="separator:aac73a1089592c5f22755b7427869827f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c374d4505de53ad68d176a5644568e6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a5c374d4505de53ad68d176a5644568e6">PrintInitialsiation</a> ()</td></tr>
<tr class="memdesc:a5c374d4505de53ad68d176a5644568e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Print info about how much knots etc has been initialised.  <a href="classSMonolith.html#a5c374d4505de53ad68d176a5644568e6">More...</a><br /></td></tr>
<tr class="separator:a5c374d4505de53ad68d176a5644568e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbbe3398718d0d02d65a1e92a91c112c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#acbbe3398718d0d02d65a1e92a91c112c">getSplineCoeff_SepMany</a> (<a class="el" href="classTSpline3__red.html">TSpline3_red</a> *&amp;spl, int &amp;nPoints, float *&amp;xArray, float *&amp;manyArray)</td></tr>
<tr class="memdesc:acbbe3398718d0d02d65a1e92a91c112c"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: This loads up coefficients into two arrays: one x array and one yabcd array.  <a href="classSMonolith.html#acbbe3398718d0d02d65a1e92a91c112c">More...</a><br /></td></tr>
<tr class="separator:acbbe3398718d0d02d65a1e92a91c112c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa36be17828281e1412a93c0e239cdbc0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aa36be17828281e1412a93c0e239cdbc0">CalcSplineWeights</a> () override</td></tr>
<tr class="memdesc:aa36be17828281e1412a93c0e239cdbc0"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU based code which eval weight for each spline.  <a href="classSMonolith.html#aa36be17828281e1412a93c0e239cdbc0">More...</a><br /></td></tr>
<tr class="separator:aa36be17828281e1412a93c0e239cdbc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac37ee525aa57316f652433a4e393afaf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac37ee525aa57316f652433a4e393afaf">ModifyWeights</a> () override</td></tr>
<tr class="memdesc:ac37ee525aa57316f652433a4e393afaf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calc total event weight.  <a href="classSMonolith.html#ac37ee525aa57316f652433a4e393afaf">More...</a><br /></td></tr>
<tr class="separator:ac37ee525aa57316f652433a4e393afaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72cd282322bdaadb23d8a376efa9e2c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a72cd282322bdaadb23d8a376efa9e2c1">ModifyWeights_GPU</a> ()</td></tr>
<tr class="memdesc:a72cd282322bdaadb23d8a376efa9e2c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Conversion from valid splines to all.  <a href="classSMonolith.html#a72cd282322bdaadb23d8a376efa9e2c1">More...</a><br /></td></tr>
<tr class="separator:a72cd282322bdaadb23d8a376efa9e2c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:afa782652b0b3da923c5b20bb1319aadd"><td class="memItemLeft" align="right" valign="top">std::vector&lt; const double * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">splineParsPointer</a></td></tr>
<tr class="memdesc:afa782652b0b3da923c5b20bb1319aadd"><td class="mdescLeft">&#160;</td><td class="mdescRight">This holds pointer to parameter position which we later copy paste it to GPU.  <a href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">More...</a><br /></td></tr>
<tr class="separator:afa782652b0b3da923c5b20bb1319aadd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac86282b04659bae5cccb6073c9edc0a5"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a></td></tr>
<tr class="memdesc:ac86282b04659bae5cccb6073c9edc0a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of events.  <a href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">More...</a><br /></td></tr>
<tr class="separator:ac86282b04659bae5cccb6073c9edc0a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af54ea9c613ef95b36dcf9c194dd38e85"><td class="memItemLeft" align="right" valign="top">short int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a></td></tr>
<tr class="memdesc:af54ea9c613ef95b36dcf9c194dd38e85"><td class="mdescLeft">&#160;</td><td class="mdescRight">Max knots for production.  <a href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">More...</a><br /></td></tr>
<tr class="separator:af54ea9c613ef95b36dcf9c194dd38e85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c4fa00b6e36d150d52e87e6463aabaa"><td class="memItemLeft" align="right" valign="top">std::vector&lt; int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a9c4fa00b6e36d150d52e87e6463aabaa">index_spline_cpu</a></td></tr>
<tr class="memdesc:a9c4fa00b6e36d150d52e87e6463aabaa"><td class="mdescLeft">&#160;</td><td class="mdescRight">holds the index for good splines; don't do unsigned since starts with negative value!  <a href="classSMonolith.html#a9c4fa00b6e36d150d52e87e6463aabaa">More...</a><br /></td></tr>
<tr class="separator:a9c4fa00b6e36d150d52e87e6463aabaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a723920c6c324901ac0fa48df7aad64cd"><td class="memItemLeft" align="right" valign="top">std::vector&lt; int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a723920c6c324901ac0fa48df7aad64cd">index_TF1_cpu</a></td></tr>
<tr class="memdesc:a723920c6c324901ac0fa48df7aad64cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">holds the index for good TF1; don't do unsigned since starts with negative value!  <a href="classSMonolith.html#a723920c6c324901ac0fa48df7aad64cd">More...</a><br /></td></tr>
<tr class="separator:a723920c6c324901ac0fa48df7aad64cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab72795333d6f632565b0f7eb0ca8a658"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a></td></tr>
<tr class="memdesc:ab72795333d6f632565b0f7eb0ca8a658"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of valid splines.  <a href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">More...</a><br /></td></tr>
<tr class="separator:ab72795333d6f632565b0f7eb0ca8a658"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13699796db31517edba3a8009317f779"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a></td></tr>
<tr class="memdesc:a13699796db31517edba3a8009317f779"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of valid TF1.  <a href="classSMonolith.html#a13699796db31517edba3a8009317f779">More...</a><br /></td></tr>
<tr class="separator:a13699796db31517edba3a8009317f779"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee3c18513f8209f1ac940b492cd3ed68"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a></td></tr>
<tr class="memdesc:aee3c18513f8209f1ac940b492cd3ed68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of total splines if each event had every parameter's spline.  <a href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">More...</a><br /></td></tr>
<tr class="separator:aee3c18513f8209f1ac940b492cd3ed68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc0e3d1eafd575cf7628319a66925d5b"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a></td></tr>
<tr class="memdesc:afc0e3d1eafd575cf7628319a66925d5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sum of all knots over all splines.  <a href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">More...</a><br /></td></tr>
<tr class="separator:afc0e3d1eafd575cf7628319a66925d5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a403e7cf909f98d4c59b5f6c7ff8aac5b"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a></td></tr>
<tr class="memdesc:a403e7cf909f98d4c59b5f6c7ff8aac5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sum of all coefficients over all TF1.  <a href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">More...</a><br /></td></tr>
<tr class="separator:a403e7cf909f98d4c59b5f6c7ff8aac5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a870bb2bce61e17162b9425f82cf2a099"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a870bb2bce61e17162b9425f82cf2a099">cpu_weights_spline_var</a></td></tr>
<tr class="memdesc:a870bb2bce61e17162b9425f82cf2a099"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU arrays to hold weight for each spline.  <a href="classSMonolith.html#a870bb2bce61e17162b9425f82cf2a099">More...</a><br /></td></tr>
<tr class="separator:a870bb2bce61e17162b9425f82cf2a099"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a1d45d273cc40cb4f684400812dcb60"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a></td></tr>
<tr class="memdesc:a4a1d45d273cc40cb4f684400812dcb60"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU arrays to hold weight for each TF1.  <a href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">More...</a><br /></td></tr>
<tr class="separator:a4a1d45d273cc40cb4f684400812dcb60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a6599372d1e3d38105478a68308d9a6"><td class="memItemLeft" align="right" valign="top">std::vector&lt; unsigned int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a></td></tr>
<tr class="memdesc:a0a6599372d1e3d38105478a68308d9a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}.  <a href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">More...</a><br /></td></tr>
<tr class="separator:a0a6599372d1e3d38105478a68308d9a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66eecc550dea893c60a435a034e7ebf5"><td class="memItemLeft" align="right" valign="top">std::vector&lt; unsigned int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a></td></tr>
<tr class="memdesc:a66eecc550dea893c60a435a034e7ebf5"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number of TF1 per event, index where TF1 start for a given event}.  <a href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">More...</a><br /></td></tr>
<tr class="separator:a66eecc550dea893c60a435a034e7ebf5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48d0e5e5b4130fcd191c3e8f1d841eb7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structSplineMonoStruct.html">SplineMonoStruct</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a></td></tr>
<tr class="memdesc:a48d0e5e5b4130fcd191c3e8f1d841eb7"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Store info about Spline monolith, this allow to obtain better step time. As all necessary information for spline weight calculation are here meaning better cache hits.  <a href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">More...</a><br /></td></tr>
<tr class="separator:a48d0e5e5b4130fcd191c3e8f1d841eb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03444cbed8a9d9a7798d0ef2b26bd702"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classSMonolithGPU.html">SMonolithGPU</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a></td></tr>
<tr class="memdesc:a03444cbed8a9d9a7798d0ef2b26bd702"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Store info about Spline monolith, this allow to obtain better step time. As all necessary information for spline weight calculation are here meaning better cache hits.  <a href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">More...</a><br /></td></tr>
<tr class="separator:a03444cbed8a9d9a7798d0ef2b26bd702"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a456dd14e1693e445ad6dddd5a8b9794f"><td class="memItemLeft" align="right" valign="top">std::vector&lt; float &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a></td></tr>
<tr class="memdesc:a456dd14e1693e445ad6dddd5a8b9794f"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU arrays to hold TF1 coefficients.  <a href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">More...</a><br /></td></tr>
<tr class="separator:a456dd14e1693e445ad6dddd5a8b9794f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14b9c21186a53196f49c8d8d3555fbf2"><td class="memItemLeft" align="right" valign="top">std::vector&lt; short int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a></td></tr>
<tr class="memdesc:a14b9c21186a53196f49c8d8d3555fbf2"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU arrays to hold number of points.  <a href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">More...</a><br /></td></tr>
<tr class="separator:a14b9c21186a53196f49c8d8d3555fbf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af87cf7ae888eb7d4c56f8b6c41c9fd02"><td class="memItemLeft" align="right" valign="top">std::vector&lt; short int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a></td></tr>
<tr class="memdesc:af87cf7ae888eb7d4c56f8b6c41c9fd02"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: CPU array with the number of points per spline (not per spline point!)  <a href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">More...</a><br /></td></tr>
<tr class="separator:af87cf7ae888eb7d4c56f8b6c41c9fd02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5692081772ca14bd012eb125e2ccfd4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">SaveSplineFile</a></td></tr>
<tr class="memdesc:ab5692081772ca14bd012eb125e2ccfd4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag telling whether we are saving spline monolith into handy root file.  <a href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">More...</a><br /></td></tr>
<tr class="separator:ab5692081772ca14bd012eb125e2ccfd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7e91b11f9708a828a521f32f8058fe9"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSMonolith.html#aa7e91b11f9708a828a521f32f8058fe9">FastSplineName</a></td></tr>
<tr class="memdesc:aa7e91b11f9708a828a521f32f8058fe9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Name of Fast Spline to which will be saved.  <a href="classSMonolith.html#aa7e91b11f9708a828a521f32f8058fe9">More...</a><br /></td></tr>
<tr class="separator:aa7e91b11f9708a828a521f32f8058fe9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pro_methods_classSplineBase"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_classSplineBase')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="classSplineBase.html">SplineBase</a></td></tr>
<tr class="memitem:a589011b547ff70262ed43021a016ef30 inherit pro_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#a589011b547ff70262ed43021a016ef30">FindSplineSegment</a> ()</td></tr>
<tr class="memdesc:a589011b547ff70262ed43021a016ef30 inherit pro_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW:Code used in step by step reweighting, Find Spline Segment for each param.  <a href="classSplineBase.html#a589011b547ff70262ed43021a016ef30">More...</a><br /></td></tr>
<tr class="separator:a589011b547ff70262ed43021a016ef30 inherit pro_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7797e26d48519c885e1537373505fcb inherit pro_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#ae7797e26d48519c885e1537373505fcb">PrepareFastSplineInfoDir</a> (std::unique_ptr&lt; TFile &gt; &amp;SplineFile) const</td></tr>
<tr class="memdesc:ae7797e26d48519c885e1537373505fcb inherit pro_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Prepare Fast Spline Info within SplineFile.  <a href="classSplineBase.html#ae7797e26d48519c885e1537373505fcb">More...</a><br /></td></tr>
<tr class="separator:ae7797e26d48519c885e1537373505fcb inherit pro_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4f4b51619ef0573c7f1497f5d1fd52d inherit pro_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#ad4f4b51619ef0573c7f1497f5d1fd52d">LoadFastSplineInfoDir</a> (std::unique_ptr&lt; TFile &gt; &amp;SplineFile)</td></tr>
<tr class="memdesc:ad4f4b51619ef0573c7f1497f5d1fd52d inherit pro_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">KS: Load preprocessed <a class="el" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.">FastSplineInfo</a>.  <a href="classSplineBase.html#ad4f4b51619ef0573c7f1497f5d1fd52d">More...</a><br /></td></tr>
<tr class="separator:ad4f4b51619ef0573c7f1497f5d1fd52d inherit pro_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8a5f86ac6f156a7e11ef188b06f425f inherit pro_methods_classSplineBase"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#ac8a5f86ac6f156a7e11ef188b06f425f">getTF1Coeff</a> (<a class="el" href="classTF1__red.html">TF1_red</a> *&amp;spl, int &amp;nPoints, float *&amp;coeffs)</td></tr>
<tr class="memdesc:ac8a5f86ac6f156a7e11ef188b06f425f inherit pro_methods_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">CW: Gets the polynomial coefficients for TF1.  <a href="classSplineBase.html#ac8a5f86ac6f156a7e11ef188b06f425f">More...</a><br /></td></tr>
<tr class="separator:ac8a5f86ac6f156a7e11ef188b06f425f inherit pro_methods_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_attribs_classSplineBase"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_classSplineBase')"><img src="closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="classSplineBase.html">SplineBase</a></td></tr>
<tr class="memitem:a9452897aecfe016466543dfe19c0628b inherit pro_attribs_classSplineBase"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structFastSplineInfo.html">FastSplineInfo</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#a9452897aecfe016466543dfe19c0628b">SplineInfoArray</a></td></tr>
<tr class="separator:a9452897aecfe016466543dfe19c0628b inherit pro_attribs_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a938e3a60326137037f868b9930e2a972 inherit pro_attribs_classSplineBase"><td class="memItemLeft" align="right" valign="top">short int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#a938e3a60326137037f868b9930e2a972">SplineSegments</a></td></tr>
<tr class="separator:a938e3a60326137037f868b9930e2a972 inherit pro_attribs_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0b1d3a1adf7cffa7e74581bc7d58d4c inherit pro_attribs_classSplineBase"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#aa0b1d3a1adf7cffa7e74581bc7d58d4c">ParamValues</a></td></tr>
<tr class="memdesc:aa0b1d3a1adf7cffa7e74581bc7d58d4c inherit pro_attribs_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store parameter values they are not in <a class="el" href="structFastSplineInfo.html" title="CW: Add a struct to hold info about the splinified xsec parameters and help with FindSplineSegment.">FastSplineInfo</a> as in case of GPU we need to copy paste it to GPU.  <a href="classSplineBase.html#aa0b1d3a1adf7cffa7e74581bc7d58d4c">More...</a><br /></td></tr>
<tr class="separator:aa0b1d3a1adf7cffa7e74581bc7d58d4c inherit pro_attribs_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2165b057a0125a28d96f247ca8680b42 inherit pro_attribs_classSplineBase"><td class="memItemLeft" align="right" valign="top">short int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a></td></tr>
<tr class="memdesc:a2165b057a0125a28d96f247ca8680b42 inherit pro_attribs_classSplineBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of parameters that have splines.  <a href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">More...</a><br /></td></tr>
<tr class="separator:a2165b057a0125a28d96f247ca8680b42 inherit pro_attribs_classSplineBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Even-by-event class calculating response for spline parameters. It is possible to use GPU acceleration. </p>
<dl class="section see"><dt>See also</dt><dd>For more details, visit the <a href="https://github.com/mach3-software/MaCh3/wiki/05.-Splines">Wiki</a>. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Clarence Wret </dd>
<dd>
Kamil Skwarczynski </dd></dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00012">12</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ab94ae8ed43de245bff67b8e18159b5e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab94ae8ed43de245bff67b8e18159b5e1">&#9670;&nbsp;</a></span>SMonolith() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SMonolith::SMonolith </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classTResponseFunction__red.html">TResponseFunction_red</a> * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="ParameterStructs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36d">RespFuncType</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>SplineType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>SaveFlatTree</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>_FastSplineName</em> = <code>&quot;SplineFile.root&quot;</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of TSpline3 pointers which we strip back </td></tr>
    <tr><td class="paramname">SplineType</td><td>Whether object is TSpline3 or TF1 </td></tr>
    <tr><td class="paramname">SaveFlatTree</td><td>Whether we want to save monolith into speedy flat tree </td></tr>
    <tr><td class="paramname">_FastSplineName</td><td>Name to which spline file will be saved </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00038">38</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;: <a class="code" href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase</a>() {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="comment">//KS: If true it will save spline monolith into huge ROOT file</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <a class="code" href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">SaveSplineFile</a> = SaveFlatTree;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="classSMonolith.html#aa7e91b11f9708a828a521f32f8058fe9">FastSplineName</a> = _FastSplineName;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <a class="code" href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">Initialise</a>();</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;-- GPUING WITH arrays and master spline containing TResponseFunction_red&quot;</span>);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="comment">// Convert the TSpline3 pointers to the reduced form and call the reduced constructor</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="classSMonolith.html#aa1bd2dc5c55b7258d5544512659ef9d7">PrepareForGPU</a>(MasterSpline, SplineType);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
<div class="ttc" id="aMaCh3Logger_8h_html_a95fa4dffc648e4c5536c9292c2bdcac3"><div class="ttname"><a href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a></div><div class="ttdeci">#define MACH3LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Logger_8h_source.html#l00035">MaCh3Logger.h:35</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a45cece9dcbe699e00a7b5fdff4806c1e"><div class="ttname"><a href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">SMonolith::Initialise</a></div><div class="ttdeci">void Initialise()</div><div class="ttdoc">KS: Set everything to null etc.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00012">SplineMonolith.cpp:12</a></div></div>
<div class="ttc" id="aclassSMonolith_html_aa1bd2dc5c55b7258d5544512659ef9d7"><div class="ttname"><a href="classSMonolith.html#aa1bd2dc5c55b7258d5544512659ef9d7">SMonolith::PrepareForGPU</a></div><div class="ttdeci">void PrepareForGPU(std::vector&lt; std::vector&lt; TResponseFunction_red * &gt; &gt; &amp;MasterSpline, const std::vector&lt; RespFuncType &gt; &amp;SplineType)</div><div class="ttdoc">CW: Prepare the TSpline3_red objects for the GPU.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00056">SplineMonolith.cpp:56</a></div></div>
<div class="ttc" id="aclassSMonolith_html_aa7e91b11f9708a828a521f32f8058fe9"><div class="ttname"><a href="classSMonolith.html#aa7e91b11f9708a828a521f32f8058fe9">SMonolith::FastSplineName</a></div><div class="ttdeci">std::string FastSplineName</div><div class="ttdoc">Name of Fast Spline to which will be saved.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00163">SplineMonolith.h:163</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ab5692081772ca14bd012eb125e2ccfd4"><div class="ttname"><a href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">SMonolith::SaveSplineFile</a></div><div class="ttdeci">bool SaveSplineFile</div><div class="ttdoc">Flag telling whether we are saving spline monolith into handy root file.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00160">SplineMonolith.h:160</a></div></div>
<div class="ttc" id="aclassSplineBase_html_aa6965d1522cc68ecf81ac3bfd2dcd6f1"><div class="ttname"><a href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase::SplineBase</a></div><div class="ttdeci">SplineBase()</div><div class="ttdoc">Constructor.</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8cpp_source.html#l00007">SplineBase.cpp:7</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2ddb60ccfabbb433c316fde62e93e8df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ddb60ccfabbb433c316fde62e93e8df">&#9670;&nbsp;</a></span>SMonolith() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SMonolith::SMonolith </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>FileName</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor where you pass path to preprocessed root FileName. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">FileName</td><td>path to pre-processed root file containing stripped monolith info </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00502">502</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          : <a class="code" href="classSplineBase.html#aa6965d1522cc68ecf81ac3bfd2dcd6f1">SplineBase</a>() {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <a class="code" href="classSMonolith.html#a45cece9dcbe699e00a7b5fdff4806c1e">Initialise</a>();</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;-- GPUING WITH {X} and {Y,B,C,D} arrays and master spline containing TSpline3_red&quot;</span>);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="comment">// Convert the TSpline3 pointers to the reduced form and call the reduced constructor</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <a class="code" href="classSMonolith.html#adeda10c85b2835adf8219cb460ae2db3">LoadSplineFile</a>(FileName);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;}</div>
<div class="ttc" id="aclassSMonolith_html_adeda10c85b2835adf8219cb460ae2db3"><div class="ttname"><a href="classSMonolith.html#adeda10c85b2835adf8219cb460ae2db3">SMonolith::LoadSplineFile</a></div><div class="ttdeci">void LoadSplineFile(std::string FileName) override</div><div class="ttdoc">KS: Load preprocessed spline file.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00513">SplineMonolith.cpp:513</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac0ae7f110fa4c6e46e808d8c1ae979b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0ae7f110fa4c6e46e808d8c1ae979b6">&#9670;&nbsp;</a></span>~SMonolith()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">SMonolith::~SMonolith </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor for <a class="el" href="classSMonolith.html" title="Even-by-event class calculating response for spline parameters. It is possible to use GPU acceleratio...">SMonolith</a> class. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00683">683</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                      {</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="preprocessor">  #ifdef MaCh3_CUDA</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <a class="code" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code" href="classSMonolithGPU.html#a1ca23401d8d99412288952a1d44390ea">CleanupGPU_SplineMonolith</a>(</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        #ifndef Weight_On_SplineBySpline_Basis</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        #endif</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        );</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160; </div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="comment">//KS: Since we declared them using CUDA alloc we have to free memory using also cuda functions</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <a class="code" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code" href="classSMonolithGPU.html#af5ca949ba6d79666b541350d24e3daaf">CleanupGPU_Segments</a>(<a class="code" href="classSplineBase.html#a938e3a60326137037f868b9930e2a972">SplineSegments</a>, <a class="code" href="classSplineBase.html#aa0b1d3a1adf7cffa7e74581bc7d58d4c">ParamValues</a>);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <span class="keyword">delete</span> <a class="code" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="preprocessor">  #else</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSplineBase.html#a938e3a60326137037f868b9930e2a972">SplineSegments</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code" href="classSplineBase.html#a938e3a60326137037f868b9930e2a972">SplineSegments</a>;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSplineBase.html#aa0b1d3a1adf7cffa7e74581bc7d58d4c">ParamValues</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code" href="classSplineBase.html#aa0b1d3a1adf7cffa7e74581bc7d58d4c">ParamValues</a>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#a870bb2bce61e17162b9425f82cf2a099">cpu_weights_spline_var</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code" href="classSMonolith.html#a870bb2bce61e17162b9425f82cf2a099">cpu_weights_spline_var</a>;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span>[] <a class="code" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a>;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a> != <span class="keyword">nullptr</span>) <span class="keyword">delete</span> <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;}</div>
<div class="ttc" id="aclassSMonolithGPU_html_a1ca23401d8d99412288952a1d44390ea"><div class="ttname"><a href="classSMonolithGPU.html#a1ca23401d8d99412288952a1d44390ea">SMonolithGPU::CleanupGPU_SplineMonolith</a></div><div class="ttdeci">__host__ void CleanupGPU_SplineMonolith(float *cpu_total_weights)</div><div class="ttdoc">This function deallocates the resources allocated for the separate {x} and {ybcd} arrays in the and T...</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00550">gpuSplineUtils.cu:550</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_af5ca949ba6d79666b541350d24e3daaf"><div class="ttname"><a href="classSMonolithGPU.html#af5ca949ba6d79666b541350d24e3daaf">SMonolithGPU::CleanupGPU_Segments</a></div><div class="ttdeci">__host__ void CleanupGPU_Segments(short int *segment, float *vals)</div><div class="ttdoc">Clean up pinned variables at CPU.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00585">gpuSplineUtils.cu:585</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a03444cbed8a9d9a7798d0ef2b26bd702"><div class="ttname"><a href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">SMonolith::gpu_spline_handler</a></div><div class="ttdeci">SMonolithGPU * gpu_spline_handler</div><div class="ttdoc">KS: Store info about Spline monolith, this allow to obtain better step time. As all necessary informa...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00148">SplineMonolith.h:148</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a48d0e5e5b4130fcd191c3e8f1d841eb7"><div class="ttname"><a href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">SMonolith::cpu_spline_handler</a></div><div class="ttdeci">SplineMonoStruct * cpu_spline_handler</div><div class="ttdoc">KS: Store info about Spline monolith, this allow to obtain better step time. As all necessary informa...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00145">SplineMonolith.h:145</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a4a1d45d273cc40cb4f684400812dcb60"><div class="ttname"><a href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">SMonolith::cpu_weights_tf1_var</a></div><div class="ttdeci">float * cpu_weights_tf1_var</div><div class="ttdoc">CPU arrays to hold weight for each TF1.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00136">SplineMonolith.h:136</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a8614e8ef07431d99f62ab88d9ebdad16"><div class="ttname"><a href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">SMonolith::cpu_weights</a></div><div class="ttdeci">float * cpu_weights</div><div class="ttdoc">The returned gpu weights, read by the GPU.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00051">SplineMonolith.h:48</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a870bb2bce61e17162b9425f82cf2a099"><div class="ttname"><a href="classSMonolith.html#a870bb2bce61e17162b9425f82cf2a099">SMonolith::cpu_weights_spline_var</a></div><div class="ttdeci">float * cpu_weights_spline_var</div><div class="ttdoc">CPU arrays to hold weight for each spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00134">SplineMonolith.h:134</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ab572dd7e0a46caf44eb925a89cbfb0cf"><div class="ttname"><a href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">SMonolith::cpu_total_weights</a></div><div class="ttdeci">float * cpu_total_weights</div><div class="ttdoc">KS: This holds the total CPU weights that gets read in samplePDFND.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00053">SplineMonolith.h:53</a></div></div>
<div class="ttc" id="aclassSplineBase_html_a938e3a60326137037f868b9930e2a972"><div class="ttname"><a href="classSplineBase.html#a938e3a60326137037f868b9930e2a972">SplineBase::SplineSegments</a></div><div class="ttdeci">short int * SplineSegments</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8h_source.html#l00074">SplineBase.h:74</a></div></div>
<div class="ttc" id="aclassSplineBase_html_aa0b1d3a1adf7cffa7e74581bc7d58d4c"><div class="ttname"><a href="classSplineBase.html#aa0b1d3a1adf7cffa7e74581bc7d58d4c">SplineBase::ParamValues</a></div><div class="ttdeci">float * ParamValues</div><div class="ttdoc">Store parameter values they are not in FastSplineInfo as in case of GPU we need to copy paste it to G...</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8h_source.html#l00076">SplineBase.h:76</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aa36be17828281e1412a93c0e239cdbc0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa36be17828281e1412a93c0e239cdbc0">&#9670;&nbsp;</a></span>CalcSplineWeights()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::CalcSplineWeights </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">private</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU based code which eval weight for each spline. </p>

<p>Implements <a class="el" href="classSplineBase.html#a1ceacf5fee1fc8438501582bef93a9b5">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00805">805</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                                  {</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment">//*********************************************************</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="comment">//KS: Open parallel region</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="preprocessor">  #pragma omp parallel</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="comment">//KS: First we calculate</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="preprocessor">    #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="preprocessor">    #pragma omp for simd nowait</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> splineNum = 0; splineNum &lt; <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>; ++splineNum)</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    {</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <span class="comment">//CW: Which Parameter we are accessing</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> Param = <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>[splineNum];</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160; </div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <span class="comment">//CW: Avoids doing costly binary search on GPU</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> segment = <a class="code" href="classSplineBase.html#a938e3a60326137037f868b9930e2a972">SplineSegments</a>[Param];</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160; </div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <span class="comment">//KS: Segment for coeff_x is simply parameter*max knots + segment as each parameters has the same spacing</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> segment_X = short(Param*<a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a>+segment);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160; </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      <span class="comment">//KS: Find knot position in out monolithical structure</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CurrentKnotPos = <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>[splineNum]*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>+segment*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <span class="comment">// We&#39;ve read the segment straight from CPU and is saved in segment_gpu</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="comment">// polynomial parameters from the monolithic splineMonolith</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">float</span> fY = <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>[CurrentKnotPos];</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">float</span> fB = <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>[CurrentKnotPos + 1];</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">float</span> fC = <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>[CurrentKnotPos + 2];</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">float</span> fD = <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>[CurrentKnotPos + 3];</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      <span class="comment">// The is the variation itself (needed to evaluate variation - stored spline point = dx)</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">float</span> dx = <a class="code" href="classSplineBase.html#aa0b1d3a1adf7cffa7e74581bc7d58d4c">ParamValues</a>[Param] - <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>[segment_X];</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="comment">//CW: Wooow, let&#39;s use some fancy intrinsic and pull down the processing time by &lt;1% from normal multiplication! HURRAY</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      <a class="code" href="classSMonolith.html#a870bb2bce61e17162b9425f82cf2a099">cpu_weights_spline_var</a>[splineNum] = fmaf(dx, fmaf(dx, fmaf(dx, fD, fC), fB), fY);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      <span class="comment">// Or for the more &quot;easy to read&quot; version:</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <span class="comment">//cpu_weights_spline_var[splineNum] = (fY+dx*(fB+dx*(fC+dx*fD)));</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    }</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="preprocessor">    #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="preprocessor">    #pragma omp for simd</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tf1Num = 0; tf1Num &lt; <a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>; ++tf1Num)</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      <span class="comment">// The is the variation itself (needed to evaluate variation - stored spline point = dx)</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">float</span> x = <a class="code" href="classSplineBase.html#aa0b1d3a1adf7cffa7e74581bc7d58d4c">ParamValues</a>[<a class="code" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a>[tf1Num]];</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160; </div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      <span class="comment">// Read the coefficients</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> TF1_Index = tf1Num * <a class="code" href="SplineCommon_8h.html#ad6cacf3d45a37eeeeffe38ad24345d54">_nTF1Coeff_</a>;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">float</span> a = <a class="code" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>[TF1_Index];</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">float</span> b = <a class="code" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>[TF1_Index + 1];</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160; </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <a class="code" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a>[tf1Num] = fmaf(a, x, b);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="comment">// cpu_weights_tf1_var[tf1Num] = a*x + b;</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="comment">//cpu_weights_tf1_var[splineNum] = 1 + a*x + b*x*x + c*x*x*x + d*x*x*x*x + e*x*x*x*x*x;</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    }</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="comment">//KS: End parallel region</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  }</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;}</div>
<div class="ttc" id="aSplineCommon_8h_html_a790348db7c20fb9896e94403fbee52cf"><div class="ttname"><a href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a></div><div class="ttdeci">constexpr int _nCoeff_</div><div class="ttdoc">KS: We store coefficients {y,b,c,d} in one array one by one, this is only to define it once rather th...</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00013">SplineCommon.h:13</a></div></div>
<div class="ttc" id="aSplineCommon_8h_html_ad6cacf3d45a37eeeeffe38ad24345d54"><div class="ttname"><a href="SplineCommon_8h.html#ad6cacf3d45a37eeeeffe38ad24345d54">_nTF1Coeff_</a></div><div class="ttdeci">constexpr int _nTF1Coeff_</div><div class="ttdoc">KS: For TF1 we store at most 5 coefficients, we could make it more flexible but for now define it her...</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00015">SplineCommon.h:15</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a13699796db31517edba3a8009317f779"><div class="ttname"><a href="classSMonolith.html#a13699796db31517edba3a8009317f779">SMonolith::NTF1_valid</a></div><div class="ttdeci">unsigned int NTF1_valid</div><div class="ttdoc">Number of valid TF1.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00123">SplineMonolith.h:123</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a456dd14e1693e445ad6dddd5a8b9794f"><div class="ttname"><a href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">SMonolith::cpu_coeff_TF1_many</a></div><div class="ttdeci">std::vector&lt; float &gt; cpu_coeff_TF1_many</div><div class="ttdoc">CPU arrays to hold TF1 coefficients.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00151">SplineMonolith.h:151</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ab72795333d6f632565b0f7eb0ca8a658"><div class="ttname"><a href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">SMonolith::NSplines_valid</a></div><div class="ttdeci">unsigned int NSplines_valid</div><div class="ttdoc">Number of valid splines.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00121">SplineMonolith.h:121</a></div></div>
<div class="ttc" id="aclassSMonolith_html_af54ea9c613ef95b36dcf9c194dd38e85"><div class="ttname"><a href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">SMonolith::_max_knots</a></div><div class="ttdeci">short int _max_knots</div><div class="ttdoc">Max knots for production.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00114">SplineMonolith.h:114</a></div></div>
<div class="ttc" id="aclassSMonolith_html_af87cf7ae888eb7d4c56f8b6c41c9fd02"><div class="ttname"><a href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">SMonolith::cpu_paramNo_TF1_arr</a></div><div class="ttdeci">std::vector&lt; short int &gt; cpu_paramNo_TF1_arr</div><div class="ttdoc">CW: CPU array with the number of points per spline (not per spline point!)</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00157">SplineMonolith.h:157</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html_a398e0212915793852137384a3406b37f"><div class="ttname"><a href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">SplineMonoStruct::nKnots_arr</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; nKnots_arr</div><div class="ttdoc">KS: CPU Number of knots per spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00041">SplineCommon.h:41</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html_a47012ee423ea21f99d06eff8257cf0f0"><div class="ttname"><a href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">SplineMonoStruct::coeff_x</a></div><div class="ttdeci">std::vector&lt; float &gt; coeff_x</div><div class="ttdoc">KS: CPU arrays to hold X coefficient.</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00035">SplineCommon.h:32</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html_a67c5585ae47fc8a646dfae3fe9690775"><div class="ttname"><a href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">SplineMonoStruct::coeff_many</a></div><div class="ttdeci">std::vector&lt; float &gt; coeff_many</div><div class="ttdoc">CPU arrays to hold other coefficients.</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00038">SplineCommon.h:38</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html_af24b409ab3da1a88e855e1a9d172741f"><div class="ttname"><a href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">SplineMonoStruct::paramNo_arr</a></div><div class="ttdeci">std::vector&lt; short int &gt; paramNo_arr</div><div class="ttdoc">CW: CPU array with the number of points per spline (not per spline point!)</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00044">SplineCommon.h:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3d1128bb78b165d94721407a124f516b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d1128bb78b165d94721407a124f516b">&#9670;&nbsp;</a></span>Evaluate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::Evaluate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: This Eval should be used when using two separate x,{y,a,b,c,d} arrays to store the weights; probably the best one here! Same thing but pass parameter spline segments instead of variations. </p>

<p>Implements <a class="el" href="classSplineBase.html#a86e629f3eef59b2f3800136c86fe90c3">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00790">790</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                         {</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <span class="comment">// There&#39;s a parameter mapping that goes from spline parameter to a global parameter index</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="comment">// Find the spline segments</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <a class="code" href="classSplineBase.html#a589011b547ff70262ed43021a016ef30">FindSplineSegment</a>();</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="comment">//KS: Huge MP loop over all valid splines</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <a class="code" href="classSMonolith.html#aa36be17828281e1412a93c0e239cdbc0">CalcSplineWeights</a>();</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="comment">//KS: Huge MP loop over all events calculating total weight</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <a class="code" href="classSMonolith.html#ac37ee525aa57316f652433a4e393afaf">ModifyWeights</a>();</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;}</div>
<div class="ttc" id="aclassSMonolith_html_aa36be17828281e1412a93c0e239cdbc0"><div class="ttname"><a href="classSMonolith.html#aa36be17828281e1412a93c0e239cdbc0">SMonolith::CalcSplineWeights</a></div><div class="ttdeci">void CalcSplineWeights() override</div><div class="ttdoc">CPU based code which eval weight for each spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00805">SplineMonolith.cpp:805</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ac37ee525aa57316f652433a4e393afaf"><div class="ttname"><a href="classSMonolith.html#ac37ee525aa57316f652433a4e393afaf">SMonolith::ModifyWeights</a></div><div class="ttdeci">void ModifyWeights() override</div><div class="ttdoc">Calc total event weight.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00870">SplineMonolith.cpp:870</a></div></div>
<div class="ttc" id="aclassSplineBase_html_a589011b547ff70262ed43021a016ef30"><div class="ttname"><a href="classSplineBase.html#a589011b547ff70262ed43021a016ef30">SplineBase::FindSplineSegment</a></div><div class="ttdeci">void FindSplineSegment()</div><div class="ttdoc">CW:Code used in step by step reweighting, Find Spline Segment for each param.</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8cpp_source.html#l00024">SplineBase.cpp:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aff3fd93c09096cc362fb9944306d976f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff3fd93c09096cc362fb9944306d976f">&#9670;&nbsp;</a></span>GetName()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string SMonolith::GetName </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get class name. </p>

<p>Reimplemented from <a class="el" href="classSplineBase.html#a2e1534f622ae1976b21df1ebf984eec5">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00033">33</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;{<span class="keywordflow">return</span> <span class="stringliteral">&quot;SplineMonolith&quot;</span>;};</div>
</div><!-- fragment -->
</div>
</div>
<a id="acbbe3398718d0d02d65a1e92a91c112c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acbbe3398718d0d02d65a1e92a91c112c">&#9670;&nbsp;</a></span>getSplineCoeff_SepMany()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::getSplineCoeff_SepMany </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classTSpline3__red.html">TSpline3_red</a> *&amp;&#160;</td>
          <td class="paramname"><em>spl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>nPoints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&amp;&#160;</td>
          <td class="paramname"><em>xArray</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&amp;&#160;</td>
          <td class="paramname"><em>manyArray</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: This loads up coefficients into two arrays: one x array and one yabcd array. </p>
<p>CW: This should maximize our cache hits! </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spl</td><td>pointer to <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> </td></tr>
    <tr><td class="paramname">nPoints</td><td>number of knots </td></tr>
    <tr><td class="paramname">xArray</td><td>array X value for each knot </td></tr>
    <tr><td class="paramname">manyArray</td><td>Array holding coefficients for each knot </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00713">713</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                                                                                                            {</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="comment">// Initialise all arrays to 1.0</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a>; ++i) {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    xArray[i] = 1.0;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>; j++) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      manyArray[i*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>+j] = 1.0;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  }</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="comment">// Get number of points in spline</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keywordtype">int</span> Np = spl-&gt;<a class="code" href="classTSpline3__red.html#a6b680cfb96e11c55b8325e1274251b91">GetNp</a>();</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="comment">// If spline is flat, set number of knots to 1.0,</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <span class="comment">// This is used later to expedite the calculations for flat splines</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="comment">// tmpArray[0] is number of knots</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  nPoints = Np;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <span class="keywordflow">if</span> (Np &gt; <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a>) {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Error, number of points is greater than saved {}&quot;</span>, <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a>);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;This _WILL_ cause problems with GPU splines and _SHOULD_ be fixed!&quot;</span>);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;nPoints = {}, _max_knots = {}&quot;</span>, nPoints, <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a>);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__ , __LINE__ );</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  }</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160; </div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="comment">// The coefficients we&#39;re writing to</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <a class="code" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a> x, y, b, c, d;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="comment">// TSpline3 can only take doubles, not floats</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="comment">// But our GPU is slow with doubles, so need to cast to float</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; Np; i++) {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="comment">// Get the coefficients from the TSpline3 object</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    spl-&gt;<a class="code" href="classTSpline3__red.html#a74d108b99a9060ab85c22343fa4a4532">GetCoeff</a>(i, x, y, b, c, d);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="comment">// Write the arrays</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    xArray[i] = float(x);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    manyArray[i*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>] = float(y); <span class="comment">// 4 because manyArray stores y,b,c,d</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    manyArray[i*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>+1] = float(b);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    manyArray[i*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>+2] = float(c);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    manyArray[i*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>+3] = float(d);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordflow">if</span>((xArray[i] == -999) || (manyArray[i*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>] == -999) || (manyArray[i*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a> +1] == -999) || (manyArray[i*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>+2] == -999) || (manyArray[i*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>+3] == -999)){</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;*********** Bad params in getSplineCoeff_SepMany() ************&quot;</span>);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;pre cast to float (x, y, b, c, d) = {:.2f}, {:.2f}, {:.2f}, {:.2f}, {:.2f}&quot;</span>, x, y, b, c, d);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;pre cast to float (x, y, b, c, d) = {:.2f}, {:.2f}, {:.2f}, {:.2f}, {:.2f}&quot;</span>, xArray[i], manyArray[i*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>], manyArray[i*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>+1], manyArray[i*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>+2], manyArray[i*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>+3]);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;This will cause problems when preparing for GPU&quot;</span>);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;***************************************************************&quot;</span>);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;}</div>
<div class="ttc" id="aMaCh3Logger_8h_html_a61052119a625282d0ec6d4a97adf3ee2"><div class="ttname"><a href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a></div><div class="ttdeci">#define MACH3LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Logger_8h_source.html#l00037">MaCh3Logger.h:37</a></div></div>
<div class="ttc" id="aclassMaCh3Exception_html"><div class="ttname"><a href="classMaCh3Exception.html">MaCh3Exception</a></div><div class="ttdoc">Custom exception class used throughout MaCh3.</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Exception_8h_source.html#l00023">MaCh3Exception.h:23</a></div></div>
<div class="ttc" id="aclassTSpline3__red_html_a6b680cfb96e11c55b8325e1274251b91"><div class="ttname"><a href="classTSpline3__red.html#a6b680cfb96e11c55b8325e1274251b91">TSpline3_red::GetNp</a></div><div class="ttdeci">M3::int_t GetNp() override</div><div class="ttdoc">CW: Get the number of points.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00719">SplineStructs.h:719</a></div></div>
<div class="ttc" id="aclassTSpline3__red_html_a74d108b99a9060ab85c22343fa4a4532"><div class="ttname"><a href="classTSpline3__red.html#a74d108b99a9060ab85c22343fa4a4532">TSpline3_red::GetCoeff</a></div><div class="ttdeci">void GetCoeff(int segment, M3::float_t &amp;x, M3::float_t &amp;y, M3::float_t &amp;b, M3::float_t &amp;c, M3::float_t &amp;d)</div><div class="ttdoc">CW: Get the coefficient of a given segment.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00727">SplineStructs.h:727</a></div></div>
<div class="ttc" id="anamespaceM3_html_a1f95274549f25fc19fe7db343c8a7a68"><div class="ttname"><a href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a></div><div class="ttdeci">double float_t</div><div class="ttdef"><b>Definition:</b> <a href="Core_8h_source.html#l00037">Core.h:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a45cece9dcbe699e00a7b5fdff4806c1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45cece9dcbe699e00a7b5fdff4806c1e">&#9670;&nbsp;</a></span>Initialise()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::Initialise </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Set everything to null etc. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00012">12</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                           {</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#ifdef MaCh3_CUDA</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Using GPU version event by event monolith&quot;</span>);</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <a class="code" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a> = <span class="keyword">new</span> <a class="code" href="structSplineMonoStruct.html">SplineMonoStruct</a>();</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a> = 0;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <a class="code" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a> = 0;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a> = 0;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a> = 0;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a> = 0;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a> = 0;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="code" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a> = 0;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <a class="code" href="classSMonolith.html#a870bb2bce61e17162b9425f82cf2a099">cpu_weights_spline_var</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;}</div>
<div class="ttc" id="aclassSMonolith_html_a403e7cf909f98d4c59b5f6c7ff8aac5b"><div class="ttname"><a href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">SMonolith::nTF1coeff</a></div><div class="ttdeci">unsigned int nTF1coeff</div><div class="ttdoc">Sum of all coefficients over all TF1.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00131">SplineMonolith.h:131</a></div></div>
<div class="ttc" id="aclassSMonolith_html_ac86282b04659bae5cccb6073c9edc0a5"><div class="ttname"><a href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">SMonolith::NEvents</a></div><div class="ttdeci">unsigned int NEvents</div><div class="ttdoc">Number of events.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00112">SplineMonolith.h:112</a></div></div>
<div class="ttc" id="aclassSMonolith_html_aee3c18513f8209f1ac940b492cd3ed68"><div class="ttname"><a href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">SMonolith::NSplines_total_large</a></div><div class="ttdeci">unsigned int NSplines_total_large</div><div class="ttdoc">Number of total splines if each event had every parameter's spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00126">SplineMonolith.h:126</a></div></div>
<div class="ttc" id="aclassSMonolith_html_afc0e3d1eafd575cf7628319a66925d5b"><div class="ttname"><a href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">SMonolith::nKnots</a></div><div class="ttdeci">unsigned int nKnots</div><div class="ttdoc">Sum of all knots over all splines.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00129">SplineMonolith.h:129</a></div></div>
<div class="ttc" id="astructSplineMonoStruct_html"><div class="ttname"><a href="structSplineMonoStruct.html">SplineMonoStruct</a></div><div class="ttdoc">KS: Struct storing information for spline monolith.</div><div class="ttdef"><b>Definition:</b> <a href="SplineCommon_8h_source.html#l00030">SplineCommon.h:30</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adeda10c85b2835adf8219cb460ae2db3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adeda10c85b2835adf8219cb460ae2db3">&#9670;&nbsp;</a></span>LoadSplineFile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::LoadSplineFile </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>FileName</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Load preprocessed spline file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">FileName</td><td>Path to ROOT file with predefined reduced Spline Monolith </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classSplineBase.html#ad107ad4a91c5de35f14f3805bc52c1d3">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00513">513</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                                                 {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="preprocessor">  #ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Trying to load Monolith from file using weight by weight base, this is not supported right now, sorry&quot;</span>);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordflow">throw</span> <a class="code" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__ , __LINE__ );</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <a class="code" href="namespaceM3.html#ad7693a9e309503bd894b04443f163f3c">M3::AddPath</a>(FileName);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keyword">auto</span> SplineFile = std::make_unique&lt;TFile&gt;(FileName.c_str(), <span class="stringliteral">&quot;OPEN&quot;</span>);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  TTree *Settings = SplineFile-&gt;Get&lt;TTree&gt;(<span class="stringliteral">&quot;Settings&quot;</span>);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  TTree *Monolith_TF1 = SplineFile-&gt;Get&lt;TTree&gt;(<span class="stringliteral">&quot;Monolith_TF1&quot;</span>);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  TTree *EventInfo = SplineFile-&gt;Get&lt;TTree&gt;(<span class="stringliteral">&quot;EventInfo&quot;</span>);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  TTree *SplineTree = SplineFile-&gt;Get&lt;TTree&gt;(<span class="stringliteral">&quot;SplineTree&quot;</span>);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NEvents_temp;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keywordtype">short</span> <span class="keywordtype">int</span> nParams_temp;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keywordtype">int</span> _max_knots_temp;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nKnots_temp;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NSplines_valid_temp;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nTF1Valid_temp;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nTF1coeff_temp;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;NEvents&quot;</span>, &amp;NEvents_temp);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;nParams&quot;</span>, &amp;nParams_temp);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;_max_knots&quot;</span>, &amp;_max_knots_temp);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;nKnots&quot;</span>, &amp;nKnots_temp);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;NSplines_valid&quot;</span>, &amp;NSplines_valid_temp);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;NTF1_valid&quot;</span>, &amp;nTF1Valid_temp);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  Settings-&gt;SetBranchAddress(<span class="stringliteral">&quot;nTF1coeff&quot;</span>, &amp;nTF1coeff_temp);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  Settings-&gt;GetEntry(0);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a> = NEvents_temp;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a> = nParams_temp;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">short</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(_max_knots_temp);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a> = nKnots_temp;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a> = NSplines_valid_temp;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a> = nTF1Valid_temp;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <a class="code" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a> = nTF1coeff_temp;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="comment">//KS: Since we are going to copy it each step use fancy CUDA memory allocation</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="preprocessor">#ifdef MaCh3_CUDA</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <a class="code" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code" href="classSMonolithGPU.html#ab674ec40c136d89b56b7c25d9337c48a">InitGPU_Segments</a>(&amp;<a class="code" href="classSplineBase.html#a938e3a60326137037f868b9930e2a972">SplineSegments</a>);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <a class="code" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code" href="classSMonolithGPU.html#a3fbbb94f6db65b73a394ab541f94fba6">InitGPU_Vals</a>(&amp;<a class="code" href="classSplineBase.html#aa0b1d3a1adf7cffa7e74581bc7d58d4c">ParamValues</a>);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <a class="code" href="classSplineBase.html#a938e3a60326137037f868b9930e2a972">SplineSegments</a> = <span class="keyword">new</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>[<a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>]();</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <a class="code" href="classSplineBase.html#aa0b1d3a1adf7cffa7e74581bc7d58d4c">ParamValues</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>]();</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.resize(2*<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <a class="code" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>.resize(2*<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <a class="code" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>.resize(<a class="code" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="comment">//KS: This is tricky as this variable use both by CPU and GPU, however if use CUDA we use cudaMallocHost</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="preprocessor">#ifndef MaCh3_CUDA</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>]();</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <a class="code" href="classSMonolith.html#a870bb2bce61e17162b9425f82cf2a099">cpu_weights_spline_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>]();</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <a class="code" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>]();</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  SplineTree-&gt;SetBranchAddress(<span class="stringliteral">&quot;SplineObject&quot;</span>, &amp;<a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  SplineTree-&gt;GetEntry(0);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordtype">float</span> coeff_tf1 = 0.;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  Monolith_TF1-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_coeff_TF1_many&quot;</span>, &amp;coeff_tf1);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>; i++)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    Monolith_TF1-&gt;GetEntry(i);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <a class="code" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>[i] = coeff_tf1;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nParamPerEvent = 0;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nParamPerEvent_tf1 = 0;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  EventInfo-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_nParamPerEvent&quot;</span>, &amp;nParamPerEvent);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  EventInfo-&gt;SetBranchAddress(<span class="stringliteral">&quot;cpu_nParamPerEvent_tf1&quot;</span>, &amp;nParamPerEvent_tf1);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 2*<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>; i++)</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    EventInfo-&gt;GetEntry(i);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[i] = nParamPerEvent;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <a class="code" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[i] = nParamPerEvent_tf1;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  }</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <a class="code" href="classSplineBase.html#ad4f4b51619ef0573c7f1497f5d1fd52d">LoadFastSplineInfoDir</a>(SplineFile);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  SplineFile-&gt;Close();</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="comment">// Print some info; could probably make this to a separate function</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <a class="code" href="classSMonolith.html#a5c374d4505de53ad68d176a5644568e6">PrintInitialsiation</a>();</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <a class="code" href="classSMonolith.html#aac73a1089592c5f22755b7427869827f">MoveToGPU</a>();</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;}</div>
<div class="ttc" id="aclassSMonolithGPU_html_a3fbbb94f6db65b73a394ab541f94fba6"><div class="ttname"><a href="classSMonolithGPU.html#a3fbbb94f6db65b73a394ab541f94fba6">SMonolithGPU::InitGPU_Vals</a></div><div class="ttdeci">__host__ void InitGPU_Vals(float **vals)</div><div class="ttdoc">Allocate memory for spline segments.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00187">gpuSplineUtils.cu:187</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_ab674ec40c136d89b56b7c25d9337c48a"><div class="ttname"><a href="classSMonolithGPU.html#ab674ec40c136d89b56b7c25d9337c48a">SMonolithGPU::InitGPU_Segments</a></div><div class="ttdeci">__host__ void InitGPU_Segments(short int **segment)</div><div class="ttdoc">Allocate memory for spline segments.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00178">gpuSplineUtils.cu:178</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a0a6599372d1e3d38105478a68308d9a6"><div class="ttname"><a href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">SMonolith::cpu_nParamPerEvent</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; cpu_nParamPerEvent</div><div class="ttdoc">KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00139">SplineMonolith.h:139</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a5c374d4505de53ad68d176a5644568e6"><div class="ttname"><a href="classSMonolith.html#a5c374d4505de53ad68d176a5644568e6">SMonolith::PrintInitialsiation</a></div><div class="ttdeci">void PrintInitialsiation()</div><div class="ttdoc">KS: Print info about how much knots etc has been initialised.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00938">SplineMonolith.cpp:938</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a66eecc550dea893c60a435a034e7ebf5"><div class="ttname"><a href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">SMonolith::cpu_nParamPerEvent_tf1</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; cpu_nParamPerEvent_tf1</div><div class="ttdoc">KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00142">SplineMonolith.h:142</a></div></div>
<div class="ttc" id="aclassSMonolith_html_aac73a1089592c5f22755b7427869827f"><div class="ttname"><a href="classSMonolith.html#aac73a1089592c5f22755b7427869827f">SMonolith::MoveToGPU</a></div><div class="ttdeci">void MoveToGPU()</div><div class="ttdoc">CW: The shared initialiser from constructors of TResponseFunction_red.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00305">SplineMonolith.cpp:305</a></div></div>
<div class="ttc" id="aclassSplineBase_html_a2165b057a0125a28d96f247ca8680b42"><div class="ttname"><a href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">SplineBase::nParams</a></div><div class="ttdeci">short int nParams</div><div class="ttdoc">Number of parameters that have splines.</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8h_source.html#l00078">SplineBase.h:78</a></div></div>
<div class="ttc" id="aclassSplineBase_html_ad4f4b51619ef0573c7f1497f5d1fd52d"><div class="ttname"><a href="classSplineBase.html#ad4f4b51619ef0573c7f1497f5d1fd52d">SplineBase::LoadFastSplineInfoDir</a></div><div class="ttdeci">void LoadFastSplineInfoDir(std::unique_ptr&lt; TFile &gt; &amp;SplineFile)</div><div class="ttdoc">KS: Load preprocessed FastSplineInfo.</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8cpp_source.html#l00159">SplineBase.cpp:159</a></div></div>
<div class="ttc" id="anamespaceM3_html_ad7693a9e309503bd894b04443f163f3c"><div class="ttname"><a href="namespaceM3.html#ad7693a9e309503bd894b04443f163f3c">M3::AddPath</a></div><div class="ttdeci">void AddPath(std::string &amp;FilePath)</div><div class="ttdoc">Prepends the MACH3 environment path to FilePath if it is not already present.</div><div class="ttdef"><b>Definition:</b> <a href="Monitor_8cpp_source.html#l00382">Monitor.cpp:382</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac37ee525aa57316f652433a4e393afaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac37ee525aa57316f652433a4e393afaf">&#9670;&nbsp;</a></span>ModifyWeights()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::ModifyWeights </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">private</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calc total event weight. </p>

<p>Implements <a class="el" href="classSplineBase.html#a49665d2712b61b038085d25ace96a568">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00870">870</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                             {</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment">//*********************************************************</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="preprocessor">#ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EventNum = 0; EventNum &lt; <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>; ++EventNum)</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  {</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordtype">float</span> totalWeight = 1.0f; <span class="comment">// Initialize total weight for each event</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Offset = 2 * EventNum;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="comment">// Extract the parameters for the current event</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> startIndex = <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[Offset + 1];</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numParams = <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[Offset];</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160; </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="comment">// Compute total weight for the current event</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="preprocessor">    #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="preprocessor">    #pragma omp simd</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; numParams; ++id) {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      totalWeight *= <a class="code" href="classSMonolith.html#a870bb2bce61e17162b9425f82cf2a099">cpu_weights_spline_var</a>[startIndex + id];</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    }</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="comment">//Now TF1</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="comment">// Extract the parameters for the current event</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> startIndex_tf1 = <a class="code" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[Offset + 1];</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numParams_tf1 = <a class="code" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[Offset];</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; </div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="comment">// Compute total weight for the current event</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="preprocessor">    #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="preprocessor">    #pragma omp simd</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; numParams_tf1; ++id) {</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      totalWeight *= <a class="code" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a>[startIndex_tf1 + id];</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    }</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160; </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="comment">// Store the total weight for the current event</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>[EventNum] = totalWeight;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  }</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="comment">//KS: Name is confusing but what it does it make a nice mapping used for debugging</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <a class="code" href="classSMonolith.html#a72cd282322bdaadb23d8a376efa9e2c1">ModifyWeights_GPU</a>();</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;}</div>
<div class="ttc" id="aclassSMonolith_html_a72cd282322bdaadb23d8a376efa9e2c1"><div class="ttname"><a href="classSMonolith.html#a72cd282322bdaadb23d8a376efa9e2c1">SMonolith::ModifyWeights_GPU</a></div><div class="ttdeci">void ModifyWeights_GPU()</div><div class="ttdoc">Conversion from valid splines to all.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00917">SplineMonolith.cpp:917</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a72cd282322bdaadb23d8a376efa9e2c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72cd282322bdaadb23d8a376efa9e2c1">&#9670;&nbsp;</a></span>ModifyWeights_GPU()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::ModifyWeights_GPU </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Conversion from valid splines to all. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00917">917</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                                 {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">//*********************************************************</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="preprocessor">#ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="comment">// Multi-thread here because _numIndex is really quite large!</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a>; ++i) {</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#a9c4fa00b6e36d150d52e87e6463aabaa">index_spline_cpu</a>[i] &gt;= 0) {</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a>[i] = <a class="code" href="classSMonolith.html#a870bb2bce61e17162b9425f82cf2a099">cpu_weights_spline_var</a>[<a class="code" href="classSMonolith.html#a9c4fa00b6e36d150d52e87e6463aabaa">index_spline_cpu</a>[i]];</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#a723920c6c324901ac0fa48df7aad64cd">index_TF1_cpu</a>[i] &gt;= 0) {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a>[i] = <a class="code" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a>[<a class="code" href="classSMonolith.html#a723920c6c324901ac0fa48df7aad64cd">index_TF1_cpu</a>[i]];</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    }  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      <a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a>[i] = 1.;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;}</div>
<div class="ttc" id="aclassSMonolith_html_a723920c6c324901ac0fa48df7aad64cd"><div class="ttname"><a href="classSMonolith.html#a723920c6c324901ac0fa48df7aad64cd">SMonolith::index_TF1_cpu</a></div><div class="ttdeci">std::vector&lt; int &gt; index_TF1_cpu</div><div class="ttdoc">holds the index for good TF1; don't do unsigned since starts with negative value!</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00118">SplineMonolith.h:118</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a9c4fa00b6e36d150d52e87e6463aabaa"><div class="ttname"><a href="classSMonolith.html#a9c4fa00b6e36d150d52e87e6463aabaa">SMonolith::index_spline_cpu</a></div><div class="ttdeci">std::vector&lt; int &gt; index_spline_cpu</div><div class="ttdoc">holds the index for good splines; don't do unsigned since starts with negative value!</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00116">SplineMonolith.h:116</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aac73a1089592c5f22755b7427869827f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac73a1089592c5f22755b7427869827f">&#9670;&nbsp;</a></span>MoveToGPU()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::MoveToGPU </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: The shared initialiser from constructors of <a class="el" href="classTResponseFunction__red.html" title="KS: A reduced ResponseFunction Generic function used for evaluating weight.">TResponseFunction_red</a>. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00305">305</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                          {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="preprocessor">  #ifdef MaCh3_CUDA</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event_size_max = <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a> * <a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Total size = {:.2f} MB memory on CPU to move to GPU&quot;</span>,</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                (<span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a> * <a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>) + <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * event_size_max) / 1.E6 +</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>) * <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)) / 1.E6);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Total TF1 size = {:.2f} MB memory on CPU to move to GPU&quot;</span>,</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a> * <a class="code" href="SplineCommon_8h.html#ad6cacf3d45a37eeeeffe38ad24345d54">_nTF1Coeff_</a>) / 1.E6);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;GPU weight array (GPU-&gt;CPU every step) = {:.2f} MB&quot;</span>, <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)) * (<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a> + <a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>) / 1.0e6);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor">  #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Since you are running Total event weight mode then GPU weight array (GPU-&gt;CPU every step) = {:.2f} MB&quot;</span>,</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>) / 1.E6);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Parameter value array (CPU-&gt;GPU every step) = {:.4f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * <a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>) / 1.E6);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="comment">//CW: With the new set-up we have:   1 coefficient array of size coeff_array_size, all same size</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="comment">//                                1 coefficient array of size coeff_array_size*4, holding y,b,c,d in order (y11,b11,c11,d11; y12,b12,c12,d12;...) where ynm is n = spline number, m = spline point. Should really make array so that order is (y11,b11,c11,d11; y21,b21,c21,d21;...) because it will optimise cache hits I think; try this if you have time</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="comment">//                                return gpu_weights</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <a class="code" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a> = <span class="keyword">new</span> <a class="code" href="classSMonolithGPU.html">SMonolithGPU</a>();</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="comment">// The gpu_XY arrays don&#39;t actually need initialising, since they are only placeholders for what we&#39;ll move onto the GPU. As long as we cudaMalloc the size of the arrays correctly there shouldn&#39;t be any problems</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="comment">// Can probably make this a bit prettier but will do for now</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="comment">// Could be a lot smaller of a function...</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <a class="code" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code" href="classSMonolithGPU.html#a713a47fd41a93d2b6d40c4b392158aae">InitGPU_SplineMonolith</a>(</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;          #ifndef Weight_On_SplineBySpline_Basis</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;          &amp;<a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>,</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;          <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>,</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;          #endif</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;          <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>, <span class="comment">// How many entries in coefficient array (*4 for the &quot;many&quot; array)</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;          <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>, <span class="comment">// What&#39;s the number of splines we have (also number of entries in gpu_nPoints_arr)</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;          <a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>,</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;          event_size_max <span class="comment">//Knots times event number of unique splines</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  );</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="comment">// Move number of splines and spline size to constant GPU memory; every thread does not need a copy...</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="comment">// The implementation lives in splines/gpuSplineUtils.cu</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="comment">// The GPU splines don&#39;t actually need declaring but is good for demonstration, kind of</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="comment">// fixed by passing const reference</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <a class="code" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code" href="classSMonolithGPU.html#aef41d94cf5e44ebf4fe427c3ce84f20b">CopyToGPU_SplineMonolith</a>(</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;          <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>,</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;          <span class="comment">// TFI related now</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;          <a class="code" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>,</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;          <a class="code" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a>,</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;          #ifndef Weight_On_SplineBySpline_Basis</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;          <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>,</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;          <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>,</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;          <a class="code" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>,</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;          #endif</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;          <a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>,</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;          <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>,</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;          <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a>,</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;          <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>,</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;          <a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="comment">// Delete all the coefficient arrays from the CPU once they are on the GPU</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <a class="code" href="ParameterStructs_8h.html#a85aef80dc0fb38ccb4ff2f7b6a49a5ab">CleanVector</a>(<a class="code" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <a class="code" href="ParameterStructs_8h.html#a85aef80dc0fb38ccb4ff2f7b6a49a5ab">CleanVector</a>(<a class="code" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a>);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="preprocessor">  #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <a class="code" href="ParameterStructs_8h.html#a85aef80dc0fb38ccb4ff2f7b6a49a5ab">CleanVector</a>(<a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <a class="code" href="ParameterStructs_8h.html#a85aef80dc0fb38ccb4ff2f7b6a49a5ab">CleanVector</a>(<a class="code" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keyword">delete</span> <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Good GPU loading&quot;</span>);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;}</div>
<div class="ttc" id="aParameterStructs_8h_html_a85aef80dc0fb38ccb4ff2f7b6a49a5ab"><div class="ttname"><a href="ParameterStructs_8h.html#a85aef80dc0fb38ccb4ff2f7b6a49a5ab">CleanVector</a></div><div class="ttdeci">void CleanVector(std::vector&lt; T &gt; &amp;vec)</div><div class="ttdoc">Generic cleanup function.</div><div class="ttdef"><b>Definition:</b> <a href="ParameterStructs_8h_source.html#l00043">ParameterStructs.h:43</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html"><div class="ttname"><a href="classSMonolithGPU.html">SMonolithGPU</a></div><div class="ttdoc">Class responsible for calculating spline weight on GPU.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cuh_source.html#l00061">gpuSplineUtils.cuh:62</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_a713a47fd41a93d2b6d40c4b392158aae"><div class="ttname"><a href="classSMonolithGPU.html#a713a47fd41a93d2b6d40c4b392158aae">SMonolithGPU::InitGPU_SplineMonolith</a></div><div class="ttdeci">__host__ void InitGPU_SplineMonolith(float **cpu_total_weights, int n_events, unsigned int total_nknots, unsigned int n_splines, unsigned int n_tf1, int Eve_size)</div><div class="ttdoc">Allocate memory on gpu for spline monolith.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00106">gpuSplineUtils.cu:106</a></div></div>
<div class="ttc" id="aclassSMonolithGPU_html_aef41d94cf5e44ebf4fe427c3ce84f20b"><div class="ttname"><a href="classSMonolithGPU.html#aef41d94cf5e44ebf4fe427c3ce84f20b">SMonolithGPU::CopyToGPU_SplineMonolith</a></div><div class="ttdeci">__host__ void CopyToGPU_SplineMonolith(SplineMonoStruct *cpu_spline_handler, std::vector&lt; float &gt; cpu_many_array_TF1, std::vector&lt; short int &gt; cpu_paramNo_arr_TF1, int n_events, std::vector&lt; unsigned int &gt; cpu_nParamPerEvent, std::vector&lt; unsigned int &gt; cpu_nParamPerEvent_TF1, int n_params, unsigned int n_splines, short int spline_size, unsigned int total_nknots, unsigned int n_tf1)</div><div class="ttdoc">Copies data from CPU to GPU for the spline monolith.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00201">gpuSplineUtils.cu:201</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa1bd2dc5c55b7258d5544512659ef9d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1bd2dc5c55b7258d5544512659ef9d7">&#9670;&nbsp;</a></span>PrepareForGPU()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::PrepareForGPU </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classTResponseFunction__red.html">TResponseFunction_red</a> * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="ParameterStructs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36d">RespFuncType</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>SplineType</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Prepare the <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> objects for the GPU. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of <a class="el" href="classTResponseFunction__red.html" title="KS: A reduced ResponseFunction Generic function used for evaluating weight.">TResponseFunction_red</a> pointers which we strip back </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00056">56</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                                                                                                                                    {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="comment">// Scan for the max number of knots, the number of events (number of splines), and number of parameters</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordtype">int</span> maxnSplines = 0;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="classSMonolith.html#af2a015f3d6f4f8a51d27f8cd8a67c229">ScanMasterSpline</a>(MasterSpline,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                   <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                   <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a>,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                   <a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                   maxnSplines,</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                   <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                   <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                   <a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                   <a class="code" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                   SplineType);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} events&quot;</span>, <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} knots at max&quot;</span>, <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} parameters&quot;</span>, <a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found {} maximum number of splines in an event&quot;</span>, maxnSplines);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found total {} knots in all splines&quot;</span>, <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Number of splines = {}&quot;</span>, <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Found total {} coeffs in all TF1&quot;</span>, <a class="code" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Number of TF1 = {}&quot;</span>, <a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">// Can pass the spline segments to the GPU instead of the values</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">// Make these here and only refill them for each loop, avoiding unnecessary new/delete on each reconfigure</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">//KS: Since we are going to copy it each step use fancy CUDA memory allocation</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">  #ifdef MaCh3_CUDA</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <a class="code" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code" href="classSMonolithGPU.html#ab674ec40c136d89b56b7c25d9337c48a">InitGPU_Segments</a>(&amp;<a class="code" href="classSplineBase.html#a938e3a60326137037f868b9930e2a972">SplineSegments</a>);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="classSMonolith.html#a03444cbed8a9d9a7798d0ef2b26bd702">gpu_spline_handler</a>-&gt;<a class="code" href="classSMonolithGPU.html#a3fbbb94f6db65b73a394ab541f94fba6">InitGPU_Vals</a>(&amp;<a class="code" href="classSplineBase.html#aa0b1d3a1adf7cffa7e74581bc7d58d4c">ParamValues</a>);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">  #else</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="classSplineBase.html#a938e3a60326137037f868b9930e2a972">SplineSegments</a> = <span class="keyword">new</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>[<a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>];</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <a class="code" href="classSplineBase.html#aa0b1d3a1adf7cffa7e74581bc7d58d4c">ParamValues</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>];</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> j = 0; j &lt; <a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>; j++)</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="classSplineBase.html#a938e3a60326137037f868b9930e2a972">SplineSegments</a>[j] = 0;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <a class="code" href="classSplineBase.html#aa0b1d3a1adf7cffa7e74581bc7d58d4c">ParamValues</a>[j] = -999;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">// Number of objects we have in total if each event has *EVERY* spline. Needed for some arrays</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <a class="code" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a> = <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>*<a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event_size_max = <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a> * <a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">// Declare the {x}, {y,b,c,d} arrays for all possible splines which the event has</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">// We&#39;ll filter off the flat and &quot;disabled&quot; (e.g. CCQE event should not have MARES spline) ones in the next for loop, but need to declare these beasts here</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">// Declare the {y,b,c,d} for each knot</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="comment">// float because GPU precision (could change to double, but will incur significant speed reduction on GPU unless you&#39;re very rich!)</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>.resize(<a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>); <span class="comment">// *4 because we store y,b,c,d parameters in this array</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">//KS: For x coeff we assume that for given dial (MAQE) spacing is identical, here we are sloppy and assume each dial has the same number of knots, not a big problem</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>.resize(event_size_max);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="comment">// Set all the big arrays to -999 to keep us safe...</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; event_size_max; j++) {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>[j] = -999;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="comment">//CW: With TF1 we only save the coefficients and the order of the polynomial</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">// Makes most sense to have one large monolithic array, but then it becomes impossible to tell apart a coefficient from a &quot;number of points&quot;. So have two arrays: one of coefficients and one of number of points</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">// Let&#39;s first assume all are of _max_knots size</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="comment">// Now declare the arrays for each point in the valid splines which the event actually has (i.e. include the splines that the event undergoes)</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">// Also make array with the number of points per spline (not per spline point!)</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">// float because GPU precision (could change to double, but will incur significant speed reduction on GPU unless you&#39;re very rich!)</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <a class="code" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>.resize(<a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <a class="code" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>.resize(<a class="code" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>); <span class="comment">// *5 because this array holds  a,b,c,d,e parameters</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">  #ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">// This holds the index of each spline</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <a class="code" href="classSMonolith.html#a9c4fa00b6e36d150d52e87e6463aabaa">index_spline_cpu</a>.resize(<a class="code" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <a class="code" href="classSMonolith.html#a723920c6c324901ac0fa48df7aad64cd">index_TF1_cpu</a>.resize(<a class="code" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a>);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a>; j++) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="classSMonolith.html#a9c4fa00b6e36d150d52e87e6463aabaa">index_spline_cpu</a>[j] = -1;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="classSMonolith.html#a723920c6c324901ac0fa48df7aad64cd">index_TF1_cpu</a>[j] = -1;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">// This holds the total CPU weights that gets read in samplePDFND</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <a class="code" href="classSMonolith.html#a8614e8ef07431d99f62ab88d9ebdad16">cpu_weights</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#aee3c18513f8209f1ac940b492cd3ed68">NSplines_total_large</a>];</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">  #else</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">//KS: Map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>.resize(2*<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <a class="code" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>.resize(2*<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="preprocessor">  #ifdef MULTITHREAD</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="preprocessor">  #pragma omp parallel for</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 2*<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>; j++) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[j] = -1;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[j] = -1;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="comment">// Make array with the number of points per spline (not per spline point!)</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>.resize(<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="comment">//KS: And array which tells where each spline stars in a big monolith array, sort of knot map</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>.resize(<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <a class="code" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a>.resize(<a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="comment">// Temporary arrays to hold the coefficients for each spline</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="comment">// We get one x, one y, one b,... for each point, so only need to be _max_knots big</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">//KS: Some params has less splines but this is all right main array will get proper number while this temp will be deleted</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordtype">float</span> *x_tmp = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a>]();</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordtype">float</span> *many_tmp = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a>*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>]();</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordtype">float</span> *temp_coeffs = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="SplineCommon_8h.html#ad6cacf3d45a37eeeeffe38ad24345d54">_nTF1Coeff_</a>]();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="comment">// Count the number of events</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> KnotCounter = 0;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> TF1PointsCounter = 0;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NSplinesCounter = 0;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> TF1sCounter = 0;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordtype">int</span> ParamCounter = 0;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordtype">int</span> ParamCounterGlobal = 0;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordtype">int</span> ParamCounter_TF1 = 0;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordtype">int</span> ParamCounterGlobalTF1 = 0;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="comment">// Loop over events and extract the spline coefficients</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EventCounter = 0; EventCounter &lt; MasterSpline.size(); ++EventCounter) {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">// Structure of MasterSpline is std::vector&lt;std::vector&lt;TSpline3*&gt;&gt;</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">// A conventional iterator to count which parameter a given spline should be applied to</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ParamNumber = 0; ParamNumber &lt; MasterSpline[EventCounter].size(); ++ParamNumber) {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="comment">// If NULL we don&#39;t have this spline for the event, so move to next spline</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="keywordflow">if</span> (MasterSpline[EventCounter][ParamNumber] == NULL) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">if</span>(SplineType[ParamNumber] == <a class="code" href="ParameterStructs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da8bea6994e011cc85a5a88b50c97ce7b2">kTSpline3_red</a>)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="comment">//KS: how much knots each spline has</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordtype">int</span> nPoints_tmp = 0;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="comment">// Get a pointer to the current spline for this event</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <a class="code" href="classTResponseFunction__red.html">TResponseFunction_red</a>* TespFunc = MasterSpline[EventCounter][ParamNumber];</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <a class="code" href="classTSpline3__red.html">TSpline3_red</a>* CurrSpline = <span class="keyword">static_cast&lt;</span><a class="code" href="classTSpline3__red.html">TSpline3_red</a>*<span class="keyword">&gt;</span>(TespFunc);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="comment">// If the number of knots are greater than 2 the spline is not a dummy and we should extract coefficients to load onto the GPU</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <a class="code" href="classSMonolith.html#acbbe3398718d0d02d65a1e92a91c112c">getSplineCoeff_SepMany</a>(CurrSpline, nPoints_tmp, x_tmp, many_tmp);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="comment">//KS: One knot means flat spline so ignore</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keywordflow">if</span> (nPoints_tmp == 1) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a>; ++j) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;          <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>[ParamNumber*<a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a> + j] = x_tmp[j];</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment">//KS: Contrary to X coeff we keep for other coeff only filled knots, there is no much gain for doing so for x coeff</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nPoints_tmp; ++j) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; <a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>; k++) {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a67c5585ae47fc8a646dfae3fe9690775">coeff_many</a>[KnotCounter*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a> + j*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a> + k] = many_tmp[j*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>+k];</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;          }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">// Set the parameter number for this spline</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#af24b409ab3da1a88e855e1a9d172741f">paramNo_arr</a>[NSplinesCounter] = short(ParamNumber);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="comment">//KS: Fill map when each spline starts</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a398e0212915793852137384a3406b37f">nKnots_arr</a>[NSplinesCounter] = KnotCounter;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        KnotCounter += nPoints_tmp;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="preprocessor">        #ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="comment">// Set the index of the spline so we can tell apart from flat splines</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <a class="code" href="classSMonolith.html#a9c4fa00b6e36d150d52e87e6463aabaa">index_spline_cpu</a>[EventCounter*<a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a> + ParamNumber] = NSplinesCounter;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="preprocessor">        #else</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        ++ParamCounter;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="preprocessor">        #endif</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="comment">// Increment the counter for the number of good splines we have</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        ++NSplinesCounter;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SplineType[ParamNumber] == <a class="code" href="ParameterStructs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da847a18b0a859ce2b3b87a98f455855b1">kTF1_red</a>)</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="comment">// Don&#39;t actually use this ever -- we give each spline the maximum number of points found in all splines</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="keywordtype">int</span> nPoints_tmp = 0;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="comment">// Get a pointer to the current spline for this event</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <a class="code" href="classTF1__red.html">TF1_red</a>* CurrSpline = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classTF1__red.html">TF1_red</a>*<span class="keyword">&gt;</span>(MasterSpline[EventCounter][ParamNumber]);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="comment">// If the number of knots are greater than 2 the spline is not a dummy and we should extract coefficients to load onto the GPU</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <a class="code" href="classSplineBase.html#ac8a5f86ac6f156a7e11ef188b06f425f">getTF1Coeff</a>(CurrSpline, nPoints_tmp, temp_coeffs);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="SplineCommon_8h.html#ad6cacf3d45a37eeeeffe38ad24345d54">_nTF1Coeff_</a>; ++j) {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;          <a class="code" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>[TF1PointsCounter+j] = temp_coeffs[j];</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="comment">// Save the number of points for this spline</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <a class="code" href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">cpu_nPoints_arr</a>[TF1sCounter] = short(nPoints_tmp);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        TF1PointsCounter += nPoints_tmp;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="comment">// Set the parameter number for this spline</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <a class="code" href="classSMonolith.html#af87cf7ae888eb7d4c56f8b6c41c9fd02">cpu_paramNo_TF1_arr</a>[TF1sCounter] = short(ParamNumber);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="preprocessor">        #ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="comment">// Set the index of the spline so we can tell apart from flat splines</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <a class="code" href="classSMonolith.html#a723920c6c324901ac0fa48df7aad64cd">index_TF1_cpu</a>[EventCounter*<a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a> + ParamNumber] = TF1sCounter;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="preprocessor">        #else</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        ++ParamCounter_TF1;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="preprocessor">        #endif</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="comment">// Increment the counter for the number of good splines we have</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        ++TF1sCounter;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      }</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="comment">//KS: Don&#39;t delete in debug</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">      #ifndef DEBUG</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keyword">delete</span> MasterSpline[EventCounter][ParamNumber];</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      MasterSpline[EventCounter][ParamNumber] = NULL;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="preprocessor">      #endif</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    } <span class="comment">// End the loop over the parameters in the MasterSpline</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="preprocessor">    #ifndef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[2*EventCounter] = ParamCounter;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[2*EventCounter+1] = ParamCounterGlobal;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    ParamCounterGlobal += ParamCounter;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[2*EventCounter] = ParamCounter_TF1;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <a class="code" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[2*EventCounter+1] = ParamCounterGlobalTF1;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    ParamCounterGlobalTF1 += ParamCounter_TF1;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    ParamCounter = 0;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    ParamCounter_TF1 = 0;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  } <span class="comment">// End the loop over the number of events</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keyword">delete</span>[] many_tmp;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keyword">delete</span>[] x_tmp;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keyword">delete</span>[] temp_coeffs;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordtype">int</span> BadXCounter = 0;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; event_size_max; j++) {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>[j] == -999) BadXCounter++;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">// Perform checks that all entries have been modified from initial values</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>-&gt;<a class="code" href="structSplineMonoStruct.html#a47012ee423ea21f99d06eff8257cf0f0">coeff_x</a>[j] == -999 &amp;&amp; BadXCounter &lt; 5) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;***** BAD X !! *****&quot;</span>);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;Indicates some parameter doesn&#39;t have a single spline&quot;</span>);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;j = {}&quot;</span>, j);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="comment">//throw MaCh3Exception(__FILE__ , __LINE__ );</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">if</span>(BadXCounter == 5) <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;There is more unutilised knots although I will stop spamming&quot;</span>);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;Found in total {} BAD X&quot;</span>, BadXCounter);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="preprocessor">  #ifdef Weight_On_SplineBySpline_Basis</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="comment">// Make the array that holds all the returned weights from the GPU to pass to the CPU</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <a class="code" href="classSMonolith.html#a870bb2bce61e17162b9425f82cf2a099">cpu_weights_spline_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>]();</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <a class="code" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>]();</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">  #else</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="comment">//KS: This is tricky as this variable use both by CPU and GPU, however if use CUDA we use cudaMallocHost</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor">    #ifndef MaCh3_CUDA</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>]();</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="classSMonolith.html#a870bb2bce61e17162b9425f82cf2a099">cpu_weights_spline_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>]();</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="classSMonolith.html#a4a1d45d273cc40cb4f684400812dcb60">cpu_weights_tf1_var</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>]();</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="comment">// Print some info; could probably make this to a separate function</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <a class="code" href="classSMonolith.html#a5c374d4505de53ad68d176a5644568e6">PrintInitialsiation</a>();</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSMonolith.html#ab5692081772ca14bd012eb125e2ccfd4">SaveSplineFile</a>) <a class="code" href="classSMonolith.html#af2cacbb68bad46a345672339dd7150b6">PrepareSplineFile</a>(<a class="code" href="classSMonolith.html#aa7e91b11f9708a828a521f32f8058fe9">FastSplineName</a>);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <a class="code" href="classSMonolith.html#aac73a1089592c5f22755b7427869827f">MoveToGPU</a>();</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div>
<div class="ttc" id="aMaCh3Logger_8h_html_ad5b2eb6377721e3ac95def22c2386bb1"><div class="ttname"><a href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a></div><div class="ttdeci">#define MACH3LOG_WARN</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Logger_8h_source.html#l00036">MaCh3Logger.h:36</a></div></div>
<div class="ttc" id="aParameterStructs_8h_html_a6a73aa1ad819973a9c421c17c2a7f36da847a18b0a859ce2b3b87a98f455855b1"><div class="ttname"><a href="ParameterStructs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da847a18b0a859ce2b3b87a98f455855b1">kTF1_red</a></div><div class="ttdeci">@ kTF1_red</div><div class="ttdoc">Uses TF1_red for interpolation.</div><div class="ttdef"><b>Definition:</b> <a href="ParameterStructs_8h_source.html#l00235">ParameterStructs.h:235</a></div></div>
<div class="ttc" id="aParameterStructs_8h_html_a6a73aa1ad819973a9c421c17c2a7f36da8bea6994e011cc85a5a88b50c97ce7b2"><div class="ttname"><a href="ParameterStructs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da8bea6994e011cc85a5a88b50c97ce7b2">kTSpline3_red</a></div><div class="ttdeci">@ kTSpline3_red</div><div class="ttdoc">Uses TSpline3_red for interpolation.</div><div class="ttdef"><b>Definition:</b> <a href="ParameterStructs_8h_source.html#l00234">ParameterStructs.h:234</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a14b9c21186a53196f49c8d8d3555fbf2"><div class="ttname"><a href="classSMonolith.html#a14b9c21186a53196f49c8d8d3555fbf2">SMonolith::cpu_nPoints_arr</a></div><div class="ttdeci">std::vector&lt; short int &gt; cpu_nPoints_arr</div><div class="ttdoc">CPU arrays to hold number of points.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00154">SplineMonolith.h:154</a></div></div>
<div class="ttc" id="aclassSMonolith_html_acbbe3398718d0d02d65a1e92a91c112c"><div class="ttname"><a href="classSMonolith.html#acbbe3398718d0d02d65a1e92a91c112c">SMonolith::getSplineCoeff_SepMany</a></div><div class="ttdeci">void getSplineCoeff_SepMany(TSpline3_red *&amp;spl, int &amp;nPoints, float *&amp;xArray, float *&amp;manyArray)</div><div class="ttdoc">CW: This loads up coefficients into two arrays: one x array and one yabcd array.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00713">SplineMonolith.cpp:713</a></div></div>
<div class="ttc" id="aclassSMonolith_html_af2a015f3d6f4f8a51d27f8cd8a67c229"><div class="ttname"><a href="classSMonolith.html#af2a015f3d6f4f8a51d27f8cd8a67c229">SMonolith::ScanMasterSpline</a></div><div class="ttdeci">void ScanMasterSpline(std::vector&lt; std::vector&lt; TResponseFunction_red * &gt; &gt; &amp;MasterSpline, unsigned int &amp;nEvents, short int &amp;MaxPoints, short int &amp;numParams, int &amp;nSplines, unsigned int &amp;NSplinesValid, unsigned int &amp;numKnots, unsigned int &amp;nTF1Valid, unsigned int &amp;nTF1_coeff, const std::vector&lt; RespFuncType &gt; &amp;SplineType)</div><div class="ttdoc">CW: Function to scan through the MasterSpline of TSpline3.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00377">SplineMonolith.cpp:377</a></div></div>
<div class="ttc" id="aclassSMonolith_html_af2cacbb68bad46a345672339dd7150b6"><div class="ttname"><a href="classSMonolith.html#af2cacbb68bad46a345672339dd7150b6">SMonolith::PrepareSplineFile</a></div><div class="ttdeci">void PrepareSplineFile(std::string FileName) override</div><div class="ttdoc">KS: Prepare spline file that can be used for fast loading.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00608">SplineMonolith.cpp:608</a></div></div>
<div class="ttc" id="aclassSplineBase_html_ac8a5f86ac6f156a7e11ef188b06f425f"><div class="ttname"><a href="classSplineBase.html#ac8a5f86ac6f156a7e11ef188b06f425f">SplineBase::getTF1Coeff</a></div><div class="ttdeci">void getTF1Coeff(TF1_red *&amp;spl, int &amp;nPoints, float *&amp;coeffs)</div><div class="ttdoc">CW: Gets the polynomial coefficients for TF1.</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8cpp_source.html#l00106">SplineBase.cpp:106</a></div></div>
<div class="ttc" id="aclassTF1__red_html"><div class="ttname"><a href="classTF1__red.html">TF1_red</a></div><div class="ttdoc">CW: A reduced TF1 class only. Only saves parameters for each TF1 and how many parameters each paramet...</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00148">SplineStructs.h:148</a></div></div>
<div class="ttc" id="aclassTResponseFunction__red_html"><div class="ttname"><a href="classTResponseFunction__red.html">TResponseFunction_red</a></div><div class="ttdoc">KS: A reduced ResponseFunction Generic function used for evaluating weight.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00131">SplineStructs.h:131</a></div></div>
<div class="ttc" id="aclassTSpline3__red_html"><div class="ttname"><a href="classTSpline3__red.html">TSpline3_red</a></div><div class="ttdoc">CW: Reduced TSpline3 class.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00265">SplineStructs.h:265</a></div></div>
<div class="ttc" id="anamespaceM3_html_adb59b8ecdc4e1b2d5d4c826a13aa7463"><div class="ttname"><a href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a></div><div class="ttdeci">int int_t</div><div class="ttdef"><b>Definition:</b> <a href="Core_8h_source.html#l00038">Core.h:38</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af2cacbb68bad46a345672339dd7150b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2cacbb68bad46a345672339dd7150b6">&#9670;&nbsp;</a></span>PrepareSplineFile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::PrepareSplineFile </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>FileName</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Prepare spline file that can be used for fast loading. </p>

<p>Implements <a class="el" href="classSplineBase.html#ab75c16cbf814b94e9a14978c781b02fe">SplineBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00608">608</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                                                    {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <a class="code" href="namespaceM3.html#ad7693a9e309503bd894b04443f163f3c">M3::AddPath</a>(FileName);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="keyword">auto</span> SplineFile = std::make_unique&lt;TFile&gt;(FileName.c_str(), <span class="stringliteral">&quot;recreate&quot;</span>);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  TTree *Settings = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;Settings&quot;</span>, <span class="stringliteral">&quot;Settings&quot;</span>);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  TTree *Monolith_TF1 = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;Monolith_TF1&quot;</span>, <span class="stringliteral">&quot;Monolith_TF1&quot;</span>);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  TTree *XKnots = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;XKnots&quot;</span>, <span class="stringliteral">&quot;XKnots&quot;</span>);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  TTree *EventInfo = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;EventInfo&quot;</span>, <span class="stringliteral">&quot;EventInfo&quot;</span>);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NEvents_temp = <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <span class="keywordtype">short</span> <span class="keywordtype">int</span> nParams_temp = <a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordtype">int</span> _max_knots_temp = <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a>;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nKnots_temp = <a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> NSplines_valid_temp = <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nTF1Valid_temp = <a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nTF1coeff_temp = <a class="code" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  Settings-&gt;Branch(<span class="stringliteral">&quot;NEvents&quot;</span>, &amp;NEvents_temp, <span class="stringliteral">&quot;NEvents/i&quot;</span>);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  Settings-&gt;Branch(<span class="stringliteral">&quot;nParams&quot;</span>, &amp;nParams_temp, <span class="stringliteral">&quot;nParams/S&quot;</span>);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  Settings-&gt;Branch(<span class="stringliteral">&quot;_max_knots&quot;</span>, &amp;_max_knots_temp, <span class="stringliteral">&quot;_max_knots/I&quot;</span>);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  Settings-&gt;Branch(<span class="stringliteral">&quot;nKnots&quot;</span>, &amp;nKnots_temp, <span class="stringliteral">&quot;nKnots/i&quot;</span>);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  Settings-&gt;Branch(<span class="stringliteral">&quot;NSplines_valid&quot;</span>, &amp;NSplines_valid_temp, <span class="stringliteral">&quot;NSplines_valid/i&quot;</span>);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  Settings-&gt;Branch(<span class="stringliteral">&quot;NTF1_valid&quot;</span>, &amp;nTF1Valid_temp, <span class="stringliteral">&quot;NTF1_valid/i&quot;</span>);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  Settings-&gt;Branch(<span class="stringliteral">&quot;nTF1coeff&quot;</span>, &amp;nTF1coeff_temp, <span class="stringliteral">&quot;nTF1coeff/i&quot;</span>);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  Settings-&gt;Fill();</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160; </div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  SplineFile-&gt;cd();</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  Settings-&gt;Write();</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  TTree *SplineTree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;SplineTree&quot;</span>, <span class="stringliteral">&quot;SplineTree&quot;</span>);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="comment">// Create a branch for the SplineMonoStruct object</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  SplineTree-&gt;Branch(<span class="stringliteral">&quot;SplineObject&quot;</span>, &amp;<a class="code" href="classSMonolith.html#a48d0e5e5b4130fcd191c3e8f1d841eb7">cpu_spline_handler</a>);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  SplineTree-&gt;Fill();</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  SplineTree-&gt;Write();</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="keyword">delete</span> SplineTree;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keywordtype">float</span> coeff_tf1 = 0.;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  Monolith_TF1-&gt;Branch(<span class="stringliteral">&quot;cpu_coeff_TF1_many&quot;</span>, &amp;coeff_tf1, <span class="stringliteral">&quot;cpu_coeff_TF1_many/F&quot;</span>);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSMonolith.html#a403e7cf909f98d4c59b5f6c7ff8aac5b">nTF1coeff</a>; i++)</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  {</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    coeff_tf1 = <a class="code" href="classSMonolith.html#a456dd14e1693e445ad6dddd5a8b9794f">cpu_coeff_TF1_many</a>[i];</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    Monolith_TF1-&gt;Fill();</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  }</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  SplineFile-&gt;cd();</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  Monolith_TF1-&gt;Write();</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160; </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nParamPerEvent = 0;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nParamPerEvent_tf1 = 0;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160; </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  EventInfo-&gt;Branch(<span class="stringliteral">&quot;cpu_nParamPerEvent&quot;</span>, &amp;nParamPerEvent, <span class="stringliteral">&quot;cpu_nParamPerEvent/i&quot;</span>);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  EventInfo-&gt;Branch(<span class="stringliteral">&quot;cpu_nParamPerEvent_tf1&quot;</span>, &amp;nParamPerEvent_tf1, <span class="stringliteral">&quot;cpu_nParamPerEvent_tf1/i&quot;</span>);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 2*<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>; i++)</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  {</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    nParamPerEvent = <a class="code" href="classSMonolith.html#a0a6599372d1e3d38105478a68308d9a6">cpu_nParamPerEvent</a>[i];</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    nParamPerEvent_tf1 = <a class="code" href="classSMonolith.html#a66eecc550dea893c60a435a034e7ebf5">cpu_nParamPerEvent_tf1</a>[i];</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    EventInfo-&gt;Fill();</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  SplineFile-&gt;cd();</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  EventInfo-&gt;Write();</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <a class="code" href="classSplineBase.html#ae7797e26d48519c885e1537373505fcb">PrepareFastSplineInfoDir</a>(SplineFile);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160; </div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="keyword">delete</span> Settings;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keyword">delete</span> Monolith_TF1;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keyword">delete</span> XKnots;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keyword">delete</span> EventInfo;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  SplineFile-&gt;Close();</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;}</div>
<div class="ttc" id="aclassSplineBase_html_ae7797e26d48519c885e1537373505fcb"><div class="ttname"><a href="classSplineBase.html#ae7797e26d48519c885e1537373505fcb">SplineBase::PrepareFastSplineInfoDir</a></div><div class="ttdeci">void PrepareFastSplineInfoDir(std::unique_ptr&lt; TFile &gt; &amp;SplineFile) const</div><div class="ttdoc">KS: Prepare Fast Spline Info within SplineFile.</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8cpp_source.html#l00131">SplineBase.cpp:131</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5c374d4505de53ad68d176a5644568e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c374d4505de53ad68d176a5644568e6">&#9670;&nbsp;</a></span>PrintInitialsiation()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::PrintInitialsiation </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Print info about how much knots etc has been initialised. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00938">938</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                                    {</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment">//*********************************************************</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> event_size_max = <a class="code" href="classSMonolith.html#af54ea9c613ef95b36dcf9c194dd38e85">_max_knots</a> * <a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160; </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;--- INITIALISED Spline Monolith ---&quot;</span>);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;{} events with {} splines&quot;</span>, <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>, <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;On average {:.2f} splines per event ({}/{})&quot;</span>, <span class="keywordtype">float</span>(<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)/<span class="keywordtype">float</span>(<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>), <a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>, <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of x array = {:.4f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*event_size_max)/1.E6);</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of coefficient (y,b,c,d) array = {:.2f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="classSMonolith.html#afc0e3d1eafd575cf7628319a66925d5b">nKnots</a>*<a class="code" href="SplineCommon_8h.html#a790348db7c20fb9896e94403fbee52cf">_nCoeff_</a>)/1.E6);</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of parameter # array = {:.2f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">short</span> <span class="keywordtype">int</span>)*<a class="code" href="classSMonolith.html#ab72795333d6f632565b0f7eb0ca8a658">NSplines_valid</a>)/1.E6);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;On average {:.2f} TF1 per event ({}/{})&quot;</span>, <span class="keywordtype">float</span>(<a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>)/<span class="keywordtype">float</span>(<a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>), <a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>, <a class="code" href="classSMonolith.html#ac86282b04659bae5cccb6073c9edc0a5">NEvents</a>);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#a95fa4dffc648e4c5536c9292c2bdcac3">MACH3LOG_INFO</a>(<span class="stringliteral">&quot;Size of TF1 coefficient (a,b,c,d,e) array = {:.2f} MB&quot;</span>, <span class="keywordtype">double</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="classSMonolith.html#a13699796db31517edba3a8009317f779">NTF1_valid</a>*<a class="code" href="SplineCommon_8h.html#ad6cacf3d45a37eeeeffe38ad24345d54">_nTF1Coeff_</a>)/1.E6);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a80a8b4afea2815cf3bbf29342df7dfd5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80a8b4afea2815cf3bbf29342df7dfd5">&#9670;&nbsp;</a></span>retPointer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const float* SMonolith::retPointer </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Get pointer to total weight to make fit faster wrooom! </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>Name event number in used MC </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to the total weight </dd></dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00041">41</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;{<span class="keywordflow">return</span> &amp;<a class="code" href="classSMonolith.html#ab572dd7e0a46caf44eb925a89cbfb0cf">cpu_total_weights</a>[event];}</div>
</div><!-- fragment -->
</div>
</div>
<a id="af2a015f3d6f4f8a51d27f8cd8a67c229"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2a015f3d6f4f8a51d27f8cd8a67c229">&#9670;&nbsp;</a></span>ScanMasterSpline()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::ScanMasterSpline </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classTResponseFunction__red.html">TResponseFunction_red</a> * &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>MasterSpline</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>nEvents</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short int &amp;&#160;</td>
          <td class="paramname"><em>MaxPoints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short int &amp;&#160;</td>
          <td class="paramname"><em>numParams</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>nSplines</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>NSplinesValid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>numKnots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>nTF1Valid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>nTF1_coeff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="ParameterStructs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36d">RespFuncType</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>SplineType</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: Function to scan through the MasterSpline of TSpline3. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MasterSpline</td><td>Vector of <a class="el" href="classTSpline3__red.html" title="CW: Reduced TSpline3 class.">TSpline3_red</a> pointers which we strip back </td></tr>
    <tr><td class="paramname">NEvents</td><td>Number of MC events </td></tr>
    <tr><td class="paramname">MaxPoints</td><td>Maximal number of knots per splines </td></tr>
    <tr><td class="paramname">numParams</td><td>Total number of parameters </td></tr>
    <tr><td class="paramname">numKnots</td><td>Total number of knots, which is sum of individual knots per each spline </td></tr>
    <tr><td class="paramname">nTF1_coeff</td><td>Number of TF1 coefficients in all TF1 objects </td></tr>
    <tr><td class="paramname">SplineType</td><td>Whether object is TSpline3 or TF1 </td></tr>
    <tr><td class="paramname">NSplinesValid</td><td>Total number of valid (not null) TSpline3 </td></tr>
    <tr><td class="paramname">nTF1Valid</td><td>Total number of valid (not null) TF1 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00377">377</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                                                                            {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">// *****************************************</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="comment">// Need to extract: the total number of events</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="comment">//                  number of parameters</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="comment">//                  maximum number of knots</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  MaxPoints = 0;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  nEvents   = 0;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  numParams   = 0;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  nSplines = 0;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  numKnots = 0;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  NSplinesValid = 0;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  nTF1Valid = 0;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  nTF1_coeff = 0;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="comment">// Check the number of events</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  nEvents = int(MasterSpline.size());</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="comment">// Maximum number of splines one event can have (scan through and find this number)</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="keywordtype">int</span> nMaxSplines_PerEvent = 0;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="comment">//KS: We later check that each event has the same number of splines so this is fine</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  numParams = short(MasterSpline[0].size());</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="comment">// Initialise</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <a class="code" href="classSplineBase.html#a9452897aecfe016466543dfe19c0628b">SplineInfoArray</a>.resize(numParams);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="comment">// Loop over each parameter</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> EventCounter = 0; EventCounter &lt; MasterSpline.size(); ++EventCounter) {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="comment">// Check that each event has each spline saved</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordflow">if</span> (numParams &gt; 0) {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      <span class="keywordtype">int</span> TempSize = int(MasterSpline[EventCounter].size());</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordflow">if</span> (TempSize != numParams) {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Found {} parameters for event {}&quot;</span>, TempSize, EventCounter);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;but was expecting {} since that&#39;s what I found for the previous event&quot;</span>, numParams);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <a class="code" href="MaCh3Logger_8h.html#a61052119a625282d0ec6d4a97adf3ee2">MACH3LOG_ERROR</a>(<span class="stringliteral">&quot;Somehow this event has a different number of spline parameters... Please study further!&quot;</span>);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__ , __LINE__ );</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    numParams = short(MasterSpline[EventCounter].size());</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordtype">int</span> nSplines_SingleEvent = 0;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordtype">int</span> nPoints = 0;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// Loop over each pointer</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ParamNumber = 0; ParamNumber &lt; MasterSpline[EventCounter].size(); ++ParamNumber) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordflow">if</span> (MasterSpline[EventCounter][ParamNumber]) {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordflow">if</span>(SplineType[ParamNumber] == <a class="code" href="ParameterStructs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da8bea6994e011cc85a5a88b50c97ce7b2">kTSpline3_red</a>)</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;          <a class="code" href="classTResponseFunction__red.html">TResponseFunction_red</a>* TespFunc = MasterSpline[EventCounter][ParamNumber];</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;          <a class="code" href="classTSpline3__red.html">TSpline3_red</a>* CurrSpline = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classTSpline3__red.html">TSpline3_red</a>*<span class="keyword">&gt;</span>(TespFunc);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;          <span class="keywordflow">if</span>(CurrSpline){</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            nPoints = CurrSpline-&gt;<a class="code" href="classTSpline3__red.html#a6b680cfb96e11c55b8325e1274251b91">GetNp</a>();</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;          }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;          <span class="keywordflow">if</span> (nPoints &gt; MaxPoints) {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            MaxPoints = <span class="keyword">static_cast&lt;</span><span class="keywordtype">short</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(nPoints);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;          }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;          numKnots += nPoints;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;          nSplines_SingleEvent++;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;          <span class="comment">// Fill the SplineInfoArray entries with information on each splinified parameter</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classSplineBase.html#a9452897aecfe016466543dfe19c0628b">SplineInfoArray</a>[ParamNumber].xPts.size() == 0)</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;          {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            <span class="comment">// Fill the number of points</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <a class="code" href="classSplineBase.html#a9452897aecfe016466543dfe19c0628b">SplineInfoArray</a>[ParamNumber].nPts = CurrSpline-&gt;<a class="code" href="classTSpline3__red.html#a6b680cfb96e11c55b8325e1274251b91">GetNp</a>();</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            <span class="comment">// Fill the x points</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            <a class="code" href="classSplineBase.html#a9452897aecfe016466543dfe19c0628b">SplineInfoArray</a>[ParamNumber].xPts.resize(<a class="code" href="classSplineBase.html#a9452897aecfe016466543dfe19c0628b">SplineInfoArray</a>[ParamNumber].nPts);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> k = 0; k &lt; <a class="code" href="classSplineBase.html#a9452897aecfe016466543dfe19c0628b">SplineInfoArray</a>[ParamNumber].nPts; ++k)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;              <a class="code" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a> xtemp = <a class="code" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a>(-999.99);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;              <a class="code" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a> ytemp = <a class="code" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a>(-999.99);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;              CurrSpline-&gt;<a class="code" href="classTSpline3__red.html#a2c3cba5b93df5a08a8b6c1aee5ebb727">GetKnot</a>(k, xtemp, ytemp);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;              <a class="code" href="classSplineBase.html#a9452897aecfe016466543dfe19c0628b">SplineInfoArray</a>[ParamNumber].xPts[k] = xtemp;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;          }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;          NSplinesValid++;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SplineType[ParamNumber] == <a class="code" href="ParameterStructs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da847a18b0a859ce2b3b87a98f455855b1">kTF1_red</a>)</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        {</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;          <a class="code" href="classTResponseFunction__red.html">TResponseFunction_red</a>* TespFunc = MasterSpline[EventCounter][ParamNumber];</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;          <a class="code" href="classTF1__red.html">TF1_red</a>* CurrSpline = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classTF1__red.html">TF1_red</a>*<span class="keyword">&gt;</span>(TespFunc);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;          nPoints = CurrSpline-&gt;<a class="code" href="classTF1__red.html#af9e3b0e8d2edad0e7e08f3bf215525c9">GetSize</a>();</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;          nTF1_coeff += nPoints;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;          nTF1Valid++;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="comment">// If NULL we don&#39;t have this spline for the event, so move to next spline</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">if</span> (nSplines_SingleEvent &gt; nMaxSplines_PerEvent) nMaxSplines_PerEvent = nSplines_SingleEvent;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  nSplines = nMaxSplines_PerEvent;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keywordtype">int</span> Counter = 0;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">//KS: Sanity check that everything was set correctly</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> i = 0; i &lt; numParams; ++i)</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="comment">// KS: We don&#39;t find segment for TF1, so ignore this</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">if</span> (SplineType[i] == <a class="code" href="ParameterStructs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da847a18b0a859ce2b3b87a98f455855b1">kTF1_red</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> nPoints = <a class="code" href="classSplineBase.html#a9452897aecfe016466543dfe19c0628b">SplineInfoArray</a>[i].nPts;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keyword">const</span> std::vector&lt;M3::float_t&gt;&amp; xArray = <a class="code" href="classSplineBase.html#a9452897aecfe016466543dfe19c0628b">SplineInfoArray</a>[i].xPts;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">if</span> (nPoints == -999 || xArray.size() == 0) {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      Counter++;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordflow">if</span>(Counter &lt; 5) {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;SplineInfoArray[{}] isn&#39;t set yet&quot;</span>, i);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="comment">//throw MaCh3Exception(__FILE__ , __LINE__ );</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <a class="code" href="MaCh3Logger_8h.html#ad5b2eb6377721e3ac95def22c2386bb1">MACH3LOG_WARN</a>(<span class="stringliteral">&quot;In total SplineInfoArray for {} hasn&#39;t been initialised&quot;</span>, Counter);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div>
<div class="ttc" id="aclassSplineBase_html_a9452897aecfe016466543dfe19c0628b"><div class="ttname"><a href="classSplineBase.html#a9452897aecfe016466543dfe19c0628b">SplineBase::SplineInfoArray</a></div><div class="ttdeci">std::vector&lt; FastSplineInfo &gt; SplineInfoArray</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8h_source.html#l00071">SplineBase.h:71</a></div></div>
<div class="ttc" id="aclassTF1__red_html_af9e3b0e8d2edad0e7e08f3bf215525c9"><div class="ttname"><a href="classTF1__red.html#af9e3b0e8d2edad0e7e08f3bf215525c9">TF1_red::GetSize</a></div><div class="ttdeci">int GetSize()</div><div class="ttdoc">Get the size.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00235">SplineStructs.h:235</a></div></div>
<div class="ttc" id="aclassTSpline3__red_html_a2c3cba5b93df5a08a8b6c1aee5ebb727"><div class="ttname"><a href="classTSpline3__red.html#a2c3cba5b93df5a08a8b6c1aee5ebb727">TSpline3_red::GetKnot</a></div><div class="ttdeci">void GetKnot(int i, M3::float_t &amp;xtmp, M3::float_t &amp;ytmp)</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00721">SplineStructs.h:721</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a40f6b9256a18fa59009e5961aec776ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40f6b9256a18fa59009e5961aec776ff">&#9670;&nbsp;</a></span>setSplinePointers()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::setSplinePointers </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; const double * &gt;&#160;</td>
          <td class="paramname"><em>spline_ParsPointers</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Set pointers to spline params. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spline_ParsPointers</td><td>Vector of pointers to spline params </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00045">45</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                                                                                  {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      <a class="code" href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">splineParsPointer</a> = spline_ParsPointers;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespaceM3.html#adb59b8ecdc4e1b2d5d4c826a13aa7463">M3::int_t</a> i = 0; i &lt; <a class="code" href="classSplineBase.html#a2165b057a0125a28d96f247ca8680b42">nParams</a>; ++i) <a class="code" href="classSplineBase.html#a9452897aecfe016466543dfe19c0628b">SplineInfoArray</a>[i].<a class="code" href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">splineParsPointer</a> = spline_ParsPointers[i];</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    };</div>
<div class="ttc" id="aclassSMonolith_html_afa782652b0b3da923c5b20bb1319aadd"><div class="ttname"><a href="classSMonolith.html#afa782652b0b3da923c5b20bb1319aadd">SMonolith::splineParsPointer</a></div><div class="ttdeci">std::vector&lt; const double * &gt; splineParsPointer</div><div class="ttdoc">This holds pointer to parameter position which we later copy paste it to GPU.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00109">SplineMonolith.h:109</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a68e18d73ed1ac524ceaea79d2a5460ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68e18d73ed1ac524ceaea79d2a5460ce">&#9670;&nbsp;</a></span>SynchroniseMemTransfer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SMonolith::SynchroniseMemTransfer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>KS: After calculations are done on GPU we copy memory to CPU. This operation is asynchronous meaning while memory is being copied some operations are being carried. Memory must be copied before actual reweight. This function make sure all has been copied. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8cpp_source.html#l00955">955</a> of file <a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                                       {</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">//*********************************************************</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="preprocessor">  #ifdef MaCh3_CUDA</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <a class="code" href="gpuSplineUtils_8cu.html#a953e5c5aecebd908f5d8c6ad64de482c">SynchroniseSplines</a>();</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;}</div>
<div class="ttc" id="agpuSplineUtils_8cu_html_a953e5c5aecebd908f5d8c6ad64de482c"><div class="ttname"><a href="gpuSplineUtils_8cu.html#a953e5c5aecebd908f5d8c6ad64de482c">SynchroniseSplines</a></div><div class="ttdeci">__host__ void SynchroniseSplines()</div><div class="ttdoc">Make sure all Cuda threads finished execution.</div><div class="ttdef"><b>Definition:</b> <a href="gpuSplineUtils_8cu_source.html#l00073">gpuSplineUtils.cu:73</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="af54ea9c613ef95b36dcf9c194dd38e85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af54ea9c613ef95b36dcf9c194dd38e85">&#9670;&nbsp;</a></span>_max_knots</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">short int SMonolith::_max_knots</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Max knots for production. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00114">114</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a456dd14e1693e445ad6dddd5a8b9794f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a456dd14e1693e445ad6dddd5a8b9794f">&#9670;&nbsp;</a></span>cpu_coeff_TF1_many</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;float&gt; SMonolith::cpu_coeff_TF1_many</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU arrays to hold TF1 coefficients. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00151">151</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a0a6599372d1e3d38105478a68308d9a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a6599372d1e3d38105478a68308d9a6">&#9670;&nbsp;</a></span>cpu_nParamPerEvent</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;unsigned int&gt; SMonolith::cpu_nParamPerEvent</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number of splines per event, index where splines start for a given event}. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00139">139</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a66eecc550dea893c60a435a034e7ebf5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66eecc550dea893c60a435a034e7ebf5">&#9670;&nbsp;</a></span>cpu_nParamPerEvent_tf1</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;unsigned int&gt; SMonolith::cpu_nParamPerEvent_tf1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: CPU map keeping track how many parameters applies to each event, we keep two numbers here {number of TF1 per event, index where TF1 start for a given event}. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00142">142</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a14b9c21186a53196f49c8d8d3555fbf2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14b9c21186a53196f49c8d8d3555fbf2">&#9670;&nbsp;</a></span>cpu_nPoints_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;short int&gt; SMonolith::cpu_nPoints_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU arrays to hold number of points. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00154">154</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="af87cf7ae888eb7d4c56f8b6c41c9fd02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af87cf7ae888eb7d4c56f8b6c41c9fd02">&#9670;&nbsp;</a></span>cpu_paramNo_TF1_arr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;short int&gt; SMonolith::cpu_paramNo_TF1_arr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CW: CPU array with the number of points per spline (not per spline point!) </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00157">157</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a48d0e5e5b4130fcd191c3e8f1d841eb7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48d0e5e5b4130fcd191c3e8f1d841eb7">&#9670;&nbsp;</a></span>cpu_spline_handler</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structSplineMonoStruct.html">SplineMonoStruct</a>* SMonolith::cpu_spline_handler</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Store info about Spline monolith, this allow to obtain better step time. As all necessary information for spline weight calculation are here meaning better cache hits. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00145">145</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ab572dd7e0a46caf44eb925a89cbfb0cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab572dd7e0a46caf44eb925a89cbfb0cf">&#9670;&nbsp;</a></span>cpu_total_weights</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::cpu_total_weights</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>KS: This holds the total CPU weights that gets read in samplePDFND. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00053">53</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a8614e8ef07431d99f62ab88d9ebdad16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8614e8ef07431d99f62ab88d9ebdad16">&#9670;&nbsp;</a></span>cpu_weights</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::cpu_weights</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The returned gpu weights, read by the GPU. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00051">51</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a870bb2bce61e17162b9425f82cf2a099"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a870bb2bce61e17162b9425f82cf2a099">&#9670;&nbsp;</a></span>cpu_weights_spline_var</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::cpu_weights_spline_var</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU arrays to hold weight for each spline. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00134">134</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a4a1d45d273cc40cb4f684400812dcb60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a1d45d273cc40cb4f684400812dcb60">&#9670;&nbsp;</a></span>cpu_weights_tf1_var</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float* SMonolith::cpu_weights_tf1_var</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU arrays to hold weight for each TF1. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00136">136</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="aa7e91b11f9708a828a521f32f8058fe9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7e91b11f9708a828a521f32f8058fe9">&#9670;&nbsp;</a></span>FastSplineName</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string SMonolith::FastSplineName</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Name of Fast Spline to which will be saved. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00163">163</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a03444cbed8a9d9a7798d0ef2b26bd702"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03444cbed8a9d9a7798d0ef2b26bd702">&#9670;&nbsp;</a></span>gpu_spline_handler</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classSMonolithGPU.html">SMonolithGPU</a>* SMonolith::gpu_spline_handler</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>KS: Store info about Spline monolith, this allow to obtain better step time. As all necessary information for spline weight calculation are here meaning better cache hits. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00148">148</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a9c4fa00b6e36d150d52e87e6463aabaa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c4fa00b6e36d150d52e87e6463aabaa">&#9670;&nbsp;</a></span>index_spline_cpu</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;int&gt; SMonolith::index_spline_cpu</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>holds the index for good splines; don't do unsigned since starts with negative value! </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00116">116</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a723920c6c324901ac0fa48df7aad64cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a723920c6c324901ac0fa48df7aad64cd">&#9670;&nbsp;</a></span>index_TF1_cpu</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;int&gt; SMonolith::index_TF1_cpu</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>holds the index for good TF1; don't do unsigned since starts with negative value! </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00118">118</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ac86282b04659bae5cccb6073c9edc0a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac86282b04659bae5cccb6073c9edc0a5">&#9670;&nbsp;</a></span>NEvents</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::NEvents</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of events. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00112">112</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="afc0e3d1eafd575cf7628319a66925d5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc0e3d1eafd575cf7628319a66925d5b">&#9670;&nbsp;</a></span>nKnots</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::nKnots</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sum of all knots over all splines. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00129">129</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="aee3c18513f8209f1ac940b492cd3ed68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee3c18513f8209f1ac940b492cd3ed68">&#9670;&nbsp;</a></span>NSplines_total_large</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::NSplines_total_large</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of total splines if each event had every parameter's spline. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00126">126</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ab72795333d6f632565b0f7eb0ca8a658"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab72795333d6f632565b0f7eb0ca8a658">&#9670;&nbsp;</a></span>NSplines_valid</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::NSplines_valid</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of valid splines. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00121">121</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a13699796db31517edba3a8009317f779"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13699796db31517edba3a8009317f779">&#9670;&nbsp;</a></span>NTF1_valid</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::NTF1_valid</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of valid TF1. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00123">123</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="a403e7cf909f98d4c59b5f6c7ff8aac5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a403e7cf909f98d4c59b5f6c7ff8aac5b">&#9670;&nbsp;</a></span>nTF1coeff</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SMonolith::nTF1coeff</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sum of all coefficients over all TF1. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00131">131</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="ab5692081772ca14bd012eb125e2ccfd4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5692081772ca14bd012eb125e2ccfd4">&#9670;&nbsp;</a></span>SaveSplineFile</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool SMonolith::SaveSplineFile</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Flag telling whether we are saving spline monolith into handy root file. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00160">160</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<a id="afa782652b0b3da923c5b20bb1319aadd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa782652b0b3da923c5b20bb1319aadd">&#9670;&nbsp;</a></span>splineParsPointer</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; const double* &gt; SMonolith::splineParsPointer</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This holds pointer to parameter position which we later copy paste it to GPU. </p>

<p class="definition">Definition at line <a class="el" href="SplineMonolith_8h_source.html#l00109">109</a> of file <a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>Splines/<a class="el" href="SplineMonolith_8h_source.html">SplineMonolith.h</a></li>
<li>Splines/<a class="el" href="SplineMonolith_8cpp_source.html">SplineMonolith.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- Footer for MaCh3 Doxygen documentation -->
<footer class="mach3-footer" style="text-align: center;">
    <div style="margin-bottom: 15px;">
        <span style="font-weight: bold;">The MaCh3 Collaboration</span>
    </div>
    <!-- Dropdown to jump between doc versions -->
    <div style="margin-bottom: 10px;">
        <span>Select Software Version: </span>
        <select id="versionSelector" onchange="window.location.href=this.value" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="">-- Select --</option>
            <option value="https://mach3-software.github.io/MaCh3/">develop</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.3.0/index.html">v2.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.2.0/index.html">v2.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.1.0/index.html">v2.1.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.0.0/index.html">v2.0.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.5.0/index.html">v1.5.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.4.0/index.html">v1.4.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.3.0/index.html">v1.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.2.0/index.html">v1.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.1.0/index.html">v1.1.0</option>
        </select>
    </div>
    <!-- Footer info about doxygen -->
    <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
        Documentation generated with
        <a href="https://www.doxygen.nl/" target="_blank" style="color: #666;">Doxygen</a>
        <span id="doxygenVersion"></span>
    </div>
    <!-- Now grab doxygen version from metadata -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const meta = document.querySelector('meta[name="generator"]');
        if (meta) {
            const version = meta.getAttribute("content").replace("Doxygen ", "");
            document.getElementById("doxygenVersion").textContent = " " + version;
        }
    });
    </script>
</footer>
