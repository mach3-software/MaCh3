\hypertarget{classmcmc}{}\doxysection{mcmc Class Reference}
\label{classmcmc}\index{mcmc@{mcmc}}


Implementation of MR2\+T2 algorithm.  




{\ttfamily \#include $<$/home/runner/work/\+Ma\+Ch3/\+Ma\+Ch3/mcmc/mcmc.\+h$>$}



Inheritance diagram for mcmc\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=146pt]{classmcmc__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for mcmc\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classmcmc__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classmcmc_a56195958aee22996158d3ba341dcf31e}{mcmc}} (\mbox{\hyperlink{classmanager}{manager}} $\ast$const \mbox{\hyperlink{classFitterBase_a4fceb68f242feeb04a0ddf42a5a37095}{fit\+Man}})
\begin{DoxyCompactList}\small\item\em Constructor. \end{DoxyCompactList}\item 
virtual \mbox{\hyperlink{classmcmc_a6685a5d7fdac30e3676d5076ea26ec92}{$\sim$mcmc}} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classmcmc_a8a9cc0e0aa65c8573fca703a42b2ee31}{run\+MCMC}} () override
\begin{DoxyCompactList}\small\item\em Actual implementation of MCMC fitting algorithm. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classmcmc_af549f9b0ab4276710bc0d2987ad825a9}{set\+Chain\+Length}} (unsigned int L)
\begin{DoxyCompactList}\small\item\em Set how long chain should be. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classmcmc_a7129ef21a4b2abab4bf142653d558535}{set\+Initial\+Step\+Number}} (const unsigned int step\+Num=0)
\begin{DoxyCompactList}\small\item\em Set initial step number, used when starting from another chain. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classmcmc_adf4c80255288c5396da3b95d609ce4b2}{Start\+From\+Previous\+Fit}} (const std\+::string \&Fit\+Name) override
\begin{DoxyCompactList}\small\item\em Allow to start from previous fit/chain. \end{DoxyCompactList}\item 
std\+::string \mbox{\hyperlink{classmcmc_a0446e3c1f2af2173ffd6f017fdf6f1ba}{Get\+Name}} () const
\begin{DoxyCompactList}\small\item\em Get name of class. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Public Member Functions inherited from \mbox{\hyperlink{classFitterBase}{Fitter\+Base}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classFitterBase_a2d45811f9bcb9719f312048bbd36a423}{Fitter\+Base}} (\mbox{\hyperlink{classmanager}{manager}} $\ast$const \mbox{\hyperlink{classFitterBase_a4fceb68f242feeb04a0ddf42a5a37095}{fit\+Man}})
\begin{DoxyCompactList}\small\item\em Constructor. \end{DoxyCompactList}\item 
virtual \mbox{\hyperlink{classFitterBase_ae8677b449e49ca86bafee685e8dbe93f}{$\sim$\+Fitter\+Base}} ()
\begin{DoxyCompactList}\small\item\em Destructor for the \mbox{\hyperlink{classFitterBase}{Fitter\+Base}} class. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classFitterBase_abe93c6d49aa079d811a9021de59691b1}{add\+Sample\+PDF}} (\mbox{\hyperlink{classsamplePDFBase}{sample\+PDFBase}} $\ast$sample)
\begin{DoxyCompactList}\small\item\em This function adds a sample PDF object to the analysis framework. The sample PDF object will be utilized in fitting procedures or likelihood scans. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classFitterBase_a1d0068193922448a6fed0e0d3ff4305a}{add\+Syst\+Obj}} (\mbox{\hyperlink{classcovarianceBase}{covariance\+Base}} $\ast$cov)
\begin{DoxyCompactList}\small\item\em This function adds a Covariance object to the analysis framework. The Covariance object will be utilized in fitting procedures or likelihood scans. \end{DoxyCompactList}\item 
virtual void \mbox{\hyperlink{classFitterBase_a1a9666dc09f91af804954e8968bc7b24}{run\+MCMC}} ()=0
\begin{DoxyCompactList}\small\item\em The specific fitting algorithm implemented in this function depends on the derived class. It could be Markov Chain Monte Carlo (MCMC), \mbox{\hyperlink{classMinuitFit}{Minuit\+Fit}}, or another algorithm. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classFitterBase_ab3db1d0bb7364e70cd432a3e1c0a600e}{Drag\+Race}} (const int NLaps=100)
\begin{DoxyCompactList}\small\item\em Calculates the required time for each sample or covariance object in a drag race simulation. Inspired by Dan\textquotesingle{}s feature. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classFitterBase_a018e8d09a62bca19840e1321b49df2c0}{Run\+LLHScan}} ()
\begin{DoxyCompactList}\small\item\em Perform a 1D likelihood scan. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classFitterBase_a63820450a9089d5281769288c007db55}{Get\+Step\+Scale\+Based\+On\+LLHScan}} ()
\begin{DoxyCompactList}\small\item\em LLH scan is good first estimate of step scale. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classFitterBase_ab8b32ca268c20dd643eaf92dae04cd0a}{Run2\+DLLHScan}} ()
\begin{DoxyCompactList}\small\item\em Perform a 2D likelihood scan. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classFitterBase_a71e43b96395568e54879d9bd1b57c0f8}{Run\+Sigma\+Var}} ()
\begin{DoxyCompactList}\small\item\em Perform a 2D and 1D sigma var for all samples. \end{DoxyCompactList}\item 
virtual void \mbox{\hyperlink{classFitterBase_a655ccea31627627e2b36745c97e5c0f0}{Start\+From\+Previous\+Fit}} (const std\+::string \&Fit\+Name)
\begin{DoxyCompactList}\small\item\em Allow to start from previous fit/chain. \end{DoxyCompactList}\item 
virtual std\+::string \mbox{\hyperlink{classFitterBase_a3706f6d722073b447b3de8c3a6516601}{Get\+Name}} () const
\begin{DoxyCompactList}\small\item\em Get name of class. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{classmcmc_aaf921343861cec8bb96beb2503b3fe2c}{Propose\+Step}} ()
\begin{DoxyCompactList}\small\item\em Propose a step. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classmcmc_aa2f1c8aa3d951b935bbb3ec637b6b651}{Check\+Step}} ()
\begin{DoxyCompactList}\small\item\em Do we accept the step. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classmcmc_ae0eabbfc70f9bae615332caa48b3f4f4}{Print\+Progress}} ()
\begin{DoxyCompactList}\small\item\em Print the progress. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{classmcmc_a537f7c2411a6a8e65fdf57b81ce6fe4a}{reject}}
\begin{DoxyCompactList}\small\item\em Do we reject based on hitting boundaries in systs. \end{DoxyCompactList}\item 
unsigned int \mbox{\hyperlink{classmcmc_a2b9a5344ea8074fcecdc1ae2f3cfc62a}{chain\+Length}}
\begin{DoxyCompactList}\small\item\em number of steps in chain \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classmcmc_a4da3776296d4f06268f240df5eb0bbcc}{anneal}}
\begin{DoxyCompactList}\small\item\em simulated annealing \end{DoxyCompactList}\item 
double \mbox{\hyperlink{classmcmc_a3052c9e38107c0070c885a5a3bbbc302}{Anneal\+Temp}}
\begin{DoxyCompactList}\small\item\em simulated annealing temperature \end{DoxyCompactList}\item 
int \mbox{\hyperlink{classmcmc_a41ce4f96a562ea3f8e750feaae4d24c4}{step\+Start}}
\begin{DoxyCompactList}\small\item\em starting value of a chain, usually 0, unless starting from previous chain \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}
\doxysubsubsection*{Protected Member Functions inherited from \mbox{\hyperlink{classFitterBase}{Fitter\+Base}}}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{classFitterBase_a1dccdac8611e70c759c47a65f2b1aea7}{Process\+MCMC}} ()
\begin{DoxyCompactList}\small\item\em Process MCMC output. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classFitterBase_a53715760edd8c7640432f31793fd28f9}{Prepare\+Output}} ()
\begin{DoxyCompactList}\small\item\em Prepare the output file. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classFitterBase_a418f581b688f035211107ddd83168c08}{Save\+Output}} ()
\begin{DoxyCompactList}\small\item\em Save output and close files. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classFitterBase_a48f38bfa8996fe00d51f35b05dd16b46}{Save\+Settings}} ()
\begin{DoxyCompactList}\small\item\em Save the settings that the MCMC was run with. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Protected Attributes inherited from \mbox{\hyperlink{classFitterBase}{Fitter\+Base}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classmanager}{manager}} $\ast$ \mbox{\hyperlink{classFitterBase_a4fceb68f242feeb04a0ddf42a5a37095}{fit\+Man}}
\begin{DoxyCompactList}\small\item\em The manager. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classMaCh3Modes}{Ma\+Ch3\+Modes}} $\ast$ \mbox{\hyperlink{classFitterBase_a004cb6e6168032d9280ce3db912f1a43}{Modes}}
\begin{DoxyCompactList}\small\item\em Ma\+Ch3 Modes. \end{DoxyCompactList}\item 
unsigned int \mbox{\hyperlink{classFitterBase_a50df1bd75b20a953f81ab9c2bab6b42c}{step}}
\begin{DoxyCompactList}\small\item\em current state \end{DoxyCompactList}\item 
double \mbox{\hyperlink{classFitterBase_abfb6f10720764d8bbbe43754fd5cd976}{log\+LCurr}}
\begin{DoxyCompactList}\small\item\em current likelihood \end{DoxyCompactList}\item 
double \mbox{\hyperlink{classFitterBase_a187dd22c17f9e96e5a7e2fb2371abace}{log\+LProp}}
\begin{DoxyCompactList}\small\item\em proposed likelihood \end{DoxyCompactList}\item 
double \mbox{\hyperlink{classFitterBase_a6319d2ea50984860475bbc6c708b0d90}{acc\+Prob}}
\begin{DoxyCompactList}\small\item\em current acceptance prob \end{DoxyCompactList}\item 
int \mbox{\hyperlink{classFitterBase_a2774f3a0047c4347ee0db05406425f79}{acc\+Count}}
\begin{DoxyCompactList}\small\item\em counts accepted steps \end{DoxyCompactList}\item 
std\+::vector$<$ double $>$ \mbox{\hyperlink{classFitterBase_a6f435e161c96eea778aba844115428d4}{sample\+\_\+llh}}
\begin{DoxyCompactList}\small\item\em store the llh breakdowns \end{DoxyCompactList}\item 
std\+::vector$<$ double $>$ \mbox{\hyperlink{classFitterBase_ace2eeca9829f63200c3f956c600d09ff}{syst\+\_\+llh}}
\begin{DoxyCompactList}\small\item\em systematic llh breakdowns \end{DoxyCompactList}\item 
std\+::vector$<$ \mbox{\hyperlink{classsamplePDFBase}{sample\+PDFBase}} $\ast$ $>$ \mbox{\hyperlink{classFitterBase_afac0dcceb1df194159c07945e8dc0069}{samples}}
\begin{DoxyCompactList}\small\item\em Sample holder. \end{DoxyCompactList}\item 
unsigned int \mbox{\hyperlink{classFitterBase_abe9814558b8ff1bccdde3b4c894467e6}{Total\+NSamples}}
\begin{DoxyCompactList}\small\item\em Total number of samples used. \end{DoxyCompactList}\item 
std\+::vector$<$ \mbox{\hyperlink{classcovarianceBase}{covariance\+Base}} $\ast$ $>$ \mbox{\hyperlink{classFitterBase_a3a15d2348b7bf0a639aaab52b9294bbf}{systematics}}
\begin{DoxyCompactList}\small\item\em Systematic holder. \end{DoxyCompactList}\item 
std\+::unique\+\_\+ptr$<$ TStopwatch $>$ \mbox{\hyperlink{classFitterBase_a858edb45544f690e90b60b9e041394a6}{clock}}
\begin{DoxyCompactList}\small\item\em tells global time how long fit took \end{DoxyCompactList}\item 
std\+::unique\+\_\+ptr$<$ TStopwatch $>$ \mbox{\hyperlink{classFitterBase_a9fe01b2b6f7f0d6a7b04675a099e1a4f}{step\+Clock}}
\begin{DoxyCompactList}\small\item\em tells how long single step/fit iteration took \end{DoxyCompactList}\item 
double \mbox{\hyperlink{classFitterBase_a8354e9a7a9cc534277ff76ab37c9a763}{step\+Time}}
\begin{DoxyCompactList}\small\item\em Time of single step. \end{DoxyCompactList}\item 
std\+::unique\+\_\+ptr$<$ TRandom3 $>$ \mbox{\hyperlink{classFitterBase_a138f250d9204a30204e4ca5b973008b2}{random}}
\begin{DoxyCompactList}\small\item\em Random number. \end{DoxyCompactList}\item 
TFile $\ast$ \mbox{\hyperlink{classFitterBase_a4260b312e3f35cf01fc73b02239f8990}{output\+File}}
\begin{DoxyCompactList}\small\item\em Output. \end{DoxyCompactList}\item 
TDirectory $\ast$ \mbox{\hyperlink{classFitterBase_aacc46437245ba8a9817f2ed2e86a96e0}{Cov\+Folder}}
\begin{DoxyCompactList}\small\item\em Output cov folder. \end{DoxyCompactList}\item 
TTree $\ast$ \mbox{\hyperlink{classFitterBase_aed2032b9c4a4f2248abe548f54f8dcc8}{out\+Tree}}
\begin{DoxyCompactList}\small\item\em Output tree with posteriors. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{classFitterBase_ad955982e63066918cba9c53381608d09}{auto\+\_\+save}}
\begin{DoxyCompactList}\small\item\em auto save every N steps \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classFitterBase_ada898e35bab22af470f2cd1e28af609b}{f\+Test\+Likelihood}}
\begin{DoxyCompactList}\small\item\em Necessary for some fitting algorithms like \mbox{\hyperlink{classPSO}{PSO}}. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classFitterBase_aedd882d8e4d0da0f89cf94e3a008affe}{save\+\_\+nominal}}
\begin{DoxyCompactList}\small\item\em save nominal matrix info or not \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classFitterBase_a490b8614c4089c6db10ff357e7aaab67}{Save\+Proposal}}
\begin{DoxyCompactList}\small\item\em Save proposal at each step. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classFitterBase_a699abe6a2c89706b54544212152d613a}{File\+Saved}}
\begin{DoxyCompactList}\small\item\em Checks if file saved not repeat some operations. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classFitterBase_a588678c71d816f48ba3c140543dbe916}{Settings\+Saved}}
\begin{DoxyCompactList}\small\item\em Checks if setting saved not repeat some operations. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classFitterBase_a3bfd8f69df891d03bae0587cd1a1e1b7}{Output\+Prepared}}
\begin{DoxyCompactList}\small\item\em Checks if output prepared not repeat some operations. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implementation of MR2\+T2 algorithm. 

Definition at line \mbox{\hyperlink{mcmc_8h_source_l00006}{6}} of file \mbox{\hyperlink{mcmc_8h_source}{mcmc.\+h}}.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classmcmc_a56195958aee22996158d3ba341dcf31e}\label{classmcmc_a56195958aee22996158d3ba341dcf31e}} 
\index{mcmc@{mcmc}!mcmc@{mcmc}}
\index{mcmc@{mcmc}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{mcmc()}{mcmc()}}
{\footnotesize\ttfamily mcmc\+::mcmc (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classmanager}{manager}} $\ast$const}]{fit\+Man }\end{DoxyParamCaption})}



Constructor. 


\begin{DoxyParams}{Parameters}
{\em fit\+Man} & A pointer to a manager object, which will handle all settings. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{mcmc_8cpp_source_l00006}{6}} of file \mbox{\hyperlink{mcmc_8cpp_source}{mcmc.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classFitterBase}{FitterBase}}(\mbox{\hyperlink{GetPostfitParamPlots_8cpp_aa6f3c9a8cee8f72f6f8ce65b720a2d40}{man}})\ \{}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ *************************}}
\DoxyCodeLine{00008\ \ \ \textcolor{comment}{//\ Beginning\ step\ number}}
\DoxyCodeLine{00009\ \ \ \mbox{\hyperlink{classmcmc_a41ce4f96a562ea3f8e750feaae4d24c4}{stepStart}}\ =\ 0;}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \ \ \textcolor{comment}{//\ Starting\ parameters\ should\ be\ thrown}}
\DoxyCodeLine{00012\ \ \ \mbox{\hyperlink{classmcmc_a537f7c2411a6a8e65fdf57b81ce6fe4a}{reject}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00013\ \ \ \mbox{\hyperlink{classmcmc_a2b9a5344ea8074fcecdc1ae2f3cfc62a}{chainLength}}\ =\ \mbox{\hyperlink{classFitterBase_a4fceb68f242feeb04a0ddf42a5a37095}{fitMan}}-\/>\mbox{\hyperlink{classmanager_ab3999cc856ede72b37f68bdb28bd5520}{raw}}()[\textcolor{stringliteral}{"{}General"{}}][\textcolor{stringliteral}{"{}MCMC"{}}][\textcolor{stringliteral}{"{}NSteps"{}}].as<\textcolor{keywordtype}{unsigned}>();}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \ \ \mbox{\hyperlink{classmcmc_a3052c9e38107c0070c885a5a3bbbc302}{AnnealTemp}}\ =\ GetFromManager<double>(\mbox{\hyperlink{classFitterBase_a4fceb68f242feeb04a0ddf42a5a37095}{fitMan}}-\/>\mbox{\hyperlink{classmanager_ab3999cc856ede72b37f68bdb28bd5520}{raw}}()[\textcolor{stringliteral}{"{}General"{}}][\textcolor{stringliteral}{"{}MCMC"{}}][\textcolor{stringliteral}{"{}AnnealTemp"{}}],\ -\/999);}
\DoxyCodeLine{00016\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classmcmc_a3052c9e38107c0070c885a5a3bbbc302}{AnnealTemp}}\ <\ 0)\ \mbox{\hyperlink{classmcmc_a4da3776296d4f06268f240df5eb0bbcc}{anneal}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00017\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00018\ \ \ \{}
\DoxyCodeLine{00019\ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Enabling\ simulated\ annealing\ with\ T\ =\ \{\}"{}},\ \mbox{\hyperlink{classmcmc_a3052c9e38107c0070c885a5a3bbbc302}{AnnealTemp}});}
\DoxyCodeLine{00020\ \ \ \ \ \mbox{\hyperlink{classmcmc_a4da3776296d4f06268f240df5eb0bbcc}{anneal}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00021\ \ \ \}}
\DoxyCodeLine{00022\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classmcmc_a6685a5d7fdac30e3676d5076ea26ec92}\label{classmcmc_a6685a5d7fdac30e3676d5076ea26ec92}} 
\index{mcmc@{mcmc}!````~mcmc@{$\sim$mcmc}}
\index{````~mcmc@{$\sim$mcmc}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{$\sim$mcmc()}{~mcmc()}}
{\footnotesize\ttfamily mcmc\+::$\sim$mcmc (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Destructor. 



Definition at line \mbox{\hyperlink{mcmc_8cpp_source_l00026}{26}} of file \mbox{\hyperlink{mcmc_8cpp_source}{mcmc.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00027\ \textcolor{comment}{//\ *************************}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classmcmc_aa2f1c8aa3d951b935bbb3ec637b6b651}\label{classmcmc_aa2f1c8aa3d951b935bbb3ec637b6b651}} 
\index{mcmc@{mcmc}!CheckStep@{CheckStep}}
\index{CheckStep@{CheckStep}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{CheckStep()}{CheckStep()}}
{\footnotesize\ttfamily void mcmc\+::\+Check\+Step (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}



Do we accept the step. 



Definition at line \mbox{\hyperlink{mcmc_8cpp_source_l00033}{33}} of file \mbox{\hyperlink{mcmc_8cpp_source}{mcmc.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00034\ \textcolor{comment}{//\ **********************}}
\DoxyCodeLine{00035\ \ \ \textcolor{keywordtype}{bool}\ accept\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \textcolor{comment}{//\ Set\ the\ acceptance\ probability\ to\ zero}}
\DoxyCodeLine{00038\ \ \ \mbox{\hyperlink{classFitterBase_a6319d2ea50984860475bbc6c708b0d90}{accProb}}\ =\ 0.0;}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \textcolor{comment}{//\ Calculate\ acceptance\ probability}}
\DoxyCodeLine{00041\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classmcmc_a4da3776296d4f06268f240df5eb0bbcc}{anneal}})\ \mbox{\hyperlink{classFitterBase_a6319d2ea50984860475bbc6c708b0d90}{accProb}}\ =\ TMath::Min(1.,TMath::Exp(\ -\/(\mbox{\hyperlink{classFitterBase_a187dd22c17f9e96e5a7e2fb2371abace}{logLProp}}-\/\mbox{\hyperlink{classFitterBase_abfb6f10720764d8bbbe43754fd5cd976}{logLCurr}})\ /\ (TMath::Exp(-\/\mbox{\hyperlink{classFitterBase_a50df1bd75b20a953f81ab9c2bab6b42c}{step}}/\mbox{\hyperlink{classmcmc_a3052c9e38107c0070c885a5a3bbbc302}{AnnealTemp}}))));\ }
\DoxyCodeLine{00042\ \ \ \textcolor{keywordflow}{else}\ \mbox{\hyperlink{classFitterBase_a6319d2ea50984860475bbc6c708b0d90}{accProb}}\ =\ TMath::Min(1.,\ TMath::Exp(\mbox{\hyperlink{classFitterBase_abfb6f10720764d8bbbe43754fd5cd976}{logLCurr}}-\/\mbox{\hyperlink{classFitterBase_a187dd22c17f9e96e5a7e2fb2371abace}{logLProp}}));}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \textcolor{comment}{//\ Get\ the\ random\ number}}
\DoxyCodeLine{00045\ \ \ \textcolor{keywordtype}{double}\ fRandom\ =\ \mbox{\hyperlink{classFitterBase_a138f250d9204a30204e4ca5b973008b2}{random}}-\/>Rndm();}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \textcolor{comment}{//\ Do\ the\ accept/reject}}
\DoxyCodeLine{00048\ \ \ \textcolor{keywordflow}{if}\ (fRandom\ <=\ \mbox{\hyperlink{classFitterBase_a6319d2ea50984860475bbc6c708b0d90}{accProb}})\ \{}
\DoxyCodeLine{00049\ \ \ \ \ accept\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00050\ \ \ \ \ ++\mbox{\hyperlink{classFitterBase_a2774f3a0047c4347ee0db05406425f79}{accCount}};}
\DoxyCodeLine{00051\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00052\ \ \ \ \ accept\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00053\ \ \ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\ \ \#ifdef\ DEBUG}}
\DoxyCodeLine{00056\ \ \ \textcolor{keywordflow}{if}\ (debug)\ debugFile\ <<\ \textcolor{stringliteral}{"{}\ logLProp:\ "{}}\ <<\ \mbox{\hyperlink{classFitterBase_a187dd22c17f9e96e5a7e2fb2371abace}{logLProp}}\ <<\ \textcolor{stringliteral}{"{}\ logLCurr:\ "{}}\ <<\ \mbox{\hyperlink{classFitterBase_abfb6f10720764d8bbbe43754fd5cd976}{logLCurr}}\ <<\ \textcolor{stringliteral}{"{}\ accProb:\ "{}}\ <<\ \mbox{\hyperlink{classFitterBase_a6319d2ea50984860475bbc6c708b0d90}{accProb}}\ <<\ \textcolor{stringliteral}{"{}\ fRandom:\ "{}}\ <<\ fRandom\ <<\ std::endl;}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{//\ Update\ all\ the\ handlers\ to\ accept\ the\ step}}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordflow}{if}\ (accept\ \&\&\ !\mbox{\hyperlink{classmcmc_a537f7c2411a6a8e65fdf57b81ce6fe4a}{reject}})\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \mbox{\hyperlink{classFitterBase_abfb6f10720764d8bbbe43754fd5cd976}{logLCurr}}\ =\ \mbox{\hyperlink{classFitterBase_a187dd22c17f9e96e5a7e2fb2371abace}{logLProp}};}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{comment}{//\ Loop\ over\ systematics\ and\ accept}}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ s\ =\ 0;\ s\ <\ \mbox{\hyperlink{classFitterBase_a3a15d2348b7bf0a639aaab52b9294bbf}{systematics}}.size();\ ++s)\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \mbox{\hyperlink{classFitterBase_a3a15d2348b7bf0a639aaab52b9294bbf}{systematics}}[s]-\/>acceptStep();}
\DoxyCodeLine{00066\ \ \ \ \ \}}
\DoxyCodeLine{00067\ \ \ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \mbox{\hyperlink{classFitterBase_a9fe01b2b6f7f0d6a7b04675a099e1a4f}{stepClock}}-\/>Stop();}
\DoxyCodeLine{00070\ \ \ \mbox{\hyperlink{classFitterBase_a8354e9a7a9cc534277ff76ab37c9a763}{stepTime}}\ =\ \mbox{\hyperlink{classFitterBase_a9fe01b2b6f7f0d6a7b04675a099e1a4f}{stepClock}}-\/>RealTime();}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{//\ Write\ step\ to\ output\ tree}}
\DoxyCodeLine{00073\ \ \ \mbox{\hyperlink{classFitterBase_aed2032b9c4a4f2248abe548f54f8dcc8}{outTree}}-\/>Fill();}
\DoxyCodeLine{00074\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classmcmc_a0446e3c1f2af2173ffd6f017fdf6f1ba}\label{classmcmc_a0446e3c1f2af2173ffd6f017fdf6f1ba}} 
\index{mcmc@{mcmc}!GetName@{GetName}}
\index{GetName@{GetName}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{GetName()}{GetName()}}
{\footnotesize\ttfamily std\+::string mcmc\+::\+Get\+Name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}



Get name of class. 



Reimplemented from \mbox{\hyperlink{classFitterBase_a3706f6d722073b447b3de8c3a6516601}{Fitter\+Base}}.



Definition at line \mbox{\hyperlink{mcmc_8h_source_l00029}{29}} of file \mbox{\hyperlink{mcmc_8h_source}{mcmc.\+h}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00029\ \{\textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}MCMC"{}};\};}

\end{DoxyCode}
\mbox{\Hypertarget{classmcmc_ae0eabbfc70f9bae615332caa48b3f4f4}\label{classmcmc_ae0eabbfc70f9bae615332caa48b3f4f4}} 
\index{mcmc@{mcmc}!PrintProgress@{PrintProgress}}
\index{PrintProgress@{PrintProgress}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{PrintProgress()}{PrintProgress()}}
{\footnotesize\ttfamily void mcmc\+::\+Print\+Progress (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}



Print the progress. 



Definition at line \mbox{\hyperlink{mcmc_8cpp_source_l00197}{197}} of file \mbox{\hyperlink{mcmc_8cpp_source}{mcmc.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00198\ \textcolor{comment}{//\ *******************}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Step:\(\backslash\)t\{\}/\{\},\ current:\ \{:.2f\},\ proposed:\ \{:.2f\}"{}},\ \mbox{\hyperlink{classFitterBase_a50df1bd75b20a953f81ab9c2bab6b42c}{step}}\ -\/\ \mbox{\hyperlink{classmcmc_a41ce4f96a562ea3f8e750feaae4d24c4}{stepStart}},\ \mbox{\hyperlink{classmcmc_a2b9a5344ea8074fcecdc1ae2f3cfc62a}{chainLength}},\ \mbox{\hyperlink{classFitterBase_abfb6f10720764d8bbbe43754fd5cd976}{logLCurr}},\ \mbox{\hyperlink{classFitterBase_a187dd22c17f9e96e5a7e2fb2371abace}{logLProp}});}
\DoxyCodeLine{00201\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Accepted/Total\ steps:\ \{\}/\{\}\ =\ \{:.2f\}"{}},\ \mbox{\hyperlink{classFitterBase_a2774f3a0047c4347ee0db05406425f79}{accCount}},\ \mbox{\hyperlink{classFitterBase_a50df1bd75b20a953f81ab9c2bab6b42c}{step}}\ -\/\ \mbox{\hyperlink{classmcmc_a41ce4f96a562ea3f8e750feaae4d24c4}{stepStart}},\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{classFitterBase_a2774f3a0047c4347ee0db05406425f79}{accCount}})\ /\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{classFitterBase_a50df1bd75b20a953f81ab9c2bab6b42c}{step}}\ -\/\ \mbox{\hyperlink{classmcmc_a41ce4f96a562ea3f8e750feaae4d24c4}{stepStart}}));}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classcovarianceBase}{covarianceBase}}\ *cov\ :\ \mbox{\hyperlink{classFitterBase_a3a15d2348b7bf0a639aaab52b9294bbf}{systematics}})\ \{}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keywordflow}{if}\ (cov-\/>getName()\ ==\ \textcolor{stringliteral}{"{}xsec\_cov"{}})\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Cross-\/section\ parameters:\ "{}});}
\DoxyCodeLine{00206\ \ \ \ \ \ \ cov-\/>printNominalCurrProp();}
\DoxyCodeLine{00207\ \ \ \ \ \}}
\DoxyCodeLine{00208\ \ \ \}}
\DoxyCodeLine{00209\ \textcolor{preprocessor}{\ \ \#ifdef\ DEBUF}}
\DoxyCodeLine{00210\ \ \ \textcolor{keywordflow}{if}\ (debug)\ \{}
\DoxyCodeLine{00211\ \ \ \ \ debugFile\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/"{}}\ <<\ std::endl;}
\DoxyCodeLine{00212\ \ \ \ \ debugFile\ <<\ \textcolor{stringliteral}{"{}Step:\(\backslash\)t"{}}\ <<\ \mbox{\hyperlink{classFitterBase_a50df1bd75b20a953f81ab9c2bab6b42c}{step}}\ +\ 1\ <<\ \textcolor{stringliteral}{"{}/"{}}\ <<\ \mbox{\hyperlink{classmcmc_a2b9a5344ea8074fcecdc1ae2f3cfc62a}{chainLength}}\ <<\ \textcolor{stringliteral}{"{}\ \ |\ \ current:\ "{}}\ <<\ \mbox{\hyperlink{classFitterBase_abfb6f10720764d8bbbe43754fd5cd976}{logLCurr}}\ <<\ \textcolor{stringliteral}{"{}\ proposed:\ "{}}\ <<\ \mbox{\hyperlink{classFitterBase_a187dd22c17f9e96e5a7e2fb2371abace}{logLProp}}\ <<\ std::endl;}
\DoxyCodeLine{00213\ \ \ \}}
\DoxyCodeLine{00214\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00215\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classmcmc_aaf921343861cec8bb96beb2503b3fe2c}\label{classmcmc_aaf921343861cec8bb96beb2503b3fe2c}} 
\index{mcmc@{mcmc}!ProposeStep@{ProposeStep}}
\index{ProposeStep@{ProposeStep}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{ProposeStep()}{ProposeStep()}}
{\footnotesize\ttfamily void mcmc\+::\+Propose\+Step (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}



Propose a step. 



Definition at line \mbox{\hyperlink{mcmc_8cpp_source_l00126}{126}} of file \mbox{\hyperlink{mcmc_8cpp_source}{mcmc.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00127\ \textcolor{comment}{//\ *******************}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \textcolor{comment}{//\ Initial\ likelihood}}
\DoxyCodeLine{00130\ \ \ \textcolor{keywordtype}{double}\ llh\ =\ 0.0;}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \textcolor{comment}{//\ Initiate\ to\ false}}
\DoxyCodeLine{00133\ \ \ \mbox{\hyperlink{classmcmc_a537f7c2411a6a8e65fdf57b81ce6fe4a}{reject}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \textcolor{comment}{//\ Loop\ over\ the\ systematics\ and\ propose\ the\ initial\ step}}
\DoxyCodeLine{00136\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ s\ =\ 0;\ s\ <\ \mbox{\hyperlink{classFitterBase_a3a15d2348b7bf0a639aaab52b9294bbf}{systematics}}.size();\ ++s)\ \{}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{comment}{//\ Could\ throw\ the\ initial\ value\ here\ to\ do\ MCMC\ stability\ studies}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{comment}{//\ Propose\ the\ steps\ for\ the\ systematics}}
\DoxyCodeLine{00139\ \ \ \ \ \mbox{\hyperlink{classFitterBase_a3a15d2348b7bf0a639aaab52b9294bbf}{systematics}}[s]-\/>proposeStep();}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ likelihood\ from\ the\ systematics}}
\DoxyCodeLine{00142\ \ \ \ \ \mbox{\hyperlink{classFitterBase_ace2eeca9829f63200c3f956c600d09ff}{syst\_llh}}[s]\ =\ \mbox{\hyperlink{classFitterBase_a3a15d2348b7bf0a639aaab52b9294bbf}{systematics}}[s]-\/>GetLikelihood();}
\DoxyCodeLine{00143\ \ \ \ \ llh\ +=\ \mbox{\hyperlink{classFitterBase_ace2eeca9829f63200c3f956c600d09ff}{syst\_llh}}[s];}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \textcolor{preprocessor}{\ \ \ \ \#ifdef\ DEBUG}}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordflow}{if}\ (debug)\ debugFile\ <<\ \textcolor{stringliteral}{"{}LLH\ after\ "{}}\ <<\ \mbox{\hyperlink{classFitterBase_a3a15d2348b7bf0a639aaab52b9294bbf}{systematics}}[s]-\/>getName()\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ llh\ <<\ std::endl;}
\DoxyCodeLine{00147\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{00148\ \ \ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \textcolor{comment}{//\ Check\ if\ we've\ hit\ a\ boundary\ in\ the\ systematics}}
\DoxyCodeLine{00151\ \ \ \textcolor{comment}{//\ In\ this\ case\ we\ can\ save\ time\ by\ not\ having\ to\ reconfigure\ the\ simulation}}
\DoxyCodeLine{00152\ \ \ \textcolor{keywordflow}{if}\ (llh\ >=\ \mbox{\hyperlink{covarianceBase_8h_a194098591fd0bc4afaf13b4fd8fee408}{\_LARGE\_LOGL\_}})\ \{}
\DoxyCodeLine{00153\ \ \ \ \ \mbox{\hyperlink{classmcmc_a537f7c2411a6a8e65fdf57b81ce6fe4a}{reject}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00154\ \textcolor{preprocessor}{\ \ \ \ \#ifdef\ DEBUG}}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordflow}{if}\ (debug)\ debugFile\ <<\ \textcolor{stringliteral}{"{}Rejecting\ based\ on\ boundary"{}}\ <<\ std::endl;}
\DoxyCodeLine{00156\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{00157\ \ \ \}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \textcolor{comment}{//\ Only\ reweight\ when\ we\ have\ a\ good\ parameter\ configuration}}
\DoxyCodeLine{00160\ \ \ \textcolor{comment}{//\ This\ speeds\ things\ up\ considerably\ because\ for\ every\ bad\ parameter\ configuration\ we\ don't\ have\ to\ reweight\ the\ MC}}
\DoxyCodeLine{00161\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classmcmc_a537f7c2411a6a8e65fdf57b81ce6fe4a}{reject}})}
\DoxyCodeLine{00162\ \ \ \{}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{comment}{//\ Could\ multi-\/thread\ this}}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{comment}{//\ But\ since\ sample\ reweight\ is\ multi-\/threaded\ it's\ probably\ better\ to\ do\ that}}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classFitterBase_afac0dcceb1df194159c07945e8dc0069}{samples}}.size();\ ++i)}
\DoxyCodeLine{00166\ \ \ \ \ \{}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \mbox{\hyperlink{classFitterBase_afac0dcceb1df194159c07945e8dc0069}{samples}}[i]-\/>reweight();}
\DoxyCodeLine{00168\ \ \ \ \ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{comment}{//DB\ for\ atmospheric\ event\ by\ event\ sample\ migration,\ need\ to\ fully\ reweight\ all\ samples\ to\ allow\ event\ passing\ prior\ to\ likelihood\ evaluation}}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classFitterBase_afac0dcceb1df194159c07945e8dc0069}{samples}}.size();\ ++i)\ \{}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ sample\ likelihoods\ and\ add\ them}}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \mbox{\hyperlink{classFitterBase_a6f435e161c96eea778aba844115428d4}{sample\_llh}}[i]\ =\ \mbox{\hyperlink{classFitterBase_afac0dcceb1df194159c07945e8dc0069}{samples}}[i]-\/>GetLikelihood();}
\DoxyCodeLine{00174\ \ \ \ \ \ \ llh\ +=\ \mbox{\hyperlink{classFitterBase_a6f435e161c96eea778aba844115428d4}{sample\_llh}}[i];}
\DoxyCodeLine{00175\ \textcolor{preprocessor}{\ \ \ \ \ \ \#ifdef\ DEBUG}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (debug)\ debugFile\ <<\ \textcolor{stringliteral}{"{}LLH\ after\ sample\ "{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ llh\ <<\ std::endl;}
\DoxyCodeLine{00177\ \textcolor{preprocessor}{\ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00178\ \ \ \ \ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \textcolor{comment}{//\ For\ when\ we\ don't\ have\ to\ reweight,\ set\ sample\ to\ madness}}
\DoxyCodeLine{00181\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classFitterBase_afac0dcceb1df194159c07945e8dc0069}{samples}}.size();\ ++i)\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ sample\_llh[i]\ to\ be\ madly\ high\ also\ to\ signify\ a\ step\ out\ of\ bounds}}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \mbox{\hyperlink{classFitterBase_a6f435e161c96eea778aba844115428d4}{sample\_llh}}[i]\ =\ \mbox{\hyperlink{covarianceBase_8h_a194098591fd0bc4afaf13b4fd8fee408}{\_LARGE\_LOGL\_}};}
\DoxyCodeLine{00185\ \textcolor{preprocessor}{\ \ \ \ \ \ \#ifdef\ DEBUG}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (debug)\ debugFile\ <<\ \textcolor{stringliteral}{"{}LLH\ after\ REJECT\ sample\ "{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ llh\ <<\ std::endl;}
\DoxyCodeLine{00187\ \textcolor{preprocessor}{\ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00188\ \ \ \ \ \}}
\DoxyCodeLine{00189\ \ \ \}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \textcolor{comment}{//\ Save\ the\ proposed\ likelihood\ (class\ member)}}
\DoxyCodeLine{00192\ \ \ \mbox{\hyperlink{classFitterBase_a187dd22c17f9e96e5a7e2fb2371abace}{logLProp}}\ =\ llh;}
\DoxyCodeLine{00193\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classmcmc_a8a9cc0e0aa65c8573fca703a42b2ee31}\label{classmcmc_a8a9cc0e0aa65c8573fca703a42b2ee31}} 
\index{mcmc@{mcmc}!runMCMC@{runMCMC}}
\index{runMCMC@{runMCMC}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{runMCMC()}{runMCMC()}}
{\footnotesize\ttfamily void mcmc\+::run\+MCMC (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Actual implementation of MCMC fitting algorithm. 



Implements \mbox{\hyperlink{classFitterBase_a1a9666dc09f91af804954e8968bc7b24}{Fitter\+Base}}.



Definition at line \mbox{\hyperlink{mcmc_8cpp_source_l00078}{78}} of file \mbox{\hyperlink{mcmc_8cpp_source}{mcmc.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00079\ \ \ \textcolor{comment}{//\ *******************}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \textcolor{comment}{//\ Save\ the\ settings\ into\ the\ output\ file}}
\DoxyCodeLine{00082\ \ \ \mbox{\hyperlink{classFitterBase_a48f38bfa8996fe00d51f35b05dd16b46}{SaveSettings}}();}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \textcolor{comment}{//\ Prepare\ the\ output\ branches}}
\DoxyCodeLine{00085\ \ \ \mbox{\hyperlink{classFitterBase_a53715760edd8c7640432f31793fd28f9}{PrepareOutput}}();}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \textcolor{comment}{//\ Reconfigure\ the\ samples,\ systematics\ and\ oscillation\ for\ first\ weight}}
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//\ ProposeStep\ sets\ logLProp}}
\DoxyCodeLine{00089\ \ \ \mbox{\hyperlink{classmcmc_aaf921343861cec8bb96beb2503b3fe2c}{ProposeStep}}();}
\DoxyCodeLine{00090\ \ \ \textcolor{comment}{//\ Set\ the\ current\ logL\ to\ the\ proposed\ logL\ for\ the\ 0th\ step}}
\DoxyCodeLine{00091\ \ \ \textcolor{comment}{//\ Accept\ the\ first\ step\ to\ set\ logLCurr:\ this\ shouldn't\ affect\ the\ MCMC\ because\ we\ ignore\ the\ first\ N\ steps\ in\ burn-\/in}}
\DoxyCodeLine{00092\ \ \ \mbox{\hyperlink{classFitterBase_abfb6f10720764d8bbbe43754fd5cd976}{logLCurr}}\ =\ \mbox{\hyperlink{classFitterBase_a187dd22c17f9e96e5a7e2fb2371abace}{logLProp}};}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \textcolor{comment}{//\ Begin\ MCMC}}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classFitterBase_a50df1bd75b20a953f81ab9c2bab6b42c}{step}}\ =\ \mbox{\hyperlink{classmcmc_a41ce4f96a562ea3f8e750feaae4d24c4}{stepStart}};\ \mbox{\hyperlink{classFitterBase_a50df1bd75b20a953f81ab9c2bab6b42c}{step}}\ <\ \mbox{\hyperlink{classmcmc_a41ce4f96a562ea3f8e750feaae4d24c4}{stepStart}}+\mbox{\hyperlink{classmcmc_a2b9a5344ea8074fcecdc1ae2f3cfc62a}{chainLength}};\ ++\mbox{\hyperlink{classFitterBase_a50df1bd75b20a953f81ab9c2bab6b42c}{step}})}
\DoxyCodeLine{00096\ \ \ \{}
\DoxyCodeLine{00097\ \ \ \ \ \mbox{\hyperlink{classFitterBase_a9fe01b2b6f7f0d6a7b04675a099e1a4f}{stepClock}}-\/>Start();}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{//\ Set\ the\ initial\ rejection\ to\ false}}
\DoxyCodeLine{00099\ \ \ \ \ \mbox{\hyperlink{classmcmc_a537f7c2411a6a8e65fdf57b81ce6fe4a}{reject}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{comment}{//\ Print\ 10\ steps\ in\ total}}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ (\mbox{\hyperlink{classFitterBase_a50df1bd75b20a953f81ab9c2bab6b42c}{step}}-\/\mbox{\hyperlink{classmcmc_a41ce4f96a562ea3f8e750feaae4d24c4}{stepStart}})\ \%\ (\mbox{\hyperlink{classmcmc_a2b9a5344ea8074fcecdc1ae2f3cfc62a}{chainLength}}/10)\ ==\ 0)\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \mbox{\hyperlink{classmcmc_ae0eabbfc70f9bae615332caa48b3f4f4}{PrintProgress}}();}
\DoxyCodeLine{00104\ \ \ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{comment}{//\ Propose\ current\ step\ variation\ and\ save\ the\ systematic\ likelihood\ that\ results\ in\ this\ step\ being\ taken}}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{comment}{//\ Updates\ logLProp}}
\DoxyCodeLine{00108\ \ \ \ \ \mbox{\hyperlink{classmcmc_aaf921343861cec8bb96beb2503b3fe2c}{ProposeStep}}();}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{//\ Does\ the\ MCMC\ accept\ this\ step?}}
\DoxyCodeLine{00111\ \ \ \ \ \mbox{\hyperlink{classmcmc_aa2f1c8aa3d951b935bbb3ec637b6b651}{CheckStep}}();}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{comment}{//\ Auto\ save\ the\ output}}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classFitterBase_a50df1bd75b20a953f81ab9c2bab6b42c}{step}}\ \%\ \mbox{\hyperlink{classFitterBase_ad955982e63066918cba9c53381608d09}{auto\_save}}\ ==\ 0)\ \mbox{\hyperlink{classFitterBase_aed2032b9c4a4f2248abe548f54f8dcc8}{outTree}}-\/>AutoSave();}
\DoxyCodeLine{00115\ \ \ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \textcolor{comment}{//\ Save\ all\ the\ MCMC\ output}}
\DoxyCodeLine{00118\ \ \ \mbox{\hyperlink{classFitterBase_a418f581b688f035211107ddd83168c08}{SaveOutput}}();}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \textcolor{comment}{//\ Process\ MCMC}}
\DoxyCodeLine{00121\ \ \ \mbox{\hyperlink{classFitterBase_a1dccdac8611e70c759c47a65f2b1aea7}{ProcessMCMC}}();}
\DoxyCodeLine{00122\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classmcmc_af549f9b0ab4276710bc0d2987ad825a9}\label{classmcmc_af549f9b0ab4276710bc0d2987ad825a9}} 
\index{mcmc@{mcmc}!setChainLength@{setChainLength}}
\index{setChainLength@{setChainLength}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{setChainLength()}{setChainLength()}}
{\footnotesize\ttfamily void mcmc\+::set\+Chain\+Length (\begin{DoxyParamCaption}\item[{unsigned int}]{L }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Set how long chain should be. 



Definition at line \mbox{\hyperlink{mcmc_8h_source_l00018}{18}} of file \mbox{\hyperlink{mcmc_8h_source}{mcmc.\+h}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00018\ \{\ \mbox{\hyperlink{classmcmc_a2b9a5344ea8074fcecdc1ae2f3cfc62a}{chainLength}}\ =\ L;\ \};}

\end{DoxyCode}
\mbox{\Hypertarget{classmcmc_a7129ef21a4b2abab4bf142653d558535}\label{classmcmc_a7129ef21a4b2abab4bf142653d558535}} 
\index{mcmc@{mcmc}!setInitialStepNumber@{setInitialStepNumber}}
\index{setInitialStepNumber@{setInitialStepNumber}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{setInitialStepNumber()}{setInitialStepNumber()}}
{\footnotesize\ttfamily void mcmc\+::set\+Initial\+Step\+Number (\begin{DoxyParamCaption}\item[{const unsigned int}]{step\+Num = {\ttfamily 0} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Set initial step number, used when starting from another chain. 



Definition at line \mbox{\hyperlink{mcmc_8h_source_l00021}{21}} of file \mbox{\hyperlink{mcmc_8h_source}{mcmc.\+h}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00021\ \{\mbox{\hyperlink{classmcmc_a41ce4f96a562ea3f8e750feaae4d24c4}{stepStart}}\ =\ stepNum;\};}

\end{DoxyCode}
\mbox{\Hypertarget{classmcmc_adf4c80255288c5396da3b95d609ce4b2}\label{classmcmc_adf4c80255288c5396da3b95d609ce4b2}} 
\index{mcmc@{mcmc}!StartFromPreviousFit@{StartFromPreviousFit}}
\index{StartFromPreviousFit@{StartFromPreviousFit}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{StartFromPreviousFit()}{StartFromPreviousFit()}}
{\footnotesize\ttfamily void mcmc\+::\+Start\+From\+Previous\+Fit (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{Fit\+Name }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Allow to start from previous fit/chain. 


\begin{DoxyParams}{Parameters}
{\em Fit\+Name} & Name of previous chain \\
\hline
\end{DoxyParams}
\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000009}{Todo}}]implement some check that number of params matches etc \end{DoxyRefDesc}


Reimplemented from \mbox{\hyperlink{classFitterBase_a655ccea31627627e2b36745c97e5c0f0}{Fitter\+Base}}.



Definition at line \mbox{\hyperlink{mcmc_8cpp_source_l00218}{218}} of file \mbox{\hyperlink{mcmc_8cpp_source}{mcmc.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00219\ \textcolor{comment}{//\ *******************}}
\DoxyCodeLine{00220\ \ \ \textcolor{comment}{//\ Use\ base\ class}}
\DoxyCodeLine{00221\ \ \ \mbox{\hyperlink{classFitterBase_a655ccea31627627e2b36745c97e5c0f0}{FitterBase::StartFromPreviousFit}}(FitName);}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \textcolor{comment}{//\ For\ MCMC\ we\ also\ need\ to\ set\ stepStart}}
\DoxyCodeLine{00224\ \ \ TFile\ *infile\ =\ \textcolor{keyword}{new}\ TFile(FitName.c\_str(),\ \textcolor{stringliteral}{"{}READ"{}});}
\DoxyCodeLine{00225\ \ \ TTree\ *posts\ =\ infile-\/>Get<TTree>(\textcolor{stringliteral}{"{}posteriors"{}});}
\DoxyCodeLine{00226\ \ \ \textcolor{keywordtype}{int}\ step\_val\ =\ 0;}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ posts-\/>SetBranchAddress(\textcolor{stringliteral}{"{}step"{}},\&step\_val);}
\DoxyCodeLine{00229\ \ \ posts-\/>GetEntry(posts-\/>GetEntries()-\/1);}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \mbox{\hyperlink{classmcmc_a41ce4f96a562ea3f8e750feaae4d24c4}{stepStart}}\ =\ step\_val;}
\DoxyCodeLine{00232\ \ \ infile-\/>Close();}
\DoxyCodeLine{00233\ \ \ \textcolor{keyword}{delete}\ infile;}
\DoxyCodeLine{00234\ \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classmcmc_a4da3776296d4f06268f240df5eb0bbcc}\label{classmcmc_a4da3776296d4f06268f240df5eb0bbcc}} 
\index{mcmc@{mcmc}!anneal@{anneal}}
\index{anneal@{anneal}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{anneal}{anneal}}
{\footnotesize\ttfamily bool mcmc\+::anneal\hspace{0.3cm}{\ttfamily [private]}}



simulated annealing 



Definition at line \mbox{\hyperlink{mcmc_8h_source_l00046}{46}} of file \mbox{\hyperlink{mcmc_8h_source}{mcmc.\+h}}.

\mbox{\Hypertarget{classmcmc_a3052c9e38107c0070c885a5a3bbbc302}\label{classmcmc_a3052c9e38107c0070c885a5a3bbbc302}} 
\index{mcmc@{mcmc}!AnnealTemp@{AnnealTemp}}
\index{AnnealTemp@{AnnealTemp}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{AnnealTemp}{AnnealTemp}}
{\footnotesize\ttfamily double mcmc\+::\+Anneal\+Temp\hspace{0.3cm}{\ttfamily [private]}}



simulated annealing temperature 



Definition at line \mbox{\hyperlink{mcmc_8h_source_l00048}{48}} of file \mbox{\hyperlink{mcmc_8h_source}{mcmc.\+h}}.

\mbox{\Hypertarget{classmcmc_a2b9a5344ea8074fcecdc1ae2f3cfc62a}\label{classmcmc_a2b9a5344ea8074fcecdc1ae2f3cfc62a}} 
\index{mcmc@{mcmc}!chainLength@{chainLength}}
\index{chainLength@{chainLength}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{chainLength}{chainLength}}
{\footnotesize\ttfamily unsigned int mcmc\+::chain\+Length\hspace{0.3cm}{\ttfamily [private]}}



number of steps in chain 



Definition at line \mbox{\hyperlink{mcmc_8h_source_l00043}{43}} of file \mbox{\hyperlink{mcmc_8h_source}{mcmc.\+h}}.

\mbox{\Hypertarget{classmcmc_a537f7c2411a6a8e65fdf57b81ce6fe4a}\label{classmcmc_a537f7c2411a6a8e65fdf57b81ce6fe4a}} 
\index{mcmc@{mcmc}!reject@{reject}}
\index{reject@{reject}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{reject}{reject}}
{\footnotesize\ttfamily bool mcmc\+::reject\hspace{0.3cm}{\ttfamily [private]}}



Do we reject based on hitting boundaries in systs. 



Definition at line \mbox{\hyperlink{mcmc_8h_source_l00041}{41}} of file \mbox{\hyperlink{mcmc_8h_source}{mcmc.\+h}}.

\mbox{\Hypertarget{classmcmc_a41ce4f96a562ea3f8e750feaae4d24c4}\label{classmcmc_a41ce4f96a562ea3f8e750feaae4d24c4}} 
\index{mcmc@{mcmc}!stepStart@{stepStart}}
\index{stepStart@{stepStart}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{stepStart}{stepStart}}
{\footnotesize\ttfamily int mcmc\+::step\+Start\hspace{0.3cm}{\ttfamily [private]}}



starting value of a chain, usually 0, unless starting from previous chain 



Definition at line \mbox{\hyperlink{mcmc_8h_source_l00051}{51}} of file \mbox{\hyperlink{mcmc_8h_source}{mcmc.\+h}}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/runner/work/\+Ma\+Ch3/\+Ma\+Ch3/mcmc/\mbox{\hyperlink{mcmc_8h}{mcmc.\+h}}\item 
/home/runner/work/\+Ma\+Ch3/\+Ma\+Ch3/mcmc/\mbox{\hyperlink{mcmc_8cpp}{mcmc.\+cpp}}\end{DoxyCompactItemize}
