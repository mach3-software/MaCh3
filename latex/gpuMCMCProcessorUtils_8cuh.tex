\hypertarget{gpuMCMCProcessorUtils_8cuh}{}\doxysection{/home/runner/work/\+Ma\+Ch3/\+Ma\+Ch3/mcmc/gpu\+MCMCProcessor\+Utils.cuh File Reference}
\label{gpuMCMCProcessorUtils_8cuh}\index{/home/runner/work/MaCh3/MaCh3/mcmc/gpuMCMCProcessorUtils.cuh@{/home/runner/work/MaCh3/MaCh3/mcmc/gpuMCMCProcessorUtils.cuh}}
{\ttfamily \#include \char`\"{}manager/gpu\+Utils.\+cuh\char`\"{}}\newline
Include dependency graph for gpu\+MCMCProcessor\+Utils.\+cuh\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=307pt]{gpuMCMCProcessorUtils_8cuh__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=266pt]{gpuMCMCProcessorUtils_8cuh__dep__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\+\_\+\+\_\+host\+\_\+\+\_\+ void \mbox{\hyperlink{gpuMCMCProcessorUtils_8cuh_a5f83eaf9a69d10b00a4078608bdd0674}{Init\+GPU\+\_\+\+Auto\+Corr}} (float $\ast$$\ast$Par\+Step\+\_\+gpu, float $\ast$$\ast$Numerator\+Sum\+\_\+gpu, float $\ast$$\ast$Param\+Sums\+\_\+gpu, float $\ast$$\ast$Denom\+Sum\+\_\+gpu, int n\+\_\+\+Entries, int n\+\_\+\+Pars, const int n\+\_\+\+Lags)
\begin{DoxyCompactList}\small\item\em KS\+: Initialiser, here we allocate memory for variables and copy constants. \end{DoxyCompactList}\item 
\+\_\+\+\_\+host\+\_\+\+\_\+ void \mbox{\hyperlink{gpuMCMCProcessorUtils_8cuh_a6388d047bba2ea16de2bcb73ca0e398c}{Copy\+To\+GPU\+\_\+\+Auto\+Corr}} (float $\ast$Par\+Step\+\_\+cpu, float $\ast$Numerator\+Sum\+\_\+cpu, float $\ast$Param\+Sums\+\_\+cpu, float $\ast$Denom\+Sum\+\_\+cpu, float $\ast$Par\+Step\+\_\+gpu, float $\ast$Numerator\+Sum\+\_\+gpu, float $\ast$Param\+Sums\+\_\+gpu, float $\ast$Denom\+Sum\+\_\+gpu)
\begin{DoxyCompactList}\small\item\em KS\+: Copy necessary variables from CPU to GPU. \end{DoxyCompactList}\item 
\+\_\+\+\_\+global\+\_\+\+\_\+ void \mbox{\hyperlink{gpuMCMCProcessorUtils_8cuh_a2e9d69f5be6976ac042f93045753acf9}{Eval\+On\+GPU\+\_\+\+Auto\+Corr}} (const float $\ast$\+\_\+\+\_\+restrict\+\_\+\+\_\+ Par\+Step\+\_\+gpu, const float $\ast$\+\_\+\+\_\+restrict\+\_\+\+\_\+ Param\+Sums\+\_\+gpu, float $\ast$Numerator\+Sum\+\_\+gpu, float $\ast$Denom\+Sum\+\_\+gpu)
\begin{DoxyCompactList}\small\item\em Eval autocorrelations based on Box and Jenkins. \end{DoxyCompactList}\item 
\+\_\+\+\_\+host\+\_\+\+\_\+ void \mbox{\hyperlink{gpuMCMCProcessorUtils_8cuh_a809672193d24a096e6d4865109357070}{Run\+GPU\+\_\+\+Auto\+Corr}} (float $\ast$Par\+Step\+\_\+gpu, float $\ast$Param\+Sums\+\_\+gpu, float $\ast$Numerator\+Sum\+\_\+gpu, float $\ast$Denom\+Sum\+\_\+gpu, float $\ast$Numerator\+Sum\+\_\+cpu, float $\ast$Denom\+Sum\+\_\+cpu)
\begin{DoxyCompactList}\small\item\em KS\+: This call the main kernel responsible for calculating LagL and later copy results back to CPU. \end{DoxyCompactList}\item 
\+\_\+\+\_\+host\+\_\+\+\_\+ void \mbox{\hyperlink{gpuMCMCProcessorUtils_8cuh_abb46837d774b5be81a6c601c762ab05a}{Cleanup\+GPU\+\_\+\+Auto\+Corr}} (float $\ast$Par\+Step\+\_\+gpu, float $\ast$Numerator\+Sum\+\_\+gpu, float $\ast$Param\+Sums\+\_\+gpu, float $\ast$Denom\+Sum\+\_\+gpu)
\begin{DoxyCompactList}\small\item\em KS\+: free memory on gpu. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{gpuMCMCProcessorUtils_8cuh_abb46837d774b5be81a6c601c762ab05a}\label{gpuMCMCProcessorUtils_8cuh_abb46837d774b5be81a6c601c762ab05a}} 
\index{gpuMCMCProcessorUtils.cuh@{gpuMCMCProcessorUtils.cuh}!CleanupGPU\_AutoCorr@{CleanupGPU\_AutoCorr}}
\index{CleanupGPU\_AutoCorr@{CleanupGPU\_AutoCorr}!gpuMCMCProcessorUtils.cuh@{gpuMCMCProcessorUtils.cuh}}
\doxysubsubsection{\texorpdfstring{CleanupGPU\_AutoCorr()}{CleanupGPU\_AutoCorr()}}
{\footnotesize\ttfamily \+\_\+\+\_\+host\+\_\+\+\_\+ void Cleanup\+GPU\+\_\+\+Auto\+Corr (\begin{DoxyParamCaption}\item[{float $\ast$}]{Par\+Step\+\_\+gpu,  }\item[{float $\ast$}]{Numerator\+Sum\+\_\+gpu,  }\item[{float $\ast$}]{Param\+Sums\+\_\+gpu,  }\item[{float $\ast$}]{Denom\+Sum\+\_\+gpu }\end{DoxyParamCaption})}



KS\+: free memory on gpu. 


\begin{DoxyParams}{Parameters}
{\em Par\+Step\+\_\+gpu} & Parameter value at each step \\
\hline
{\em Numerator\+Sum\+\_\+gpu} & Sum used for nominator of autocorrelation calculations \\
\hline
{\em Param\+Sums\+\_\+gpu} & Overall sum for each parameter over all steps \\
\hline
{\em Denom\+Sum\+\_\+gpu} & Sum used for denominator of autocorrelation calculations \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_source_l00201}{201}} of file \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_source}{gpu\+MCMCProcessor\+Utils.\+cu}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00206\ \textcolor{comment}{//\ *********************************}}
\DoxyCodeLine{00207\ \ \ cudaFree(ParStep\_gpu);}
\DoxyCodeLine{00208\ \ \ cudaFree(NumeratorSum\_gpu);}
\DoxyCodeLine{00209\ \ \ cudaFree(ParamSums\_gpu);}
\DoxyCodeLine{00210\ \ \ cudaFree(DenomSum\_gpu);}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ printf(\textcolor{stringliteral}{"{}\ Cleared\ memory\ at\ GPU,\ I\ am\ free\ \(\backslash\)n"{}});}
\DoxyCodeLine{00213\ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00214\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{gpuMCMCProcessorUtils_8cuh_a6388d047bba2ea16de2bcb73ca0e398c}\label{gpuMCMCProcessorUtils_8cuh_a6388d047bba2ea16de2bcb73ca0e398c}} 
\index{gpuMCMCProcessorUtils.cuh@{gpuMCMCProcessorUtils.cuh}!CopyToGPU\_AutoCorr@{CopyToGPU\_AutoCorr}}
\index{CopyToGPU\_AutoCorr@{CopyToGPU\_AutoCorr}!gpuMCMCProcessorUtils.cuh@{gpuMCMCProcessorUtils.cuh}}
\doxysubsubsection{\texorpdfstring{CopyToGPU\_AutoCorr()}{CopyToGPU\_AutoCorr()}}
{\footnotesize\ttfamily \+\_\+\+\_\+host\+\_\+\+\_\+ void Copy\+To\+GPU\+\_\+\+Auto\+Corr (\begin{DoxyParamCaption}\item[{float $\ast$}]{Par\+Step\+\_\+cpu,  }\item[{float $\ast$}]{Numerator\+Sum\+\_\+cpu,  }\item[{float $\ast$}]{Param\+Sums\+\_\+cpu,  }\item[{float $\ast$}]{Denom\+Sum\+\_\+cpu,  }\item[{float $\ast$}]{Par\+Step\+\_\+gpu,  }\item[{float $\ast$}]{Numerator\+Sum\+\_\+gpu,  }\item[{float $\ast$}]{Param\+Sums\+\_\+gpu,  }\item[{float $\ast$}]{Denom\+Sum\+\_\+gpu }\end{DoxyParamCaption})}



KS\+: Copy necessary variables from CPU to GPU. 


\begin{DoxyParams}{Parameters}
{\em Par\+Step\+\_\+cpu} & Parameter value at each step \\
\hline
{\em Numerator\+Sum\+\_\+cpu} & Sum used for nominator of autocorrelation calculations \\
\hline
{\em Param\+Sums\+\_\+cpu} & Overall sum for each parameter over all steps \\
\hline
{\em Denom\+Sum\+\_\+cpu} & Sum used for denominator of autocorrelation calculations \\
\hline
{\em Par\+Step\+\_\+gpu} & Parameter value at each step \\
\hline
{\em Numerator\+Sum\+\_\+gpu} & Sum used for nominator of autocorrelation calculations \\
\hline
{\em Param\+Sums\+\_\+gpu} & Overall sum for each parameter over all steps \\
\hline
{\em Denom\+Sum\+\_\+gpu} & Sum used for denominator of autocorrelation calculations \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_source_l00076}{76}} of file \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_source}{gpu\+MCMCProcessor\+Utils.\+cu}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//store\ value\ of\ parameter\ for\ each\ step}}
\DoxyCodeLine{00089\ \ \ cudaMemcpy(ParStep\_gpu,\ ParStep\_cpu,\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_adbc5ade24b4b04c29d1437f78a3f8923}{h\_nEntries}}*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}),\ cudaMemcpyHostToDevice);}
\DoxyCodeLine{00090\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \textcolor{comment}{//Mean\ value\ for\ a\ given\ parameter}}
\DoxyCodeLine{00093\ \ \ cudaMemcpy(ParamSums\_gpu,\ ParamSums\_cpu,\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}),\ cudaMemcpyHostToDevice);}
\DoxyCodeLine{00094\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \textcolor{comment}{//Numerator\ which\ is\ directly\ used\ for\ calculating\ LagL}}
\DoxyCodeLine{00097\ \ \ cudaMemcpy(NumeratorSum\_gpu,\ NumeratorSum\_cpu,\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a3d609e7d3946c09c05beebd1f703f355}{h\_nLag}}*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}),\ cudaMemcpyHostToDevice);}
\DoxyCodeLine{00098\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \textcolor{comment}{//Denominator\ which\ is\ directly\ used\ for\ calculating\ LagL}}
\DoxyCodeLine{00101\ \ \ cudaMemcpy(DenomSum\_gpu,\ DenomSum\_cpu,\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a3d609e7d3946c09c05beebd1f703f355}{h\_nLag}}*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}),\ cudaMemcpyHostToDevice);}
\DoxyCodeLine{00102\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00103\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{gpuMCMCProcessorUtils_8cuh_a2e9d69f5be6976ac042f93045753acf9}\label{gpuMCMCProcessorUtils_8cuh_a2e9d69f5be6976ac042f93045753acf9}} 
\index{gpuMCMCProcessorUtils.cuh@{gpuMCMCProcessorUtils.cuh}!EvalOnGPU\_AutoCorr@{EvalOnGPU\_AutoCorr}}
\index{EvalOnGPU\_AutoCorr@{EvalOnGPU\_AutoCorr}!gpuMCMCProcessorUtils.cuh@{gpuMCMCProcessorUtils.cuh}}
\doxysubsubsection{\texorpdfstring{EvalOnGPU\_AutoCorr()}{EvalOnGPU\_AutoCorr()}}
{\footnotesize\ttfamily \+\_\+\+\_\+global\+\_\+\+\_\+ void Eval\+On\+GPU\+\_\+\+Auto\+Corr (\begin{DoxyParamCaption}\item[{const float $\ast$\+\_\+\+\_\+restrict\+\_\+\+\_\+}]{Par\+Step\+\_\+gpu,  }\item[{const float $\ast$\+\_\+\+\_\+restrict\+\_\+\+\_\+}]{Param\+Sums\+\_\+gpu,  }\item[{float $\ast$}]{Numerator\+Sum\+\_\+gpu,  }\item[{float $\ast$}]{Denom\+Sum\+\_\+gpu }\end{DoxyParamCaption})}



Eval autocorrelations based on Box and Jenkins. 


\begin{DoxyParams}{Parameters}
{\em Par\+Step\+\_\+gpu} & Parameter value at each step \\
\hline
{\em Numerator\+Sum\+\_\+gpu} & Sum used for nominator of autocorrelation calculations \\
\hline
{\em Param\+Sums\+\_\+gpu} & Overall sum for each parameter over all steps \\
\hline
{\em Denom\+Sum\+\_\+gpu} & Sum used for denominator of autocorrelation calculations \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_source_l00112}{112}} of file \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_source}{gpu\+MCMCProcessor\+Utils.\+cu}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00117\ \textcolor{comment}{//*********************************************************}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ CurrentLagNum\ =\ (blockIdx.x\ *\ blockDim.x\ +\ threadIdx.x);}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \textcolor{comment}{//KS:\ Accessing\ shared\ memory\ is\ much\ much\ faster\ than\ global\ memory\ hence\ we\ use\ shared\ memory\ for\ calculation\ and\ then\ write\ to\ global\ memory}}
\DoxyCodeLine{00122\ \ \ \_\_shared\_\_\ \textcolor{keywordtype}{float}\ shared\_NumeratorSum[\mbox{\hyperlink{gpuUtils_8cuh_a393d21a8f493c2561a0ae703973dccc2}{\_BlockSize\_}}];}
\DoxyCodeLine{00123\ \ \ \_\_shared\_\_\ \textcolor{keywordtype}{float}\ shared\_DenomSum[\mbox{\hyperlink{gpuUtils_8cuh_a393d21a8f493c2561a0ae703973dccc2}{\_BlockSize\_}}];}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \textcolor{comment}{//\ this\ is\ the\ stopping\ condition!}}
\DoxyCodeLine{00126\ \ \ \textcolor{keywordflow}{if}\ (CurrentLagNum\ <\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_af8f4968d58719d599f3d6ac1adecf9bd}{d\_nLag}}*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_ad9b41c473ce2b52f562c1809d6b233ca}{d\_nDraws}})}
\DoxyCodeLine{00127\ \ \ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ shared\_NumeratorSum[threadIdx.x]\ =\ 0;}
\DoxyCodeLine{00129\ \ \ \ \ \ \ shared\_DenomSum[threadIdx.x]\ =\ 0;}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \ \ \textcolor{comment}{//KS:\ Might\ consider\ caching\ this\ information,\ which\ MIGHT\ be\ faster\ too\ lazy\ right\ now}}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ Param\ =\ int(CurrentLagNum/\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_af8f4968d58719d599f3d6ac1adecf9bd}{d\_nLag}});}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ nLag\ =\ CurrentLagNum\ -\/\ Param*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_af8f4968d58719d599f3d6ac1adecf9bd}{d\_nLag}};}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \textcolor{comment}{//\ Loop\ over\ the\ number\ of\ entries}}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a2612fc014389124064ca4e2c9c2eb616}{d\_nEntries}};\ ++i)}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \textcolor{comment}{//KS:\ Use\ fmaf\ to\ have\ it\ tiny\ bit\ faster,\ for\ something\ easier\ to\ read:\ Param*d\_nEntries\ +\ i}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ CurrParStep\ =\ fmaf(Param,\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a2612fc014389124064ca4e2c9c2eb616}{d\_nEntries}},\ i);}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ Diff\ =\ ParStep\_gpu[CurrParStep]-\/ParamSums\_gpu[Param];}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ sum\ the\ numerator\ up\ to\ i\ =\ N-\/k}}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ <\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a2612fc014389124064ca4e2c9c2eb616}{d\_nEntries}}-\/nLag)}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//KS:\ Use\ fmaf\ to\ have\ it\ tiny\ bit\ faster,\ for\ something\ easier\ to\ read:\ Param*d\_nEntries\ +\ (i\ +\ nLag)}}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ CurrParStep\ =\ fmaf(Param,\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a2612fc014389124064ca4e2c9c2eb616}{d\_nEntries}},\ i\ +\ nLag);}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ LagTerm\ =\ ParStep\_gpu[CurrParStep]-\/ParamSums\_gpu[Param];}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ Product\ =\ Diff*LagTerm;}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ shared\_NumeratorSum[threadIdx.x]\ +=\ Product;}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Square\ the\ difference\ to\ form\ the\ denominator}}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ Denom\ =\ Diff*Diff;}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ shared\_DenomSum[threadIdx.x]\ +=\ Denom;}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{comment}{//KS:\ Make\ sure\ threads\ are\ synchronised\ before\ moving\ to\ global\ memory}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \_\_syncthreads();}
\DoxyCodeLine{00156\ \ \ \ \ \ \ NumeratorSum\_gpu[CurrentLagNum]\ =\ shared\_NumeratorSum[threadIdx.x];}
\DoxyCodeLine{00157\ \ \ \ \ \ \ DenomSum\_gpu[CurrentLagNum]\ \ \ \ \ =\ shared\_DenomSum[threadIdx.x];}
\DoxyCodeLine{00158\ \ \ \}}
\DoxyCodeLine{00159\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{gpuMCMCProcessorUtils_8cuh_a5f83eaf9a69d10b00a4078608bdd0674}\label{gpuMCMCProcessorUtils_8cuh_a5f83eaf9a69d10b00a4078608bdd0674}} 
\index{gpuMCMCProcessorUtils.cuh@{gpuMCMCProcessorUtils.cuh}!InitGPU\_AutoCorr@{InitGPU\_AutoCorr}}
\index{InitGPU\_AutoCorr@{InitGPU\_AutoCorr}!gpuMCMCProcessorUtils.cuh@{gpuMCMCProcessorUtils.cuh}}
\doxysubsubsection{\texorpdfstring{InitGPU\_AutoCorr()}{InitGPU\_AutoCorr()}}
{\footnotesize\ttfamily \+\_\+\+\_\+host\+\_\+\+\_\+ void Init\+GPU\+\_\+\+Auto\+Corr (\begin{DoxyParamCaption}\item[{float $\ast$$\ast$}]{Par\+Step\+\_\+gpu,  }\item[{float $\ast$$\ast$}]{Numerator\+Sum\+\_\+gpu,  }\item[{float $\ast$$\ast$}]{Param\+Sums\+\_\+gpu,  }\item[{float $\ast$$\ast$}]{Denom\+Sum\+\_\+gpu,  }\item[{int}]{n\+\_\+\+Entries,  }\item[{int}]{n\+\_\+\+Pars,  }\item[{const int}]{n\+\_\+\+Lags }\end{DoxyParamCaption})}



KS\+: Initialiser, here we allocate memory for variables and copy constants. 


\begin{DoxyParams}{Parameters}
{\em Par\+Step\+\_\+gpu} & Parameter value at each step \\
\hline
{\em Numerator\+Sum\+\_\+gpu} & Sum used for nominator of autocorrelation calculations \\
\hline
{\em Param\+Sums\+\_\+gpu} & Overall sum for each parameter over all steps \\
\hline
{\em Denom\+Sum\+\_\+gpu} & Sum used for denominator of autocorrelation calculations \\
\hline
{\em n\+\_\+\+Entries} & Total number of entries in mcmc chain \\
\hline
{\em n\+\_\+\+Pars} & Number of relevant parameters \\
\hline
{\em n\+\_\+\+Lags} & Value of Lag in autocreation calculation \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_source_l00023}{23}} of file \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_source}{gpu\+MCMCProcessor\+Utils.\+cu}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \textcolor{comment}{//\ Write\ to\ the\ global\ statics\ (h\_*\ denotes\ host\ stored\ variable)}}
\DoxyCodeLine{00035\ \ \ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}\ =\ n\_Pars;}
\DoxyCodeLine{00036\ \ \ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a3d609e7d3946c09c05beebd1f703f355}{h\_nLag}}\ =\ n\_Lags;}
\DoxyCodeLine{00037\ \ \ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_adbc5ade24b4b04c29d1437f78a3f8923}{h\_nEntries}}\ =\ n\_Entries;}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \textcolor{comment}{//\ Copy\ the\ constants}}
\DoxyCodeLine{00040\ \ \ cudaMemcpyToSymbol(\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_af8f4968d58719d599f3d6ac1adecf9bd}{d\_nLag}},\ \ \ \&\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a3d609e7d3946c09c05beebd1f703f355}{h\_nLag}},\ \ \ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a3d609e7d3946c09c05beebd1f703f355}{h\_nLag}}));}
\DoxyCodeLine{00041\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ cudaMemcpyToSymbol(\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_ad9b41c473ce2b52f562c1809d6b233ca}{d\_nDraws}},\ \&\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}));}
\DoxyCodeLine{00044\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ cudaMemcpyToSymbol(\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a2612fc014389124064ca4e2c9c2eb616}{d\_nEntries}},\ \&\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_adbc5ade24b4b04c29d1437f78a3f8923}{h\_nEntries}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_adbc5ade24b4b04c29d1437f78a3f8923}{h\_nEntries}}));}
\DoxyCodeLine{00047\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \textcolor{comment}{//\ Allocate\ chunks\ of\ memory\ to\ GPU}}
\DoxyCodeLine{00050\ \ \ \textcolor{comment}{//Numerator\ which\ is\ directly\ used\ for\ calculating\ LagL}}
\DoxyCodeLine{00051\ \ \ cudaMalloc((\textcolor{keywordtype}{void}\ **)\ NumeratorSum\_gpu,\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a3d609e7d3946c09c05beebd1f703f355}{h\_nLag}}*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}));}
\DoxyCodeLine{00052\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \textcolor{comment}{//Denominator\ which\ is\ directly\ used\ for\ calculating\ LagL}}
\DoxyCodeLine{00055\ \ \ cudaMalloc((\textcolor{keywordtype}{void}\ **)\ DenomSum\_gpu,\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a3d609e7d3946c09c05beebd1f703f355}{h\_nLag}}*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}));}
\DoxyCodeLine{00056\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \textcolor{comment}{//Mean\ value\ for\ a\ given\ parameter}}
\DoxyCodeLine{00059\ \ \ cudaMalloc((\textcolor{keywordtype}{void}\ **)\ ParamSums\_gpu,\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}));}
\DoxyCodeLine{00060\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \textcolor{comment}{//store\ value\ of\ paramter\ for\ each\ step}}
\DoxyCodeLine{00063\ \ \ cudaMalloc((\textcolor{keywordtype}{void}\ **)\ ParStep\_gpu,\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_adbc5ade24b4b04c29d1437f78a3f8923}{h\_nEntries}}*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}*));}
\DoxyCodeLine{00064\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ printf(\textcolor{stringliteral}{"{}\ Allocated\ in\ total\ \%f\ MB\ for\ autocorrelations\ calculations\ on\ GPU\(\backslash\)n"{}},\ \textcolor{keywordtype}{double}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})*(\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a3d609e7d3946c09c05beebd1f703f355}{h\_nLag}}*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}+\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a3d609e7d3946c09c05beebd1f703f355}{h\_nLag}}*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}+\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}+\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_adbc5ade24b4b04c29d1437f78a3f8923}{h\_nEntries}}))/1.E6);}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{gpuMCMCProcessorUtils_8cuh_a809672193d24a096e6d4865109357070}\label{gpuMCMCProcessorUtils_8cuh_a809672193d24a096e6d4865109357070}} 
\index{gpuMCMCProcessorUtils.cuh@{gpuMCMCProcessorUtils.cuh}!RunGPU\_AutoCorr@{RunGPU\_AutoCorr}}
\index{RunGPU\_AutoCorr@{RunGPU\_AutoCorr}!gpuMCMCProcessorUtils.cuh@{gpuMCMCProcessorUtils.cuh}}
\doxysubsubsection{\texorpdfstring{RunGPU\_AutoCorr()}{RunGPU\_AutoCorr()}}
{\footnotesize\ttfamily \+\_\+\+\_\+host\+\_\+\+\_\+ void Run\+GPU\+\_\+\+Auto\+Corr (\begin{DoxyParamCaption}\item[{float $\ast$}]{Par\+Step\+\_\+gpu,  }\item[{float $\ast$}]{Param\+Sums\+\_\+gpu,  }\item[{float $\ast$}]{Numerator\+Sum\+\_\+gpu,  }\item[{float $\ast$}]{Denom\+Sum\+\_\+gpu,  }\item[{float $\ast$}]{Numerator\+Sum\+\_\+cpu,  }\item[{float $\ast$}]{Denom\+Sum\+\_\+cpu }\end{DoxyParamCaption})}



KS\+: This call the main kernel responsible for calculating LagL and later copy results back to CPU. 


\begin{DoxyParams}{Parameters}
{\em Par\+Step\+\_\+gpu} & Parameter value at each step \\
\hline
{\em Numerator\+Sum\+\_\+gpu} & Sum used for nominator of autocorrelation calculations \\
\hline
{\em Param\+Sums\+\_\+gpu} & Overall sum for each parameter over all steps \\
\hline
{\em Denom\+Sum\+\_\+gpu} & Sum used for denominator of autocorrelation calculations \\
\hline
{\em Numerator\+Sum\+\_\+cpu} & Sum used for nominator of autocorrelation calculations \\
\hline
{\em Denom\+Sum\+\_\+cpu} & Sum used for denominator of autocorrelation calculations \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_source_l00163}{163}} of file \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_source}{gpu\+MCMCProcessor\+Utils.\+cu}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00170\ \textcolor{comment}{//\ *****************************************}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ dim3\ block\_size;}
\DoxyCodeLine{00173\ \ \ dim3\ grid\_size;}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ block\_size.x\ =\ \mbox{\hyperlink{gpuUtils_8cuh_a393d21a8f493c2561a0ae703973dccc2}{\_BlockSize\_}};}
\DoxyCodeLine{00176\ \ \ grid\_size.x\ =\ (\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a3d609e7d3946c09c05beebd1f703f355}{h\_nLag}}*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}\ /\ block\_size.x)\ +\ 1;}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ EvalOnGPU\_AutoCorr<<<grid\_size,\ block\_size>>>(}
\DoxyCodeLine{00179\ \ \ \ \ \ \ ParStep\_gpu,}
\DoxyCodeLine{00180\ \ \ \ \ \ \ ParamSums\_gpu,}
\DoxyCodeLine{00181\ \ \ \ \ \ \ NumeratorSum\_gpu,}
\DoxyCodeLine{00182\ \ \ \ \ \ \ DenomSum\_gpu);}
\DoxyCodeLine{00183\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ printf(\textcolor{stringliteral}{"{}\ Finished\ calculating\ now\ copying\ results\ back\ to\ CPU\ \(\backslash\)n"{}});}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \textcolor{comment}{//KS:\ Finally\ copy\ paste\ memory\ from\ GPU\ to\ CPU}}
\DoxyCodeLine{00188\ \ \ cudaMemcpy(NumeratorSum\_cpu,\ NumeratorSum\_gpu,\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a3d609e7d3946c09c05beebd1f703f355}{h\_nLag}}*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}),\ cudaMemcpyDeviceToHost);}
\DoxyCodeLine{00189\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ cudaMemcpy(DenomSum\_cpu,\ DenomSum\_gpu,\ \mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_a3d609e7d3946c09c05beebd1f703f355}{h\_nLag}}*\mbox{\hyperlink{gpuMCMCProcessorUtils_8cu_afe4d63f9540a121d02444724ba2abe10}{h\_nDraws}}*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}),\ cudaMemcpyDeviceToHost);}
\DoxyCodeLine{00192\ \ \ \mbox{\hyperlink{gpuUtils_8cuh_a0345e89c96b417069f1e64674cc77318}{CudaCheckError}}();}
\DoxyCodeLine{00193\ \}}

\end{DoxyCode}
