\hypertarget{MaCh3Factory_8h}{}\doxysection{/home/runner/work/\+Ma\+Ch3/\+Ma\+Ch3/mcmc/\+Ma\+Ch3\+Factory.h File Reference}
\label{MaCh3Factory_8h}\index{/home/runner/work/MaCh3/MaCh3/mcmc/MaCh3Factory.h@{/home/runner/work/MaCh3/MaCh3/mcmc/MaCh3Factory.h}}
{\ttfamily \#include \char`\"{}mcmc/\+Fitter\+Base.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mcmc/mcmc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mcmc/\+PSO.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mcmc/\+Likelihood\+Fit.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}covariance/covariance\+Xsec.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}covariance/covariance\+Osc.\+h\char`\"{}}\newline
Include dependency graph for Ma\+Ch3\+Factory.\+h\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{MaCh3Factory_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=257pt]{MaCh3Factory_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classcovarianceXsec}{covariance\+Xsec}} $\ast$ \mbox{\hyperlink{MaCh3Factory_8h_adf686154f88c21b8937a8c9062d41644}{Ma\+Ch3\+Covariance\+Factory}} (\mbox{\hyperlink{classmanager}{manager}} $\ast$fit\+Man, const std\+::string \&Pre\+Fix)
\begin{DoxyCompactList}\small\item\em Ma\+Ch3 Factory initiates one of implemented fitting algorithms. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{MaCh3Factory_8h_adf686154f88c21b8937a8c9062d41644}\label{MaCh3Factory_8h_adf686154f88c21b8937a8c9062d41644}} 
\index{MaCh3Factory.h@{MaCh3Factory.h}!MaCh3CovarianceFactory@{MaCh3CovarianceFactory}}
\index{MaCh3CovarianceFactory@{MaCh3CovarianceFactory}!MaCh3Factory.h@{MaCh3Factory.h}}
\doxysubsubsection{\texorpdfstring{MaCh3CovarianceFactory()}{MaCh3CovarianceFactory()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classcovarianceXsec}{covariance\+Xsec}} $\ast$ Ma\+Ch3\+Covariance\+Factory (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classmanager}{manager}} $\ast$}]{fit\+Man,  }\item[{const std\+::string \&}]{Pre\+Fix }\end{DoxyParamCaption})}



Ma\+Ch3 Factory initiates one of implemented fitting algorithms. 


\begin{DoxyParams}{Parameters}
{\em fit\+Man} & pointer to Manager class \\
\hline
{\em Samples} & vector of Sample PDF which will be used in the fits \\
\hline
{\em Covariances} & vector of Systematic objects which will be used in the fits\\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
Example YAML configuration\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\ \ \ \ General:}
\DoxyCodeLine{\ \ \ \ \ \ FittingAlgorithm:\ [\textcolor{stringliteral}{"{}MCMC"{}}]}
\DoxyCodeLine{std::unique\_ptr<FitterBase>\ \mbox{\hyperlink{MaCh3Factory_8cpp_adc486d9a678970321030996bd965de77}{MaCh3FitterFactory}}(\mbox{\hyperlink{classmanager}{manager}}\ *fitMan,\ std::vector<samplePDFBase>\&\ Samples,\ std::vector<covarianceBase>\&\ Covariances);}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ @brief\ Factory\ function\ \textcolor{keywordflow}{for}\ creating\ a\ covariance\ matrix\ \textcolor{keywordflow}{for}\ systematic\ handling.}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \ @param\ fitMan\ Pointer\ to\ the\ \mbox{\hyperlink{classmanager}{manager}}\ \textcolor{keyword}{class\ }that\ holds\ the\ configuration\ settings.}
\DoxyCodeLine{\ \ \ \ @param\ name\ Prefix,\ for\ example\ Xsec,\ then\ code\ will\ look\ for\ XsecCovFile}
\DoxyCodeLine{\ \ \ \ @return\ Pointer\ to\ the\ initialized\ \mbox{\hyperlink{classcovarianceXsec}{covarianceXsec}}\ matrix\ object.}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \ @note\ Example\ YAML\ configuration:}
\DoxyCodeLine{\ \ \ \ @code}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{MaCh3Factory_8cpp_a37464d72da10c4e30eba841888416f40}{MaCh3CovarianceFactory}}(,\ Xsec)}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \ General:}
\DoxyCodeLine{\ \ \ \ \ \ Systematics:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ XsecCovName:\ \textcolor{stringliteral}{"{}xsec\_cov"{}}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ XsecCovFile:\ [\textcolor{stringliteral}{"{}inputs/blarb1.yaml"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}inputs/blarb2.yaml"{}}]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ XsecFix:\ [\textcolor{stringliteral}{"{}Param\_0"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Param\_1"{}}]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ XsecPCAThreshold:\ -\/1}
\DoxyCodeLine{\textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \#XsecPCAThreshold:\ 0.00001}}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ XsecPCAParams:\ [-\/999,\ -\/999]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ XsecStepScale:\ 0.0075}

\end{DoxyCode}

\end{DoxyNote}
\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000008}{Todo}}]add adaptive stuff \end{DoxyRefDesc}
\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000007}{Todo}}]this massive hack with \char`\"{}xsec\+\_\+cov\char`\"{} is because we have const char $\ast$ ... will have to fix it later... \end{DoxyRefDesc}


Definition at line \mbox{\hyperlink{MaCh3Factory_8cpp_source_l00038}{38}} of file \mbox{\hyperlink{MaCh3Factory_8cpp_source}{Ma\+Ch3\+Factory.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00039\ \textcolor{comment}{//\ ********************************************}}
\DoxyCodeLine{00040\ \ \ \textcolor{comment}{//\ config\ for\ our\ matrix}}
\DoxyCodeLine{00041\ \ \ YAML::Node\ Settings\ =\ FitManager-\/>raw()[\textcolor{stringliteral}{"{}General"{}}][\textcolor{stringliteral}{"{}Systematics"{}}];}
\DoxyCodeLine{00042\ \ \ \textcolor{keyword}{auto}\ CovMatrixName\ =\ Settings[std::string(PreFix)\ +\ \textcolor{stringliteral}{"{}CovName"{}}].as<std::string>();}
\DoxyCodeLine{00043\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Initialising\ \{\}\ matrix"{}},\ CovMatrixName);}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \textcolor{comment}{//\ yaml\ files\ initialising\ out\ matrix}}
\DoxyCodeLine{00046\ \ \ \textcolor{keyword}{auto}\ CovMatrixFile\ =\ Settings[std::string(PreFix)\ +\ \textcolor{stringliteral}{"{}CovFile"{}}].as<std::vector<std::string>>();}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \textcolor{comment}{//\ PCA\ threshold,\ -\/1\ means\ no\ pca}}
\DoxyCodeLine{00049\ \ \ \textcolor{keyword}{auto}\ PCAThreshold\ =\ GetFromManager<int>(Settings[std::string(PreFix)\ +\ \textcolor{stringliteral}{"{}PCAThreshold"{}}],\ -\/1);}
\DoxyCodeLine{00050\ \ \ \textcolor{comment}{//\ do\ we\ pca\ whole\ matrix\ or\ only\ submatrix}}
\DoxyCodeLine{00051\ \ \ \textcolor{keyword}{auto}\ PCAParamRegion\ =\ GetFromManager<std::vector<int>>(Settings[std::string(PreFix)\ +\ \textcolor{stringliteral}{"{}PCAParams"{}}],\ \{-\/999,\ -\/999\});}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00054\ \ \ \mbox{\hyperlink{classcovarianceXsec}{covarianceXsec}}*\ xsec\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classcovarianceXsec}{covarianceXsec}}(CovMatrixFile,\ \textcolor{stringliteral}{"{}xsec\_cov"{}},\ PCAThreshold,\ PCAParamRegion[0],\ PCAParamRegion[1]);}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \textcolor{comment}{//\ Fill\ the\ parameter\ values\ with\ their\ nominal\ values}}
\DoxyCodeLine{00057\ \ \ \textcolor{comment}{//\ should\ \_ALWAYS\_\ be\ done\ before\ overriding\ with\ fix\ or\ flat}}
\DoxyCodeLine{00058\ \ \ xsec-\/>setParameters();}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \textcolor{keyword}{auto}\ FixParams\ =\ GetFromManager<std::vector<std::string>>(Settings[std::string(PreFix)\ +\ \textcolor{stringliteral}{"{}FixParams"{}}],\ \{\});}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \textcolor{comment}{//\ Fixed\ xsec\ parameters\ loop}}
\DoxyCodeLine{00063\ \ \ \textcolor{keywordflow}{if}\ (FixParams.size()\ ==\ 1\ \&\&\ FixParams.at(0)\ ==\ \textcolor{stringliteral}{"{}All"{}})\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ xsec-\/>GetNumParams();\ j++)\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ xsec-\/>toggleFixParameter(j);}
\DoxyCodeLine{00066\ \ \ \ \ \}}
\DoxyCodeLine{00067\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ FixParams.size();\ j++)\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ xsec-\/>toggleFixParameter(FixParams.at(j));}
\DoxyCodeLine{00070\ \ \ \ \ \}}
\DoxyCodeLine{00071\ \ \ \}}
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{//Global\ step\ scale\ for\ matrix}}
\DoxyCodeLine{00073\ \ \ \textcolor{keyword}{auto}\ StepScale\ =\ Settings[std::string(PreFix)\ +\ \textcolor{stringliteral}{"{}StepScale"{}}].as<\textcolor{keywordtype}{double}>();}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ xsec-\/>setStepScale(StepScale);}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \textcolor{comment}{//\ Adaptive\ MCMC\ stuff}}
\DoxyCodeLine{00078\ \ \ \textcolor{keywordflow}{if}(FitManager-\/>raw()[\textcolor{stringliteral}{"{}AdaptionOptions"{}}])}
\DoxyCodeLine{00079\ \ \ \ \ xsec-\/>initialiseAdaption(FitManager-\/>raw());}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Factory\ successful"{}});}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \textcolor{keywordflow}{return}\ xsec;}
\DoxyCodeLine{00084\ \}}

\end{DoxyCode}
