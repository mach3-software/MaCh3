\hypertarget{classSMonolith}{}\doxysection{SMonolith Class Reference}
\label{classSMonolith}\index{SMonolith@{SMonolith}}


Even-\/by-\/event class calculating response for spline parameters. It is possible to use GPU acceleration.  




{\ttfamily \#include $<$/home/runner/work/\+Ma\+Ch3/\+Ma\+Ch3/splines/\+Spline\+Monolith.\+h$>$}



Inheritance diagram for SMonolith\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=151pt]{classSMonolith__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for SMonolith\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSMonolith__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classSMonolith_a4fe737f7c948f9ee963d87aac46ddebb}{SMonolith}} (std\+::vector$<$ std\+::vector$<$ \mbox{\hyperlink{classTResponseFunction__red}{TResponse\+Function\+\_\+red}} $\ast$ $>$ $>$ \&Master\+Spline, const std\+::vector$<$ \mbox{\hyperlink{Structs_8h_a6a73aa1ad819973a9c421c17c2a7f36d}{Resp\+Func\+Type}} $>$ \&Spline\+Type, const bool Save\+Flat\+Tree=false)
\begin{DoxyCompactList}\small\item\em Constructor. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classSMonolith_ac622c355f630c12438b547bbb9fe212c}{SMonolith}} (std\+::string File\+Name)
\begin{DoxyCompactList}\small\item\em Constructor where you pass path to preprocessed root File\+Name. \end{DoxyCompactList}\item 
virtual \mbox{\hyperlink{classSMonolith_ac0ae7f110fa4c6e46e808d8c1ae979b6}{$\sim$\+SMonolith}} ()
\begin{DoxyCompactList}\small\item\em Destructor for \mbox{\hyperlink{classSMonolith}{SMonolith}} class. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_a3d1128bb78b165d94721407a124f516b}{Evaluate}} () override
\begin{DoxyCompactList}\small\item\em CW\+: This Eval should be used when using two separate x,\{y,a,b,c,d\} arrays to store the weights; probably the best one here! Same thing but pass parameter spline segments instead of variations. \end{DoxyCompactList}\item 
std\+::string \mbox{\hyperlink{classSMonolith_ad85cab15f5dfdd47e1123b5bd1815a05}{Get\+Name}} () const
\begin{DoxyCompactList}\small\item\em Get class name. \end{DoxyCompactList}\item 
short int \mbox{\hyperlink{classSMonolith_aa3332e054f985fc59a162419f0a1d71d}{Get\+NParams}} () const
\begin{DoxyCompactList}\small\item\em Get number of spline parameters. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_a68e18d73ed1ac524ceaea79d2a5460ce}{Synchronise\+Mem\+Transfer}} ()
\begin{DoxyCompactList}\small\item\em KS\+: After calculations are done on GPU we copy memory to CPU. This operation is asynchronous meaning while memory is being copied some operations are being carried. Memory must be copied before actual reweight. This function make sure all has been copied. \end{DoxyCompactList}\item 
const float $\ast$ \mbox{\hyperlink{classSMonolith_a51bbc20cfe4ebed21f6d9f91a86ea0ee}{ret\+Pointer}} (const int event)
\begin{DoxyCompactList}\small\item\em KS\+: Get pointer to total weight to make fit faster wrooom! \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_a40f6b9256a18fa59009e5961aec776ff}{set\+Spline\+Pointers}} (std\+::vector$<$ const double $\ast$ $>$ spline\+\_\+\+Pars\+Pointers)
\begin{DoxyCompactList}\small\item\em KS\+: Set pointers to spline params. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Public Member Functions inherited from \mbox{\hyperlink{classSplineBase}{Spline\+Base}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classSplineBase_aa6965d1522cc68ecf81ac3bfd2dcd6f1}{Spline\+Base}} ()
\begin{DoxyCompactList}\small\item\em Constructor. \end{DoxyCompactList}\item 
virtual \mbox{\hyperlink{classSplineBase_a0de19b2322edb4197380506d594456bd}{$\sim$\+Spline\+Base}} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\item 
virtual void \mbox{\hyperlink{classSplineBase_a86e629f3eef59b2f3800136c86fe90c3}{Evaluate}} ()=0
\begin{DoxyCompactList}\small\item\em CW\+: This Eval should be used when using two separate x,\{y,a,b,c,d\} arrays to store the weights; probably the best one here! Same thing but pass parameter spline segments instead of variations. \end{DoxyCompactList}\item 
virtual std\+::string \mbox{\hyperlink{classSplineBase_a2e1534f622ae1976b21df1ebf984eec5}{Get\+Name}} () const
\begin{DoxyCompactList}\small\item\em Get class name. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
float $\ast$ \mbox{\hyperlink{classSMonolith_a8614e8ef07431d99f62ab88d9ebdad16}{cpu\+\_\+weights}}
\begin{DoxyCompactList}\small\item\em The returned gpu weights, read by the GPU. \end{DoxyCompactList}\item 
float $\ast$ \mbox{\hyperlink{classSMonolith_ab572dd7e0a46caf44eb925a89cbfb0cf}{cpu\+\_\+total\+\_\+weights}}
\begin{DoxyCompactList}\small\item\em KS\+: This holds the total CPU weights that gets read in sample\+PDFND. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{classSMonolith_a45cece9dcbe699e00a7b5fdff4806c1e}{Initialise}} ()
\begin{DoxyCompactList}\small\item\em KS\+: Set everything to null etc. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_a12cddfcbec851b468cba86dc9b223c78}{Scan\+Master\+Spline}} (std\+::vector$<$ std\+::vector$<$ \mbox{\hyperlink{classTResponseFunction__red}{TResponse\+Function\+\_\+red}} $\ast$ $>$ $>$ \&Master\+Spline, unsigned int \&n\+Events, int \&Max\+Points, short int \&num\+Params, int \&n\+Splines, unsigned int \&NSplines\+Valid, unsigned int \&num\+Knots, unsigned int \&n\+TF1\+Valid, unsigned int \&n\+TF1\+\_\+coeff, const std\+::vector$<$ \mbox{\hyperlink{Structs_8h_a6a73aa1ad819973a9c421c17c2a7f36d}{Resp\+Func\+Type}} $>$ \&Spline\+Type)
\begin{DoxyCompactList}\small\item\em CW\+: Function to scan through the Master\+Spline of TSpline3. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_aa1bd2dc5c55b7258d5544512659ef9d7}{Prepare\+For\+GPU}} (std\+::vector$<$ std\+::vector$<$ \mbox{\hyperlink{classTResponseFunction__red}{TResponse\+Function\+\_\+red}} $\ast$ $>$ $>$ \&Master\+Spline, const std\+::vector$<$ \mbox{\hyperlink{Structs_8h_a6a73aa1ad819973a9c421c17c2a7f36d}{Resp\+Func\+Type}} $>$ \&Spline\+Type)
\begin{DoxyCompactList}\small\item\em CW\+: Prepare the \mbox{\hyperlink{classTSpline3__red}{TSpline3\+\_\+red}} objects for the GPU. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_aac73a1089592c5f22755b7427869827f}{Move\+To\+GPU}} ()
\begin{DoxyCompactList}\small\item\em CW\+: The shared initialiser from constructors of \mbox{\hyperlink{classTResponseFunction__red}{TResponse\+Function\+\_\+red}}. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_a5c374d4505de53ad68d176a5644568e6}{Print\+Initialsiation}} ()
\begin{DoxyCompactList}\small\item\em KS\+: Print info about how much knots etc has been initialised. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_acbbe3398718d0d02d65a1e92a91c112c}{get\+Spline\+Coeff\+\_\+\+Sep\+Many}} (\mbox{\hyperlink{classTSpline3__red}{TSpline3\+\_\+red}} $\ast$\&spl, int \&n\+Points, float $\ast$\&x\+Array, float $\ast$\&many\+Array)
\begin{DoxyCompactList}\small\item\em CW\+: This loads up coefficients into two arrays\+: one x array and one yabcd array. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_a7128a7c13b10f331df8946a0a87c4b33}{Find\+Spline\+Segment}} () override
\begin{DoxyCompactList}\small\item\em CW\+:Code used in step by step reweighting, Find Spline Segment for each param. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_aa36be17828281e1412a93c0e239cdbc0}{Calc\+Spline\+Weights}} () override
\begin{DoxyCompactList}\small\item\em CPU based code which eval weight for each spline. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_ac37ee525aa57316f652433a4e393afaf}{Modify\+Weights}} () override
\begin{DoxyCompactList}\small\item\em Calc total event weight. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_a72cd282322bdaadb23d8a376efa9e2c1}{Modify\+Weights\+\_\+\+GPU}} ()
\begin{DoxyCompactList}\small\item\em Conversion from valid splines to all. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_a79f4bf0cac279cf57ab8f06698052922}{Prepare\+Spline\+File}} ()
\begin{DoxyCompactList}\small\item\em KS\+: Prepare spline file that can be used for fast loading. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSMonolith_a6783cdc3c485378ca21852e1a7b02482}{Load\+Spline\+File}} (std\+::string File\+Name)
\begin{DoxyCompactList}\small\item\em KS\+: Load preprocessed spline file. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{structFastSplineInfo}{Fast\+Spline\+Info}} $\ast$ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{Spline\+Info\+Array}}
\item 
short int $\ast$ \mbox{\hyperlink{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}{segments}}
\begin{DoxyCompactList}\small\item\em Store currently found segment they are not in \mbox{\hyperlink{structFastSplineInfo}{Fast\+Spline\+Info}} as in case of GPU we need to copy paste it to GPU. \end{DoxyCompactList}\item 
float $\ast$ \mbox{\hyperlink{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}{vals}}
\begin{DoxyCompactList}\small\item\em Store parameter values they are not in \mbox{\hyperlink{structFastSplineInfo}{Fast\+Spline\+Info}} as in case of GPU we need to copy paste it to GPU. \end{DoxyCompactList}\item 
std\+::vector$<$ const double $\ast$ $>$ \mbox{\hyperlink{classSMonolith_afa782652b0b3da923c5b20bb1319aadd}{spline\+Pars\+Pointer}}
\begin{DoxyCompactList}\small\item\em This holds pointer to parameter position which we later copy paste it to GPU. \end{DoxyCompactList}\item 
unsigned int \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}}
\begin{DoxyCompactList}\small\item\em Number of events. \end{DoxyCompactList}\item 
short int \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{n\+Params}}
\begin{DoxyCompactList}\small\item\em Number of NIWG parameters that have splines. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\+\_\+max\+\_\+knots}}
\begin{DoxyCompactList}\small\item\em Max knots for production. \end{DoxyCompactList}\item 
int $\ast$ \mbox{\hyperlink{classSMonolith_ae9fa50f60f717558f517faea6a38d251}{index\+\_\+cpu}}
\begin{DoxyCompactList}\small\item\em holds the index for good splines; don\textquotesingle{}t do unsigned since starts with negative value! \end{DoxyCompactList}\item 
int $\ast$ \mbox{\hyperlink{classSMonolith_a1aa70cce5867e7e784e97eacebe6bfbd}{index\+\_\+\+TF1\+\_\+cpu}}
\begin{DoxyCompactList}\small\item\em holds the index for good TF1; don\textquotesingle{}t do unsigned since starts with negative value! \end{DoxyCompactList}\item 
unsigned int \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\+\_\+valid}}
\begin{DoxyCompactList}\small\item\em Number of valid splines. \end{DoxyCompactList}\item 
unsigned int \mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\+\_\+valid}}
\begin{DoxyCompactList}\small\item\em Number of valid TF1. \end{DoxyCompactList}\item 
unsigned int \mbox{\hyperlink{classSMonolith_aee3c18513f8209f1ac940b492cd3ed68}{NSplines\+\_\+total\+\_\+large}}
\begin{DoxyCompactList}\small\item\em Number of total splines if each event had every parameter\textquotesingle{}s spline. \end{DoxyCompactList}\item 
unsigned int \mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{n\+Knots}}
\begin{DoxyCompactList}\small\item\em Sum of all knots over all splines. \end{DoxyCompactList}\item 
unsigned int \mbox{\hyperlink{classSMonolith_a403e7cf909f98d4c59b5f6c7ff8aac5b}{n\+TF1coeff}}
\begin{DoxyCompactList}\small\item\em Sum of all coefficients over all TF1. \end{DoxyCompactList}\item 
float $\ast$ \mbox{\hyperlink{classSMonolith_ab6a29f13d8e6efb380f2b9d59cfa88fc}{cpu\+\_\+weights\+\_\+var}}
\begin{DoxyCompactList}\small\item\em CPU arrays to hold weight for each spline. \end{DoxyCompactList}\item 
float $\ast$ \mbox{\hyperlink{classSMonolith_a4a1d45d273cc40cb4f684400812dcb60}{cpu\+\_\+weights\+\_\+tf1\+\_\+var}}
\begin{DoxyCompactList}\small\item\em CPU arrays to hold weight for each TF1. \end{DoxyCompactList}\item 
std\+::vector$<$ unsigned int $>$ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\+\_\+n\+Param\+Per\+Event}}
\begin{DoxyCompactList}\small\item\em KS\+: CPU map keeping track how many parameters applies to each event, we keep two numbers here \{number of splines per event, index where splines start for a given event\}. \end{DoxyCompactList}\item 
std\+::vector$<$ unsigned int $>$ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\+\_\+n\+Param\+Per\+Event\+\_\+tf1}}
\begin{DoxyCompactList}\small\item\em KS\+: CPU map keeping track how many parameters applies to each event, we keep two numbers here \{number of TF1 per event, index where TF1 start for a given event\}. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structSplineMonoStruct}{Spline\+Mono\+Struct}} $\ast$ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\+\_\+spline\+\_\+handler}}
\begin{DoxyCompactList}\small\item\em KS\+: Store info about Spline monolith, this allow to obtain better step time. As all necessary information for spline weight calculation are here meaning better cache hits. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classSMonolithGPU}{SMonolith\+GPU}} $\ast$ \mbox{\hyperlink{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}{gpu\+\_\+spline\+\_\+handler}}
\begin{DoxyCompactList}\small\item\em KS\+: Store info about Spline monolith, this allow to obtain better step time. As all necessary information for spline weight calculation are here meaning better cache hits. \end{DoxyCompactList}\item 
std\+::vector$<$ float $>$ \mbox{\hyperlink{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}{cpu\+\_\+coeff\+\_\+\+TF1\+\_\+many}}
\begin{DoxyCompactList}\small\item\em CPU arrays to hold TF1 coefficients. \end{DoxyCompactList}\item 
std\+::vector$<$ short int $>$ \mbox{\hyperlink{classSMonolith_a14b9c21186a53196f49c8d8d3555fbf2}{cpu\+\_\+n\+Points\+\_\+arr}}
\begin{DoxyCompactList}\small\item\em CPU arrays to hold number of points. \end{DoxyCompactList}\item 
std\+::vector$<$ short int $>$ \mbox{\hyperlink{classSMonolith_af87cf7ae888eb7d4c56f8b6c41c9fd02}{cpu\+\_\+param\+No\+\_\+\+TF1\+\_\+arr}}
\begin{DoxyCompactList}\small\item\em CW\+: CPU array with the number of points per spline (not per spline point!) \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classSMonolith_ab5692081772ca14bd012eb125e2ccfd4}{Save\+Spline\+File}}
\begin{DoxyCompactList}\small\item\em Flag telling whether we are saving spline monolith into handy root file. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}
\doxysubsubsection*{Protected Member Functions inherited from \mbox{\hyperlink{classSplineBase}{Spline\+Base}}}
\begin{DoxyCompactItemize}
\item 
virtual void \mbox{\hyperlink{classSplineBase_ae18e490295762416c8627d2db11ee98d}{Find\+Spline\+Segment}} ()=0
\begin{DoxyCompactList}\small\item\em CW\+:Code used in step by step reweighting, Find Spline Segment for each param. \end{DoxyCompactList}\item 
virtual void \mbox{\hyperlink{classSplineBase_a1ceacf5fee1fc8438501582bef93a9b5}{Calc\+Spline\+Weights}} ()=0
\begin{DoxyCompactList}\small\item\em CPU based code which eval weight for each spline. \end{DoxyCompactList}\item 
virtual void \mbox{\hyperlink{classSplineBase_a49665d2712b61b038085d25ace96a568}{Modify\+Weights}} ()=0
\begin{DoxyCompactList}\small\item\em Calc total event weight. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSplineBase_ac8a5f86ac6f156a7e11ef188b06f425f}{get\+TF1\+Coeff}} (\mbox{\hyperlink{classTF1__red}{TF1\+\_\+red}} $\ast$\&spl, int \&n\+Points, float $\ast$\&coeffs)
\begin{DoxyCompactList}\small\item\em CW\+: Gets the polynomial coefficients for TF1. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Even-\/by-\/event class calculating response for spline parameters. It is possible to use GPU acceleration. 

\begin{DoxySeeAlso}{See also}
For more details, visit the \href{https://github.com/mach3-software/MaCh3/wiki/05.-Splines}{\texttt{ Wiki}}. 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00010}{10}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classSMonolith_a4fe737f7c948f9ee963d87aac46ddebb}\label{classSMonolith_a4fe737f7c948f9ee963d87aac46ddebb}} 
\index{SMonolith@{SMonolith}!SMonolith@{SMonolith}}
\index{SMonolith@{SMonolith}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{SMonolith()}{SMonolith()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily SMonolith\+::\+SMonolith (\begin{DoxyParamCaption}\item[{std\+::vector$<$ std\+::vector$<$ \mbox{\hyperlink{classTResponseFunction__red}{TResponse\+Function\+\_\+red}} $\ast$ $>$ $>$ \&}]{Master\+Spline,  }\item[{const std\+::vector$<$ \mbox{\hyperlink{Structs_8h_a6a73aa1ad819973a9c421c17c2a7f36d}{Resp\+Func\+Type}} $>$ \&}]{Spline\+Type,  }\item[{const bool}]{Save\+Flat\+Tree = {\ttfamily false} }\end{DoxyParamCaption})}



Constructor. 


\begin{DoxyParams}{Parameters}
{\em Master\+Spline} & Vector of TSpline3 pointers which we strip back \\
\hline
{\em Spline\+Type} & Whether object is TSpline3 or TF1 \\
\hline
{\em Save\+Flat\+Tree} & Whether we want to save monolith into speedy flat tree \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l00048}{48}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00049\ :\ \mbox{\hyperlink{classSplineBase_aa6965d1522cc68ecf81ac3bfd2dcd6f1}{SplineBase}}()\ \{}
\DoxyCodeLine{00050\ \textcolor{comment}{//\ *****************************************}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \textcolor{comment}{//KS:\ If\ true\ it\ will\ save\ spline\ monolith\ into\ huge\ ROOT\ file}}
\DoxyCodeLine{00053\ \ \ \mbox{\hyperlink{classSMonolith_ab5692081772ca14bd012eb125e2ccfd4}{SaveSplineFile}}\ =\ SaveFlatTree;}
\DoxyCodeLine{00054\ \ \ \mbox{\hyperlink{classSMonolith_a45cece9dcbe699e00a7b5fdff4806c1e}{Initialise}}();}
\DoxyCodeLine{00055\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}-\/-\/\ GPUING\ WITH\ arrays\ and\ master\ spline\ containing\ TResponseFunction\_red"{}});}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \textcolor{comment}{//\ Convert\ the\ TSpline3\ pointers\ to\ the\ reduced\ form\ and\ call\ the\ reduced\ constructor}}
\DoxyCodeLine{00058\ \ \ \mbox{\hyperlink{classSMonolith_aa1bd2dc5c55b7258d5544512659ef9d7}{PrepareForGPU}}(MasterSpline,\ SplineType);}
\DoxyCodeLine{00059\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_ac622c355f630c12438b547bbb9fe212c}\label{classSMonolith_ac622c355f630c12438b547bbb9fe212c}} 
\index{SMonolith@{SMonolith}!SMonolith@{SMonolith}}
\index{SMonolith@{SMonolith}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{SMonolith()}{SMonolith()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily SMonolith\+::\+SMonolith (\begin{DoxyParamCaption}\item[{std\+::string}]{File\+Name }\end{DoxyParamCaption})}



Constructor where you pass path to preprocessed root File\+Name. 


\begin{DoxyParams}{Parameters}
{\em File\+Name} & path to pre-\/processed root file containing stripped monolith info \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l00518}{518}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classSplineBase_aa6965d1522cc68ecf81ac3bfd2dcd6f1}{SplineBase}}()\ \{}
\DoxyCodeLine{00520\ \textcolor{comment}{//\ *****************************************}}
\DoxyCodeLine{00521\ \ \ \mbox{\hyperlink{classSMonolith_a45cece9dcbe699e00a7b5fdff4806c1e}{Initialise}}();}
\DoxyCodeLine{00522\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}-\/-\/\ GPUING\ WITH\ \{X\}\ and\ \{Y,B,C,D\}\ arrays\ and\ master\ spline\ containing\ TSpline3\_red"{}});}
\DoxyCodeLine{00523\ \ \ \textcolor{comment}{//\ Convert\ the\ TSpline3\ pointers\ to\ the\ reduced\ form\ and\ call\ the\ reduced\ constructor}}
\DoxyCodeLine{00524\ \ \ \mbox{\hyperlink{classSMonolith_a6783cdc3c485378ca21852e1a7b02482}{LoadSplineFile}}(FileName);}
\DoxyCodeLine{00525\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_ac0ae7f110fa4c6e46e808d8c1ae979b6}\label{classSMonolith_ac0ae7f110fa4c6e46e808d8c1ae979b6}} 
\index{SMonolith@{SMonolith}!````~SMonolith@{$\sim$SMonolith}}
\index{````~SMonolith@{$\sim$SMonolith}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{$\sim$SMonolith()}{~SMonolith()}}
{\footnotesize\ttfamily SMonolith\+::$\sim$\+SMonolith (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Destructor for \mbox{\hyperlink{classSMonolith}{SMonolith}} class. 



Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l00812}{812}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00813\ \ \ \textcolor{comment}{//\ *****************************************}}
\DoxyCodeLine{00814\ }
\DoxyCodeLine{00815\ \textcolor{preprocessor}{\ \ \#ifdef\ CUDA}}
\DoxyCodeLine{00816\ \ \ \mbox{\hyperlink{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}{gpu\_spline\_handler}}-\/>\mbox{\hyperlink{classSMonolithGPU_a1ca23401d8d99412288952a1d44390ea}{CleanupGPU\_SplineMonolith}}(}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \#ifndef\ Weight\_On\_SplineBySpline\_Basis}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_ab572dd7e0a46caf44eb925a89cbfb0cf}{cpu\_total\_weights}}}
\DoxyCodeLine{00819\ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00821\ }
\DoxyCodeLine{00822\ \ \ \textcolor{comment}{//KS:\ Since\ we\ declared\ them\ using\ CUDA\ alloc\ we\ have\ to\ free\ memory\ using\ also\ cuda\ functions}}
\DoxyCodeLine{00823\ \ \ \mbox{\hyperlink{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}{gpu\_spline\_handler}}-\/>\mbox{\hyperlink{classSMonolithGPU_af5ca949ba6d79666b541350d24e3daaf}{CleanupGPU\_Segments}}(\mbox{\hyperlink{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}{segments}},\ \mbox{\hyperlink{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}{vals}});}
\DoxyCodeLine{00824\ }
\DoxyCodeLine{00825\ \ \ \textcolor{keyword}{delete}\ \mbox{\hyperlink{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}{gpu\_spline\_handler}};}
\DoxyCodeLine{00826\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00827\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}{segments}}\ !=\ \textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}[]\ \mbox{\hyperlink{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}{segments}};}
\DoxyCodeLine{00828\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}{vals}}\ !=\ \textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}[]\ \mbox{\hyperlink{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}{vals}};}
\DoxyCodeLine{00829\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSMonolith_ab572dd7e0a46caf44eb925a89cbfb0cf}{cpu\_total\_weights}}\ !=\ \textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}[]\ \mbox{\hyperlink{classSMonolith_ab572dd7e0a46caf44eb925a89cbfb0cf}{cpu\_total\_weights}};}
\DoxyCodeLine{00830\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00831\ }
\DoxyCodeLine{00832\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}\ !=\ \textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}[]\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}};}
\DoxyCodeLine{00833\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSMonolith_a8614e8ef07431d99f62ab88d9ebdad16}{cpu\_weights}}\ !=\ \textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}[]\ \mbox{\hyperlink{classSMonolith_a8614e8ef07431d99f62ab88d9ebdad16}{cpu\_weights}};}
\DoxyCodeLine{00834\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSMonolith_ab6a29f13d8e6efb380f2b9d59cfa88fc}{cpu\_weights\_var}}\ !=\ \textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}[]\ \mbox{\hyperlink{classSMonolith_ab6a29f13d8e6efb380f2b9d59cfa88fc}{cpu\_weights\_var}};}
\DoxyCodeLine{00835\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSMonolith_a4a1d45d273cc40cb4f684400812dcb60}{cpu\_weights\_tf1\_var}}\ !=\ \textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}[]\ \mbox{\hyperlink{classSMonolith_a4a1d45d273cc40cb4f684400812dcb60}{cpu\_weights\_tf1\_var}};}
\DoxyCodeLine{00836\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSMonolith_ae9fa50f60f717558f517faea6a38d251}{index\_cpu}}\ !=\ \textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}[]\ \mbox{\hyperlink{classSMonolith_ae9fa50f60f717558f517faea6a38d251}{index\_cpu}};}
\DoxyCodeLine{00837\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSMonolith_a1aa70cce5867e7e784e97eacebe6bfbd}{index\_TF1\_cpu}}\ !=\ \textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}[]\ \mbox{\hyperlink{classSMonolith_a1aa70cce5867e7e784e97eacebe6bfbd}{index\_TF1\_cpu}};}
\DoxyCodeLine{00838\ }
\DoxyCodeLine{00839\ \ \ \textcolor{comment}{//KS:\ Those\ might\ be\ deleted\ or\ not\ depending\ on\ GPU/CPU\ TSpline3/TF1\ DEBUG\ or\ not\ hence\ we\ check\ if\ not\ NULL}}
\DoxyCodeLine{00840\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}\ !=\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00841\ \ \ \{}
\DoxyCodeLine{00842\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a47012ee423ea21f99d06eff8257cf0f0}{coeff\_x}}.clear();}
\DoxyCodeLine{00843\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a47012ee423ea21f99d06eff8257cf0f0}{coeff\_x}}.shrink\_to\_fit();}
\DoxyCodeLine{00844\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a67c5585ae47fc8a646dfae3fe9690775}{coeff\_many}}.clear();}
\DoxyCodeLine{00845\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a67c5585ae47fc8a646dfae3fe9690775}{coeff\_many}}.shrink\_to\_fit();}
\DoxyCodeLine{00846\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_af24b409ab3da1a88e855e1a9d172741f}{paramNo\_arr}}.clear();}
\DoxyCodeLine{00847\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_af24b409ab3da1a88e855e1a9d172741f}{paramNo\_arr}}.shrink\_to\_fit();}
\DoxyCodeLine{00848\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a398e0212915793852137384a3406b37f}{nKnots\_arr}}.clear();}
\DoxyCodeLine{00849\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a398e0212915793852137384a3406b37f}{nKnots\_arr}}.shrink\_to\_fit();}
\DoxyCodeLine{00850\ \ \ \}}
\DoxyCodeLine{00851\ \ \ \mbox{\hyperlink{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}{cpu\_coeff\_TF1\_many}}.clear();}
\DoxyCodeLine{00852\ \ \ \mbox{\hyperlink{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}{cpu\_coeff\_TF1\_many}}.shrink\_to\_fit();}
\DoxyCodeLine{00853\ \ \ \mbox{\hyperlink{classSMonolith_af87cf7ae888eb7d4c56f8b6c41c9fd02}{cpu\_paramNo\_TF1\_arr}}.clear();}
\DoxyCodeLine{00854\ \ \ \mbox{\hyperlink{classSMonolith_af87cf7ae888eb7d4c56f8b6c41c9fd02}{cpu\_paramNo\_TF1\_arr}}.shrink\_to\_fit();}
\DoxyCodeLine{00855\ \textcolor{preprocessor}{\ \ \#ifndef\ Weight\_On\_SplineBySpline\_Basis}}
\DoxyCodeLine{00856\ \ \ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}}.clear();}
\DoxyCodeLine{00857\ \ \ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}}.shrink\_to\_fit();}
\DoxyCodeLine{00858\ \ \ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}}.clear();}
\DoxyCodeLine{00859\ \ \ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}}.shrink\_to\_fit();}
\DoxyCodeLine{00860\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00861\ \ \ \mbox{\hyperlink{classSMonolith_a14b9c21186a53196f49c8d8d3555fbf2}{cpu\_nPoints\_arr}}.clear();}
\DoxyCodeLine{00862\ \ \ \mbox{\hyperlink{classSMonolith_a14b9c21186a53196f49c8d8d3555fbf2}{cpu\_nPoints\_arr}}.shrink\_to\_fit();}
\DoxyCodeLine{00863\ }
\DoxyCodeLine{00864\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}\ !=\ \textcolor{keyword}{nullptr})\ \textcolor{keyword}{delete}\ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}};}
\DoxyCodeLine{00865\ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classSMonolith_aa36be17828281e1412a93c0e239cdbc0}\label{classSMonolith_aa36be17828281e1412a93c0e239cdbc0}} 
\index{SMonolith@{SMonolith}!CalcSplineWeights@{CalcSplineWeights}}
\index{CalcSplineWeights@{CalcSplineWeights}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{CalcSplineWeights()}{CalcSplineWeights()}}
{\footnotesize\ttfamily void SMonolith\+::\+Calc\+Spline\+Weights (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [private]}, {\ttfamily [virtual]}}



CPU based code which eval weight for each spline. 



Implements \mbox{\hyperlink{classSplineBase_a1ceacf5fee1fc8438501582bef93a9b5}{Spline\+Base}}.



Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l01050}{1050}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01051\ \textcolor{comment}{//*********************************************************}}
\DoxyCodeLine{01052\ \textcolor{preprocessor}{\ \ \#ifdef\ MULTITHREAD}}
\DoxyCodeLine{01053\ \ \ \textcolor{comment}{//KS:\ Open\ parallel\ region}}
\DoxyCodeLine{01054\ \textcolor{preprocessor}{\ \ \#pragma\ omp\ parallel}}
\DoxyCodeLine{01055\ \ \ \{}
\DoxyCodeLine{01056\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{01057\ \ \ \ \ \textcolor{comment}{//KS:\ First\ we\ calculate}}
\DoxyCodeLine{01058\ \textcolor{preprocessor}{\ \ \ \ \#ifdef\ MULTITHREAD}}
\DoxyCodeLine{01059\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ omp\ for\ simd\ nowait}}
\DoxyCodeLine{01060\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{01061\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ splineNum\ =\ 0;\ splineNum\ <\ \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}};\ ++splineNum)}
\DoxyCodeLine{01062\ \ \ \ \ \{}
\DoxyCodeLine{01063\ \ \ \ \ \ \ \textcolor{comment}{//CW:\ Which\ Parameter\ we\ are\ accessing}}
\DoxyCodeLine{01064\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{short}\ \textcolor{keywordtype}{int}\ Param\ =\ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_af24b409ab3da1a88e855e1a9d172741f}{paramNo\_arr}}[splineNum];}
\DoxyCodeLine{01065\ }
\DoxyCodeLine{01066\ \ \ \ \ \ \ \textcolor{comment}{//CW:\ Avoids\ doing\ costly\ binary\ search\ on\ GPU}}
\DoxyCodeLine{01067\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{short}\ \textcolor{keywordtype}{int}\ segment\ =\ \mbox{\hyperlink{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}{segments}}[Param];}
\DoxyCodeLine{01068\ }
\DoxyCodeLine{01069\ \ \ \ \ \ \ \textcolor{comment}{//KS:\ Segment\ for\ coeff\_x\ is\ simply\ parameter*max\ knots\ +\ segment\ as\ each\ parameters\ has\ the\ same\ spacing}}
\DoxyCodeLine{01070\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{short}\ \textcolor{keywordtype}{int}\ segment\_X\ =\ short(Param*\mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}}+segment);}
\DoxyCodeLine{01071\ }
\DoxyCodeLine{01072\ \ \ \ \ \ \ \textcolor{comment}{//KS:\ Find\ knot\ position\ in\ out\ monolithical\ structure}}
\DoxyCodeLine{01073\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ CurrentKnotPos\ =\ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a398e0212915793852137384a3406b37f}{nKnots\_arr}}[splineNum]*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}+segment*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}};}
\DoxyCodeLine{01074\ }
\DoxyCodeLine{01075\ \ \ \ \ \ \ \textcolor{comment}{//\ We've\ read\ the\ segment\ straight\ from\ CPU\ and\ is\ saved\ in\ segment\_gpu}}
\DoxyCodeLine{01076\ \ \ \ \ \ \ \textcolor{comment}{//\ polynomial\ parameters\ from\ the\ monolithic\ splineMonolith}}
\DoxyCodeLine{01077\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ fY\ =\ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a67c5585ae47fc8a646dfae3fe9690775}{coeff\_many}}[CurrentKnotPos];}
\DoxyCodeLine{01078\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ fB\ =\ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a67c5585ae47fc8a646dfae3fe9690775}{coeff\_many}}[CurrentKnotPos+1];}
\DoxyCodeLine{01079\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ fC\ =\ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a67c5585ae47fc8a646dfae3fe9690775}{coeff\_many}}[CurrentKnotPos+2];}
\DoxyCodeLine{01080\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ fD\ =\ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a67c5585ae47fc8a646dfae3fe9690775}{coeff\_many}}[CurrentKnotPos+3];}
\DoxyCodeLine{01081\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ is\ the\ variation\ itself\ (needed\ to\ evaluate\ variation\ -\/\ stored\ spline\ point\ =\ dx)}}
\DoxyCodeLine{01082\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ dx\ =\ \mbox{\hyperlink{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}{vals}}[Param]\ -\/\ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a47012ee423ea21f99d06eff8257cf0f0}{coeff\_x}}[segment\_X];}
\DoxyCodeLine{01083\ }
\DoxyCodeLine{01084\ \ \ \ \ \ \ \textcolor{comment}{//CW:\ Wooow,\ let's\ use\ some\ fancy\ intrinsic\ and\ pull\ down\ the\ processing\ time\ by\ <1\%\ from\ normal\ multiplication!\ HURRAY}}
\DoxyCodeLine{01085\ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_ab6a29f13d8e6efb380f2b9d59cfa88fc}{cpu\_weights\_var}}[splineNum]\ =\ fmaf(dx,\ fmaf(dx,\ fmaf(dx,\ fD,\ fC),\ fB),\ fY);}
\DoxyCodeLine{01086\ \ \ \ \ \ \ \textcolor{comment}{//\ Or\ for\ the\ more\ "{}easy\ to\ read"{}\ version:}}
\DoxyCodeLine{01087\ \ \ \ \ \ \ \textcolor{comment}{//cpu\_weights\_var[splineNum]\ =\ (fY+dx*(fB+dx*(fC+dx*fD)));}}
\DoxyCodeLine{01088\ \ \ \ \ \}}
\DoxyCodeLine{01089\ }
\DoxyCodeLine{01090\ \textcolor{preprocessor}{\ \ \ \ \#ifdef\ MULTITHREAD}}
\DoxyCodeLine{01091\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ omp\ for\ simd}}
\DoxyCodeLine{01092\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{01093\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ tf1Num\ =\ 0;\ tf1Num\ <\ \mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}};\ ++tf1Num)}
\DoxyCodeLine{01094\ \ \ \ \ \{}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ is\ the\ variation\ itself\ (needed\ to\ evaluate\ variation\ -\/\ stored\ spline\ point\ =\ dx)}}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ x\ =\ \mbox{\hyperlink{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}{vals}}[\mbox{\hyperlink{classSMonolith_af87cf7ae888eb7d4c56f8b6c41c9fd02}{cpu\_paramNo\_TF1\_arr}}[tf1Num]];}
\DoxyCodeLine{01097\ }
\DoxyCodeLine{01098\ \ \ \ \ \ \ \textcolor{comment}{//\ Read\ the\ coefficients}}
\DoxyCodeLine{01099\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ a\ =\ \mbox{\hyperlink{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}{cpu\_coeff\_TF1\_many}}[tf1Num*\mbox{\hyperlink{SplineCommon_8h_a911160077ffa38727e0494f178ce380a}{\_nTF1Coeff\_}}];}
\DoxyCodeLine{01100\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ b\ =\ \mbox{\hyperlink{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}{cpu\_coeff\_TF1\_many}}[tf1Num*\mbox{\hyperlink{SplineCommon_8h_a911160077ffa38727e0494f178ce380a}{\_nTF1Coeff\_}}+1];}
\DoxyCodeLine{01101\ }
\DoxyCodeLine{01102\ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a4a1d45d273cc40cb4f684400812dcb60}{cpu\_weights\_tf1\_var}}[tf1Num]\ =\ fmaf(a,\ x,\ b);}
\DoxyCodeLine{01103\ \ \ \ \ \ \ \textcolor{comment}{//\ cpu\_weights\_tf1\_var[tf1Num]\ =\ a*x\ +\ b;}}
\DoxyCodeLine{01104\ }
\DoxyCodeLine{01105\ \ \ \ \ \ \ \textcolor{comment}{//cpu\_weights\_tf1\_var[splineNum]\ =\ 1\ +\ a*x\ +\ b*x*x\ +\ c*x*x*x\ +\ d*x*x*x*x\ +\ e*x*x*x*x*x;}}
\DoxyCodeLine{01106\ \ \ \ \ \}}
\DoxyCodeLine{01107\ \textcolor{preprocessor}{\ \ \#ifdef\ MULTITHREAD}}
\DoxyCodeLine{01108\ \ \ \textcolor{comment}{//KS:\ End\ parallel\ region}}
\DoxyCodeLine{01109\ \ \ \}}
\DoxyCodeLine{01110\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{01111\ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01112\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_a3d1128bb78b165d94721407a124f516b}\label{classSMonolith_a3d1128bb78b165d94721407a124f516b}} 
\index{SMonolith@{SMonolith}!Evaluate@{Evaluate}}
\index{Evaluate@{Evaluate}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{Evaluate()}{Evaluate()}}
{\footnotesize\ttfamily void SMonolith\+::\+Evaluate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



CW\+: This Eval should be used when using two separate x,\{y,a,b,c,d\} arrays to store the weights; probably the best one here! Same thing but pass parameter spline segments instead of variations. 



Implements \mbox{\hyperlink{classSplineBase_a86e629f3eef59b2f3800136c86fe90c3}{Spline\+Base}}.



Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l00950}{950}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00950\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00951\ \textcolor{comment}{//\ *****************************************}}
\DoxyCodeLine{00952\ }
\DoxyCodeLine{00953\ \ \ \textcolor{comment}{//\ There's\ a\ parameter\ mapping\ that\ goes\ from\ spline\ parameter\ to\ a\ global\ parameter\ index}}
\DoxyCodeLine{00954\ \ \ \textcolor{comment}{//\ Find\ the\ spline\ segments}}
\DoxyCodeLine{00955\ \ \ \mbox{\hyperlink{classSMonolith_a7128a7c13b10f331df8946a0a87c4b33}{FindSplineSegment}}();}
\DoxyCodeLine{00956\ }
\DoxyCodeLine{00957\ \ \ \textcolor{comment}{//KS:\ Huge\ MP\ loop\ over\ all\ valid\ splines}}
\DoxyCodeLine{00958\ \ \ \mbox{\hyperlink{classSMonolith_aa36be17828281e1412a93c0e239cdbc0}{CalcSplineWeights}}();}
\DoxyCodeLine{00959\ }
\DoxyCodeLine{00960\ \ \ \textcolor{comment}{//KS:\ Huge\ MP\ loop\ over\ all\ events\ calculating\ total\ weight}}
\DoxyCodeLine{00961\ \ \ \mbox{\hyperlink{classSMonolith_ac37ee525aa57316f652433a4e393afaf}{ModifyWeights}}();}
\DoxyCodeLine{00962\ }
\DoxyCodeLine{00963\ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00964\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_a7128a7c13b10f331df8946a0a87c4b33}\label{classSMonolith_a7128a7c13b10f331df8946a0a87c4b33}} 
\index{SMonolith@{SMonolith}!FindSplineSegment@{FindSplineSegment}}
\index{FindSplineSegment@{FindSplineSegment}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{FindSplineSegment()}{FindSplineSegment()}}
{\footnotesize\ttfamily void SMonolith\+::\+Find\+Spline\+Segment (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [private]}, {\ttfamily [virtual]}}



CW\+:Code used in step by step reweighting, Find Spline Segment for each param. 



Implements \mbox{\hyperlink{classSplineBase_ae18e490295762416c8627d2db11ee98d}{Spline\+Base}}.



Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l00971}{971}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00971\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00972\ \textcolor{comment}{//\ *************************}}
\DoxyCodeLine{00973\ \ \ \textcolor{comment}{//\ Loop\ over\ the\ splines}}
\DoxyCodeLine{00974\ \ \ \textcolor{comment}{//KS:\ Tried\ multithreading\ here\ with\ 48\ splines\ and\ it\ is\ faster\ with\ one\ thread,\ maybe\ in\ future\ multithreading\ will\ be\ worth\ revisiting}}
\DoxyCodeLine{00975\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}};\ ++i)}
\DoxyCodeLine{00976\ \ \ \{}
\DoxyCodeLine{00977\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ nPoints\ =\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{structFastSplineInfo_ac8538a8e3438ae06d8f467cc0fd5ce0d}{nPts}};}
\DoxyCodeLine{00978\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceM3_a1f95274549f25fc19fe7db343c8a7a68}{M3::float\_t}}*\ xArray\ =\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{structFastSplineInfo_a9e9d432eb250bba227d31022ac9c5779}{xPts}};}
\DoxyCodeLine{00979\ }
\DoxyCodeLine{00980\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ variation\ for\ this\ reconfigure\ for\ the\ ith\ parameter}}
\DoxyCodeLine{00981\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ xvar\ =\ float(*\mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{classSMonolith_afa782652b0b3da923c5b20bb1319aadd}{splineParsPointer}});}
\DoxyCodeLine{00982\ \ \ \ \ \mbox{\hyperlink{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}{vals}}[i]\ =\ xvar;}
\DoxyCodeLine{00983\ }
\DoxyCodeLine{00984\ \ \ \ \ \textcolor{comment}{//\ EM:\ if\ we\ have\ a\ parameter\ that\ has\ no\ response\ for\ any\ event\ (i.e.\ all\ splines\ have\ just\ one\ knot),\ then\ skip\ it\ and\ avoid\ a\ seg\ fault\ here}}
\DoxyCodeLine{00985\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ In\ principle,\ such\ parameters\ shouldn't\ really\ be\ included\ in\ the\ first\ place,\ but\ with\ new\ det\ syst\ splines\ this}}
\DoxyCodeLine{00986\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ could\ happen\ if\ say\ you\ were\ just\ running\ on\ one\ FHC\ run,\ then\ all\ RHC\ parameters\ would\ be\ flat\ and\ the\ code\ below\ would\ break.}}
\DoxyCodeLine{00987\ \ \ \ \ \textcolor{keywordflow}{if}(xArray\ ==\ NULL)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00988\ }
\DoxyCodeLine{00989\ \ \ \ \ \textcolor{comment}{//\ The\ segment\ we're\ interested\ in\ (klow\ in\ ROOT\ code)}}
\DoxyCodeLine{00990\ \ \ \ \ \mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ segment\ =\ 0;}
\DoxyCodeLine{00991\ \ \ \ \ \mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ kHigh\ =\ nPoints-\/1;}
\DoxyCodeLine{00992\ \ \ \ \ \textcolor{comment}{//KS:\ We\ expect\ new\ segment\ is\ very\ close\ to\ previous}}
\DoxyCodeLine{00993\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ PreviousSegment\ =\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{structFastSplineInfo_a80e4c1195099d2c34a1a511e4f749fe4}{CurrSegment}};}
\DoxyCodeLine{00994\ }
\DoxyCodeLine{00995\ \ \ \ \ \textcolor{comment}{//\ If\ the\ variation\ is\ below\ the\ lowest\ saved\ spline\ point}}
\DoxyCodeLine{00996\ \ \ \ \ \textcolor{keywordflow}{if}\ (xvar\ <=\ xArray[0])\ \{}
\DoxyCodeLine{00997\ \ \ \ \ \ \ segment\ =\ 0;}
\DoxyCodeLine{00998\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ variation\ is\ above\ the\ highest\ saved\ spline\ point}}
\DoxyCodeLine{00999\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (xvar\ >=\ xArray[nPoints-\/1])\ \{}
\DoxyCodeLine{01000\ \ \ \ \ \ \ \textcolor{comment}{//CW:\ Yes,\ the\ -\/2\ is\ indeed\ correct,\ see\ TSpline.cxx:814\ and\ //see:\ https://savannah.cern.ch/bugs/?71651}}
\DoxyCodeLine{01001\ \ \ \ \ \ \ segment\ =\ kHigh;}
\DoxyCodeLine{01002\ \ \ \ \ \ \ \textcolor{comment}{//KS:\ It\ is\ quite\ probable\ the\ new\ segment\ is\ same\ as\ in\ previous\ step\ so\ try\ to\ avoid\ binary\ search,\ first\ we\ have\ to\ check\ if\ it\ is\ in\ bounds\ to\ avoid\ seg\ fault}}
\DoxyCodeLine{01003\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ xArray[PreviousSegment+1]\ >\ xvar\ \&\&\ xvar\ >=\ xArray[PreviousSegment]\ )\ \{}
\DoxyCodeLine{01004\ \ \ \ \ \ \ segment\ =\ PreviousSegment;}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ variation\ is\ between\ the\ maximum\ and\ minimum,\ perform\ a\ binary\ search}}
\DoxyCodeLine{01006\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01007\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ top\ point\ we've\ got}}
\DoxyCodeLine{01008\ \ \ \ \ \ \ \mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ kHalf\ =\ 0;}
\DoxyCodeLine{01009\ \ \ \ \ \ \ \textcolor{comment}{//\ While\ there\ is\ still\ a\ difference\ in\ the\ points\ (we\ haven't\ yet\ found\ the\ segment)}}
\DoxyCodeLine{01010\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ a\ binary\ search,\ incrementing\ segment\ and\ decrementing\ kHalf\ until\ we've\ found\ the\ segment}}
\DoxyCodeLine{01011\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (kHigh\ -\/\ segment\ >\ 1)\ \{}
\DoxyCodeLine{01012\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Increment\ the\ half-\/step}}
\DoxyCodeLine{01013\ \ \ \ \ \ \ \ \ kHalf\ =\ \mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}((segment\ +\ kHigh)/2);}
\DoxyCodeLine{01014\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ our\ variation\ is\ above\ the\ kHalf,\ set\ the\ segment\ to\ kHalf}}
\DoxyCodeLine{01015\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (xvar\ >\ xArray[kHalf])\ \{}
\DoxyCodeLine{01016\ \ \ \ \ \ \ \ \ \ \ segment\ =\ kHalf;}
\DoxyCodeLine{01017\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Else\ move\ kHigh\ down}}
\DoxyCodeLine{01018\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01019\ \ \ \ \ \ \ \ \ \ \ kHigh\ =\ kHalf;}
\DoxyCodeLine{01020\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01021\ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ End\ the\ while:\ we've\ now\ done\ our\ binary\ search}}
\DoxyCodeLine{01022\ \ \ \ \ \}\ \textcolor{comment}{//\ End\ the\ else:\ we've\ now\ found\ our\ point}}
\DoxyCodeLine{01023\ }
\DoxyCodeLine{01024\ \ \ \ \ \textcolor{keywordflow}{if}\ (segment\ >=\ nPoints-\/1\ \&\&\ nPoints\ >\ 1)\ segment\ =\ nPoints-\/2;}
\DoxyCodeLine{01025\ }
\DoxyCodeLine{01026\ \ \ \ \ \textcolor{comment}{//CW:\ This\ way\ we\ avoid\ doing\ 1.2M+\ binary\ searches\ on\ the\ GPU}}
\DoxyCodeLine{01027\ \ \ \ \ \textcolor{comment}{//\ and\ literally\ just\ multiply\ lots\ of\ numbers\ together\ on\ the\ GPU\ without\ any\ algorithm}}
\DoxyCodeLine{01028\ \ \ \ \ \textcolor{comment}{//\ Update\ the\ values\ and\ which\ segment\ it\ belongs\ to}}
\DoxyCodeLine{01029\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{structFastSplineInfo_a80e4c1195099d2c34a1a511e4f749fe4}{CurrSegment}}\ =\ segment;}
\DoxyCodeLine{01030\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}{segments}}[i]\ =\ short(\mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].CurrSegment);}
\DoxyCodeLine{01031\ }
\DoxyCodeLine{01032\ \textcolor{preprocessor}{\#ifdef\ DEBUG}}
\DoxyCodeLine{01033\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].xPts[segment]\ >\ xvar\ \&\&\ segment\ !=\ 0)\ \{}
\DoxyCodeLine{01034\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}Found\ a\ segment\ which\ is\ \_ABOVE\_\ the\ variation!"{}});}
\DoxyCodeLine{01035\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}IT\ SHOULD\ ALWAYS\ BE\ BELOW!\ (except\ when\ segment\ 0)"{}});}
\DoxyCodeLine{01036\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}Spline:\ \{\}"{}},\ i);}
\DoxyCodeLine{01037\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}Found\ segment\ =\ \{\}"{}},\ segment);}
\DoxyCodeLine{01038\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}Doing\ variation\ =\ \{\}"{}},\ xvar);}
\DoxyCodeLine{01039\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}x\ in\ spline\ =\ \{\}"{}},\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].xPts[segment]);}
\DoxyCodeLine{01040\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ j\ =\ 0;\ j\ <\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[j].\mbox{\hyperlink{structFastSplineInfo_ac8538a8e3438ae06d8f467cc0fd5ce0d}{nPts}};\ ++j)\ \{}
\DoxyCodeLine{01041\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}\ \ \ \ \{\}\ =\ \{\}"{}},\ j,\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].xPts[j]);}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01043\ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classMaCh3Exception}{MaCh3Exception}}(\_\_FILE\_\_\ ,\ \_\_LINE\_\_\ );}
\DoxyCodeLine{01044\ \ \ \ \ \}}
\DoxyCodeLine{01045\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01046\ \ \ \}\ \textcolor{comment}{//end\ loop\ over\ params}}
\DoxyCodeLine{01047\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_ad85cab15f5dfdd47e1123b5bd1815a05}\label{classSMonolith_ad85cab15f5dfdd47e1123b5bd1815a05}} 
\index{SMonolith@{SMonolith}!GetName@{GetName}}
\index{GetName@{GetName}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{GetName()}{GetName()}}
{\footnotesize\ttfamily std\+::string SMonolith\+::\+Get\+Name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}



Get class name. 



Reimplemented from \mbox{\hyperlink{classSplineBase_a2e1534f622ae1976b21df1ebf984eec5}{Spline\+Base}}.



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00029}{29}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00029\ \{\textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}SplineMonolith"{}};\};}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_aa3332e054f985fc59a162419f0a1d71d}\label{classSMonolith_aa3332e054f985fc59a162419f0a1d71d}} 
\index{SMonolith@{SMonolith}!GetNParams@{GetNParams}}
\index{GetNParams@{GetNParams}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{GetNParams()}{GetNParams()}}
{\footnotesize\ttfamily short int SMonolith\+::\+Get\+NParams (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Get number of spline parameters. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00032}{32}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00032\ \{\textcolor{keywordflow}{return}\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}};\};}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_acbbe3398718d0d02d65a1e92a91c112c}\label{classSMonolith_acbbe3398718d0d02d65a1e92a91c112c}} 
\index{SMonolith@{SMonolith}!getSplineCoeff\_SepMany@{getSplineCoeff\_SepMany}}
\index{getSplineCoeff\_SepMany@{getSplineCoeff\_SepMany}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{getSplineCoeff\_SepMany()}{getSplineCoeff\_SepMany()}}
{\footnotesize\ttfamily void SMonolith\+::get\+Spline\+Coeff\+\_\+\+Sep\+Many (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classTSpline3__red}{TSpline3\+\_\+red}} $\ast$\&}]{spl,  }\item[{int \&}]{n\+Points,  }\item[{float $\ast$\&}]{x\+Array,  }\item[{float $\ast$\&}]{many\+Array }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}



CW\+: This loads up coefficients into two arrays\+: one x array and one yabcd array. 

CW\+: This should maximize our cache hits! 
\begin{DoxyParams}{Parameters}
{\em spl} & pointer to \mbox{\hyperlink{classTSpline3__red}{TSpline3\+\_\+red}} \\
\hline
{\em n\+Points} & number of knots \\
\hline
{\em x\+Array} & array X value for each knot \\
\hline
{\em many\+Array} & Array holding coefficients for each knot \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l00871}{871}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00871\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00872\ \textcolor{comment}{//\ *****************************************}}
\DoxyCodeLine{00873\ \ \ \textcolor{comment}{//\ Initialise\ all\ arrays\ to\ 1.0}}
\DoxyCodeLine{00874\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}};\ ++i)\ \{}
\DoxyCodeLine{00875\ \ \ \ \ xArray[i]\ =\ 1.0;}
\DoxyCodeLine{00876\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ \mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}};\ j++)\ \{}
\DoxyCodeLine{00877\ \ \ \ \ \ \ manyArray[i*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}+j]\ =\ 1.0;}
\DoxyCodeLine{00878\ \ \ \ \ \}}
\DoxyCodeLine{00879\ \ \ \}}
\DoxyCodeLine{00880\ \ \ \textcolor{comment}{//\ Get\ number\ of\ points\ in\ spline}}
\DoxyCodeLine{00881\ \ \ \textcolor{keywordtype}{int}\ Np\ =\ spl-\/>\mbox{\hyperlink{classTSpline3__red_a6b680cfb96e11c55b8325e1274251b91}{GetNp}}();}
\DoxyCodeLine{00882\ \ \ \textcolor{comment}{//\ If\ spline\ is\ flat,\ set\ number\ of\ knots\ to\ 1.0,}}
\DoxyCodeLine{00883\ \ \ \textcolor{comment}{//\ This\ is\ used\ later\ to\ expedite\ the\ calculations\ for\ flat\ splines}}
\DoxyCodeLine{00884\ \ \ \textcolor{comment}{//\ tmpArray[0]\ is\ number\ of\ knots}}
\DoxyCodeLine{00885\ \ \ nPoints\ =\ Np;}
\DoxyCodeLine{00886\ \ \ \textcolor{keywordflow}{if}\ (Np\ >\ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}})\ \{}
\DoxyCodeLine{00887\ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}Error,\ number\ of\ points\ is\ greater\ than\ saved\ \{\}"{}},\ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}});}
\DoxyCodeLine{00888\ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}This\ \_WILL\_\ cause\ problems\ with\ GPU\ splines\ and\ \_SHOULD\_\ be\ fixed!"{}});}
\DoxyCodeLine{00889\ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}nPoints\ =\ \{\},\ \_max\_knots\ =\ \{\}"{}},\ nPoints,\ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}});}
\DoxyCodeLine{00890\ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classMaCh3Exception}{MaCh3Exception}}(\_\_FILE\_\_\ ,\ \_\_LINE\_\_\ );}
\DoxyCodeLine{00891\ \ \ \}}
\DoxyCodeLine{00892\ }
\DoxyCodeLine{00893\ \ \ \textcolor{comment}{//\ The\ coefficients\ we're\ writing\ to}}
\DoxyCodeLine{00894\ \ \ \mbox{\hyperlink{namespaceM3_a1f95274549f25fc19fe7db343c8a7a68}{M3::float\_t}}\ x,\ y,\ b,\ c,\ d;}
\DoxyCodeLine{00895\ \ \ \textcolor{comment}{//\ TSpline3\ can\ only\ take\ doubles,\ not\ floats}}
\DoxyCodeLine{00896\ \ \ \textcolor{comment}{//\ But\ our\ GPU\ is\ slow\ with\ doubles,\ so\ need\ to\ cast\ to\ float}}
\DoxyCodeLine{00897\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ Np;\ i++)\ \{}
\DoxyCodeLine{00898\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ coefficients\ from\ the\ TSpline3\ object}}
\DoxyCodeLine{00899\ \ \ \ \ spl-\/>\mbox{\hyperlink{classTSpline3__red_a74d108b99a9060ab85c22343fa4a4532}{GetCoeff}}(i,\ x,\ y,\ b,\ c,\ d);}
\DoxyCodeLine{00900\ \ \ \ \ \textcolor{comment}{//\ Write\ the\ arrays}}
\DoxyCodeLine{00901\ \ \ \ \ xArray[i]\ =\ float(x);}
\DoxyCodeLine{00902\ \ \ \ \ manyArray[i*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}]\ =\ float(y);\ \textcolor{comment}{//\ 4\ because\ manyArray\ stores\ y,b,c,d}}
\DoxyCodeLine{00903\ \ \ \ \ manyArray[i*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}+1]\ =\ float(b);}
\DoxyCodeLine{00904\ \ \ \ \ manyArray[i*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}+2]\ =\ float(c);}
\DoxyCodeLine{00905\ \ \ \ \ manyArray[i*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}+3]\ =\ float(d);}
\DoxyCodeLine{00906\ \ \ \ \ \textcolor{keywordflow}{if}((xArray[i]\ ==\ -\/999)\ ||\ (manyArray[i*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}]\ ==\ -\/999)\ ||\ (manyArray[i*4+1]\ ==\ -\/999)\ ||\ (manyArray[i*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}+2]\ ==\ -\/999)\ ||\ (manyArray[i*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}+3]\ ==\ -\/999))\{}
\DoxyCodeLine{00907\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}***********\ Bad\ params\ in\ getSplineCoeff\_SepMany()\ ************"{}});}
\DoxyCodeLine{00908\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}pre\ cast\ to\ float\ (x,\ y,\ b,\ c,\ d)\ =\ \{:.2f\},\ \{:.2f\},\ \{:.2f\},\ \{:.2f\},\ \{:.2f\}"{}},\ x,\ y,\ b,\ c,\ d);}
\DoxyCodeLine{00909\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}pre\ cast\ to\ float\ (x,\ y,\ b,\ c,\ d)\ =\ \{:.2f\},\ \{:.2f\},\ \{:.2f\},\ \{:.2f\},\ \{:.2f\}"{}},\ xArray[i],\ manyArray[i*4],\ manyArray[i*4+1],\ manyArray[i*4+2],\ manyArray[i*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}+3]);}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}This\ will\ cause\ problems\ when\ preparing\ for\ GPU"{}});}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}***************************************************************"{}});}
\DoxyCodeLine{00912\ \ \ \ \ \}}
\DoxyCodeLine{00913\ \ \ \}}
\DoxyCodeLine{00914\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_a45cece9dcbe699e00a7b5fdff4806c1e}\label{classSMonolith_a45cece9dcbe699e00a7b5fdff4806c1e}} 
\index{SMonolith@{SMonolith}!Initialise@{Initialise}}
\index{Initialise@{Initialise}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{Initialise()}{Initialise()}}
{\footnotesize\ttfamily void SMonolith\+::\+Initialise (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}



KS\+: Set everything to null etc. 



Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l00012}{12}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ *****************************************}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#ifdef\ CUDA}}
\DoxyCodeLine{00016\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Using\ GPU\ version\ event\ by\ event\ monolith"{}});}
\DoxyCodeLine{00017\ \ \ \mbox{\hyperlink{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}{gpu\_spline\_handler}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{structSplineMonoStruct}{SplineMonoStruct}}();}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \ \ \mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{nKnots}}\ =\ 0;}
\DoxyCodeLine{00023\ \ \ \mbox{\hyperlink{classSMonolith_a403e7cf909f98d4c59b5f6c7ff8aac5b}{nTF1coeff}}\ =\ 0;}
\DoxyCodeLine{00024\ \ \ \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}}\ =\ 0;}
\DoxyCodeLine{00025\ \ \ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}}\ =\ 0;}
\DoxyCodeLine{00026\ \ \ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}}\ =\ 0;}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}}\ =\ 0;}
\DoxyCodeLine{00029\ \ \ \mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}}\ =\ 0;}
\DoxyCodeLine{00030\ \ \ \mbox{\hyperlink{classSMonolith_aee3c18513f8209f1ac940b492cd3ed68}{NSplines\_total\_large}}\ =\ 0;}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \mbox{\hyperlink{classSMonolith_ae9fa50f60f717558f517faea6a38d251}{index\_cpu}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00033\ \ \ \mbox{\hyperlink{classSMonolith_a1aa70cce5867e7e784e97eacebe6bfbd}{index\_TF1\_cpu}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00034\ \ \ \mbox{\hyperlink{classSMonolith_ab6a29f13d8e6efb380f2b9d59cfa88fc}{cpu\_weights\_var}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00035\ \ \ \mbox{\hyperlink{classSMonolith_a8614e8ef07431d99f62ab88d9ebdad16}{cpu\_weights}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00036\ \ \ \mbox{\hyperlink{classSMonolith_a4a1d45d273cc40cb4f684400812dcb60}{cpu\_weights\_tf1\_var}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \mbox{\hyperlink{classSMonolith_ab572dd7e0a46caf44eb925a89cbfb0cf}{cpu\_total\_weights}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00041\ \ \ \mbox{\hyperlink{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}{segments}}\ =\ NULL;}
\DoxyCodeLine{00042\ \ \ \mbox{\hyperlink{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}{vals}}\ =\ NULL;}
\DoxyCodeLine{00043\ \ \ }
\DoxyCodeLine{00044\ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00045\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_a6783cdc3c485378ca21852e1a7b02482}\label{classSMonolith_a6783cdc3c485378ca21852e1a7b02482}} 
\index{SMonolith@{SMonolith}!LoadSplineFile@{LoadSplineFile}}
\index{LoadSplineFile@{LoadSplineFile}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{LoadSplineFile()}{LoadSplineFile()}}
{\footnotesize\ttfamily void SMonolith\+::\+Load\+Spline\+File (\begin{DoxyParamCaption}\item[{std\+::string}]{File\+Name }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}



KS\+: Load preprocessed spline file. 


\begin{DoxyParams}{Parameters}
{\em File\+Name} & Path to ROOT file with predefined reduced Spline Monolith \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l00529}{529}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00530\ \textcolor{comment}{//\ *****************************************}}
\DoxyCodeLine{00531\ \textcolor{preprocessor}{\ \ \#ifdef\ Weight\_On\_SplineBySpline\_Basis}}
\DoxyCodeLine{00532\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}Trying\ to\ load\ Monolith\ from\ file\ using\ weight\ by\ weight\ base,\ this\ is\ not\ supported\ right\ now,\ sorry"{}});}
\DoxyCodeLine{00533\ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classMaCh3Exception}{MaCh3Exception}}(\_\_FILE\_\_\ ,\ \_\_LINE\_\_\ );}
\DoxyCodeLine{00534\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00535\ }
\DoxyCodeLine{00536\ \ \ \textcolor{keywordflow}{if}\ (std::getenv(\textcolor{stringliteral}{"{}MACH3"{}})\ !=\ NULL)\ \{}
\DoxyCodeLine{00537\ \ \ \ \ \ \ FileName.insert(0,\ std::string(std::getenv(\textcolor{stringliteral}{"{}MACH3"{}}))+\textcolor{stringliteral}{"{}/"{}});}
\DoxyCodeLine{00538\ \ \ \ \}}
\DoxyCodeLine{00539\ }
\DoxyCodeLine{00540\ \ \ TFile\ *SplineFile\ =\ \textcolor{keyword}{new}\ TFile(FileName.c\_str(),\ \textcolor{stringliteral}{"{}OPEN"{}});}
\DoxyCodeLine{00541\ \ \ TTree\ *Settings\ =\ SplineFile-\/>Get<TTree>(\textcolor{stringliteral}{"{}Settings"{}});}
\DoxyCodeLine{00542\ \ \ TTree\ *Monolith\ =\ SplineFile-\/>Get<TTree>(\textcolor{stringliteral}{"{}Monolith"{}});}
\DoxyCodeLine{00543\ \ \ TTree\ *Monolith\_TF1\ =\ SplineFile-\/>Get<TTree>(\textcolor{stringliteral}{"{}Monolith\_TF1"{}});}
\DoxyCodeLine{00544\ \ \ TTree\ *ParamInfo\ =\ SplineFile-\/>Get<TTree>(\textcolor{stringliteral}{"{}ParamInfo"{}});}
\DoxyCodeLine{00545\ \ \ TTree\ *XKnots\ =\ SplineFile-\/>Get<TTree>(\textcolor{stringliteral}{"{}XKnots"{}});}
\DoxyCodeLine{00546\ \ \ TTree\ *EventInfo\ =\ SplineFile-\/>Get<TTree>(\textcolor{stringliteral}{"{}EventInfo"{}});}
\DoxyCodeLine{00547\ \ \ TTree\ *FastSplineInfoTree\ =\ SplineFile-\/>Get<TTree>(\textcolor{stringliteral}{"{}FastSplineInfoTree"{}});}
\DoxyCodeLine{00548\ }
\DoxyCodeLine{00549\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ NEvents\_temp;}
\DoxyCodeLine{00550\ \ \ \textcolor{keywordtype}{short}\ \textcolor{keywordtype}{int}\ nParams\_temp;}
\DoxyCodeLine{00551\ \ \ \textcolor{keywordtype}{int}\ \_max\_knots\_temp;}
\DoxyCodeLine{00552\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nKnots\_temp;}
\DoxyCodeLine{00553\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ NSplines\_valid\_temp;}
\DoxyCodeLine{00554\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nTF1Valid\_temp;}
\DoxyCodeLine{00555\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nTF1coeff\_temp;}
\DoxyCodeLine{00556\ }
\DoxyCodeLine{00557\ \ \ Settings-\/>SetBranchAddress(\textcolor{stringliteral}{"{}NEvents"{}},\ \&NEvents\_temp);}
\DoxyCodeLine{00558\ \ \ Settings-\/>SetBranchAddress(\textcolor{stringliteral}{"{}nParams"{}},\ \&nParams\_temp);}
\DoxyCodeLine{00559\ \ \ Settings-\/>SetBranchAddress(\textcolor{stringliteral}{"{}\_max\_knots"{}},\ \&\_max\_knots\_temp);}
\DoxyCodeLine{00560\ \ \ Settings-\/>SetBranchAddress(\textcolor{stringliteral}{"{}nKnots"{}},\ \&nKnots\_temp);}
\DoxyCodeLine{00561\ \ \ Settings-\/>SetBranchAddress(\textcolor{stringliteral}{"{}NSplines\_valid"{}},\ \&NSplines\_valid\_temp);}
\DoxyCodeLine{00562\ \ \ Settings-\/>SetBranchAddress(\textcolor{stringliteral}{"{}NTF1\_valid"{}},\ \&nTF1Valid\_temp);}
\DoxyCodeLine{00563\ \ \ Settings-\/>SetBranchAddress(\textcolor{stringliteral}{"{}nTF1coeff"{}},\ \&nTF1coeff\_temp);}
\DoxyCodeLine{00564\ }
\DoxyCodeLine{00565\ \ \ Settings-\/>GetEntry(0);}
\DoxyCodeLine{00566\ }
\DoxyCodeLine{00567\ \ \ \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}}\ =\ NEvents\_temp;}
\DoxyCodeLine{00568\ \ \ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}}\ =\ nParams\_temp;}
\DoxyCodeLine{00569\ \ \ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}}\ =\ \_max\_knots\_temp;}
\DoxyCodeLine{00570\ \ \ \mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{nKnots}}\ =\ nKnots\_temp;}
\DoxyCodeLine{00571\ \ \ \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}}\ =\ NSplines\_valid\_temp;}
\DoxyCodeLine{00572\ \ \ \mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}}\ =\ nTF1Valid\_temp;}
\DoxyCodeLine{00573\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ event\_size\_max\ =\ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}}\ *\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}};}
\DoxyCodeLine{00574\ \ \ \mbox{\hyperlink{classSMonolith_a403e7cf909f98d4c59b5f6c7ff8aac5b}{nTF1coeff}}\ =\ nTF1coeff\_temp;}
\DoxyCodeLine{00575\ }
\DoxyCodeLine{00576\ \ \ \textcolor{comment}{//KS:\ Since\ we\ are\ going\ to\ copy\ it\ each\ step\ use\ fancy\ CUDA\ memory\ allocation}}
\DoxyCodeLine{00577\ \textcolor{preprocessor}{\#ifdef\ CUDA}}
\DoxyCodeLine{00578\ \ \ \mbox{\hyperlink{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}{gpu\_spline\_handler}}-\/>\mbox{\hyperlink{classSMonolithGPU_ab674ec40c136d89b56b7c25d9337c48a}{InitGPU\_Segments}}(\&\mbox{\hyperlink{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}{segments}});}
\DoxyCodeLine{00579\ \ \ \mbox{\hyperlink{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}{gpu\_spline\_handler}}-\/>\mbox{\hyperlink{classSMonolithGPU_a3fbbb94f6db65b73a394ab541f94fba6}{InitGPU\_Vals}}(\&\mbox{\hyperlink{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}{vals}});}
\DoxyCodeLine{00580\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00581\ \ \ \mbox{\hyperlink{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}{segments}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{short}\ \textcolor{keywordtype}{int}[\mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}}]();}
\DoxyCodeLine{00582\ \ \ \mbox{\hyperlink{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}{vals}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}}]();}
\DoxyCodeLine{00583\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00584\ }
\DoxyCodeLine{00585\ \ \ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}}.resize(2*\mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}});}
\DoxyCodeLine{00586\ \ \ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}}.resize(2*\mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}});}
\DoxyCodeLine{00587\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_af24b409ab3da1a88e855e1a9d172741f}{paramNo\_arr}}.resize(\mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}});}
\DoxyCodeLine{00588\ \ \ \textcolor{comment}{//KS:\ And\ array\ which\ tells\ where\ each\ spline\ stars\ in\ a\ big\ monolith\ array,\ sort\ of\ knot\ map}}
\DoxyCodeLine{00589\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a398e0212915793852137384a3406b37f}{nKnots\_arr}}.resize(\mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}});}
\DoxyCodeLine{00590\ }
\DoxyCodeLine{00591\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a67c5585ae47fc8a646dfae3fe9690775}{coeff\_many}}.resize(\mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{nKnots}}*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}});\ \textcolor{comment}{//\ *4\ because\ we\ store\ y,b,c,d\ parameters\ in\ this\ array}}
\DoxyCodeLine{00592\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a47012ee423ea21f99d06eff8257cf0f0}{coeff\_x}}.resize(event\_size\_max);}
\DoxyCodeLine{00593\ }
\DoxyCodeLine{00594\ \ \ \mbox{\hyperlink{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}{cpu\_coeff\_TF1\_many}}.resize(\mbox{\hyperlink{classSMonolith_a403e7cf909f98d4c59b5f6c7ff8aac5b}{nTF1coeff}});}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00596\ \ \ \textcolor{comment}{//KS:\ This\ is\ tricky\ as\ this\ variable\ use\ both\ by\ CPU\ and\ GPU,\ however\ if\ use\ CUDA\ we\ use\ cudaMallocHost}}
\DoxyCodeLine{00597\ \textcolor{preprocessor}{\#ifndef\ CUDA}}
\DoxyCodeLine{00598\ \ \ \mbox{\hyperlink{classSMonolith_ab572dd7e0a46caf44eb925a89cbfb0cf}{cpu\_total\_weights}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}}]();}
\DoxyCodeLine{00599\ \ \ \mbox{\hyperlink{classSMonolith_ab6a29f13d8e6efb380f2b9d59cfa88fc}{cpu\_weights\_var}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}}]();}
\DoxyCodeLine{00600\ \ \ \mbox{\hyperlink{classSMonolith_a4a1d45d273cc40cb4f684400812dcb60}{cpu\_weights\_tf1\_var}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}}]();}
\DoxyCodeLine{00601\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00603\ \ \ \textcolor{keywordtype}{float}\ coeff\ =\ 0.;}
\DoxyCodeLine{00604\ \ \ Monolith-\/>SetBranchAddress(\textcolor{stringliteral}{"{}cpu\_coeff\_many"{}},\ \&coeff);}
\DoxyCodeLine{00605\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{nKnots}}*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}};\ i++)}
\DoxyCodeLine{00606\ \ \ \{}
\DoxyCodeLine{00607\ \ \ \ \ Monolith-\/>GetEntry(i);}
\DoxyCodeLine{00608\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a67c5585ae47fc8a646dfae3fe9690775}{coeff\_many}}[i]\ =\ coeff;}
\DoxyCodeLine{00609\ \ \ \}}
\DoxyCodeLine{00610\ }
\DoxyCodeLine{00611\ \ \ \textcolor{keywordtype}{float}\ coeff\_tf1\ =\ 0.;}
\DoxyCodeLine{00612\ \ \ Monolith\_TF1-\/>SetBranchAddress(\textcolor{stringliteral}{"{}cpu\_coeff\_TF1\_many"{}},\ \&coeff\_tf1);}
\DoxyCodeLine{00613\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classSMonolith_a403e7cf909f98d4c59b5f6c7ff8aac5b}{nTF1coeff}};\ i++)}
\DoxyCodeLine{00614\ \ \ \{}
\DoxyCodeLine{00615\ \ \ \ \ Monolith\_TF1-\/>GetEntry(i);}
\DoxyCodeLine{00616\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}{cpu\_coeff\_TF1\_many}}[i]\ =\ coeff\_tf1;}
\DoxyCodeLine{00617\ \ \ \}}
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00619\ \ \ \textcolor{keywordtype}{short}\ \textcolor{keywordtype}{int}\ paramNo\_arr\ =\ 0;}
\DoxyCodeLine{00620\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nKnots\_arr\ =\ 0;}
\DoxyCodeLine{00621\ \ \ ParamInfo-\/>SetBranchAddress(\textcolor{stringliteral}{"{}cpu\_paramNo\_arr"{}},\ \&paramNo\_arr);}
\DoxyCodeLine{00622\ \ \ ParamInfo-\/>SetBranchAddress(\textcolor{stringliteral}{"{}cpu\_nKnots\_arr"{}},\ \&nKnots\_arr);}
\DoxyCodeLine{00623\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}};\ i++)}
\DoxyCodeLine{00624\ \ \ \{}
\DoxyCodeLine{00625\ \ \ \ \ ParamInfo-\/>GetEntry(i);}
\DoxyCodeLine{00626\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_af24b409ab3da1a88e855e1a9d172741f}{paramNo\_arr}}[i]\ =\ paramNo\_arr;}
\DoxyCodeLine{00627\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a398e0212915793852137384a3406b37f}{nKnots\_arr}}[i]\ =\ nKnots\_arr;}
\DoxyCodeLine{00628\ \ \ \}}
\DoxyCodeLine{00629\ }
\DoxyCodeLine{00630\ \ \ \textcolor{keywordtype}{float}\ coeff\_x\ =\ 0.;}
\DoxyCodeLine{00631\ \ \ XKnots-\/>SetBranchAddress(\textcolor{stringliteral}{"{}cpu\_coeff\_x"{}},\ \&coeff\_x);}
\DoxyCodeLine{00632\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ event\_size\_max;\ i++)}
\DoxyCodeLine{00633\ \ \ \{}
\DoxyCodeLine{00634\ \ \ \ \ XKnots-\/>GetEntry(i);}
\DoxyCodeLine{00635\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a47012ee423ea21f99d06eff8257cf0f0}{coeff\_x}}[i]\ =\ coeff\_x;}
\DoxyCodeLine{00636\ \ \ \}}
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00638\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nParamPerEvent\ =\ 0;}
\DoxyCodeLine{00639\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nParamPerEvent\_tf1\ =\ 0;}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00641\ \ \ EventInfo-\/>SetBranchAddress(\textcolor{stringliteral}{"{}cpu\_nParamPerEvent"{}},\ \&nParamPerEvent);}
\DoxyCodeLine{00642\ \ \ EventInfo-\/>SetBranchAddress(\textcolor{stringliteral}{"{}cpu\_nParamPerEvent\_tf1"{}},\ \&nParamPerEvent\_tf1);}
\DoxyCodeLine{00643\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 2*\mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}};\ i++)}
\DoxyCodeLine{00644\ \ \ \{}
\DoxyCodeLine{00645\ \ \ \ \ EventInfo-\/>GetEntry(i);}
\DoxyCodeLine{00646\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}}[i]\ =\ nParamPerEvent;}
\DoxyCodeLine{00647\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}}[i]\ =\ nParamPerEvent\_tf1;}
\DoxyCodeLine{00648\ \ \ \}}
\DoxyCodeLine{00649\ }
\DoxyCodeLine{00650\ \ \ \mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ nPoints\ =\ 0;}
\DoxyCodeLine{00651\ \ \ \textcolor{keywordtype}{float}\ xtemp[20];}
\DoxyCodeLine{00652\ \ \ FastSplineInfoTree-\/>SetBranchAddress(\textcolor{stringliteral}{"{}nPts"{}},\ \&nPoints);}
\DoxyCodeLine{00653\ \ \ FastSplineInfoTree-\/>SetBranchAddress(\textcolor{stringliteral}{"{}xPts"{}},\ \&xtemp);}
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00655\ \ \ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{structFastSplineInfo}{FastSplineInfo}}[\mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}}];}
\DoxyCodeLine{00656\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}};\ ++i)\ \{}
\DoxyCodeLine{00657\ \ \ \ \ FastSplineInfoTree-\/>GetEntry(i);}
\DoxyCodeLine{00658\ }
\DoxyCodeLine{00659\ \ \ \ \ \textcolor{comment}{//\ Fill\ the\ number\ of\ points}}
\DoxyCodeLine{00660\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{structFastSplineInfo_ac8538a8e3438ae06d8f467cc0fd5ce0d}{nPts}}\ =\ nPoints;}
\DoxyCodeLine{00661\ \ \ \ \ \textcolor{keywordflow}{if}(nPoints\ ==\ -\/999)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00662\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{structFastSplineInfo_a9e9d432eb250bba227d31022ac9c5779}{xPts}}\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespaceM3_a1f95274549f25fc19fe7db343c8a7a68}{M3::float\_t}}[\mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{structFastSplineInfo_ac8538a8e3438ae06d8f467cc0fd5ce0d}{nPts}}];}
\DoxyCodeLine{00663\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ k\ =\ 0;\ k\ <\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{structFastSplineInfo_ac8538a8e3438ae06d8f467cc0fd5ce0d}{nPts}};\ ++k)}
\DoxyCodeLine{00664\ \ \ \ \ \{}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{structFastSplineInfo_a9e9d432eb250bba227d31022ac9c5779}{xPts}}[k]\ =\ xtemp[k];}
\DoxyCodeLine{00666\ \ \ \ \ \}}
\DoxyCodeLine{00667\ \ \ \}}
\DoxyCodeLine{00668\ }
\DoxyCodeLine{00669\ \ \ SplineFile-\/>Close();}
\DoxyCodeLine{00670\ \ \ \textcolor{keyword}{delete}\ SplineFile;}
\DoxyCodeLine{00671\ }
\DoxyCodeLine{00672\ \ \ \textcolor{comment}{//\ Print\ some\ info;\ could\ probably\ make\ this\ to\ a\ separate\ function}}
\DoxyCodeLine{00673\ \ \ \mbox{\hyperlink{classSMonolith_a5c374d4505de53ad68d176a5644568e6}{PrintInitialsiation}}();}
\DoxyCodeLine{00674\ }
\DoxyCodeLine{00675\ \ \ \mbox{\hyperlink{classSMonolith_aac73a1089592c5f22755b7427869827f}{MoveToGPU}}();}
\DoxyCodeLine{00676\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_ac37ee525aa57316f652433a4e393afaf}\label{classSMonolith_ac37ee525aa57316f652433a4e393afaf}} 
\index{SMonolith@{SMonolith}!ModifyWeights@{ModifyWeights}}
\index{ModifyWeights@{ModifyWeights}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{ModifyWeights()}{ModifyWeights()}}
{\footnotesize\ttfamily void SMonolith\+::\+Modify\+Weights (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [private]}, {\ttfamily [virtual]}}



Calc total event weight. 



Implements \mbox{\hyperlink{classSplineBase_a49665d2712b61b038085d25ace96a568}{Spline\+Base}}.



Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l01116}{1116}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01117\ \textcolor{comment}{//*********************************************************}}
\DoxyCodeLine{01118\ \textcolor{preprocessor}{\#ifndef\ Weight\_On\_SplineBySpline\_Basis}}
\DoxyCodeLine{01119\ \textcolor{preprocessor}{\ \ \#ifdef\ MULTITHREAD}}
\DoxyCodeLine{01120\ \textcolor{preprocessor}{\ \ \#pragma\ omp\ parallel\ for}}
\DoxyCodeLine{01121\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{01122\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ EventNum\ =\ 0;\ EventNum\ <\ \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}};\ ++EventNum)}
\DoxyCodeLine{01123\ \ \ \{}
\DoxyCodeLine{01124\ \ \ \ \ \textcolor{keywordtype}{float}\ totalWeight\ =\ 1.0f;\ \textcolor{comment}{//\ Initialize\ total\ weight\ for\ each\ event}}
\DoxyCodeLine{01125\ }
\DoxyCodeLine{01126\ \ \ \ \ \textcolor{comment}{//\ Extract\ the\ parameters\ for\ the\ current\ event}}
\DoxyCodeLine{01127\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ startIndex\ =\ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}}[2\ *\ EventNum\ +\ 1];}
\DoxyCodeLine{01128\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ numParams\ =\ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}}[2\ *\ EventNum];}
\DoxyCodeLine{01129\ }
\DoxyCodeLine{01130\ \ \ \ \ \textcolor{comment}{//\ Compute\ total\ weight\ for\ the\ current\ event}}
\DoxyCodeLine{01131\ \textcolor{preprocessor}{\ \ \ \ \#ifdef\ MULTITHREAD}}
\DoxyCodeLine{01132\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ omp\ simd}}
\DoxyCodeLine{01133\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{01134\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id}\ =\ 0;\ \textcolor{keywordtype}{id}\ <\ numParams;\ ++id)\ \{}
\DoxyCodeLine{01135\ \ \ \ \ \ \ totalWeight\ *=\ \mbox{\hyperlink{classSMonolith_ab6a29f13d8e6efb380f2b9d59cfa88fc}{cpu\_weights\_var}}[startIndex\ +\ id];}
\DoxyCodeLine{01136\ \ \ \ \ \}}
\DoxyCodeLine{01137\ \ \ \ \ \textcolor{comment}{//Now\ TF1}}
\DoxyCodeLine{01138\ \ \ \ \ \textcolor{comment}{//\ Extract\ the\ parameters\ for\ the\ current\ event}}
\DoxyCodeLine{01139\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ startIndex\_tf1\ =\ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}}[2\ *\ EventNum\ +\ 1];}
\DoxyCodeLine{01140\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ numParams\_tf1\ =\ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}}[2\ *\ EventNum];}
\DoxyCodeLine{01141\ }
\DoxyCodeLine{01142\ \ \ \ \ \textcolor{comment}{//\ Compute\ total\ weight\ for\ the\ current\ event}}
\DoxyCodeLine{01143\ \textcolor{preprocessor}{\ \ \ \ \#ifdef\ MULTITHREAD}}
\DoxyCodeLine{01144\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ omp\ simd}}
\DoxyCodeLine{01145\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{01146\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id}\ =\ 0;\ \textcolor{keywordtype}{id}\ <\ numParams\_tf1;\ ++id)\ \{}
\DoxyCodeLine{01147\ \ \ \ \ \ \ totalWeight\ *=\ \mbox{\hyperlink{classSMonolith_a4a1d45d273cc40cb4f684400812dcb60}{cpu\_weights\_tf1\_var}}[startIndex\_tf1\ +\ id];}
\DoxyCodeLine{01148\ \ \ \ \ \}}
\DoxyCodeLine{01149\ }
\DoxyCodeLine{01150\ \ \ \ \ \textcolor{comment}{//\ Store\ the\ total\ weight\ for\ the\ current\ event}}
\DoxyCodeLine{01151\ \ \ \ \ \mbox{\hyperlink{classSMonolith_ab572dd7e0a46caf44eb925a89cbfb0cf}{cpu\_total\_weights}}[EventNum]\ =\ totalWeight;}
\DoxyCodeLine{01152\ \ \ \}}
\DoxyCodeLine{01153\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01154\ \ \ \textcolor{comment}{//KS:\ Name\ is\ confusing\ but\ what\ it\ does\ it\ make\ a\ nice\ mapping\ used\ for\ debugging}}
\DoxyCodeLine{01155\ \ \ \mbox{\hyperlink{classSMonolith_a72cd282322bdaadb23d8a376efa9e2c1}{ModifyWeights\_GPU}}();}
\DoxyCodeLine{01156\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01157\ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01158\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_a72cd282322bdaadb23d8a376efa9e2c1}\label{classSMonolith_a72cd282322bdaadb23d8a376efa9e2c1}} 
\index{SMonolith@{SMonolith}!ModifyWeights\_GPU@{ModifyWeights\_GPU}}
\index{ModifyWeights\_GPU@{ModifyWeights\_GPU}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{ModifyWeights\_GPU()}{ModifyWeights\_GPU()}}
{\footnotesize\ttfamily void SMonolith\+::\+Modify\+Weights\+\_\+\+GPU (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}



Conversion from valid splines to all. 



Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l01162}{1162}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01163\ \textcolor{comment}{//*********************************************************}}
\DoxyCodeLine{01164\ \textcolor{preprocessor}{\#ifdef\ Weight\_On\_SplineBySpline\_Basis}}
\DoxyCodeLine{01165\ \ \ \textcolor{comment}{//\ Multi-\/thread\ here\ because\ \_numIndex\ is\ really\ quite\ large!}}
\DoxyCodeLine{01166\ \textcolor{preprocessor}{\ \ \#ifdef\ MULTITHREAD}}
\DoxyCodeLine{01167\ \textcolor{preprocessor}{\ \ \#pragma\ omp\ parallel\ for}}
\DoxyCodeLine{01168\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{01169\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classSMonolith_aee3c18513f8209f1ac940b492cd3ed68}{NSplines\_total\_large}};\ ++i)\ \{}
\DoxyCodeLine{01170\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classSMonolith_ae9fa50f60f717558f517faea6a38d251}{index\_cpu}}[i]\ >=\ 0)\ \{}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a8614e8ef07431d99f62ab88d9ebdad16}{cpu\_weights}}[i]\ =\ \mbox{\hyperlink{classSMonolith_ab6a29f13d8e6efb380f2b9d59cfa88fc}{cpu\_weights\_var}}[\mbox{\hyperlink{classSMonolith_ae9fa50f60f717558f517faea6a38d251}{index\_cpu}}[i]];}
\DoxyCodeLine{01172\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classSMonolith_a1aa70cce5867e7e784e97eacebe6bfbd}{index\_TF1\_cpu}}[i]\ >=\ 0)\ \{}
\DoxyCodeLine{01173\ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a8614e8ef07431d99f62ab88d9ebdad16}{cpu\_weights}}[i]\ =\ \mbox{\hyperlink{classSMonolith_a4a1d45d273cc40cb4f684400812dcb60}{cpu\_weights\_tf1\_var}}[\mbox{\hyperlink{classSMonolith_a1aa70cce5867e7e784e97eacebe6bfbd}{index\_TF1\_cpu}}[i]];}
\DoxyCodeLine{01174\ \ \ \ \ \}\ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01175\ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a8614e8ef07431d99f62ab88d9ebdad16}{cpu\_weights}}[i]\ =\ 1.;}
\DoxyCodeLine{01176\ \ \ \ \ \}}
\DoxyCodeLine{01177\ \ \ \}}
\DoxyCodeLine{01178\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01179\ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01180\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_aac73a1089592c5f22755b7427869827f}\label{classSMonolith_aac73a1089592c5f22755b7427869827f}} 
\index{SMonolith@{SMonolith}!MoveToGPU@{MoveToGPU}}
\index{MoveToGPU@{MoveToGPU}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{MoveToGPU()}{MoveToGPU()}}
{\footnotesize\ttfamily void SMonolith\+::\+Move\+To\+GPU (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}



CW\+: The shared initialiser from constructors of \mbox{\hyperlink{classTResponseFunction__red}{TResponse\+Function\+\_\+red}}. 



Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l00314}{314}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00315\ \textcolor{comment}{//\ *****************************************}}
\DoxyCodeLine{00316\ \textcolor{preprocessor}{\ \ \#ifdef\ CUDA}}
\DoxyCodeLine{00317\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ event\_size\_max\ =\ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}}\ *\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}};}
\DoxyCodeLine{00318\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Total\ size\ =\ \{:.2f\}\ MB\ memory\ on\ CPU\ to\ move\ to\ GPU"{}},}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{double}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})\ *\ \mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{nKnots}}\ *\ \mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}})\ +\ \textcolor{keywordtype}{double}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})\ *\ event\_size\_max)\ /\ 1.E6\ +}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{short}\ \textcolor{keywordtype}{int})\ *\ \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}}))\ /\ 1.E6);}
\DoxyCodeLine{00321\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Total\ TF1\ size\ =\ \{:.2f\}\ MB\ memory\ on\ CPU\ to\ move\ to\ GPU"{}},}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})\ *\ \mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}}\ *\ \mbox{\hyperlink{SplineCommon_8h_a911160077ffa38727e0494f178ce380a}{\_nTF1Coeff\_}})\ /\ 1.E6);}
\DoxyCodeLine{00323\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}GPU\ weight\ array\ (GPU-\/>CPU\ every\ step)\ =\ \{:.2f\}\ MB"{}},\ \textcolor{keywordtype}{double}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})\ *\ (\mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}}\ +\ \mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}})\ /\ 1.E6));}
\DoxyCodeLine{00324\ \textcolor{preprocessor}{\ \ \#ifndef\ Weight\_On\_SplineBySpline\_Basis}}
\DoxyCodeLine{00325\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Since\ you\ are\ running\ Total\ event\ weight\ mode\ then\ GPU\ weight\ array\ (GPU-\/>CPU\ every\ step)\ =\ \{:.2f\}\ MB"{}},}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})\ *\ \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}})\ /\ 1.E6);}
\DoxyCodeLine{00327\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00328\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Parameter\ value\ array\ (CPU-\/>GPU\ every\ step)\ =\ \{:.4f\}\ MB"{}},\ \textcolor{keywordtype}{double}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})\ *\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}})\ /\ 1.E6);}
\DoxyCodeLine{00329\ \ \ \textcolor{comment}{//CW:\ With\ the\ new\ set-\/up\ we\ have:\ \ \ 1\ coefficient\ array\ of\ size\ coeff\_array\_size,\ all\ same\ size}}
\DoxyCodeLine{00330\ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1\ coefficient\ array\ of\ size\ coeff\_array\_size*4,\ holding\ y,b,c,d\ in\ order\ (y11,b11,c11,d11;\ y12,b12,c12,d12;...)\ where\ ynm\ is\ n\ =\ spline\ number,\ m\ =\ spline\ point.\ Should\ really\ make\ array\ so\ that\ order\ is\ (y11,b11,c11,d11;\ y21,b21,c21,d21;...)\ because\ it\ will\ optimise\ cache\ hits\ I\ think;\ try\ this\ if\ you\ have\ time}}
\DoxyCodeLine{00331\ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ return\ gpu\_weights}}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \mbox{\hyperlink{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}{gpu\_spline\_handler}}\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classSMonolithGPU}{SMonolithGPU}}();}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ \textcolor{comment}{//\ The\ gpu\_XY\ arrays\ don't\ actually\ need\ initialising,\ since\ they\ are\ only\ placeholders\ for\ what\ we'll\ move\ onto\ the\ GPU.\ As\ long\ as\ we\ cudaMalloc\ the\ size\ of\ the\ arrays\ correctly\ there\ shouldn't\ be\ any\ problems}}
\DoxyCodeLine{00336\ \ \ \textcolor{comment}{//\ Can\ probably\ make\ this\ a\ bit\ prettier\ but\ will\ do\ for\ now}}
\DoxyCodeLine{00337\ \ \ \textcolor{comment}{//\ Could\ be\ a\ lot\ smaller\ of\ a\ function...}}
\DoxyCodeLine{00338\ \ \ \mbox{\hyperlink{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}{gpu\_spline\_handler}}-\/>\mbox{\hyperlink{classSMonolithGPU_a713a47fd41a93d2b6d40c4b392158aae}{InitGPU\_SplineMonolith}}(}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \#ifndef\ Weight\_On\_SplineBySpline\_Basis}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \ \ \&\mbox{\hyperlink{classSMonolith_ab572dd7e0a46caf44eb925a89cbfb0cf}{cpu\_total\_weights}},}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}},}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{nKnots}},\ \textcolor{comment}{//\ How\ many\ entries\ in\ coefficient\ array\ (*4\ for\ the\ "{}many"{}\ array)}}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}},\ \textcolor{comment}{//\ What's\ the\ number\ of\ splines\ we\ have\ (also\ number\ of\ entries\ in\ gpu\_nPoints\_arr)}}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}},}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ event\_size\_max\ \textcolor{comment}{//Knots\ times\ event\ number\ of\ unique\ splines}}
\DoxyCodeLine{00347\ \ \ );}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ \ \ \textcolor{comment}{//\ Move\ number\ of\ splines\ and\ spline\ size\ to\ constant\ GPU\ memory;\ every\ thread\ does\ not\ need\ a\ copy...}}
\DoxyCodeLine{00350\ \ \ \textcolor{comment}{//\ The\ implementation\ lives\ in\ splines/gpuSplineUtils.cu}}
\DoxyCodeLine{00351\ \ \ \textcolor{comment}{//\ The\ GPU\ splines\ don't\ actually\ need\ declaring\ but\ is\ good\ for\ demonstration,\ kind\ of}}
\DoxyCodeLine{00352\ \ \ \textcolor{comment}{//\ fixed\ by\ passing\ const\ reference}}
\DoxyCodeLine{00353\ \ \ \mbox{\hyperlink{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}{gpu\_spline\_handler}}-\/>\mbox{\hyperlink{classSMonolithGPU_aef41d94cf5e44ebf4fe427c3ce84f20b}{CopyToGPU\_SplineMonolith}}(}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}},}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TFI\ related\ now}}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}{cpu\_coeff\_TF1\_many}},}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_af87cf7ae888eb7d4c56f8b6c41c9fd02}{cpu\_paramNo\_TF1\_arr}},}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \ \ \#ifndef\ Weight\_On\_SplineBySpline\_Basis}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}},}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}},}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}},}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \#endif}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}},}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}},}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}},}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{nKnots}},}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}});}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \textcolor{comment}{//\ Delete\ all\ the\ coefficient\ arrays\ from\ the\ CPU\ once\ they\ are\ on\ the\ GPU}}
\DoxyCodeLine{00371\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a47012ee423ea21f99d06eff8257cf0f0}{coeff\_x}}.clear();}
\DoxyCodeLine{00372\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a47012ee423ea21f99d06eff8257cf0f0}{coeff\_x}}.shrink\_to\_fit();}
\DoxyCodeLine{00373\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a67c5585ae47fc8a646dfae3fe9690775}{coeff\_many}}.clear();}
\DoxyCodeLine{00374\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a67c5585ae47fc8a646dfae3fe9690775}{coeff\_many}}.shrink\_to\_fit();}
\DoxyCodeLine{00375\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_af24b409ab3da1a88e855e1a9d172741f}{paramNo\_arr}}.clear();}
\DoxyCodeLine{00376\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_af24b409ab3da1a88e855e1a9d172741f}{paramNo\_arr}}.shrink\_to\_fit();}
\DoxyCodeLine{00377\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a398e0212915793852137384a3406b37f}{nKnots\_arr}}.clear();}
\DoxyCodeLine{00378\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a398e0212915793852137384a3406b37f}{nKnots\_arr}}.shrink\_to\_fit();}
\DoxyCodeLine{00379\ \ \ \mbox{\hyperlink{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}{cpu\_coeff\_TF1\_many}}.clear();}
\DoxyCodeLine{00380\ \ \ \mbox{\hyperlink{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}{cpu\_coeff\_TF1\_many}}.shrink\_to\_fit();}
\DoxyCodeLine{00381\ \ \ \mbox{\hyperlink{classSMonolith_af87cf7ae888eb7d4c56f8b6c41c9fd02}{cpu\_paramNo\_TF1\_arr}}.clear();}
\DoxyCodeLine{00382\ \ \ \mbox{\hyperlink{classSMonolith_af87cf7ae888eb7d4c56f8b6c41c9fd02}{cpu\_paramNo\_TF1\_arr}}.shrink\_to\_fit();}
\DoxyCodeLine{00383\ \textcolor{preprocessor}{\ \ \#ifndef\ Weight\_On\_SplineBySpline\_Basis}}
\DoxyCodeLine{00384\ \ \ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}}.clear();}
\DoxyCodeLine{00385\ \ \ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}}.shrink\_to\_fit();}
\DoxyCodeLine{00386\ \ \ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}}.clear();}
\DoxyCodeLine{00387\ \ \ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}}.shrink\_to\_fit();}
\DoxyCodeLine{00388\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00389\ \ \ \textcolor{keyword}{delete}\ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}};}
\DoxyCodeLine{00390\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00391\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Good\ GPU\ loading"{}});}
\DoxyCodeLine{00392\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00393\ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00394\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_aa1bd2dc5c55b7258d5544512659ef9d7}\label{classSMonolith_aa1bd2dc5c55b7258d5544512659ef9d7}} 
\index{SMonolith@{SMonolith}!PrepareForGPU@{PrepareForGPU}}
\index{PrepareForGPU@{PrepareForGPU}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{PrepareForGPU()}{PrepareForGPU()}}
{\footnotesize\ttfamily void SMonolith\+::\+Prepare\+For\+GPU (\begin{DoxyParamCaption}\item[{std\+::vector$<$ std\+::vector$<$ \mbox{\hyperlink{classTResponseFunction__red}{TResponse\+Function\+\_\+red}} $\ast$ $>$ $>$ \&}]{Master\+Spline,  }\item[{const std\+::vector$<$ \mbox{\hyperlink{Structs_8h_a6a73aa1ad819973a9c421c17c2a7f36d}{Resp\+Func\+Type}} $>$ \&}]{Spline\+Type }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}



CW\+: Prepare the \mbox{\hyperlink{classTSpline3__red}{TSpline3\+\_\+red}} objects for the GPU. 


\begin{DoxyParams}{Parameters}
{\em Master\+Spline} & Vector of \mbox{\hyperlink{classTResponseFunction__red}{TResponse\+Function\+\_\+red}} pointers which we strip back \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l00063}{63}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00064\ \textcolor{comment}{//\ *****************************************}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \textcolor{comment}{//\ Scan\ for\ the\ max\ number\ of\ knots,\ the\ number\ of\ events\ (number\ of\ splines),\ and\ number\ of\ parameters}}
\DoxyCodeLine{00067\ \ \ \textcolor{keywordtype}{int}\ maxnSplines\ =\ 0;}
\DoxyCodeLine{00068\ \ \ \mbox{\hyperlink{classSMonolith_a12cddfcbec851b468cba86dc9b223c78}{ScanMasterSpline}}(MasterSpline,}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}},}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}},}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}},}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ maxnSplines,}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}},}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{nKnots}},}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}},}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a403e7cf909f98d4c59b5f6c7ff8aac5b}{nTF1coeff}},}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ SplineType);}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Found\ \{\}\ events"{}},\ \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}});}
\DoxyCodeLine{00080\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Found\ \{\}\ knots\ at\ max"{}},\ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}});}
\DoxyCodeLine{00081\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Found\ \{\}\ parameters"{}},\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}});}
\DoxyCodeLine{00082\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Found\ \{\}\ maximum\ number\ of\ splines\ in\ an\ event"{}},\ maxnSplines);}
\DoxyCodeLine{00083\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Found\ total\ \{\}\ knots\ in\ all\ splines"{}},\ \mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{nKnots}});}
\DoxyCodeLine{00084\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Number\ of\ splines\ =\ \{\}"{}},\ \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}});}
\DoxyCodeLine{00085\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Found\ total\ \{\}\ coeffs\ in\ all\ TF1"{}},\ \mbox{\hyperlink{classSMonolith_a403e7cf909f98d4c59b5f6c7ff8aac5b}{nTF1coeff}});}
\DoxyCodeLine{00086\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Number\ of\ TF1\ =\ \{\}"{}},\ \mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}});}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//\ Can\ pass\ the\ spline\ segments\ to\ the\ GPU\ instead\ of\ the\ values}}
\DoxyCodeLine{00089\ \ \ \textcolor{comment}{//\ Make\ these\ here\ and\ only\ refill\ them\ for\ each\ loop,\ avoiding\ unnecessary\ new/delete\ on\ each\ reconfigure}}
\DoxyCodeLine{00090\ \ \ \textcolor{comment}{//KS:\ Since\ we\ are\ going\ to\ copy\ it\ each\ step\ use\ fancy\ CUDA\ memory\ allocation}}
\DoxyCodeLine{00091\ \textcolor{preprocessor}{\ \ \#ifdef\ CUDA}}
\DoxyCodeLine{00092\ \ \ \mbox{\hyperlink{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}{gpu\_spline\_handler}}-\/>\mbox{\hyperlink{classSMonolithGPU_ab674ec40c136d89b56b7c25d9337c48a}{InitGPU\_Segments}}(\&\mbox{\hyperlink{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}{segments}});}
\DoxyCodeLine{00093\ \ \ \mbox{\hyperlink{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}{gpu\_spline\_handler}}-\/>\mbox{\hyperlink{classSMonolithGPU_a3fbbb94f6db65b73a394ab541f94fba6}{InitGPU\_Vals}}(\&\mbox{\hyperlink{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}{vals}});}
\DoxyCodeLine{00094\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00095\ \ \ \mbox{\hyperlink{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}{segments}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{short}\ \textcolor{keywordtype}{int}[\mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}}]();}
\DoxyCodeLine{00096\ \ \ \mbox{\hyperlink{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}{vals}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}}]();}
\DoxyCodeLine{00097\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ j\ =\ 0;\ j\ <\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}};\ j++)}
\DoxyCodeLine{00100\ \ \ \{}
\DoxyCodeLine{00101\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}{segments}}[j]\ =\ 0;}
\DoxyCodeLine{00102\ \ \ \ \ \mbox{\hyperlink{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}{vals}}[j]\ =\ -\/999;}
\DoxyCodeLine{00103\ \ \ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \textcolor{comment}{//\ Number\ of\ objects\ we\ have\ in\ total\ if\ each\ event\ has\ *EVERY*\ spline.\ Needed\ for\ some\ arrays}}
\DoxyCodeLine{00106\ \ \ \mbox{\hyperlink{classSMonolith_aee3c18513f8209f1ac940b492cd3ed68}{NSplines\_total\_large}}\ =\ \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}}*\mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}};}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ event\_size\_max\ =\ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}}\ *\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}};}
\DoxyCodeLine{00109\ \ \ \textcolor{comment}{//\ Declare\ the\ \{x\},\ \{y,b,c,d\}\ arrays\ for\ all\ possible\ splines\ which\ the\ event\ has}}
\DoxyCodeLine{00110\ \ \ \textcolor{comment}{//\ We'll\ filter\ off\ the\ flat\ and\ "{}disabled"{}\ (e.g.\ CCQE\ event\ should\ not\ have\ MARES\ spline)\ ones\ in\ the\ next\ for\ loop,\ but\ need\ to\ declare\ these\ beasts\ here}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \textcolor{comment}{//\ Declare\ the\ \{y,b,c,d\}\ for\ each\ knot}}
\DoxyCodeLine{00113\ \ \ \textcolor{comment}{//\ float\ because\ GPU\ precision\ (could\ change\ to\ double,\ but\ will\ incur\ significant\ speed\ reduction\ on\ GPU\ unless\ you're\ very\ rich!)}}
\DoxyCodeLine{00114\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a67c5585ae47fc8a646dfae3fe9690775}{coeff\_many}}.resize(\mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{nKnots}}*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}});\ \textcolor{comment}{//\ *4\ because\ we\ store\ y,b,c,d\ parameters\ in\ this\ array}}
\DoxyCodeLine{00115\ \ \ \textcolor{comment}{//KS:\ For\ x\ coeff\ we\ assume\ that\ for\ given\ dial\ (MAQE)\ spacing\ is\ identical,\ here\ we\ are\ sloppy\ and\ assume\ each\ dial\ has\ the\ same\ number\ of\ knots,\ not\ a\ big\ problem}}
\DoxyCodeLine{00116\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a47012ee423ea21f99d06eff8257cf0f0}{coeff\_x}}.resize(event\_size\_max);}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \textcolor{comment}{//\ Set\ all\ the\ big\ arrays\ to\ -\/999\ to\ keep\ us\ safe...}}
\DoxyCodeLine{00119\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ event\_size\_max;\ j++)\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a47012ee423ea21f99d06eff8257cf0f0}{coeff\_x}}[j]\ =\ -\/999;}
\DoxyCodeLine{00121\ \ \ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \textcolor{comment}{//CW:\ With\ TF1\ we\ only\ save\ the\ coefficients\ and\ the\ order\ of\ the\ polynomial}}
\DoxyCodeLine{00124\ \ \ \textcolor{comment}{//\ Makes\ most\ sense\ to\ have\ one\ large\ monolithic\ array,\ but\ then\ it\ becomes\ impossible\ to\ tell\ apart\ a\ coefficient\ from\ a\ "{}number\ of\ points"{}.\ So\ have\ two\ arrays:\ one\ of\ coefficients\ and\ one\ of\ number\ of\ points}}
\DoxyCodeLine{00125\ \ \ \textcolor{comment}{//\ Let's\ first\ assume\ all\ are\ of\ \_max\_knots\ size}}
\DoxyCodeLine{00126\ \ \ \textcolor{comment}{//\ Now\ declare\ the\ arrays\ for\ each\ point\ in\ the\ valid\ splines\ which\ the\ event\ actually\ has\ (i.e.\ include\ the\ splines\ that\ the\ event\ undergoes)}}
\DoxyCodeLine{00127\ \ \ \textcolor{comment}{//\ Also\ make\ array\ with\ the\ number\ of\ points\ per\ spline\ (not\ per\ spline\ point!)}}
\DoxyCodeLine{00128\ \ \ \textcolor{comment}{//\ float\ because\ GPU\ precision\ (could\ change\ to\ double,\ but\ will\ incur\ significant\ speed\ reduction\ on\ GPU\ unless\ you're\ very\ rich!)}}
\DoxyCodeLine{00129\ \ \ \mbox{\hyperlink{classSMonolith_a14b9c21186a53196f49c8d8d3555fbf2}{cpu\_nPoints\_arr}}.resize(\mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}});}
\DoxyCodeLine{00130\ \ \ \mbox{\hyperlink{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}{cpu\_coeff\_TF1\_many}}.resize(\mbox{\hyperlink{classSMonolith_a403e7cf909f98d4c59b5f6c7ff8aac5b}{nTF1coeff}});\ \textcolor{comment}{//\ *5\ because\ this\ array\ holds\ \ a,b,c,d,e\ parameters}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \textcolor{preprocessor}{\ \ \#ifdef\ Weight\_On\_SplineBySpline\_Basis}}
\DoxyCodeLine{00133\ \ \ \textcolor{comment}{//\ This\ holds\ the\ index\ of\ each\ spline}}
\DoxyCodeLine{00134\ \ \ \mbox{\hyperlink{classSMonolith_ae9fa50f60f717558f517faea6a38d251}{index\_cpu}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{int}[\mbox{\hyperlink{classSMonolith_aee3c18513f8209f1ac940b492cd3ed68}{NSplines\_total\_large}}];}
\DoxyCodeLine{00135\ \ \ \mbox{\hyperlink{classSMonolith_a1aa70cce5867e7e784e97eacebe6bfbd}{index\_TF1\_cpu}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{int}[\mbox{\hyperlink{classSMonolith_aee3c18513f8209f1ac940b492cd3ed68}{NSplines\_total\_large}}];}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \textcolor{preprocessor}{\ \ \#ifdef\ MULTITHREAD}}
\DoxyCodeLine{00138\ \textcolor{preprocessor}{\ \ \#pragma\ omp\ parallel\ for}}
\DoxyCodeLine{00139\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00140\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ \mbox{\hyperlink{classSMonolith_aee3c18513f8209f1ac940b492cd3ed68}{NSplines\_total\_large}};\ j++)\ \{}
\DoxyCodeLine{00141\ \ \ \ \ \mbox{\hyperlink{classSMonolith_ae9fa50f60f717558f517faea6a38d251}{index\_cpu}}[j]\ =\ -\/1;}
\DoxyCodeLine{00142\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a1aa70cce5867e7e784e97eacebe6bfbd}{index\_TF1\_cpu}}[j]\ =\ -\/1;}
\DoxyCodeLine{00143\ \ \ \}}
\DoxyCodeLine{00144\ \ \ \textcolor{comment}{//\ This\ holds\ the\ total\ CPU\ weights\ that\ gets\ read\ in\ samplePDFND}}
\DoxyCodeLine{00145\ \ \ \mbox{\hyperlink{classSMonolith_a8614e8ef07431d99f62ab88d9ebdad16}{cpu\_weights}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{classSMonolith_aee3c18513f8209f1ac940b492cd3ed68}{NSplines\_total\_large}}];}
\DoxyCodeLine{00146\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00147\ \ \ \textcolor{comment}{//KS:\ Map\ keeping\ track\ how\ many\ parameters\ applies\ to\ each\ event,\ we\ keep\ two\ numbers\ here\ \{number\ of\ splines\ per\ event,\ index\ where\ splines\ start\ for\ a\ given\ event\}}}
\DoxyCodeLine{00148\ \ \ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}}.resize(2*\mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}});}
\DoxyCodeLine{00149\ \ \ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}}.resize(2*\mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}});}
\DoxyCodeLine{00150\ \textcolor{preprocessor}{\ \ \#ifdef\ MULTITHREAD}}
\DoxyCodeLine{00151\ \textcolor{preprocessor}{\ \ \#pragma\ omp\ parallel\ for}}
\DoxyCodeLine{00152\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00153\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ 2*\mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}};\ j++)\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}}[j]\ =\ -\/1;}
\DoxyCodeLine{00155\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}}[j]\ =\ -\/1;}
\DoxyCodeLine{00156\ \ \ \}}
\DoxyCodeLine{00157\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \textcolor{comment}{//\ Make\ array\ with\ the\ number\ of\ points\ per\ spline\ (not\ per\ spline\ point!)}}
\DoxyCodeLine{00160\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_af24b409ab3da1a88e855e1a9d172741f}{paramNo\_arr}}.resize(\mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}});}
\DoxyCodeLine{00161\ \ \ \textcolor{comment}{//KS:\ And\ array\ which\ tells\ where\ each\ spline\ stars\ in\ a\ big\ monolith\ array,\ sort\ of\ knot\ map}}
\DoxyCodeLine{00162\ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a398e0212915793852137384a3406b37f}{nKnots\_arr}}.resize(\mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}});}
\DoxyCodeLine{00163\ \ \ \mbox{\hyperlink{classSMonolith_af87cf7ae888eb7d4c56f8b6c41c9fd02}{cpu\_paramNo\_TF1\_arr}}.resize(\mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}});}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \textcolor{comment}{//\ Temporary\ arrays\ to\ hold\ the\ coefficients\ for\ each\ spline}}
\DoxyCodeLine{00166\ \ \ \textcolor{comment}{//\ We\ get\ one\ x,\ one\ y,\ one\ b,...\ for\ each\ point,\ so\ only\ need\ to\ be\ \_max\_knots\ big}}
\DoxyCodeLine{00167\ \ \ \textcolor{comment}{//KS:\ Some\ params\ has\ less\ splines\ but\ this\ is\ all\ right\ main\ array\ will\ get\ proper\ number\ while\ this\ temp\ will\ be\ deleted}}
\DoxyCodeLine{00168\ \ \ \textcolor{keywordtype}{float}\ *x\_tmp\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}}]();}
\DoxyCodeLine{00169\ \ \ \textcolor{keywordtype}{float}\ *many\_tmp\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}}*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}]();}
\DoxyCodeLine{00170\ \ \ \textcolor{keywordtype}{float}\ *temp\_coeffs\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{SplineCommon_8h_a911160077ffa38727e0494f178ce380a}{\_nTF1Coeff\_}}]();}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \textcolor{comment}{//\ Count\ the\ number\ of\ events}}
\DoxyCodeLine{00173\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ KnotCounter\ =\ 0;}
\DoxyCodeLine{00174\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ TF1PointsCounter\ =\ 0;}
\DoxyCodeLine{00175\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ NSplinesCounter\ =\ 0;}
\DoxyCodeLine{00176\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ TF1sCounter\ =\ 0;}
\DoxyCodeLine{00177\ \ \ \textcolor{keywordtype}{int}\ ParamCounter\ =\ 0;}
\DoxyCodeLine{00178\ \ \ \textcolor{keywordtype}{int}\ ParamCounterGlobal\ =\ 0;}
\DoxyCodeLine{00179\ \ \ \textcolor{keywordtype}{int}\ ParamCounter\_TF1\ =\ 0;}
\DoxyCodeLine{00180\ \ \ \textcolor{keywordtype}{int}\ ParamCounterGlobalTF1\ =\ 0;}
\DoxyCodeLine{00181\ \ \ \textcolor{comment}{//\ Loop\ over\ events\ and\ extract\ the\ spline\ coefficients}}
\DoxyCodeLine{00182\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ EventCounter\ =\ 0;\ EventCounter\ <\ MasterSpline.size();\ ++EventCounter)\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{comment}{//\ Structure\ of\ MasterSpline\ is\ std::vector<std::vector<TSpline3*>>}}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{comment}{//\ A\ conventional\ iterator\ to\ count\ which\ parameter\ a\ given\ spline\ should\ be\ applied\ to}}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ ParamNumber\ =\ 0;\ ParamNumber\ <\ MasterSpline[EventCounter].size();\ ++ParamNumber)\ \{}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ NULL\ we\ don't\ have\ this\ spline\ for\ the\ event,\ so\ move\ to\ next\ spline}}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (MasterSpline[EventCounter][ParamNumber]\ ==\ NULL)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(SplineType[ParamNumber]\ ==\ \mbox{\hyperlink{Structs_8h_a6a73aa1ad819973a9c421c17c2a7f36da8bea6994e011cc85a5a88b50c97ce7b2}{kTSpline3\_red}})}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \textcolor{comment}{//KS:\ how\ much\ knots\ each\ spline\ has}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nPoints\_tmp\ =\ 0;}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ a\ pointer\ to\ the\ current\ spline\ for\ this\ event}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTResponseFunction__red}{TResponseFunction\_red}}*\ TespFunc\ =\ MasterSpline[EventCounter][ParamNumber];}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTSpline3__red}{TSpline3\_red}}*\ CurrSpline\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classTSpline3__red}{TSpline3\_red}}*\textcolor{keyword}{>}(TespFunc);}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ number\ of\ knots\ are\ greater\ than\ 2\ the\ spline\ is\ not\ a\ dummy\ and\ we\ should\ extract\ coefficients\ to\ load\ onto\ the\ GPU}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_acbbe3398718d0d02d65a1e92a91c112c}{getSplineCoeff\_SepMany}}(CurrSpline,\ nPoints\_tmp,\ x\_tmp,\ many\_tmp);}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{comment}{//KS:\ One\ knot\ means\ flat\ spline\ so\ ignore}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nPoints\_tmp\ ==\ 1)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}};\ ++j)\ \{}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a47012ee423ea21f99d06eff8257cf0f0}{coeff\_x}}[ParamNumber*\mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}}\ +\ j]\ =\ x\_tmp[j];}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \textcolor{comment}{//KS:\ Contrary\ to\ X\ coeff\ we\ keep\ for\ other\ coeff\ only\ filled\ knots,\ there\ is\ no\ much\ gain\ for\ doing\ so\ for\ x\ coeff}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ nPoints\_tmp;\ ++j)\ \{}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ \mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}};\ k++)\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a67c5585ae47fc8a646dfae3fe9690775}{coeff\_many}}[KnotCounter*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}\ +\ j*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}\ +\ k]\ =\ many\_tmp[j*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}}+k];}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ parameter\ number\ for\ this\ spline}}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_af24b409ab3da1a88e855e1a9d172741f}{paramNo\_arr}}[NSplinesCounter]\ =\ short(ParamNumber);}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \textcolor{comment}{//KS:\ Fill\ map\ when\ each\ spline\ starts}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a398e0212915793852137384a3406b37f}{nKnots\_arr}}[NSplinesCounter]\ =\ KnotCounter;}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ KnotCounter\ +=\ nPoints\_tmp;}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#ifdef\ Weight\_On\_SplineBySpline\_Basis}}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ index\ of\ the\ spline\ so\ we\ can\ tell\ apart\ from\ flat\ splines}}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_ae9fa50f60f717558f517faea6a38d251}{index\_cpu}}[EventCounter*\mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}}\ +\ ParamNumber]\ =\ NSplinesCounter;}
\DoxyCodeLine{00221\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#else}}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ ++ParamCounter;}
\DoxyCodeLine{00223\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Increment\ the\ counter\ for\ the\ number\ of\ good\ splines\ we\ have}}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ ++NSplinesCounter;}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (SplineType[ParamNumber]\ ==\ \mbox{\hyperlink{Structs_8h_a6a73aa1ad819973a9c421c17c2a7f36da847a18b0a859ce2b3b87a98f455855b1}{kTF1\_red}})}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Don't\ actually\ use\ this\ ever\ -\/-\/\ we\ give\ each\ spline\ the\ maximum\ number\ of\ points\ found\ in\ all\ splines}}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nPoints\_tmp\ =\ 0;}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ a\ pointer\ to\ the\ current\ spline\ for\ this\ event}}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTF1__red}{TF1\_red}}*\ CurrSpline\ =\ \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classTF1__red}{TF1\_red}}*\textcolor{keyword}{>}(MasterSpline[EventCounter][ParamNumber]);}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ number\ of\ knots\ are\ greater\ than\ 2\ the\ spline\ is\ not\ a\ dummy\ and\ we\ should\ extract\ coefficients\ to\ load\ onto\ the\ GPU}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSplineBase_ac8a5f86ac6f156a7e11ef188b06f425f}{getTF1Coeff}}(CurrSpline,\ nPoints\_tmp,\ temp\_coeffs);}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ \mbox{\hyperlink{SplineCommon_8h_a911160077ffa38727e0494f178ce380a}{\_nTF1Coeff\_}};\ ++j)\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}{cpu\_coeff\_TF1\_many}}[TF1PointsCounter+j]\ =\ temp\_coeffs[j];}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Save\ the\ number\ of\ points\ for\ this\ spline}}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a14b9c21186a53196f49c8d8d3555fbf2}{cpu\_nPoints\_arr}}[TF1sCounter]\ =\ short(nPoints\_tmp);}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ TF1PointsCounter\ +=\ nPoints\_tmp;}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ parameter\ number\ for\ this\ spline}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_af87cf7ae888eb7d4c56f8b6c41c9fd02}{cpu\_paramNo\_TF1\_arr}}[TF1sCounter]\ =\ short(ParamNumber);}
\DoxyCodeLine{00245\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#ifdef\ Weight\_On\_SplineBySpline\_Basis}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ index\ of\ the\ spline\ so\ we\ can\ tell\ apart\ from\ flat\ splines}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a1aa70cce5867e7e784e97eacebe6bfbd}{index\_TF1\_cpu}}[EventCounter*\mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}}\ +\ ParamNumber]\ =\ TF1sCounter;}
\DoxyCodeLine{00248\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#else}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ ++ParamCounter\_TF1;}
\DoxyCodeLine{00250\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Increment\ the\ counter\ for\ the\ number\ of\ good\ splines\ we\ have}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ ++TF1sCounter;}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \textcolor{comment}{//KS:\ Don't\ delete\ in\ debug}}
\DoxyCodeLine{00255\ \textcolor{preprocessor}{\ \ \ \ \ \ \#ifndef\ DEBUG}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ MasterSpline[EventCounter][ParamNumber];}
\DoxyCodeLine{00257\ \ \ \ \ \ \ MasterSpline[EventCounter][ParamNumber]\ =\ NULL;}
\DoxyCodeLine{00258\ \textcolor{preprocessor}{\ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00259\ \ \ \ \ \}\ \textcolor{comment}{//\ End\ the\ loop\ over\ the\ parameters\ in\ the\ MasterSpline}}
\DoxyCodeLine{00260\ \textcolor{preprocessor}{\ \ \ \ \#ifndef\ Weight\_On\_SplineBySpline\_Basis}}
\DoxyCodeLine{00261\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}}[2*EventCounter]\ =\ ParamCounter;}
\DoxyCodeLine{00262\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}}[2*EventCounter+1]\ =\ ParamCounterGlobal;}
\DoxyCodeLine{00263\ \ \ \ \ ParamCounterGlobal\ +=\ ParamCounter;}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}}[2*EventCounter]\ =\ ParamCounter\_TF1;}
\DoxyCodeLine{00266\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}}[2*EventCounter+1]\ =\ ParamCounterGlobalTF1;}
\DoxyCodeLine{00267\ \ \ \ \ ParamCounterGlobalTF1\ +=\ ParamCounter\_TF1;}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \ \ ParamCounter\ =\ 0;}
\DoxyCodeLine{00270\ \ \ \ \ ParamCounter\_TF1\ =\ 0;}
\DoxyCodeLine{00271\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{00272\ \ \ \}\ \textcolor{comment}{//\ End\ the\ loop\ over\ the\ number\ of\ events}}
\DoxyCodeLine{00273\ \ \ \textcolor{keyword}{delete}[]\ many\_tmp;}
\DoxyCodeLine{00274\ \ \ \textcolor{keyword}{delete}[]\ x\_tmp;}
\DoxyCodeLine{00275\ \ \ \textcolor{keyword}{delete}[]\ temp\_coeffs;}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \textcolor{keywordtype}{int}\ BadXCounter\ =\ 0;}
\DoxyCodeLine{00278\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ event\_size\_max;\ j++)\ \{}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a47012ee423ea21f99d06eff8257cf0f0}{coeff\_x}}[j]\ ==\ -\/999)\ BadXCounter++;}
\DoxyCodeLine{00280\ \ \ \ \ \textcolor{comment}{//\ Perform\ checks\ that\ all\ entries\ have\ been\ modified\ from\ initial\ values}}
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a47012ee423ea21f99d06eff8257cf0f0}{coeff\_x}}[j]\ ==\ -\/999\ \&\&\ BadXCounter\ <\ 5)\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_ad5b2eb6377721e3ac95def22c2386bb1}{MACH3LOG\_WARN}}(\textcolor{stringliteral}{"{}*****\ BAD\ X\ !!\ *****"{}});}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_ad5b2eb6377721e3ac95def22c2386bb1}{MACH3LOG\_WARN}}(\textcolor{stringliteral}{"{}Indicates\ some\ parameter\ doesn't\ have\ a\ single\ spline"{}});}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_ad5b2eb6377721e3ac95def22c2386bb1}{MACH3LOG\_WARN}}(\textcolor{stringliteral}{"{}j\ =\ \{\}"{}},\ j);}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \textcolor{comment}{//throw\ MaCh3Exception(\_\_FILE\_\_\ ,\ \_\_LINE\_\_\ );}}
\DoxyCodeLine{00286\ \ \ \ \ \}}
\DoxyCodeLine{00287\ \ \ \ \ \textcolor{keywordflow}{if}(BadXCounter\ ==\ 5)\ \mbox{\hyperlink{MaCh3Logger_8h_ad5b2eb6377721e3ac95def22c2386bb1}{MACH3LOG\_WARN}}(\textcolor{stringliteral}{"{}There\ is\ more\ unutilised\ knots\ although\ I\ will\ stop\ spamming"{}});}
\DoxyCodeLine{00288\ \ \ \}}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_ad5b2eb6377721e3ac95def22c2386bb1}{MACH3LOG\_WARN}}(\textcolor{stringliteral}{"{}Found\ in\ total\ \{\}\ BAD\ X"{}},\ BadXCounter);}
\DoxyCodeLine{00291\ \textcolor{preprocessor}{\ \ \#ifdef\ Weight\_On\_SplineBySpline\_Basis}}
\DoxyCodeLine{00292\ \ \ \textcolor{comment}{//\ Make\ the\ array\ that\ holds\ all\ the\ returned\ weights\ from\ the\ GPU\ to\ pass\ to\ the\ CPU}}
\DoxyCodeLine{00293\ \ \ \mbox{\hyperlink{classSMonolith_ab6a29f13d8e6efb380f2b9d59cfa88fc}{cpu\_weights\_var}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}}]();}
\DoxyCodeLine{00294\ \ \ \mbox{\hyperlink{classSMonolith_a4a1d45d273cc40cb4f684400812dcb60}{cpu\_weights\_tf1\_var}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}}]();}
\DoxyCodeLine{00295\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00296\ \ \ \ \ \textcolor{comment}{//KS:\ This\ is\ tricky\ as\ this\ variable\ use\ both\ by\ CPU\ and\ GPU,\ however\ if\ use\ CUDA\ we\ use\ cudaMallocHost}}
\DoxyCodeLine{00297\ \textcolor{preprocessor}{\ \ \ \ \#ifndef\ CUDA}}
\DoxyCodeLine{00298\ \ \ \ \ \mbox{\hyperlink{classSMonolith_ab572dd7e0a46caf44eb925a89cbfb0cf}{cpu\_total\_weights}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}}]();}
\DoxyCodeLine{00299\ \ \ \ \ \mbox{\hyperlink{classSMonolith_ab6a29f13d8e6efb380f2b9d59cfa88fc}{cpu\_weights\_var}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}}]();}
\DoxyCodeLine{00300\ \ \ \ \ \mbox{\hyperlink{classSMonolith_a4a1d45d273cc40cb4f684400812dcb60}{cpu\_weights\_tf1\_var}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{float}[\mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}}]();}
\DoxyCodeLine{00301\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{00302\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ \textcolor{comment}{//\ Print\ some\ info;\ could\ probably\ make\ this\ to\ a\ separate\ function}}
\DoxyCodeLine{00305\ \ \ \mbox{\hyperlink{classSMonolith_a5c374d4505de53ad68d176a5644568e6}{PrintInitialsiation}}();}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSMonolith_ab5692081772ca14bd012eb125e2ccfd4}{SaveSplineFile}})\ \mbox{\hyperlink{classSMonolith_a79f4bf0cac279cf57ab8f06698052922}{PrepareSplineFile}}();}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \mbox{\hyperlink{classSMonolith_aac73a1089592c5f22755b7427869827f}{MoveToGPU}}();}
\DoxyCodeLine{00310\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_a79f4bf0cac279cf57ab8f06698052922}\label{classSMonolith_a79f4bf0cac279cf57ab8f06698052922}} 
\index{SMonolith@{SMonolith}!PrepareSplineFile@{PrepareSplineFile}}
\index{PrepareSplineFile@{PrepareSplineFile}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{PrepareSplineFile()}{PrepareSplineFile()}}
{\footnotesize\ttfamily void SMonolith\+::\+Prepare\+Spline\+File (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}



KS\+: Prepare spline file that can be used for fast loading. 



Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l00680}{680}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00681\ \textcolor{comment}{//\ *****************************************}}
\DoxyCodeLine{00682\ \ \ std::string\ FileName\ =\ \textcolor{stringliteral}{"{}SplineFile.root"{}};}
\DoxyCodeLine{00683\ \ \ \textcolor{keywordflow}{if}\ (std::getenv(\textcolor{stringliteral}{"{}MACH3"{}})\ !=\ NULL)\ \{}
\DoxyCodeLine{00684\ \ \ \ \ \ \ FileName.insert(0,\ std::string(std::getenv(\textcolor{stringliteral}{"{}MACH3"{}}))+\textcolor{stringliteral}{"{}/"{}});}
\DoxyCodeLine{00685\ \ \ \ \}}
\DoxyCodeLine{00686\ }
\DoxyCodeLine{00687\ \ \ TFile\ *SplineFile\ =\ \textcolor{keyword}{new}\ TFile(FileName.c\_str(),\ \textcolor{stringliteral}{"{}recreate"{}});}
\DoxyCodeLine{00688\ \ \ TTree\ *Settings\ =\ \textcolor{keyword}{new}\ TTree(\textcolor{stringliteral}{"{}Settings"{}},\ \textcolor{stringliteral}{"{}Settings"{}});}
\DoxyCodeLine{00689\ \ \ TTree\ *Monolith\ =\ \textcolor{keyword}{new}\ TTree(\textcolor{stringliteral}{"{}Monolith"{}},\ \textcolor{stringliteral}{"{}Monolith"{}});}
\DoxyCodeLine{00690\ \ \ TTree\ *Monolith\_TF1\ =\ \textcolor{keyword}{new}\ TTree(\textcolor{stringliteral}{"{}Monolith\_TF1"{}},\ \textcolor{stringliteral}{"{}Monolith\_TF1"{}});}
\DoxyCodeLine{00691\ \ \ TTree\ *ParamInfo\ =\ \textcolor{keyword}{new}\ TTree(\textcolor{stringliteral}{"{}ParamInfo"{}},\ \textcolor{stringliteral}{"{}ParamInfo"{}});}
\DoxyCodeLine{00692\ \ \ TTree\ *XKnots\ =\ \textcolor{keyword}{new}\ TTree(\textcolor{stringliteral}{"{}XKnots"{}},\ \textcolor{stringliteral}{"{}XKnots"{}});}
\DoxyCodeLine{00693\ \ \ TTree\ *EventInfo\ =\ \textcolor{keyword}{new}\ TTree(\textcolor{stringliteral}{"{}EventInfo"{}},\ \textcolor{stringliteral}{"{}EventInfo"{}});}
\DoxyCodeLine{00694\ \ \ TTree\ *FastSplineInfoTree\ =\ \textcolor{keyword}{new}\ TTree(\textcolor{stringliteral}{"{}FastSplineInfoTree"{}},\ \textcolor{stringliteral}{"{}FastSplineInfoTree"{}});}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ NEvents\_temp\ =\ \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}};}
\DoxyCodeLine{00697\ \ \ \textcolor{keywordtype}{short}\ \textcolor{keywordtype}{int}\ nParams\_temp\ =\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}};}
\DoxyCodeLine{00698\ \ \ \textcolor{keywordtype}{int}\ \_max\_knots\_temp\ =\ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}};}
\DoxyCodeLine{00699\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nKnots\_temp\ =\ \mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{nKnots}};}
\DoxyCodeLine{00700\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ NSplines\_valid\_temp\ =\ \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}};}
\DoxyCodeLine{00701\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nTF1Valid\_temp\ =\ \mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}};}
\DoxyCodeLine{00702\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nTF1coeff\_temp\ =\ \mbox{\hyperlink{classSMonolith_a403e7cf909f98d4c59b5f6c7ff8aac5b}{nTF1coeff}};}
\DoxyCodeLine{00703\ }
\DoxyCodeLine{00704\ \ \ Settings-\/>Branch(\textcolor{stringliteral}{"{}NEvents"{}},\ \&NEvents\_temp,\ \textcolor{stringliteral}{"{}NEvents/i"{}});}
\DoxyCodeLine{00705\ \ \ Settings-\/>Branch(\textcolor{stringliteral}{"{}nParams"{}},\ \&nParams\_temp,\ \textcolor{stringliteral}{"{}nParams/S"{}});}
\DoxyCodeLine{00706\ \ \ Settings-\/>Branch(\textcolor{stringliteral}{"{}\_max\_knots"{}},\ \&\_max\_knots\_temp,\ \textcolor{stringliteral}{"{}\_max\_knots/I"{}});}
\DoxyCodeLine{00707\ \ \ Settings-\/>Branch(\textcolor{stringliteral}{"{}nKnots"{}},\ \&nKnots\_temp,\ \textcolor{stringliteral}{"{}nKnots/i"{}});}
\DoxyCodeLine{00708\ \ \ Settings-\/>Branch(\textcolor{stringliteral}{"{}NSplines\_valid"{}},\ \&NSplines\_valid\_temp,\ \textcolor{stringliteral}{"{}NSplines\_valid/i"{}});}
\DoxyCodeLine{00709\ \ \ Settings-\/>Branch(\textcolor{stringliteral}{"{}NTF1\_valid"{}},\ \&nTF1Valid\_temp,\ \textcolor{stringliteral}{"{}NTF1\_valid/i"{}});}
\DoxyCodeLine{00710\ \ \ Settings-\/>Branch(\textcolor{stringliteral}{"{}nTF1coeff"{}},\ \&nTF1coeff\_temp,\ \textcolor{stringliteral}{"{}nTF1coeff/i"{}});}
\DoxyCodeLine{00711\ }
\DoxyCodeLine{00712\ \ \ Settings-\/>Fill();}
\DoxyCodeLine{00713\ }
\DoxyCodeLine{00714\ \ \ SplineFile-\/>cd();}
\DoxyCodeLine{00715\ \ \ Settings-\/>Write();}
\DoxyCodeLine{00716\ }
\DoxyCodeLine{00717\ \ \ \textcolor{keywordtype}{float}\ coeff\ =\ 0.;}
\DoxyCodeLine{00718\ \ \ Monolith-\/>Branch(\textcolor{stringliteral}{"{}cpu\_coeff\_many"{}},\ \&coeff,\ \textcolor{stringliteral}{"{}cpu\_coeff\_many/F"{}});}
\DoxyCodeLine{00719\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{nKnots}}*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}};\ i++)}
\DoxyCodeLine{00720\ \ \ \{}
\DoxyCodeLine{00721\ \ \ \ \ coeff\ =\ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a67c5585ae47fc8a646dfae3fe9690775}{coeff\_many}}[i];}
\DoxyCodeLine{00722\ \ \ \ \ Monolith-\/>Fill();}
\DoxyCodeLine{00723\ \ \ \}}
\DoxyCodeLine{00724\ \ \ SplineFile-\/>cd();}
\DoxyCodeLine{00725\ \ \ Monolith-\/>Write();}
\DoxyCodeLine{00726\ }
\DoxyCodeLine{00727\ }
\DoxyCodeLine{00728\ \ \ \textcolor{keywordtype}{float}\ coeff\_tf1\ =\ 0.;}
\DoxyCodeLine{00729\ \ \ Monolith\_TF1-\/>Branch(\textcolor{stringliteral}{"{}cpu\_coeff\_TF1\_many"{}},\ \&coeff\_tf1,\ \textcolor{stringliteral}{"{}cpu\_coeff\_TF1\_many/F"{}});}
\DoxyCodeLine{00730\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classSMonolith_a403e7cf909f98d4c59b5f6c7ff8aac5b}{nTF1coeff}};\ i++)}
\DoxyCodeLine{00731\ \ \ \{}
\DoxyCodeLine{00732\ \ \ \ \ coeff\_tf1\ =\ \mbox{\hyperlink{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}{cpu\_coeff\_TF1\_many}}[i];}
\DoxyCodeLine{00733\ \ \ \ \ Monolith\_TF1-\/>Fill();}
\DoxyCodeLine{00734\ \ \ \}}
\DoxyCodeLine{00735\ \ \ SplineFile-\/>cd();}
\DoxyCodeLine{00736\ \ \ Monolith\_TF1-\/>Write();}
\DoxyCodeLine{00737\ }
\DoxyCodeLine{00738\ \ \ \textcolor{keywordtype}{short}\ \textcolor{keywordtype}{int}\ paramNo\_arr\ =\ 0;}
\DoxyCodeLine{00739\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nKnots\_arr\ =\ 0;}
\DoxyCodeLine{00740\ \ \ ParamInfo-\/>Branch(\textcolor{stringliteral}{"{}cpu\_paramNo\_arr"{}},\ \&paramNo\_arr,\ \textcolor{stringliteral}{"{}cpu\_paramNo\_arr/S"{}});}
\DoxyCodeLine{00741\ \ \ ParamInfo-\/>Branch(\textcolor{stringliteral}{"{}cpu\_nKnots\_arr"{}},\ \&nKnots\_arr,\ \textcolor{stringliteral}{"{}cpu\_nKnots\_arr/i"{}});}
\DoxyCodeLine{00742\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}};\ i++)}
\DoxyCodeLine{00743\ \ \ \{}
\DoxyCodeLine{00744\ \ \ \ \ paramNo\_arr\ =\ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_af24b409ab3da1a88e855e1a9d172741f}{paramNo\_arr}}[i];}
\DoxyCodeLine{00745\ \ \ \ \ nKnots\_arr\ =\ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a398e0212915793852137384a3406b37f}{nKnots\_arr}}[i];}
\DoxyCodeLine{00746\ }
\DoxyCodeLine{00747\ \ \ \ \ ParamInfo-\/>Fill();}
\DoxyCodeLine{00748\ \ \ \}}
\DoxyCodeLine{00749\ \ \ SplineFile-\/>cd();}
\DoxyCodeLine{00750\ \ \ ParamInfo-\/>Write();}
\DoxyCodeLine{00751\ }
\DoxyCodeLine{00752\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ event\_size\_max\ =\ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}}\ *\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}};}
\DoxyCodeLine{00753\ }
\DoxyCodeLine{00754\ \ \ \textcolor{keywordtype}{float}\ coeff\_x\ =\ 0.;}
\DoxyCodeLine{00755\ \ \ XKnots-\/>Branch(\textcolor{stringliteral}{"{}cpu\_coeff\_x"{}},\ \&coeff\_x,\ \textcolor{stringliteral}{"{}cpu\_coeff\_x/F"{}});}
\DoxyCodeLine{00756\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ event\_size\_max;\ i++)}
\DoxyCodeLine{00757\ \ \ \{}
\DoxyCodeLine{00758\ \ \ \ \ coeff\_x\ =\ \mbox{\hyperlink{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}{cpu\_spline\_handler}}-\/>\mbox{\hyperlink{structSplineMonoStruct_a47012ee423ea21f99d06eff8257cf0f0}{coeff\_x}}[i];}
\DoxyCodeLine{00759\ \ \ \ \ XKnots-\/>Fill();}
\DoxyCodeLine{00760\ \ \ \}}
\DoxyCodeLine{00761\ \ \ SplineFile-\/>cd();}
\DoxyCodeLine{00762\ \ \ XKnots-\/>Write();}
\DoxyCodeLine{00763\ }
\DoxyCodeLine{00764\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nParamPerEvent\ =\ 0;}
\DoxyCodeLine{00765\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ nParamPerEvent\_tf1\ =\ 0;}
\DoxyCodeLine{00766\ }
\DoxyCodeLine{00767\ \ \ EventInfo-\/>Branch(\textcolor{stringliteral}{"{}cpu\_nParamPerEvent"{}},\ \&nParamPerEvent,\ \textcolor{stringliteral}{"{}cpu\_nParamPerEvent/i"{}});}
\DoxyCodeLine{00768\ \ \ EventInfo-\/>Branch(\textcolor{stringliteral}{"{}cpu\_nParamPerEvent\_tf1"{}},\ \&nParamPerEvent\_tf1,\ \textcolor{stringliteral}{"{}cpu\_nParamPerEvent\_tf1/i"{}});}
\DoxyCodeLine{00769\ }
\DoxyCodeLine{00770\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 2*\mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}};\ i++)}
\DoxyCodeLine{00771\ \ \ \{}
\DoxyCodeLine{00772\ \ \ \ \ nParamPerEvent\ =\ \mbox{\hyperlink{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}{cpu\_nParamPerEvent}}[i];}
\DoxyCodeLine{00773\ \ \ \ \ nParamPerEvent\_tf1\ =\ \mbox{\hyperlink{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}{cpu\_nParamPerEvent\_tf1}}[i];}
\DoxyCodeLine{00774\ \ \ \ \ EventInfo-\/>Fill();}
\DoxyCodeLine{00775\ \ \ \}}
\DoxyCodeLine{00776\ \ \ SplineFile-\/>cd();}
\DoxyCodeLine{00777\ \ \ EventInfo-\/>Write();}
\DoxyCodeLine{00778\ }
\DoxyCodeLine{00779\ \ \ \mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ nPoints\ =\ 0;}
\DoxyCodeLine{00780\ \ \ \textcolor{keywordtype}{float}\ xtemp[20];}
\DoxyCodeLine{00781\ \ \ FastSplineInfoTree-\/>Branch(\textcolor{stringliteral}{"{}nPts"{}},\ \&nPoints,\ \textcolor{stringliteral}{"{}nPts/I"{}});}
\DoxyCodeLine{00782\ \ \ FastSplineInfoTree-\/>Branch(\textcolor{stringliteral}{"{}xPts"{}},\ xtemp,\ \textcolor{stringliteral}{"{}xPts[nPts]/F"{}});}
\DoxyCodeLine{00783\ }
\DoxyCodeLine{00784\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}};\ ++i)}
\DoxyCodeLine{00785\ \ \ \{}
\DoxyCodeLine{00786\ \ \ \ \ nPoints\ =\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{structFastSplineInfo_ac8538a8e3438ae06d8f467cc0fd5ce0d}{nPts}};}
\DoxyCodeLine{00787\ }
\DoxyCodeLine{00788\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ k\ =\ 0;\ k\ <\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{structFastSplineInfo_ac8538a8e3438ae06d8f467cc0fd5ce0d}{nPts}};\ ++k)}
\DoxyCodeLine{00789\ \ \ \ \ \{}
\DoxyCodeLine{00790\ \ \ \ \ \ \ xtemp[k]\ =\ float(\mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].xPts[k]);}
\DoxyCodeLine{00791\ \ \ \ \ \}}
\DoxyCodeLine{00792\ \ \ \ \ FastSplineInfoTree-\/>Fill();}
\DoxyCodeLine{00793\ \ \ \}}
\DoxyCodeLine{00794\ }
\DoxyCodeLine{00795\ \ \ SplineFile-\/>cd();}
\DoxyCodeLine{00796\ \ \ FastSplineInfoTree-\/>Write();}
\DoxyCodeLine{00797\ }
\DoxyCodeLine{00798\ \ \ \textcolor{keyword}{delete}\ Settings;}
\DoxyCodeLine{00799\ \ \ \textcolor{keyword}{delete}\ Monolith;}
\DoxyCodeLine{00800\ \ \ \textcolor{keyword}{delete}\ Monolith\_TF1;}
\DoxyCodeLine{00801\ \ \ \textcolor{keyword}{delete}\ ParamInfo;}
\DoxyCodeLine{00802\ \ \ \textcolor{keyword}{delete}\ XKnots;}
\DoxyCodeLine{00803\ \ \ \textcolor{keyword}{delete}\ EventInfo;}
\DoxyCodeLine{00804\ \ \ \textcolor{keyword}{delete}\ FastSplineInfoTree;}
\DoxyCodeLine{00805\ \ \ SplineFile-\/>Close();}
\DoxyCodeLine{00806\ \ \ \textcolor{keyword}{delete}\ SplineFile;}
\DoxyCodeLine{00807\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_a5c374d4505de53ad68d176a5644568e6}\label{classSMonolith_a5c374d4505de53ad68d176a5644568e6}} 
\index{SMonolith@{SMonolith}!PrintInitialsiation@{PrintInitialsiation}}
\index{PrintInitialsiation@{PrintInitialsiation}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{PrintInitialsiation()}{PrintInitialsiation()}}
{\footnotesize\ttfamily void SMonolith\+::\+Print\+Initialsiation (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}



KS\+: Print info about how much knots etc has been initialised. 



Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l01184}{1184}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01185\ \textcolor{comment}{//*********************************************************}}
\DoxyCodeLine{01186\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ event\_size\_max\ =\ \mbox{\hyperlink{classSMonolith_ac0d1df54649909e4cee3385f68132799}{\_max\_knots}}\ *\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}};}
\DoxyCodeLine{01187\ }
\DoxyCodeLine{01188\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}-\/-\/-\/\ INITIALISED\ Spline\ Monolith\ -\/-\/-\/"{}});}
\DoxyCodeLine{01189\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}\{\}\ events\ with\ \{\}\ splines"{}},\ \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}},\ \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}});}
\DoxyCodeLine{01190\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}On\ average\ \{:.2f\}\ splines\ per\ event\ (\{\}/\{\})"{}},\ \textcolor{keywordtype}{float}(\mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}})/\textcolor{keywordtype}{float}(\mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}}),\ \mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}},\ \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}});}
\DoxyCodeLine{01191\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Size\ of\ x\ array\ =\ \{:.4f\}\ MB"{}},\ \textcolor{keywordtype}{double}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})*event\_size\_max)/1.E6);}
\DoxyCodeLine{01192\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Size\ of\ coefficient\ (y,b,c,d)\ array\ =\ \{:.2f\}\ MB"{}},\ \textcolor{keywordtype}{double}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})*\mbox{\hyperlink{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}{nKnots}}*\mbox{\hyperlink{SplineCommon_8h_a283177311bade7400c6088e8fad71a1f}{\_nCoeff\_}})/1.E6);}
\DoxyCodeLine{01193\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Size\ of\ parameter\ \#\ array\ =\ \{:.2f\}\ MB"{}},\ \textcolor{keywordtype}{double}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{short}\ \textcolor{keywordtype}{int})*\mbox{\hyperlink{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}{NSplines\_valid}})/1.E6);}
\DoxyCodeLine{01194\ }
\DoxyCodeLine{01195\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}On\ average\ \{:.2f\}\ TF1\ per\ event\ (\{\}/\{\})"{}},\ \textcolor{keywordtype}{float}(\mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}})/\textcolor{keywordtype}{float}(\mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}}),\ \mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}},\ \mbox{\hyperlink{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}{NEvents}});}
\DoxyCodeLine{01196\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a95fa4dffc648e4c5536c9292c2bdcac3}{MACH3LOG\_INFO}}(\textcolor{stringliteral}{"{}Size\ of\ TF1\ coefficient\ (a,b,c,d,e)\ array\ =\ \{:.2f\}\ MB"{}},\ \textcolor{keywordtype}{double}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})*\mbox{\hyperlink{classSMonolith_a13699796db31517edba3a8009317f779}{NTF1\_valid}}*\mbox{\hyperlink{SplineCommon_8h_a911160077ffa38727e0494f178ce380a}{\_nTF1Coeff\_}})/1.E6);}
\DoxyCodeLine{01197\ }
\DoxyCodeLine{01198\ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01199\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_a51bbc20cfe4ebed21f6d9f91a86ea0ee}\label{classSMonolith_a51bbc20cfe4ebed21f6d9f91a86ea0ee}} 
\index{SMonolith@{SMonolith}!retPointer@{retPointer}}
\index{retPointer@{retPointer}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{retPointer()}{retPointer()}}
{\footnotesize\ttfamily const float $\ast$ SMonolith\+::ret\+Pointer (\begin{DoxyParamCaption}\item[{const int}]{event }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



KS\+: Get pointer to total weight to make fit faster wrooom! 


\begin{DoxyParams}{Parameters}
{\em event} & Name event number in used MC \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the total weight 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00040}{40}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00040\ \{\textcolor{keywordflow}{return}\ \&\mbox{\hyperlink{classSMonolith_ab572dd7e0a46caf44eb925a89cbfb0cf}{cpu\_total\_weights}}[event];\}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_a12cddfcbec851b468cba86dc9b223c78}\label{classSMonolith_a12cddfcbec851b468cba86dc9b223c78}} 
\index{SMonolith@{SMonolith}!ScanMasterSpline@{ScanMasterSpline}}
\index{ScanMasterSpline@{ScanMasterSpline}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{ScanMasterSpline()}{ScanMasterSpline()}}
{\footnotesize\ttfamily void SMonolith\+::\+Scan\+Master\+Spline (\begin{DoxyParamCaption}\item[{std\+::vector$<$ std\+::vector$<$ \mbox{\hyperlink{classTResponseFunction__red}{TResponse\+Function\+\_\+red}} $\ast$ $>$ $>$ \&}]{Master\+Spline,  }\item[{unsigned int \&}]{n\+Events,  }\item[{int \&}]{Max\+Points,  }\item[{short int \&}]{num\+Params,  }\item[{int \&}]{n\+Splines,  }\item[{unsigned int \&}]{NSplines\+Valid,  }\item[{unsigned int \&}]{num\+Knots,  }\item[{unsigned int \&}]{n\+TF1\+Valid,  }\item[{unsigned int \&}]{n\+TF1\+\_\+coeff,  }\item[{const std\+::vector$<$ \mbox{\hyperlink{Structs_8h_a6a73aa1ad819973a9c421c17c2a7f36d}{Resp\+Func\+Type}} $>$ \&}]{Spline\+Type }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}



CW\+: Function to scan through the Master\+Spline of TSpline3. 


\begin{DoxyParams}{Parameters}
{\em Master\+Spline} & Vector of \mbox{\hyperlink{classTSpline3__red}{TSpline3\+\_\+red}} pointers which we strip back \\
\hline
{\em NEvents} & Number of MC events \\
\hline
{\em Max\+Points} & Maximal number of knots per splines \\
\hline
{\em num\+Params} & Total number of parameters \\
\hline
{\em num\+Knots} & Total number of knots, which is sum of individual knots per each spline \\
\hline
{\em n\+TF1\+\_\+coeff} & Number of TF1 coefficients in all TF1 objects \\
\hline
{\em Spline\+Type} & Whether object is TSpline3 or TF1 \\
\hline
{\em NSplines\+Valid} & Total number of valid (not null) TSpline3 \\
\hline
{\em n\+TF1\+Valid} & Total number of valid (not null) TF1 \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l00399}{399}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00409\ \textcolor{comment}{//\ *****************************************}}
\DoxyCodeLine{00410\ \ \ \textcolor{comment}{//\ Need\ to\ extract:\ the\ total\ number\ of\ events}}
\DoxyCodeLine{00411\ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ number\ of\ parameters}}
\DoxyCodeLine{00412\ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ maximum\ number\ of\ knots}}
\DoxyCodeLine{00413\ \ \ MaxPoints\ =\ 0;}
\DoxyCodeLine{00414\ \ \ nEvents\ \ \ =\ 0;}
\DoxyCodeLine{00415\ \ \ numParams\ \ \ =\ 0;}
\DoxyCodeLine{00416\ \ \ nSplines\ =\ 0;}
\DoxyCodeLine{00417\ \ \ numKnots\ =\ 0;}
\DoxyCodeLine{00418\ \ \ NSplinesValid\ =\ 0;}
\DoxyCodeLine{00419\ \ \ nTF1Valid\ =\ 0;}
\DoxyCodeLine{00420\ \ \ nTF1\_coeff\ =\ 0;}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \ \ \textcolor{comment}{//\ Check\ the\ number\ of\ events}}
\DoxyCodeLine{00423\ \ \ nEvents\ =\ int(MasterSpline.size());}
\DoxyCodeLine{00424\ }
\DoxyCodeLine{00425\ \ \ \textcolor{comment}{//\ Maximum\ number\ of\ splines\ one\ event\ can\ have\ (scan\ through\ and\ find\ this\ number)}}
\DoxyCodeLine{00426\ \ \ \textcolor{keywordtype}{int}\ nMaxSplines\_PerEvent\ =\ 0;}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \textcolor{comment}{//KS:\ We\ later\ check\ that\ each\ event\ has\ the\ same\ number\ of\ splines\ so\ this\ is\ fine}}
\DoxyCodeLine{00429\ \ \ numParams\ =\ short(MasterSpline[0].\mbox{\hyperlink{GetPenaltyTerm_8cpp_a439227feff9d7f55384e8780cfc2eb82}{size}}());}
\DoxyCodeLine{00430\ \ \ \textcolor{comment}{//\ Initialise}}
\DoxyCodeLine{00431\ \ \ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{structFastSplineInfo}{FastSplineInfo}}[numParams];}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00433\ \ \ \textcolor{comment}{//\ Loop\ over\ each\ parameter}}
\DoxyCodeLine{00434\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ EventCounter\ =\ 0;\ EventCounter\ <\ MasterSpline.size();\ ++EventCounter)\ \{}
\DoxyCodeLine{00435\ \ \ \ \ \textcolor{comment}{//\ Check\ that\ each\ event\ has\ each\ spline\ saved}}
\DoxyCodeLine{00436\ \ \ \ \ \textcolor{keywordflow}{if}\ (numParams\ >\ 0)\ \{}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ TempSize\ =\ int(MasterSpline[EventCounter].\mbox{\hyperlink{GetPenaltyTerm_8cpp_a439227feff9d7f55384e8780cfc2eb82}{size}}());}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (TempSize\ !=\ numParams)\ \{}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}Found\ \{\}\ parameters\ for\ event\ \{\}"{}},\ TempSize,\ EventCounter);}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}but\ was\ expecting\ \{\}\ since\ that's\ what\ I\ found\ for\ the\ previous\ event"{}},\ numParams);}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_a61052119a625282d0ec6d4a97adf3ee2}{MACH3LOG\_ERROR}}(\textcolor{stringliteral}{"{}Somehow\ this\ event\ has\ a\ different\ number\ of\ spline\ parameters...\ Please\ study\ further!"{}});}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classMaCh3Exception}{MaCh3Exception}}(\_\_FILE\_\_\ ,\ \_\_LINE\_\_\ );}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00444\ \ \ \ \ \}}
\DoxyCodeLine{00445\ \ \ \ \ numParams\ =\ short(MasterSpline[EventCounter].\mbox{\hyperlink{GetPenaltyTerm_8cpp_a439227feff9d7f55384e8780cfc2eb82}{size}}());}
\DoxyCodeLine{00446\ }
\DoxyCodeLine{00447\ \ \ \ \ \textcolor{keywordtype}{int}\ nSplines\_SingleEvent\ =\ 0;}
\DoxyCodeLine{00448\ \ \ \ \ \textcolor{comment}{//\ Loop\ over\ each\ pointer}}
\DoxyCodeLine{00449\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ ParamNumber\ =\ 0;\ ParamNumber\ <\ MasterSpline[EventCounter].size();\ ++ParamNumber)\ \{}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ NULL\ we\ don't\ have\ this\ spline\ for\ the\ event,\ so\ move\ to\ next\ spline}}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (MasterSpline[EventCounter][ParamNumber]\ ==\ NULL)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00452\ }
\DoxyCodeLine{00453\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(SplineType[ParamNumber]\ ==\ \mbox{\hyperlink{Structs_8h_a6a73aa1ad819973a9c421c17c2a7f36da8bea6994e011cc85a5a88b50c97ce7b2}{kTSpline3\_red}})}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTResponseFunction__red}{TResponseFunction\_red}}*\ TespFunc\ =\ MasterSpline[EventCounter][ParamNumber];}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTSpline3__red}{TSpline3\_red}}*\ CurrSpline\ =\ \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classTSpline3__red}{TSpline3\_red}}*\textcolor{keyword}{>}(TespFunc);}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nPoints\ =\ CurrSpline-\/>\mbox{\hyperlink{classTSpline3__red_a6b680cfb96e11c55b8325e1274251b91}{GetNp}}();}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nPoints\ >\ MaxPoints)\ \{}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \ \ MaxPoints\ =\ nPoints;}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ numKnots\ +=\ nPoints;}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ nSplines\_SingleEvent++;}
\DoxyCodeLine{00463\ }
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Fill\ the\ SplineInfoArray\ entries\ with\ information\ on\ each\ splinified\ parameter}}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[ParamNumber].xPts\ ==\ NULL)}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Fill\ the\ number\ of\ points}}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[ParamNumber].\mbox{\hyperlink{structFastSplineInfo_ac8538a8e3438ae06d8f467cc0fd5ce0d}{nPts}}\ =\ CurrSpline-\/>\mbox{\hyperlink{classTSpline3__red_a6b680cfb96e11c55b8325e1274251b91}{GetNp}}();}
\DoxyCodeLine{00469\ }
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Fill\ the\ x\ points}}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[ParamNumber].\mbox{\hyperlink{structFastSplineInfo_a9e9d432eb250bba227d31022ac9c5779}{xPts}}\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespaceM3_a1f95274549f25fc19fe7db343c8a7a68}{M3::float\_t}}[\mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[ParamNumber].\mbox{\hyperlink{structFastSplineInfo_ac8538a8e3438ae06d8f467cc0fd5ce0d}{nPts}}];}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ k\ =\ 0;\ k\ <\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[ParamNumber].\mbox{\hyperlink{structFastSplineInfo_ac8538a8e3438ae06d8f467cc0fd5ce0d}{nPts}};\ ++k)}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceM3_a1f95274549f25fc19fe7db343c8a7a68}{M3::float\_t}}\ xtemp\ =\ \mbox{\hyperlink{namespaceM3_a1f95274549f25fc19fe7db343c8a7a68}{M3::float\_t}}(-\/999.99);}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceM3_a1f95274549f25fc19fe7db343c8a7a68}{M3::float\_t}}\ ytemp\ =\ \mbox{\hyperlink{namespaceM3_a1f95274549f25fc19fe7db343c8a7a68}{M3::float\_t}}(-\/999.99);}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \ \ \ \ CurrSpline-\/>\mbox{\hyperlink{classTSpline3__red_a2c3cba5b93df5a08a8b6c1aee5ebb727}{GetKnot}}(k,\ xtemp,\ ytemp);}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[ParamNumber].\mbox{\hyperlink{structFastSplineInfo_a9e9d432eb250bba227d31022ac9c5779}{xPts}}[k]\ =\ xtemp;}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ NSplinesValid++;}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (SplineType[ParamNumber]\ ==\ \mbox{\hyperlink{Structs_8h_a6a73aa1ad819973a9c421c17c2a7f36da847a18b0a859ce2b3b87a98f455855b1}{kTF1\_red}})}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTResponseFunction__red}{TResponseFunction\_red}}*\ TespFunc\ =\ MasterSpline[EventCounter][ParamNumber];}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTF1__red}{TF1\_red}}*\ CurrSpline\ =\ \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classTF1__red}{TF1\_red}}*\textcolor{keyword}{>}(TespFunc);}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nPoints\ =\ CurrSpline-\/>\mbox{\hyperlink{classTF1__red_af9e3b0e8d2edad0e7e08f3bf215525c9}{GetSize}}();}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ nTF1\_coeff\ +=\ nPoints;}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ nTF1Valid++;}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00490\ \ \ \ \ \}}
\DoxyCodeLine{00491\ \ \ \ \ \textcolor{keywordflow}{if}\ (nSplines\_SingleEvent\ >\ nMaxSplines\_PerEvent)\ nMaxSplines\_PerEvent\ =\ nSplines\_SingleEvent;}
\DoxyCodeLine{00492\ \ \ \}}
\DoxyCodeLine{00493\ \ \ nSplines\ =\ nMaxSplines\_PerEvent;}
\DoxyCodeLine{00494\ }
\DoxyCodeLine{00495\ \ \ \textcolor{keywordtype}{int}\ Counter\ =\ 0;}
\DoxyCodeLine{00496\ \ \ \textcolor{comment}{//KS:\ Sanity\ check\ that\ everything\ was\ set\ correctly}}
\DoxyCodeLine{00497\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ i\ =\ 0;\ i\ <\ numParams;\ ++i)}
\DoxyCodeLine{00498\ \ \ \{}
\DoxyCodeLine{00499\ \ \ \ \ \textcolor{comment}{//\ KS:\ We\ don't\ find\ segment\ for\ TF1,\ so\ ignore\ this}}
\DoxyCodeLine{00500\ \ \ \ \ \textcolor{keywordflow}{if}\ (SplineType[i]\ ==\ \mbox{\hyperlink{Structs_8h_a6a73aa1ad819973a9c421c17c2a7f36da847a18b0a859ce2b3b87a98f455855b1}{kTF1\_red}})\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00501\ }
\DoxyCodeLine{00502\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ nPoints\ =\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{structFastSplineInfo_ac8538a8e3438ae06d8f467cc0fd5ce0d}{nPts}};}
\DoxyCodeLine{00503\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespaceM3_a1f95274549f25fc19fe7db343c8a7a68}{M3::float\_t}}*\ xArray\ =\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{structFastSplineInfo_a9e9d432eb250bba227d31022ac9c5779}{xPts}};}
\DoxyCodeLine{00504\ \ \ \ \ \textcolor{keywordflow}{if}\ (nPoints\ ==\ -\/999\ ||\ xArray\ ==\ NULL)\ \{}
\DoxyCodeLine{00505\ \ \ \ \ \ \ Counter++;}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(Counter\ <\ 5)\ \{}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{MaCh3Logger_8h_ad5b2eb6377721e3ac95def22c2386bb1}{MACH3LOG\_WARN}}(\textcolor{stringliteral}{"{}SplineInfoArray[\{\}]\ isn't\ set\ yet"{}},\ i);}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \textcolor{comment}{//throw\ MaCh3Exception(\_\_FILE\_\_\ ,\ \_\_LINE\_\_\ );}}
\DoxyCodeLine{00511\ \ \ \ \ \}}
\DoxyCodeLine{00512\ \ \ \}}
\DoxyCodeLine{00513\ \ \ \mbox{\hyperlink{MaCh3Logger_8h_ad5b2eb6377721e3ac95def22c2386bb1}{MACH3LOG\_WARN}}(\textcolor{stringliteral}{"{}In\ total\ SplineInfoArray\ for\ \{\}\ hasn't\ been\ initialised"{}},\ Counter);}
\DoxyCodeLine{00514\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_a40f6b9256a18fa59009e5961aec776ff}\label{classSMonolith_a40f6b9256a18fa59009e5961aec776ff}} 
\index{SMonolith@{SMonolith}!setSplinePointers@{setSplinePointers}}
\index{setSplinePointers@{setSplinePointers}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{setSplinePointers()}{setSplinePointers()}}
{\footnotesize\ttfamily void SMonolith\+::set\+Spline\+Pointers (\begin{DoxyParamCaption}\item[{std\+::vector$<$ const double $\ast$ $>$}]{spline\+\_\+\+Pars\+Pointers }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



KS\+: Set pointers to spline params. 


\begin{DoxyParams}{Parameters}
{\em spline\+\_\+\+Pars\+Pointers} & Vector of pointers to spline params \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00044}{44}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \mbox{\hyperlink{classSMonolith_afa782652b0b3da923c5b20bb1319aadd}{splineParsPointer}}\ =\ spline\_ParsPointers;}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{namespaceM3_adb59b8ecdc4e1b2d5d4c826a13aa7463}{M3::int\_t}}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classSMonolith_a4606b53f321992377d420a838c76ab3b}{nParams}};\ ++i)\ \mbox{\hyperlink{classSMonolith_a50a4ad58aebffdb820626f855bae6821}{SplineInfoArray}}[i].\mbox{\hyperlink{classSMonolith_afa782652b0b3da923c5b20bb1319aadd}{splineParsPointer}}\ =\ spline\_ParsPointers[i];}
\DoxyCodeLine{00047\ \ \ \ \ \};}

\end{DoxyCode}
\mbox{\Hypertarget{classSMonolith_a68e18d73ed1ac524ceaea79d2a5460ce}\label{classSMonolith_a68e18d73ed1ac524ceaea79d2a5460ce}} 
\index{SMonolith@{SMonolith}!SynchroniseMemTransfer@{SynchroniseMemTransfer}}
\index{SynchroniseMemTransfer@{SynchroniseMemTransfer}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{SynchroniseMemTransfer()}{SynchroniseMemTransfer()}}
{\footnotesize\ttfamily void SMonolith\+::\+Synchronise\+Mem\+Transfer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



KS\+: After calculations are done on GPU we copy memory to CPU. This operation is asynchronous meaning while memory is being copied some operations are being carried. Memory must be copied before actual reweight. This function make sure all has been copied. 



Definition at line \mbox{\hyperlink{SplineMonolith_8cpp_source_l01203}{1203}} of file \mbox{\hyperlink{SplineMonolith_8cpp_source}{Spline\+Monolith.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01204\ \textcolor{comment}{//*********************************************************}}
\DoxyCodeLine{01205\ \textcolor{preprocessor}{\ \ \#ifdef\ CUDA}}
\DoxyCodeLine{01206\ \ \ \mbox{\hyperlink{gpuSplineUtils_8cu_a953e5c5aecebd908f5d8c6ad64de482c}{SynchroniseSplines}}();}
\DoxyCodeLine{01207\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{01208\ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01209\ \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classSMonolith_ac0d1df54649909e4cee3385f68132799}\label{classSMonolith_ac0d1df54649909e4cee3385f68132799}} 
\index{SMonolith@{SMonolith}!\_max\_knots@{\_max\_knots}}
\index{\_max\_knots@{\_max\_knots}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{\_max\_knots}{\_max\_knots}}
{\footnotesize\ttfamily int SMonolith\+::\+\_\+max\+\_\+knots\hspace{0.3cm}{\ttfamily [private]}}



Max knots for production. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00124}{124}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}\label{classSMonolith_a456dd14e1693e445ad6dddd5a8b9794f}} 
\index{SMonolith@{SMonolith}!cpu\_coeff\_TF1\_many@{cpu\_coeff\_TF1\_many}}
\index{cpu\_coeff\_TF1\_many@{cpu\_coeff\_TF1\_many}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{cpu\_coeff\_TF1\_many}{cpu\_coeff\_TF1\_many}}
{\footnotesize\ttfamily std\+::vector$<$float$>$ SMonolith\+::cpu\+\_\+coeff\+\_\+\+TF1\+\_\+many\hspace{0.3cm}{\ttfamily [private]}}



CPU arrays to hold TF1 coefficients. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00162}{162}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}\label{classSMonolith_a0a6599372d1e3d38105478a68308d9a6}} 
\index{SMonolith@{SMonolith}!cpu\_nParamPerEvent@{cpu\_nParamPerEvent}}
\index{cpu\_nParamPerEvent@{cpu\_nParamPerEvent}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{cpu\_nParamPerEvent}{cpu\_nParamPerEvent}}
{\footnotesize\ttfamily std\+::vector$<$unsigned int$>$ SMonolith\+::cpu\+\_\+n\+Param\+Per\+Event\hspace{0.3cm}{\ttfamily [private]}}



KS\+: CPU map keeping track how many parameters applies to each event, we keep two numbers here \{number of splines per event, index where splines start for a given event\}. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00150}{150}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}\label{classSMonolith_a66eecc550dea893c60a435a034e7ebf5}} 
\index{SMonolith@{SMonolith}!cpu\_nParamPerEvent\_tf1@{cpu\_nParamPerEvent\_tf1}}
\index{cpu\_nParamPerEvent\_tf1@{cpu\_nParamPerEvent\_tf1}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{cpu\_nParamPerEvent\_tf1}{cpu\_nParamPerEvent\_tf1}}
{\footnotesize\ttfamily std\+::vector$<$unsigned int$>$ SMonolith\+::cpu\+\_\+n\+Param\+Per\+Event\+\_\+tf1\hspace{0.3cm}{\ttfamily [private]}}



KS\+: CPU map keeping track how many parameters applies to each event, we keep two numbers here \{number of TF1 per event, index where TF1 start for a given event\}. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00153}{153}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a14b9c21186a53196f49c8d8d3555fbf2}\label{classSMonolith_a14b9c21186a53196f49c8d8d3555fbf2}} 
\index{SMonolith@{SMonolith}!cpu\_nPoints\_arr@{cpu\_nPoints\_arr}}
\index{cpu\_nPoints\_arr@{cpu\_nPoints\_arr}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{cpu\_nPoints\_arr}{cpu\_nPoints\_arr}}
{\footnotesize\ttfamily std\+::vector$<$short int$>$ SMonolith\+::cpu\+\_\+n\+Points\+\_\+arr\hspace{0.3cm}{\ttfamily [private]}}



CPU arrays to hold number of points. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00165}{165}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_af87cf7ae888eb7d4c56f8b6c41c9fd02}\label{classSMonolith_af87cf7ae888eb7d4c56f8b6c41c9fd02}} 
\index{SMonolith@{SMonolith}!cpu\_paramNo\_TF1\_arr@{cpu\_paramNo\_TF1\_arr}}
\index{cpu\_paramNo\_TF1\_arr@{cpu\_paramNo\_TF1\_arr}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{cpu\_paramNo\_TF1\_arr}{cpu\_paramNo\_TF1\_arr}}
{\footnotesize\ttfamily std\+::vector$<$short int$>$ SMonolith\+::cpu\+\_\+param\+No\+\_\+\+TF1\+\_\+arr\hspace{0.3cm}{\ttfamily [private]}}



CW\+: CPU array with the number of points per spline (not per spline point!) 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00168}{168}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}\label{classSMonolith_a48d0e5e5b4130fcd191c3e8f1d841eb7}} 
\index{SMonolith@{SMonolith}!cpu\_spline\_handler@{cpu\_spline\_handler}}
\index{cpu\_spline\_handler@{cpu\_spline\_handler}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{cpu\_spline\_handler}{cpu\_spline\_handler}}
{\footnotesize\ttfamily \mbox{\hyperlink{structSplineMonoStruct}{Spline\+Mono\+Struct}}$\ast$ SMonolith\+::cpu\+\_\+spline\+\_\+handler\hspace{0.3cm}{\ttfamily [private]}}



KS\+: Store info about Spline monolith, this allow to obtain better step time. As all necessary information for spline weight calculation are here meaning better cache hits. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00156}{156}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_ab572dd7e0a46caf44eb925a89cbfb0cf}\label{classSMonolith_ab572dd7e0a46caf44eb925a89cbfb0cf}} 
\index{SMonolith@{SMonolith}!cpu\_total\_weights@{cpu\_total\_weights}}
\index{cpu\_total\_weights@{cpu\_total\_weights}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{cpu\_total\_weights}{cpu\_total\_weights}}
{\footnotesize\ttfamily float$\ast$ SMonolith\+::cpu\+\_\+total\+\_\+weights}



KS\+: This holds the total CPU weights that gets read in sample\+PDFND. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00052}{52}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a8614e8ef07431d99f62ab88d9ebdad16}\label{classSMonolith_a8614e8ef07431d99f62ab88d9ebdad16}} 
\index{SMonolith@{SMonolith}!cpu\_weights@{cpu\_weights}}
\index{cpu\_weights@{cpu\_weights}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{cpu\_weights}{cpu\_weights}}
{\footnotesize\ttfamily float$\ast$ SMonolith\+::cpu\+\_\+weights}



The returned gpu weights, read by the GPU. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00050}{50}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a4a1d45d273cc40cb4f684400812dcb60}\label{classSMonolith_a4a1d45d273cc40cb4f684400812dcb60}} 
\index{SMonolith@{SMonolith}!cpu\_weights\_tf1\_var@{cpu\_weights\_tf1\_var}}
\index{cpu\_weights\_tf1\_var@{cpu\_weights\_tf1\_var}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{cpu\_weights\_tf1\_var}{cpu\_weights\_tf1\_var}}
{\footnotesize\ttfamily float$\ast$ SMonolith\+::cpu\+\_\+weights\+\_\+tf1\+\_\+var\hspace{0.3cm}{\ttfamily [private]}}



CPU arrays to hold weight for each TF1. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00147}{147}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_ab6a29f13d8e6efb380f2b9d59cfa88fc}\label{classSMonolith_ab6a29f13d8e6efb380f2b9d59cfa88fc}} 
\index{SMonolith@{SMonolith}!cpu\_weights\_var@{cpu\_weights\_var}}
\index{cpu\_weights\_var@{cpu\_weights\_var}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{cpu\_weights\_var}{cpu\_weights\_var}}
{\footnotesize\ttfamily float$\ast$ SMonolith\+::cpu\+\_\+weights\+\_\+var\hspace{0.3cm}{\ttfamily [private]}}



CPU arrays to hold weight for each spline. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00144}{144}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}\label{classSMonolith_a03444cbed8a9d9a7798d0ef2b26bd702}} 
\index{SMonolith@{SMonolith}!gpu\_spline\_handler@{gpu\_spline\_handler}}
\index{gpu\_spline\_handler@{gpu\_spline\_handler}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{gpu\_spline\_handler}{gpu\_spline\_handler}}
{\footnotesize\ttfamily \mbox{\hyperlink{classSMonolithGPU}{SMonolith\+GPU}}$\ast$ SMonolith\+::gpu\+\_\+spline\+\_\+handler\hspace{0.3cm}{\ttfamily [private]}}



KS\+: Store info about Spline monolith, this allow to obtain better step time. As all necessary information for spline weight calculation are here meaning better cache hits. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00159}{159}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_ae9fa50f60f717558f517faea6a38d251}\label{classSMonolith_ae9fa50f60f717558f517faea6a38d251}} 
\index{SMonolith@{SMonolith}!index\_cpu@{index\_cpu}}
\index{index\_cpu@{index\_cpu}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{index\_cpu}{index\_cpu}}
{\footnotesize\ttfamily int$\ast$ SMonolith\+::index\+\_\+cpu\hspace{0.3cm}{\ttfamily [private]}}



holds the index for good splines; don\textquotesingle{}t do unsigned since starts with negative value! 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00126}{126}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a1aa70cce5867e7e784e97eacebe6bfbd}\label{classSMonolith_a1aa70cce5867e7e784e97eacebe6bfbd}} 
\index{SMonolith@{SMonolith}!index\_TF1\_cpu@{index\_TF1\_cpu}}
\index{index\_TF1\_cpu@{index\_TF1\_cpu}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{index\_TF1\_cpu}{index\_TF1\_cpu}}
{\footnotesize\ttfamily int$\ast$ SMonolith\+::index\+\_\+\+TF1\+\_\+cpu\hspace{0.3cm}{\ttfamily [private]}}



holds the index for good TF1; don\textquotesingle{}t do unsigned since starts with negative value! 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00128}{128}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}\label{classSMonolith_ac86282b04659bae5cccb6073c9edc0a5}} 
\index{SMonolith@{SMonolith}!NEvents@{NEvents}}
\index{NEvents@{NEvents}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{NEvents}{NEvents}}
{\footnotesize\ttfamily unsigned int SMonolith\+::\+NEvents\hspace{0.3cm}{\ttfamily [private]}}



Number of events. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00120}{120}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}\label{classSMonolith_afc0e3d1eafd575cf7628319a66925d5b}} 
\index{SMonolith@{SMonolith}!nKnots@{nKnots}}
\index{nKnots@{nKnots}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{nKnots}{nKnots}}
{\footnotesize\ttfamily unsigned int SMonolith\+::n\+Knots\hspace{0.3cm}{\ttfamily [private]}}



Sum of all knots over all splines. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00139}{139}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a4606b53f321992377d420a838c76ab3b}\label{classSMonolith_a4606b53f321992377d420a838c76ab3b}} 
\index{SMonolith@{SMonolith}!nParams@{nParams}}
\index{nParams@{nParams}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{nParams}{nParams}}
{\footnotesize\ttfamily short int SMonolith\+::n\+Params\hspace{0.3cm}{\ttfamily [private]}}



Number of NIWG parameters that have splines. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00122}{122}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_aee3c18513f8209f1ac940b492cd3ed68}\label{classSMonolith_aee3c18513f8209f1ac940b492cd3ed68}} 
\index{SMonolith@{SMonolith}!NSplines\_total\_large@{NSplines\_total\_large}}
\index{NSplines\_total\_large@{NSplines\_total\_large}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{NSplines\_total\_large}{NSplines\_total\_large}}
{\footnotesize\ttfamily unsigned int SMonolith\+::\+NSplines\+\_\+total\+\_\+large\hspace{0.3cm}{\ttfamily [private]}}



Number of total splines if each event had every parameter\textquotesingle{}s spline. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00136}{136}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}\label{classSMonolith_ab72795333d6f632565b0f7eb0ca8a658}} 
\index{SMonolith@{SMonolith}!NSplines\_valid@{NSplines\_valid}}
\index{NSplines\_valid@{NSplines\_valid}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{NSplines\_valid}{NSplines\_valid}}
{\footnotesize\ttfamily unsigned int SMonolith\+::\+NSplines\+\_\+valid\hspace{0.3cm}{\ttfamily [private]}}



Number of valid splines. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00131}{131}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a13699796db31517edba3a8009317f779}\label{classSMonolith_a13699796db31517edba3a8009317f779}} 
\index{SMonolith@{SMonolith}!NTF1\_valid@{NTF1\_valid}}
\index{NTF1\_valid@{NTF1\_valid}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{NTF1\_valid}{NTF1\_valid}}
{\footnotesize\ttfamily unsigned int SMonolith\+::\+NTF1\+\_\+valid\hspace{0.3cm}{\ttfamily [private]}}



Number of valid TF1. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00133}{133}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a403e7cf909f98d4c59b5f6c7ff8aac5b}\label{classSMonolith_a403e7cf909f98d4c59b5f6c7ff8aac5b}} 
\index{SMonolith@{SMonolith}!nTF1coeff@{nTF1coeff}}
\index{nTF1coeff@{nTF1coeff}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{nTF1coeff}{nTF1coeff}}
{\footnotesize\ttfamily unsigned int SMonolith\+::n\+TF1coeff\hspace{0.3cm}{\ttfamily [private]}}



Sum of all coefficients over all TF1. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00141}{141}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_ab5692081772ca14bd012eb125e2ccfd4}\label{classSMonolith_ab5692081772ca14bd012eb125e2ccfd4}} 
\index{SMonolith@{SMonolith}!SaveSplineFile@{SaveSplineFile}}
\index{SaveSplineFile@{SaveSplineFile}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{SaveSplineFile}{SaveSplineFile}}
{\footnotesize\ttfamily bool SMonolith\+::\+Save\+Spline\+File\hspace{0.3cm}{\ttfamily [private]}}



Flag telling whether we are saving spline monolith into handy root file. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00171}{171}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}\label{classSMonolith_a53ab5b2235fd697f27556f1a1a7a5354}} 
\index{SMonolith@{SMonolith}!segments@{segments}}
\index{segments@{segments}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{segments}{segments}}
{\footnotesize\ttfamily short int$\ast$ SMonolith\+::segments\hspace{0.3cm}{\ttfamily [private]}}



Store currently found segment they are not in \mbox{\hyperlink{structFastSplineInfo}{Fast\+Spline\+Info}} as in case of GPU we need to copy paste it to GPU. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00113}{113}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_a50a4ad58aebffdb820626f855bae6821}\label{classSMonolith_a50a4ad58aebffdb820626f855bae6821}} 
\index{SMonolith@{SMonolith}!SplineInfoArray@{SplineInfoArray}}
\index{SplineInfoArray@{SplineInfoArray}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{SplineInfoArray}{SplineInfoArray}}
{\footnotesize\ttfamily \mbox{\hyperlink{structFastSplineInfo}{Fast\+Spline\+Info}}$\ast$ SMonolith\+::\+Spline\+Info\+Array\hspace{0.3cm}{\ttfamily [private]}}

Array of \mbox{\hyperlink{structFastSplineInfo}{Fast\+Spline\+Info}} structs\+: keeps information on each xsec spline for fast evaluation Method identical to TSpline3\+::\+Eval(double) but faster because less operations 

Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00111}{111}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_afa782652b0b3da923c5b20bb1319aadd}\label{classSMonolith_afa782652b0b3da923c5b20bb1319aadd}} 
\index{SMonolith@{SMonolith}!splineParsPointer@{splineParsPointer}}
\index{splineParsPointer@{splineParsPointer}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{splineParsPointer}{splineParsPointer}}
{\footnotesize\ttfamily std\+::vector$<$ const double$\ast$ $>$ SMonolith\+::spline\+Pars\+Pointer\hspace{0.3cm}{\ttfamily [private]}}



This holds pointer to parameter position which we later copy paste it to GPU. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00117}{117}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.

\mbox{\Hypertarget{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}\label{classSMonolith_aa2a793b82a6c650a6fad52510e49b6b0}} 
\index{SMonolith@{SMonolith}!vals@{vals}}
\index{vals@{vals}!SMonolith@{SMonolith}}
\doxysubsubsection{\texorpdfstring{vals}{vals}}
{\footnotesize\ttfamily float$\ast$ SMonolith\+::vals\hspace{0.3cm}{\ttfamily [private]}}



Store parameter values they are not in \mbox{\hyperlink{structFastSplineInfo}{Fast\+Spline\+Info}} as in case of GPU we need to copy paste it to GPU. 



Definition at line \mbox{\hyperlink{SplineMonolith_8h_source_l00115}{115}} of file \mbox{\hyperlink{SplineMonolith_8h_source}{Spline\+Monolith.\+h}}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/runner/work/\+Ma\+Ch3/\+Ma\+Ch3/splines/\mbox{\hyperlink{SplineMonolith_8h}{Spline\+Monolith.\+h}}\item 
/home/runner/work/\+Ma\+Ch3/\+Ma\+Ch3/splines/\mbox{\hyperlink{SplineMonolith_8cpp}{Spline\+Monolith.\+cpp}}\end{DoxyCompactItemize}
