import os
import ctypes
import glob

## where are we????
mach3_dir = f"{os.path.join(os.path.split(os.path.realpath(__file__))[0])}"
lib_dir = f"{mach3_dir}/lib"

## load up root libraries
ctypes.cdll.LoadLibrary(f'/home/ewan/ROOT/root/lib/libTree.so')
ctypes.cdll.LoadLibrary(f'/home/ewan/ROOT/root/lib/libGpad.so')
ctypes.cdll.LoadLibrary(f'/home/ewan/ROOT/root/lib/libHist.so')
ctypes.cdll.LoadLibrary(f'/home/ewan/ROOT/root/lib/libCore.so')

## load all the core libraries
ctypes.cdll.LoadLibrary(f'{lib_dir}/core/libyaml-cpp.so')
ctypes.cdll.LoadLibrary(f'{lib_dir}/core/libOscProbCalcer.so')
ctypes.cdll.LoadLibrary(f'{lib_dir}/core/libOscillator.so')
ctypes.cdll.LoadLibrary(f'{lib_dir}/core/libManager.so')
ctypes.cdll.LoadLibrary(f'{lib_dir}/core/libSplineDict.so')
ctypes.cdll.LoadLibrary(f'{lib_dir}/core/libParameters.so')
ctypes.cdll.LoadLibrary(f'{lib_dir}/core/libSplines.so')
ctypes.cdll.LoadLibrary(f'{lib_dir}/core/libSamples.so')
ctypes.cdll.LoadLibrary(f'{lib_dir}/core/libFitters.so')
ctypes.cdll.LoadLibrary(f'{lib_dir}/core/libPlotting.so')

## search for any experiment specific libraries
other_libs = [@LINK_TARGET_LIB_LIST@]

print(other_libs)

for lib in other_libs:
    ctypes.cdll.LoadLibrary(f"{lib_dir}/other/lib{lib}.so")

ctypes.cdll.LoadLibrary(f'@ROOT_LIBRARY_DIR@/libCore.so')
ctypes.cdll.LoadLibrary(f'@ROOT_LIBRARY_DIR@/libTree.so')

## set the MaCh3 environment var
os.environ["MaCh3_ROOT"] = "@MaCh3_BUILD_PATH@"

from ._pyMaCh3 import __doc__, fitters, manager, plotting, samples, splines, parameters @PYMACH3_ADDITIONAL_MODULE_IMPORT@

__all__ = ["__doc__", "fitters", "manager", "plotting", "samples", "splines", "parameters" @PYMACH3_ADDITIONAL_MODULE_NAMES@]
