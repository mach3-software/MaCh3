<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MaCh3: Containers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="MaCh3.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mach3logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MaCh3
   &#160;<span id="projectnumber">2.4.2</span>
   </div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Containers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_Doc_User_Guide_12__Containers"></a></p>
<p>MaCh3 containers are stored in <a href="https://github.com/mach3-software/MaCh3/pkgs/container/mach3">https://github.com/mach3-software/MaCh3/pkgs/container/mach3</a></p>
<h1><a class="anchor" id="autotoc_md167"></a>
Setting up</h1>
<p>If you are on cluster then due to security reasons most likely you will have singularity or apptainer, in VERY rare cases docker. If you want to setup on your private machine then use the following.</p>
<h2><a class="anchor" id="autotoc_md168"></a>
Linux Users</h2>
<p>Install docker or podman via your distribution package manager, instructions below: YOU ONLY NEED ONE OF THE THREE docker: <a href="https://docs.docker.com/engine/install/">https://docs.docker.com/engine/install/</a></p>
<p>OR docker-desktop: <a href="https://docs.docker.com/desktop/install/linux-install/">https://docs.docker.com/desktop/install/linux-install/</a></p>
<p>OR podman: <a href="https://podman.io/docs/installation">https://podman.io/docs/installation</a></p>
<p>docker-desktop might be slightly easier to use for those not as comfortable sysadmining linux.</p>
<h2><a class="anchor" id="autotoc_md169"></a>
Mac Users:</h2>
<p>Install orbstack or docker-desktop. I highly recommend orbstack over docker-desktop: <a href="https://orbstack.dev/download">https://orbstack.dev/download</a></p>
<p>Select the right version for your mac architecture </p>
<h2><a class="anchor" id="autotoc_md170"></a>
Windows Users:</h2>
<p>Install docker-desktop: <a href="https://docs.docker.com/desktop/install/windows-install/">https://docs.docker.com/desktop/install/windows-install/</a></p>
<h1><a class="anchor" id="autotoc_md171"></a>
How to use</h1>
<h2><a class="anchor" id="autotoc_md172"></a>
Docker</h2>
<p>To pull: <code>docker pull ghcr.io/mach3-software/mach3:alma9latest</code><br  />
 now that you have pulled it use: <code>docker run -it --name mach3-container ghcr.io/mach3-software/mach3:alma9latest</code><br  />
 Congratulations you just entered MaCh3 container<br  />
</p>
<p>If encountering any access issues please use: </p><div class="fragment"><div class="line">export CR_PAT=&lt;TOKEN&gt;</div>
<div class="line">echo $CR_PAT | docker login ghcr.io -u USERNAME --password-stdin</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md173"></a>
Singularity</h2>
<p>To pull: <code>singularity pull docker://ghcr.io/mach3-software/mach3:alma9latest</code><br  />
 now that you pulled it use: <code>singularity shell mach3_alma9latest.sif</code><br  />
 Congratulations you just entered MaCh3 container<br  />
 now </p><div class="fragment"><div class="line">cd ${MACH3_INSTALL_DIR}</div>
<div class="line">source bin/setup.MaCh3.sh</div>
</div><!-- fragment --><p> Your MaCh3 is setup and ready.</p>
<p>If encountering any access issues please use: </p><div class="fragment"><div class="line">export SINGULARITY_DOCKER_USERNAME=&lt;USERNAME&gt;</div>
<div class="line">export SINGULARITY_DOCKER_PASSWORD=&lt;TOKEN&gt;</div>
</div><!-- fragment --><p>Alternatively, you can treat the container as a black box and execute exe inside the container like this. </p><div class="fragment"><div class="line">singularity exec &lt;my_container.sif&gt; do_something.exe /path/to/input &lt;arguments&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md174"></a>
Words of caution</h2>
<p>They are ephemeral: When you exit the main container process, everything is thrown away. Don't expect changes you make to the container image to persist in different containers from the same image.</p>
<h2><a class="anchor" id="autotoc_md175"></a>
Build experiment specific MaCh3 using Core as base</h2>
<p>Docker allow</p>
<p>#Use MaCh3 container as a base FROM ghcr.io/mach3-software/mach3:alma9latest AS mach3t2k_build </p><div class="fragment"><div class="line">// Clone Your MaCh3</div>
<div class="line">RUN git XXXXXXX.YourMaCh3.git</div>
<div class="line">// cmake</div>
<div class="line">RUN cmake ../</div>
<div class="line">// compile</div>
<div class="line">RUN make &amp;&amp; make install</div>
</div><!-- fragment --><p>For more see <a href="https://github.com/KSkwarczynski/OA_Docker/blob/main/MaCh3T2K/Dockerfile">https://github.com/KSkwarczynski/OA_Docker/blob/main/MaCh3T2K/Dockerfile</a></p>
<h2><a class="anchor" id="autotoc_md176"></a>
GPU</h2>
<p>TODO!!!</p>
<h2><a class="anchor" id="autotoc_md177"></a>
Acknowledgments</h2>
<p>Highly inspired by lessons from Luke Pickering </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- Footer for MaCh3 Doxygen documentation -->
<footer class="mach3-footer" style="text-align: center;">
    <div style="margin-bottom: 15px;">
        <span style="font-weight: bold;">The MaCh3 Collaboration</span>
    </div>
    <!-- Dropdown to jump between doc versions -->
    <div style="margin-bottom: 10px;">
        <span>Select Software Version: </span>
        <select id="versionSelector" onchange="window.location.href=this.value" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="">-- Select --</option>
            <option value="https://mach3-software.github.io/MaCh3/">develop</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.4.0/index.html">v2.4.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.3.0/index.html">v2.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.2.0/index.html">v2.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.1.0/index.html">v2.1.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.0.0/index.html">v2.0.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.5.0/index.html">v1.5.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.4.0/index.html">v1.4.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.3.0/index.html">v1.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.2.0/index.html">v1.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.1.0/index.html">v1.1.0</option>
        </select>
    </div>
    <!-- Footer info about doxygen -->
    <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
        Documentation generated with
        <a href="https://www.doxygen.nl/" target="_blank" style="color: #666;">Doxygen</a>
        <span id="doxygenVersion"></span>
    </div>
    <!-- Now grab doxygen version from metadata -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const meta = document.querySelector('meta[name="generator"]');
        if (meta) {
            const version = meta.getAttribute("content").replace("Doxygen ", "");
            document.getElementById("doxygenVersion").textContent = " " + version;
        }
    });
    </script>
</footer>
