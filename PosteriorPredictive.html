<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MaCh3: Posterior Predictive</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="MaCh3.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mach3logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MaCh3
   &#160;<span id="projectnumber">2.4.2</span>
   </div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Posterior Predictive </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_Doc_User_Guide_10__Posterior_Predictive__pâvalue_etc_"></a></p>
<h1><a class="anchor" id="autotoc_md153"></a>
Prior and Posterior Predictive Distributions</h1>
<p>we will consider the predictive distributions of the number of events $Z$. The prior predictive distribution of $Z$ is given by:</p>
<p>$$ p(Z) = \int_{\vec{\theta}} p(\vec{\theta}) \, p(Z \mid \vec{\theta}) \, d\vec{\theta}. $$</p>
<p>where $p( \vec{\theta} )$ is the same prior probability as in Bayes' theorem. We use the following procedure to obtain the prior predictive distribution:</p>
<ol type="1">
<li>Throw values of the parameters using their prior distributions.</li>
<li>Reweight MC to the selected parameters values. Reweighted MC is usually called a toy MC.</li>
<li>From multiple toy MCs, we obtain the mean value of the number of events (Z).</li>
</ol>
<p>After the fit, we can predict the observable $Z_{pred}$, which estimates the expected measurement of the same physical process as $Z$. This is knows as posterior predictive distribution $p(Z_{pred}|Z)$ and can be expressed as~$$ p(Z_{pred} Z) = \int_{\vec{\theta}} p(Z_{pred}|\vec{\theta}) \, p(\vec{\theta}|Z) \, d\vec{\theta}. $$</p>
<p>where $p(\vec{\theta}|Z)$ is the posterior probability. We obtain the posterior predictive distribution with the following steps:</p>
<ol type="1">
<li>Sample the posterior probability distribution by randomly selecting steps, to get $(\vec{\theta})$ associated with the selected step.</li>
<li>Reweight MC to the selected parameters values.</li>
<li>From multiple toy MCs, we obtain the mean value of the number of events $(Z_{pred})$.</li>
</ol>
<p>Figure shows the prior and posterior predictive distributions of the number of events. The prior predictive distribution is very wide compared to the posterior predictive distribution, and the relative error on the number of events for this sample has been reduced from 14% to 0.7%, which demonstrates how fit can reduce uncertainties.</p>
<p><img src="https://github.com/user-attachments/assets/eee1c0bb-b14a-4f1f-9063-3e84f7a3ab12" alt="image" width="1352" height="554" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md154"></a>
Posterior Predictive p-value</h1>
<p>Bayesian posterior predictive $p$-value is meant to estimate how likely we are to observe the data described by our postfit model if we were to take the same amount of data again. Therefore, it is a much more `&lsquo;demanding&rsquo;' $p$-value test than the frequentist $p$-value, which uses the larger prior parameter phase space.</p>
<p>Firstly, an ensemble of parameter values explored by the MCMC, once the stationary state has been reached, is used. We draw parameter values from a random MCMC step after <em>burn-in</em> stage and build the predictions for each sample (by reweighting the nominal MC to drawn parameters values). Then, we statistically fluctuate the drawn prediction by applying Poissonian smearing to each bin. Afterwards, for each sample, we calculate -2LLH between the drawn prediction and its statistical fluctuation: <em>-LLH(Draw Fluc, Draw)</em>, and similarly between the drawn prediction and the data distribution: <em>-LLH(Data, Draw)</em>. We repeat this process a few thousand times. An example of <em>-LLH(Data, Draw)</em> vs. <em>-2LLH(Draw Fluc, Draw)</em> is shown below.</p>
<p><img src="https://github.com/user-attachments/assets/519d4b46-5d11-402a-858b-9e9fc9daf99e" alt="image" width="771" height="557" class="inline"/></p>
<p>We identify two methods for calculating the $p$-value, statistically fluctuating two different distributions. The first method uses the prediction from the draw <em>-LLH(Draw Fluc, Draw)</em>, and the other uses the averaged prediction for all draws and its statistical fluctuation <em>-LLH(Pred Fluc, Draw)</em>. On average, we expect the $p$-value from the second method to be better.</p>
<h1><a class="anchor" id="autotoc_md155"></a>
References</h1>
<p>[1] Kamil Skwarczynski PhD thesis <br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- Footer for MaCh3 Doxygen documentation -->
<footer class="mach3-footer" style="text-align: center;">
    <div style="margin-bottom: 15px;">
        <span style="font-weight: bold;">The MaCh3 Collaboration</span>
    </div>
    <!-- Dropdown to jump between doc versions -->
    <div style="margin-bottom: 10px;">
        <span>Select Software Version: </span>
        <select id="versionSelector" onchange="window.location.href=this.value" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
            <option value="">-- Select --</option>
            <option value="https://mach3-software.github.io/MaCh3/">develop</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.4.0/index.html">v2.4.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.3.0/index.html">v2.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.2.0/index.html">v2.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.1.0/index.html">v2.1.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v2.0.0/index.html">v2.0.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.5.0/index.html">v1.5.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.4.0/index.html">v1.4.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.3.0/index.html">v1.3.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.2.0/index.html">v1.2.0</option>
            <option value="https://mach3-software.github.io/MaCh3/.Archive/v1.1.0/index.html">v1.1.0</option>
        </select>
    </div>
    <!-- Footer info about doxygen -->
    <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
        Documentation generated with
        <a href="https://www.doxygen.nl/" target="_blank" style="color: #666;">Doxygen</a>
        <span id="doxygenVersion"></span>
    </div>
    <!-- Now grab doxygen version from metadata -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const meta = document.querySelector('meta[name="generator"]');
        if (meta) {
            const version = meta.getAttribute("content").replace("Doxygen ", "");
            document.getElementById("doxygenVersion").textContent = " " + version;
        }
    });
    </script>
</footer>
