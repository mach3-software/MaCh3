<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MaCh3: python/splines.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="MaCh3.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="mach3logo_small.png"/></td>
  <td id="projectalign">
   <div id="projectname">MaCh3<span id="projectnumber">&#160;1.4.2</span>
   </div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_7837fde3ab9c1fb2fc5be7b717af8d79.html">python</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">splines.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;pybind11/pybind11.h&gt;</code><br />
<code>#include &lt;pybind11/stl.h&gt;</code><br />
<code>#include &lt;pybind11/numpy.h&gt;</code><br />
<code>#include &quot;<a class="el" href="SplineBase_8h_source.html">splines/SplineBase.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="SplineMonolith_8h_source.html">splines/SplineMonolith.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="SplineStructs_8h_source.html">splines/SplineStructs.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Structs_8h_source.html">samplePDF/Structs.h</a>&quot;</code><br />
<code>#include &quot;TSpline.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for splines.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="splines_8cpp__incl.png" border="0" usemap="#apython_2splines_8cpp" alt=""/></div>
<map name="apython_2splines_8cpp" id="apython_2splines_8cpp">
<area shape="rect" title=" " alt="" coords="1127,5,1271,31"/>
<area shape="rect" title=" " alt="" coords="634,79,793,104"/>
<area shape="rect" title=" " alt="" coords="817,79,932,104"/>
<area shape="rect" title=" " alt="" coords="956,79,1097,104"/>
<area shape="rect" href="SplineBase_8h.html" title=" " alt="" coords="799,152,955,177"/>
<area shape="rect" href="SplineStructs_8h.html" title="Contains structures and helper functions for handling spline representations of systematic parameters..." alt="" coords="1429,225,1598,251"/>
<area shape="rect" href="Structs_8h.html" title=" " alt="" coords="1361,592,1519,617"/>
<area shape="rect" title=" " alt="" coords="1055,665,1137,691"/>
<area shape="rect" href="SplineMonolith_8h.html" title=" " alt="" coords="1172,79,1353,104"/>
<area shape="rect" title=" " alt="" coords="43,665,109,691"/>
<area shape="rect" title=" " alt="" coords="40,959,115,984"/>
<area shape="rect" href="MaCh3Logger_8h.html" title="KS: Based on this https://github.com/gabime/spdlog/blob/a2b4262090fd3f005c2315dcb5be2f0f1774a005/incl..." alt="" coords="893,812,1077,837"/>
<area shape="rect" title=" " alt="" coords="965,665,1030,691"/>
<area shape="rect" title=" " alt="" coords="768,665,837,691"/>
<area shape="rect" title=" " alt="" coords="633,665,743,691"/>
<area shape="rect" href="SplineCommon_8h.html" title="Contains definitions for spline coefficients and structure used in both CPU and GPU code." alt="" coords="991,225,1174,251"/>
<area shape="rect" title=" " alt="" coords="1199,225,1265,251"/>
<area shape="rect" title=" " alt="" coords="1289,225,1353,251"/>
<area shape="rect" title=" " alt="" coords="408,225,488,251"/>
<area shape="rect" title=" " alt="" coords="513,225,602,251"/>
<area shape="rect" title=" " alt="" coords="626,225,715,251"/>
<area shape="rect" title=" " alt="" coords="740,225,815,251"/>
<area shape="rect" title=" " alt="" coords="544,959,624,984"/>
<area shape="rect" title=" " alt="" coords="875,959,949,984"/>
<area shape="rect" title=" " alt="" coords="869,885,955,911"/>
<area shape="rect" title=" " alt="" coords="437,885,496,911"/>
<area shape="rect" title=" " alt="" coords="979,885,1066,911"/>
<area shape="rect" href="Core_8h.html" title=" " alt="" coords="521,885,647,911"/>
<area shape="rect" title=" " alt="" coords="1142,885,1266,911"/>
<area shape="rect" title=" " alt="" coords="211,959,285,984"/>
<area shape="rect" title=" " alt="" coords="383,959,446,984"/>
<area shape="rect" title=" " alt="" coords="1594,959,1657,984"/>
<area shape="rect" href="covarianceXsec_8h.html" title=" " alt="" coords="1336,299,1547,324"/>
<area shape="rect" href="covarianceBase_8h.html" title=" " alt="" coords="779,372,991,397"/>
<area shape="rect" href="manager_8h.html" title=" " alt="" coords="601,519,754,544"/>
<area shape="rect" href="CovarianceUtils_8h.html" title=" " alt="" coords="818,519,1030,544"/>
<area shape="rect" href="AdaptiveMCMCHandler_8h.html" title=" " alt="" coords="509,445,768,471"/>
<area shape="rect" href="PCAHandler_8h.html" title=" " alt="" coords="793,445,978,471"/>
<area shape="rect" href="MaCh3Exception_8h.html" title=" " alt="" coords="589,739,795,764"/>
<area shape="rect" href="YamlHelper_8h.html" title="Utility functions for handling YAML nodes." alt="" coords="337,665,506,691"/>
<area shape="rect" href="Monitor_8h.html" title="System and monitoring utilities for printing system information and status updates." alt="" coords="187,592,333,617"/>
<area shape="rect" title=" " alt="" coords="1897,665,1940,691"/>
<area shape="rect" title=" " alt="" coords="1964,665,2007,691"/>
<area shape="rect" title=" " alt="" coords="2031,665,2155,691"/>
<area shape="rect" title=" " alt="" coords="819,739,922,764"/>
<area shape="rect" title=" " alt="" coords="1313,665,1372,691"/>
<area shape="rect" title=" " alt="" coords="1397,665,1483,691"/>
<area shape="rect" title=" " alt="" coords="1507,665,1567,691"/>
<area shape="rect" title=" " alt="" coords="1591,665,1822,691"/>
<area shape="rect" title=" " alt="" coords="691,812,778,837"/>
</map>
</div>
</div>
<p><a href="splines_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPySplineBase.html">PySplineBase</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac852d821e532f068df6194c6da0a7ad5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="splines_8cpp.html#ac852d821e532f068df6194c6da0a7ad5">initSplines</a> (py::module &amp;m)</td></tr>
<tr class="separator:ac852d821e532f068df6194c6da0a7ad5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ac852d821e532f068df6194c6da0a7ad5" name="ac852d821e532f068df6194c6da0a7ad5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac852d821e532f068df6194c6da0a7ad5">&#9670;&#160;</a></span>initSplines()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initSplines </td>
          <td>(</td>
          <td class="paramtype">py::module &amp;&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="splines_8cpp_source.html#l00072">72</a> of file <a class="el" href="splines_8cpp_source.html">splines.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   72</span>                             {</div>
<div class="line"><span class="lineno">   73</span> </div>
<div class="line"><span class="lineno">   74</span>    <span class="keyword">auto</span> m_splines = m.def_submodule(<span class="stringliteral">&quot;splines&quot;</span>);</div>
<div class="line"><span class="lineno">   75</span>    m_splines.doc() = </div>
<div class="line"><span class="lineno">   76</span>        <span class="stringliteral">&quot;This is a Python binding of MaCh3s C++ based spline library.&quot;</span>;</div>
<div class="line"><span class="lineno">   77</span> </div>
<div class="line"><span class="lineno">   78</span>    <span class="comment">// Bind the interpolation type enum that lets us set different interpolation types for our splines</span></div>
<div class="line"><span class="lineno">   79</span>    py::enum_&lt;SplineInterpolation&gt;(m_splines, <span class="stringliteral">&quot;InterpolationType&quot;</span>)</div>
<div class="line"><span class="lineno">   80</span>            .value(<span class="stringliteral">&quot;Linear&quot;</span>, <a class="code hl_enumvalue" href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4ac188c019178783e5be55110601309d7d">SplineInterpolation::kLinear</a>, <span class="stringliteral">&quot;Linear interpolation between the knots&quot;</span>)</div>
<div class="line"><span class="lineno">   81</span>            .value(<span class="stringliteral">&quot;Linear_Func&quot;</span>, <a class="code hl_enumvalue" href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4ade75212a78a5cf860f84473a80355f42">SplineInterpolation::kLinearFunc</a>, <span class="stringliteral">&quot;Same as &#39;Linear&#39;&quot;</span>)</div>
<div class="line"><span class="lineno">   82</span>            .value(<span class="stringliteral">&quot;Cubic_TSpline3&quot;</span>, <a class="code hl_enumvalue" href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4a56c886e7b34c938027a7140748999c8a">SplineInterpolation::kTSpline3</a>, <span class="stringliteral">&quot;Use same coefficients as `ROOT&#39;s TSpline3 &lt;https://root.cern.ch/doc/master/classTSpline3.html&gt;`_ implementation&quot;</span>)</div>
<div class="line"><span class="lineno">   83</span>            .value(<span class="stringliteral">&quot;Cubic_Monotonic&quot;</span>, <a class="code hl_enumvalue" href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4a68f4b10c9689389fd8fea39dc6c097d3">SplineInterpolation::kMonotonic</a>, <span class="stringliteral">&quot;Coefficients are calculated such that the segments between knots are forced to be monotonic. The implementation we use is based on `this method &lt;https://www.jstor.org/stable/2156610&gt;`_ by Fritsch and Carlson.&quot;</span>)</div>
<div class="line"><span class="lineno">   84</span>            .value(<span class="stringliteral">&quot;Cubic_Akima&quot;</span>, <a class="code hl_enumvalue" href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4afe5701215b64da0194c6fead25edd976">SplineInterpolation::kAkima</a>, <span class="stringliteral">&quot;The second derivative is not required to be continuous at the knots. This means that these splines are useful if the second derivative is rapidly varying. The implementation we used is based on `this paper &lt;http://www.leg.ufpr.br/lib/exe/fetch.php/wiki:internas:biblioteca:akima.pdf&gt;`_ by Akima.&quot;</span>)</div>
<div class="line"><span class="lineno">   85</span>            .value(<span class="stringliteral">&quot;N_Interpolation_Types&quot;</span>, <a class="code hl_enumvalue" href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4a9e1a345912f2baebd863ab7d40c9ab7b">SplineInterpolation::kSplineInterpolations</a>, <span class="stringliteral">&quot;This is only to be used when iterating and is not a valid interpolation type.&quot;</span>);</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span>    </div>
<div class="line"><span class="lineno">   88</span>    py::class_&lt;<a class="code hl_class" href="classSplineBase.html">SplineBase</a>, <a class="code hl_class" href="classPySplineBase.html">PySplineBase</a> <span class="comment">/* &lt;--- trampoline*/</span>&gt;(m_splines, <span class="stringliteral">&quot;SplineBase&quot;</span>);</div>
<div class="line"><span class="lineno">   89</span> </div>
<div class="line"><span class="lineno">   90</span>    py::class_&lt;TResponseFunction_red&gt;(m_splines, <span class="stringliteral">&quot;_ResponseFunctionBase&quot;</span>)</div>
<div class="line"><span class="lineno">   91</span>        .doc() = <span class="stringliteral">&quot;Base class of the response function, this binding only exists for consistency with the inheritance structure of the c++ code. Just pretend it doesn&#39;t exist and don&#39;t worry about it...&quot;</span>;</div>
<div class="line"><span class="lineno">   92</span> </div>
<div class="line"><span class="lineno">   93</span>    <span class="comment">// Bind the TSpline3_red class. Decided to go with a clearer name of ResponseFunction for the python binding</span></div>
<div class="line"><span class="lineno">   94</span>    <span class="comment">// and make the interface a bit more python-y. Additionally remove passing root stuff so we don&#39;t need to deal </span></div>
<div class="line"><span class="lineno">   95</span>    <span class="comment">// with root python binding and can just pass it native python objects.</span></div>
<div class="line"><span class="lineno">   96</span>    py::class_&lt;TSpline3_red, TResponseFunction_red, std::unique_ptr&lt;TSpline3_red, py::nodelete&gt;&gt;(m_splines, <span class="stringliteral">&quot;ResponseFunction&quot;</span>)</div>
<div class="line"><span class="lineno">   97</span>        .def(</div>
<div class="line"><span class="lineno">   98</span>            <span class="comment">// define a more python friendly constructor that massages the inputs and passes them</span></div>
<div class="line"><span class="lineno">   99</span>            <span class="comment">// through to the c++ constructor</span></div>
<div class="line"><span class="lineno">  100</span>            py::init</div>
<div class="line"><span class="lineno">  101</span>            (</div>
<div class="line"><span class="lineno">  102</span>                <span class="comment">// Just take in some vectors, then build a TSpline3 and pass this to the constructor</span></div>
<div class="line"><span class="lineno">  103</span>                [](std::vector&lt;double&gt; &amp;xVals, std::vector&lt;double&gt; &amp;yVals, <a class="code hl_enumeration" href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4">SplineInterpolation</a> interpType)</div>
<div class="line"><span class="lineno">  104</span>                {</div>
<div class="line"><span class="lineno">  105</span>                    <span class="keywordflow">if</span> ( xVals.size() != yVals.size() )</div>
<div class="line"><span class="lineno">  106</span>                    {</div>
<div class="line"><span class="lineno">  107</span>                        throw MaCh3Exception(__FILE__, __LINE__, <span class="stringliteral">&quot;Different number of x values and y values!&quot;</span>);</div>
<div class="line"><span class="lineno">  108</span>                    }</div>
<div class="line"><span class="lineno">  109</span> </div>
<div class="line"><span class="lineno">  110</span>                    <span class="keywordtype">int</span> length = <span class="keywordtype">int</span>(xVals.size());</div>
<div class="line"><span class="lineno">  111</span> </div>
<div class="line"><span class="lineno">  112</span>                    if (length == 1)</div>
<div class="line"><span class="lineno">  113</span>                    {</div>
<div class="line"><span class="lineno">  114</span>                        <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a> xKnot = <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a>(xVals[0]);</div>
<div class="line"><span class="lineno">  115</span>                        <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a> yKnot = <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a>(yVals[0]);</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>                        std::vector&lt;M3::float_t *&gt; pars;</div>
<div class="line"><span class="lineno">  118</span>                        pars.resize(3);</div>
<div class="line"><span class="lineno">  119</span>                        pars[0] = <span class="keyword">new</span> <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a>(0.0);</div>
<div class="line"><span class="lineno">  120</span>                        pars[1] = <span class="keyword">new</span> <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a>(0.0);</div>
<div class="line"><span class="lineno">  121</span>                        pars[2] = <span class="keyword">new</span> <a class="code hl_typedef" href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a>(0.0);</div>
<div class="line"><span class="lineno">  122</span>                        <span class="keyword">delete</span> pars[0];</div>
<div class="line"><span class="lineno">  123</span>                        <span class="keyword">delete</span> pars[1];</div>
<div class="line"><span class="lineno">  124</span>                        <span class="keyword">delete</span> pars[2];</div>
<div class="line"><span class="lineno">  125</span> </div>
<div class="line"><span class="lineno">  126</span>                        <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code hl_class" href="classTSpline3__red.html">TSpline3_red</a>(&amp;xKnot, &amp;yKnot, 1, pars.data());</div>
<div class="line"><span class="lineno">  127</span>                    }</div>
<div class="line"><span class="lineno">  128</span> </div>
<div class="line"><span class="lineno">  129</span>                    TSpline3 *splineTmp = <span class="keyword">new</span> TSpline3( <span class="stringliteral">&quot;spline_tmp&quot;</span>, xVals.data(), yVals.data(), length );</div>
<div class="line"><span class="lineno">  130</span>                    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code hl_class" href="classTSpline3__red.html">TSpline3_red</a>(splineTmp, interpType);</div>
<div class="line"><span class="lineno">  131</span>                }</div>
<div class="line"><span class="lineno">  132</span>            )</div>
<div class="line"><span class="lineno">  133</span>        )</div>
<div class="line"><span class="lineno">  134</span> </div>
<div class="line"><span class="lineno">  135</span>        .def(</div>
<div class="line"><span class="lineno">  136</span>            <span class="stringliteral">&quot;find_segment&quot;</span>, </div>
<div class="line"><span class="lineno">  137</span>            &amp;<a class="code hl_function" href="classTSpline3__red.html#a39668a1dc14058a1f833e9621ec19caf">TSpline3_red::FindX</a>, </div>
<div class="line"><span class="lineno">  138</span>            <span class="stringliteral">&quot;Find the segment that a particular *value* lies in. \n&quot;</span></div>
<div class="line"><span class="lineno">  139</span>            <span class="stringliteral">&quot;:param value: The value to test&quot;</span>,</div>
<div class="line"><span class="lineno">  140</span>            py::arg(<span class="stringliteral">&quot;value&quot;</span>)</div>
<div class="line"><span class="lineno">  141</span>        )</div>
<div class="line"><span class="lineno">  142</span> </div>
<div class="line"><span class="lineno">  143</span>        .def(</div>
<div class="line"><span class="lineno">  144</span>            <span class="stringliteral">&quot;evaluate&quot;</span>,</div>
<div class="line"><span class="lineno">  145</span>            &amp;<a class="code hl_function" href="classTSpline3__red.html#a12bb3549bacb76c7d04ee303c4abe389">TSpline3_red::Eval</a>,</div>
<div class="line"><span class="lineno">  146</span>            <span class="stringliteral">&quot;Evaluate the response function at a particular *value*. \n&quot;</span></div>
<div class="line"><span class="lineno">  147</span>            <span class="stringliteral">&quot;:param value: The value to evaluate at.&quot;</span>,</div>
<div class="line"><span class="lineno">  148</span>            py::arg(<span class="stringliteral">&quot;value&quot;</span>)</div>
<div class="line"><span class="lineno">  149</span>        )</div>
<div class="line"><span class="lineno">  150</span>    ; <span class="comment">// End of binding for ResponseFunction</span></div>
<div class="line"><span class="lineno">  151</span> </div>
<div class="line"><span class="lineno">  152</span>    py::class_&lt;SMonolith, SplineBase&gt;(m_splines, <span class="stringliteral">&quot;EventSplineMonolith&quot;</span>)</div>
<div class="line"><span class="lineno">  153</span>        .def(</div>
<div class="line"><span class="lineno">  154</span>            py::init(</div>
<div class="line"><span class="lineno">  155</span>                [](std::vector&lt;std::vector&lt;TResponseFunction_red*&gt;&gt; &amp;responseFns, <span class="keyword">const</span> <span class="keywordtype">bool</span> saveFlatTree)</div>
<div class="line"><span class="lineno">  156</span>                {</div>
<div class="line"><span class="lineno">  157</span>                    std::vector&lt;RespFuncType&gt; respFnTypes;</div>
<div class="line"><span class="lineno">  158</span>                    <span class="keywordflow">for</span>(uint i = 0; i &lt; responseFns[0].size(); i++)</div>
<div class="line"><span class="lineno">  159</span>                    {</div>
<div class="line"><span class="lineno">  160</span>                        <span class="comment">// ** WARNING **</span></div>
<div class="line"><span class="lineno">  161</span>                        <span class="comment">// Right now I&#39;m only pushing back TSpline3_reds as thats all thats supported right now</span></div>
<div class="line"><span class="lineno">  162</span>                        <span class="comment">// In the future there might be more</span></div>
<div class="line"><span class="lineno">  163</span>                        <span class="comment">// I think what would be best to do would be to store the interpolation type somehow in the ResponseFunction objects</span></div>
<div class="line"><span class="lineno">  164</span>                        <span class="comment">// then just read them here and pass through to the constructor</span></div>
<div class="line"><span class="lineno">  165</span>                        respFnTypes.push_back(<a class="code hl_enumvalue" href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da8bea6994e011cc85a5a88b50c97ce7b2">RespFuncType::kTSpline3_red</a>);</div>
<div class="line"><span class="lineno">  166</span>                    }</div>
<div class="line"><span class="lineno">  167</span>                    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code hl_class" href="classSMonolith.html">SMonolith</a>(responseFns, respFnTypes, saveFlatTree);</div>
<div class="line"><span class="lineno">  168</span>                }</div>
<div class="line"><span class="lineno">  169</span>            ),</div>
<div class="line"><span class="lineno">  170</span>            <span class="stringliteral">&quot;Create an EventSplineMonolith \n&quot;</span></div>
<div class="line"><span class="lineno">  171</span>            <span class="stringliteral">&quot;:param master_splines: These are the &#39;knot&#39; values to make splines from. This should be an P x E 2D list where P is the number of parameters and E is the number of events. \n&quot;</span></div>
<div class="line"><span class="lineno">  172</span>            <span class="stringliteral">&quot;:param save_flat_tree: Whether we want to save monolith into speedy flat tree&quot;</span>,</div>
<div class="line"><span class="lineno">  173</span>            py::arg(<span class="stringliteral">&quot;master_splines&quot;</span>),</div>
<div class="line"><span class="lineno">  174</span>            py::arg(<span class="stringliteral">&quot;save_flat_tree&quot;</span>) = false</div>
<div class="line"><span class="lineno">  175</span>        )</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>        .def(</div>
<div class="line"><span class="lineno">  178</span>            py::init&lt;std::string&gt;(),</div>
<div class="line"><span class="lineno">  179</span>            <span class="stringliteral">&quot;Constructor where you pass path to preprocessed root FileName which is generated by creating an EventSplineMonolith with the `save_flat_tree` flag set to True. \n&quot;</span></div>
<div class="line"><span class="lineno">  180</span>            <span class="stringliteral">&quot;:param file_name: The name of the file to read from.&quot;</span>,</div>
<div class="line"><span class="lineno">  181</span>            py::arg(<span class="stringliteral">&quot;file_name&quot;</span>)</div>
<div class="line"><span class="lineno">  182</span>        )</div>
<div class="line"><span class="lineno">  183</span> </div>
<div class="line"><span class="lineno">  184</span>        .def(</div>
<div class="line"><span class="lineno">  185</span>            <span class="stringliteral">&quot;evaluate&quot;</span>,</div>
<div class="line"><span class="lineno">  186</span>            &amp;<a class="code hl_function" href="classSMonolith.html#a3d1128bb78b165d94721407a124f516b">SMonolith::Evaluate</a>,</div>
<div class="line"><span class="lineno">  187</span>            <span class="stringliteral">&quot;Evaluate the splines at their current values.&quot;</span></div>
<div class="line"><span class="lineno">  188</span>        )</div>
<div class="line"><span class="lineno">  189</span> </div>
<div class="line"><span class="lineno">  190</span>        .def(</div>
<div class="line"><span class="lineno">  191</span>            <span class="stringliteral">&quot;sync_mem_transfer&quot;</span>,</div>
<div class="line"><span class="lineno">  192</span>            &amp;<a class="code hl_function" href="classSMonolith.html#a68e18d73ed1ac524ceaea79d2a5460ce">SMonolith::SynchroniseMemTransfer</a>,</div>
<div class="line"><span class="lineno">  193</span>            <span class="stringliteral">&quot;This is important when running on GPU. After calculations are done on GPU we copy memory to CPU. This operation is asynchronous meaning while memory is being copied some operations are being carried. Memory must be copied before actual reweight. This function make sure all has been copied.&quot;</span></div>
<div class="line"><span class="lineno">  194</span>        )</div>
<div class="line"><span class="lineno">  195</span> </div>
<div class="line"><span class="lineno">  196</span>        .def(</div>
<div class="line"><span class="lineno">  197</span>            <span class="stringliteral">&quot;get_event_weight&quot;</span>,</div>
<div class="line"><span class="lineno">  198</span>            &amp;<a class="code hl_function" href="classSMonolith.html#a51bbc20cfe4ebed21f6d9f91a86ea0ee">SMonolith::retPointer</a>,</div>
<div class="line"><span class="lineno">  199</span>            py::return_value_policy::reference,</div>
<div class="line"><span class="lineno">  200</span>            <span class="stringliteral">&quot;Get the weight of a particular event. \n&quot;</span></div>
<div class="line"><span class="lineno">  201</span>            <span class="stringliteral">&quot;:param event: The index of the event whose weight you would like.&quot;</span>,</div>
<div class="line"><span class="lineno">  202</span>            py::arg(<span class="stringliteral">&quot;event&quot;</span>)</div>
<div class="line"><span class="lineno">  203</span>        )</div>
<div class="line"><span class="lineno">  204</span> </div>
<div class="line"><span class="lineno">  205</span>        .def(</div>
<div class="line"><span class="lineno">  206</span>            <span class="stringliteral">&quot;set_param_value_array&quot;</span>,</div>
<div class="line"><span class="lineno">  207</span>            <span class="comment">// Wrap up the setSplinePointers method so that we can take in a numpy array and get </span></div>
<div class="line"><span class="lineno">  208</span>            <span class="comment">// pointers to it&#39;s sweet sweet data and use those pointers in the splineMonolith </span></div>
<div class="line"><span class="lineno">  209</span>            [](<a class="code hl_class" href="classSMonolith.html">SMonolith</a> &amp;self, py::array_t&lt;double, py::array::c_style&gt; &amp;array)</div>
<div class="line"><span class="lineno">  210</span>            {</div>
<div class="line"><span class="lineno">  211</span>                py::buffer_info bufInfo = array.request();</div>
<div class="line"><span class="lineno">  212</span> </div>
<div class="line"><span class="lineno">  213</span>                <span class="keywordflow">if</span> ( bufInfo.ndim != 1)</div>
<div class="line"><span class="lineno">  214</span>                {</div>
<div class="line"><span class="lineno">  215</span>                    <span class="keywordflow">throw</span> <a class="code hl_class" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__, __LINE__, <span class="stringliteral">&quot;Number of dimensions in parameter array must be one!&quot;</span>);</div>
<div class="line"><span class="lineno">  216</span>                }</div>
<div class="line"><span class="lineno">  217</span> </div>
<div class="line"><span class="lineno">  218</span>                <span class="keywordflow">if</span> ( bufInfo.shape[0] != self.<a class="code hl_function" href="classSplineBase.html#af825e2661f4a52c146973edf35de9afb">GetNParams</a>() )</div>
<div class="line"><span class="lineno">  219</span>                {</div>
<div class="line"><span class="lineno">  220</span>                    <span class="keywordflow">throw</span> <a class="code hl_class" href="classMaCh3Exception.html">MaCh3Exception</a>(__FILE__, __LINE__, <span class="stringliteral">&quot;Number of entries in parameter array must equal the number of parameters!&quot;</span>);</div>
<div class="line"><span class="lineno">  221</span>                }</div>
<div class="line"><span class="lineno">  222</span> </div>
<div class="line"><span class="lineno">  223</span>                std::vector&lt;const double *&gt; paramVec;</div>
<div class="line"><span class="lineno">  224</span>                paramVec.resize(self.<a class="code hl_function" href="classSplineBase.html#af825e2661f4a52c146973edf35de9afb">GetNParams</a>());</div>
<div class="line"><span class="lineno">  225</span> </div>
<div class="line"><span class="lineno">  226</span>                <span class="keywordflow">for</span>( <span class="keywordtype">int</span> idx = 0; idx &lt; self.<a class="code hl_function" href="classSplineBase.html#af825e2661f4a52c146973edf35de9afb">GetNParams</a>(); idx++ )</div>
<div class="line"><span class="lineno">  227</span>                {</div>
<div class="line"><span class="lineno">  228</span>                    <span class="comment">// booooo pointer arithmetic</span></div>
<div class="line"><span class="lineno">  229</span>                    paramVec[idx] = array.data() + idx;</div>
<div class="line"><span class="lineno">  230</span>                } </div>
<div class="line"><span class="lineno">  231</span> </div>
<div class="line"><span class="lineno">  232</span>                self.<a class="code hl_function" href="classSMonolith.html#a40f6b9256a18fa59009e5961aec776ff">setSplinePointers</a>(paramVec);</div>
<div class="line"><span class="lineno">  233</span>            },</div>
<div class="line"><span class="lineno">  234</span>            <span class="stringliteral">&quot;Set the array that the monolith should use to read parameter values from. \n&quot;</span></div>
<div class="line"><span class="lineno">  235</span>            <span class="stringliteral">&quot;Usage of this might vary a bit from what you&#39;re used to in python. \n&quot;</span></div>
<div class="line"><span class="lineno">  236</span>            <span class="stringliteral">&quot;Rather than just setting the values here, what you&#39;re really doing is setting pointers in the underlying c++ code. \n&quot;</span></div>
<div class="line"><span class="lineno">  237</span>            <span class="stringliteral">&quot;What that means is that you pass an array to this function like:: \n&quot;</span></div>
<div class="line"><span class="lineno">  238</span>            <span class="stringliteral">&quot;\n event_spline_monolith_instance.set_param_value_array(array) \n\n&quot;</span></div>
<div class="line"><span class="lineno">  239</span>            <span class="stringliteral">&quot;Then when you set values in that array as normal, they will also be updated inside of the event_spline_monolith_instance.&quot;</span>,</div>
<div class="line"><span class="lineno">  240</span>            py::arg(<span class="stringliteral">&quot;array&quot;</span>)</div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>        )</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>        .doc() = <span class="stringliteral">&quot;This &#39;monolith&#39; deals with event by event weighting using splines.&quot;</span></div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span>    ; <span class="comment">// End of binding for EventSplineMonolith</span></div>
<div class="line"><span class="lineno">  247</span>}</div>
<div class="ttc" id="aStructs_8h_html_a6720d732608767153550aebebcf8fbf4"><div class="ttname"><a href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4">SplineInterpolation</a></div><div class="ttdeci">SplineInterpolation</div><div class="ttdoc">Make an enum of the spline interpolation type.</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00128">Structs.h:128</a></div></div>
<div class="ttc" id="aStructs_8h_html_a6720d732608767153550aebebcf8fbf4a56c886e7b34c938027a7140748999c8a"><div class="ttname"><a href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4a56c886e7b34c938027a7140748999c8a">kTSpline3</a></div><div class="ttdeci">@ kTSpline3</div><div class="ttdoc">Default TSpline3 interpolation.</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00129">Structs.h:129</a></div></div>
<div class="ttc" id="aStructs_8h_html_a6720d732608767153550aebebcf8fbf4a68f4b10c9689389fd8fea39dc6c097d3"><div class="ttname"><a href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4a68f4b10c9689389fd8fea39dc6c097d3">kMonotonic</a></div><div class="ttdeci">@ kMonotonic</div><div class="ttdoc">EM: DOES NOT make the entire spline monotonic, only the segments.</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00131">Structs.h:131</a></div></div>
<div class="ttc" id="aStructs_8h_html_a6720d732608767153550aebebcf8fbf4a9e1a345912f2baebd863ab7d40c9ab7b"><div class="ttname"><a href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4a9e1a345912f2baebd863ab7d40c9ab7b">kSplineInterpolations</a></div><div class="ttdeci">@ kSplineInterpolations</div><div class="ttdoc">This only enumerates.</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00135">Structs.h:134</a></div></div>
<div class="ttc" id="aStructs_8h_html_a6720d732608767153550aebebcf8fbf4ac188c019178783e5be55110601309d7d"><div class="ttname"><a href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4ac188c019178783e5be55110601309d7d">kLinear</a></div><div class="ttdeci">@ kLinear</div><div class="ttdoc">Linear interpolation between knots.</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00130">Structs.h:130</a></div></div>
<div class="ttc" id="aStructs_8h_html_a6720d732608767153550aebebcf8fbf4ade75212a78a5cf860f84473a80355f42"><div class="ttname"><a href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4ade75212a78a5cf860f84473a80355f42">kLinearFunc</a></div><div class="ttdeci">@ kLinearFunc</div><div class="ttdoc">Liner interpolation using TF1 not spline.</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00133">Structs.h:133</a></div></div>
<div class="ttc" id="aStructs_8h_html_a6720d732608767153550aebebcf8fbf4afe5701215b64da0194c6fead25edd976"><div class="ttname"><a href="Structs_8h.html#a6720d732608767153550aebebcf8fbf4afe5701215b64da0194c6fead25edd976">kAkima</a></div><div class="ttdeci">@ kAkima</div><div class="ttdoc">EM: Akima spline iis allowed to be discontinuous in 2nd derivative and coefficients in any segment.</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00132">Structs.h:132</a></div></div>
<div class="ttc" id="aStructs_8h_html_a6a73aa1ad819973a9c421c17c2a7f36da8bea6994e011cc85a5a88b50c97ce7b2"><div class="ttname"><a href="Structs_8h.html#a6a73aa1ad819973a9c421c17c2a7f36da8bea6994e011cc85a5a88b50c97ce7b2">kTSpline3_red</a></div><div class="ttdeci">@ kTSpline3_red</div><div class="ttdoc">Uses TSpline3_red for interpolation.</div><div class="ttdef"><b>Definition:</b> <a href="Structs_8h_source.html#l00122">Structs.h:122</a></div></div>
<div class="ttc" id="aclassMaCh3Exception_html"><div class="ttname"><a href="classMaCh3Exception.html">MaCh3Exception</a></div><div class="ttdoc">Custom exception class for MaCh3 errors.</div><div class="ttdef"><b>Definition:</b> <a href="MaCh3Exception_8h_source.html#l00013">MaCh3Exception.h:13</a></div></div>
<div class="ttc" id="aclassPySplineBase_html"><div class="ttname"><a href="classPySplineBase.html">PySplineBase</a></div><div class="ttdef"><b>Definition:</b> <a href="splines_8cpp_source.html#l00019">splines.cpp:19</a></div></div>
<div class="ttc" id="aclassSMonolith_html"><div class="ttname"><a href="classSMonolith.html">SMonolith</a></div><div class="ttdoc">Even-by-event class calculating response for spline parameters. It is possible to use GPU acceleratio...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00012">SplineMonolith.h:12</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a3d1128bb78b165d94721407a124f516b"><div class="ttname"><a href="classSMonolith.html#a3d1128bb78b165d94721407a124f516b">SMonolith::Evaluate</a></div><div class="ttdeci">void Evaluate() override</div><div class="ttdoc">CW: This Eval should be used when using two separate x,{y,a,b,c,d} arrays to store the weights; proba...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l00901">SplineMonolith.cpp:901</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a40f6b9256a18fa59009e5961aec776ff"><div class="ttname"><a href="classSMonolith.html#a40f6b9256a18fa59009e5961aec776ff">SMonolith::setSplinePointers</a></div><div class="ttdeci">void setSplinePointers(std::vector&lt; const double * &gt; spline_ParsPointers)</div><div class="ttdoc">KS: Set pointers to spline params.</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00043">SplineMonolith.h:43</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a51bbc20cfe4ebed21f6d9f91a86ea0ee"><div class="ttname"><a href="classSMonolith.html#a51bbc20cfe4ebed21f6d9f91a86ea0ee">SMonolith::retPointer</a></div><div class="ttdeci">const float * retPointer(const int event)</div><div class="ttdoc">KS: Get pointer to total weight to make fit faster wrooom!</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8h_source.html#l00039">SplineMonolith.h:39</a></div></div>
<div class="ttc" id="aclassSMonolith_html_a68e18d73ed1ac524ceaea79d2a5460ce"><div class="ttname"><a href="classSMonolith.html#a68e18d73ed1ac524ceaea79d2a5460ce">SMonolith::SynchroniseMemTransfer</a></div><div class="ttdeci">void SynchroniseMemTransfer()</div><div class="ttdoc">KS: After calculations are done on GPU we copy memory to CPU. This operation is asynchronous meaning ...</div><div class="ttdef"><b>Definition:</b> <a href="SplineMonolith_8cpp_source.html#l01066">SplineMonolith.cpp:1066</a></div></div>
<div class="ttc" id="aclassSplineBase_html"><div class="ttname"><a href="classSplineBase.html">SplineBase</a></div><div class="ttdoc">Base class for calculating weight from spline.</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8h_source.html#l00026">SplineBase.h:26</a></div></div>
<div class="ttc" id="aclassSplineBase_html_af825e2661f4a52c146973edf35de9afb"><div class="ttname"><a href="classSplineBase.html#af825e2661f4a52c146973edf35de9afb">SplineBase::GetNParams</a></div><div class="ttdeci">short int GetNParams() const</div><div class="ttdoc">Get number of spline parameters.</div><div class="ttdef"><b>Definition:</b> <a href="SplineBase_8h_source.html#l00040">SplineBase.h:40</a></div></div>
<div class="ttc" id="aclassTSpline3__red_html"><div class="ttname"><a href="classTSpline3__red.html">TSpline3_red</a></div><div class="ttdoc">CW: Reduced TSpline3 class.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00234">SplineStructs.h:234</a></div></div>
<div class="ttc" id="aclassTSpline3__red_html_a12bb3549bacb76c7d04ee303c4abe389"><div class="ttname"><a href="classTSpline3__red.html#a12bb3549bacb76c7d04ee303c4abe389">TSpline3_red::Eval</a></div><div class="ttdeci">double Eval(double var) override</div><div class="ttdoc">CW: Evaluate the weight from a variation.</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00598">SplineStructs.h:598</a></div></div>
<div class="ttc" id="aclassTSpline3__red_html_a39668a1dc14058a1f833e9621ec19caf"><div class="ttname"><a href="classTSpline3__red.html#a39668a1dc14058a1f833e9621ec19caf">TSpline3_red::FindX</a></div><div class="ttdeci">int FindX(double x)</div><div class="ttdoc">Find the segment relevant to this variation in x See root/hist/hist/src/TSpline3FindX(double) or samp...</div><div class="ttdef"><b>Definition:</b> <a href="SplineStructs_8h_source.html#l00564">SplineStructs.h:564</a></div></div>
<div class="ttc" id="anamespaceM3_html_a1f95274549f25fc19fe7db343c8a7a68"><div class="ttname"><a href="namespaceM3.html#a1f95274549f25fc19fe7db343c8a7a68">M3::float_t</a></div><div class="ttdeci">double float_t</div><div class="ttdef"><b>Definition:</b> <a href="Core_8h_source.html#l00026">Core.h:26</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
